var Prototype={Version:"1.7_rc2",Browser:function(){var b=navigator.userAgent,c=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!c,Opera:c,WebKit:b.indexOf("AppleWebKit/")>-1,Gecko:b.indexOf("Gecko")>-1&&b.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(b)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var b=window.Element||window.HTMLElement;return!!(b&&b.prototype)}(),SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!==
"undefined")return true;var b=document.createElement("div"),c=document.createElement("form"),d=false;if(b.__proto__&&b.__proto__!==c.__proto__)d=true;return d}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(b){return b}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;
var Abstract={},Try={these:function(){for(var b,c=0,d=arguments.length;c<d;c++){var e=arguments[c];try{b=e();break}catch(f){}}return b}},Class=function(){function b(){}var c=function(){for(var d in{toString:1})if(d==="toString")return false;return true}();return{create:function(){function d(){this.initialize.apply(this,arguments)}var e=null,f=$A(arguments);if(Object.isFunction(f[0]))e=f.shift();Object.extend(d,Class.Methods);d.superclass=e;d.subclasses=[];if(e){b.prototype=e.prototype;d.prototype=
new b;e.subclasses.push(d)}e=0;for(var h=f.length;e<h;e++)d.addMethods(f[e]);if(!d.prototype.initialize)d.prototype.initialize=Prototype.emptyFunction;return d.prototype.constructor=d},Methods:{addMethods:function(d){var e=this.superclass&&this.superclass.prototype,f=Object.keys(d);if(c){d.toString!=Object.prototype.toString&&f.push("toString");d.valueOf!=Object.prototype.valueOf&&f.push("valueOf")}for(var h=0,g=f.length;h<g;h++){var i=f[h],j=d[i];if(e&&Object.isFunction(j)&&j.argumentNames()[0]==
"$super"){var k=j;j=function(l){return function(){return e[l].apply(this,arguments)}}(i).wrap(k);j.valueOf=k.valueOf.bind(k);j.toString=k.toString.bind(k)}this.prototype[i]=j}return this}}}}();
(function(){function b(p){switch(p){case null:return k;case void 0:return l}switch(typeof p){case "boolean":return o;case "number":return q;case "string":return t}return w}function c(p,s){for(var u in s)p[u]=s[u];return p}function d(p){return e("",{"":p},[])}function e(p,s,u){s=s[p];var v=typeof s;if(b(s)===w&&typeof s.toJSON==="function")s=s.toJSON(p);p=j.call(s);switch(p){case A:case z:case n:s=s.valueOf()}switch(s){case null:return"null";case true:return"true";case false:return"false"}v=typeof s;
switch(v){case "string":return s.inspect(true);case "number":return isFinite(s)?String(s):"null";case "object":v=0;for(var y=u.length;v<y;v++)if(u[v]===s)throw new TypeError;u.push(s);var x=[];if(p===m){v=0;for(y=s.length;v<y;v++){var B=e(v,s,u);x.push(typeof B==="undefined"?"null":B)}x="["+x.join(",")+"]"}else{var C=Object.keys(s);v=0;for(y=C.length;v<y;v++){p=C[v];B=e(p,s,u);typeof B!=="undefined"&&x.push(p.inspect(true)+":"+B)}x="{"+x.join(",")+"}"}u.pop();return x}}function f(p){return JSON.stringify(p)}
function h(p){if(b(p)!==w)throw new TypeError;var s=[],u;for(u in p)p.hasOwnProperty(u)&&s.push(u);return s}function g(p){return j.call(p)===m}function i(p){return typeof p==="undefined"}var j=Object.prototype.toString,k="Null",l="Undefined",o="Boolean",q="Number",t="String",w="Object",z="[object Boolean]",A="[object Number]",n="[object String]",m="[object Array]",r=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";if(typeof Array.isArray==
"function"&&Array.isArray([])&&!Array.isArray({}))g=Array.isArray;c(Object,{extend:c,inspect:function(p){try{if(i(p))return"undefined";if(p===null)return"null";return p.inspect?p.inspect():String(p)}catch(s){if(s instanceof RangeError)return"...";throw s;}},toJSON:r?f:d,toQueryString:function(p){return $H(p).toQueryString()},toHTML:function(p){return p&&p.toHTML?p.toHTML():String.interpret(p)},keys:Object.keys||h,values:function(p){var s=[],u;for(u in p)s.push(p[u]);return s},clone:function(p){return c({},
p)},isElement:function(p){return!!(p&&p.nodeType==1)},isArray:g,isHash:function(p){return p instanceof Hash},isFunction:function(p){return typeof p==="function"},isString:function(p){return j.call(p)===n},isNumber:function(p){return j.call(p)===A},isUndefined:i})})();
Object.extend(Function.prototype,function(){function b(e,f){for(var h=e.length,g=f.length;g--;)e[h+g]=f[g];return e}function c(e,f){e=d.call(e,0);return b(e,f)}var d=Array.prototype.slice;return{argumentNames:function(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e},bind:function(e){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var f=this,h=d.call(arguments,
1);return function(){var g=c(h,arguments);return f.apply(e,g)}},bindAsEventListener:function(e){var f=this,h=d.call(arguments,1);return function(g){g=b([g||window.event],h);return f.apply(e,g)}},curry:function(){if(!arguments.length)return this;var e=this,f=d.call(arguments,0);return function(){var h=c(f,arguments);return e.apply(this,h)}},delay:function(e){var f=this,h=d.call(arguments,1);e*=1E3;return window.setTimeout(function(){return f.apply(f,h)},e)},defer:function(){return this.delay.apply(this,
b([0.01],arguments))},wrap:function(e){var f=this;return function(){var h=b([f.bind(this)],arguments);return e.apply(this,h)}},methodize:function(){if(this._methodized)return this._methodized;var e=this;return this._methodized=function(){var f=b([this],arguments);return e.apply(null,f)}}}}());
(function(b){function c(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function d(){return this.toISOString()}if(!b.toISOString)b.toISOString=c;if(!b.toJSON)b.toJSON=d})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(b){return String(b).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(b,c){this.callback=b;this.frequency=c;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(b){this.currentlyExecuting=
false;throw b;}}});Object.extend(String,{interpret:function(b){return b==null?"":String(b)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function b(g){if(Object.isFunction(g))return g;var i=new Template(g);return function(j){return i.evaluate(j)}}function c(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function d(g){var i=this.strip().match(/([^?#]*)(#.*)?$/);if(!i)return{};return i[1].split(g||"&").inject({},function(j,k){if((k=k.split("="))[0]){var l=decodeURIComponent(k.shift()),o=k.length>1?k.join("="):k[0];if(o!=undefined)o=decodeURIComponent(o);if(l in j){Object.isArray(j[l])||
(j[l]=[j[l]]);j[l].push(o)}else j[l]=o}return j})}function e(g){var i=this.unfilterJSON(),j=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(j.test(i))i=i.replace(j,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});try{if(!g||i.isJSON())return eval("("+i+")")}catch(k){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function f(){var g=this.unfilterJSON();return JSON.parse(g)}var h=window.JSON&&
typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;return{gsub:function(g,i){var j="",k=this,l;i=b(i);if(Object.isString(g))g=RegExp.escape(g);if(!(g.length||g.source)){i=i("");return i+k.split("").join(i)+i}for(;k.length>0;)if(l=k.match(g)){j+=k.slice(0,l.index);j+=String.interpret(i(l));k=k.slice(l.index+l[0].length)}else{j+=k;k=""}return j},sub:function(g,i,j){i=b(i);j=Object.isUndefined(j)?1:j;return this.gsub(g,function(k){if(--j<0)return k[0];return i(k)})},scan:function(g,i){this.gsub(g,
i);return String(this)},truncate:function(g,i){g=g||30;i=Object.isUndefined(i)?"...":i;return this.length>g?this.slice(0,g-i.length)+i:String(this)},strip:String.prototype.trim||c,stripTags:function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripScripts:function(){return this.replace(RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var g=RegExp(Prototype.ScriptFragment,"im");return(this.match(RegExp(Prototype.ScriptFragment,"img"))||[]).map(function(i){return(i.match(g)||
["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(g){return eval(g)})},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},toQueryParams:d,parseQuery:d,toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(g){return g<
1?"":Array(g+1).join(this)},camelize:function(){return this.replace(/-+(.)?/g,function(g,i){return i?i.toUpperCase():""})},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/_/g,"-")},inspect:function(g){var i=this.replace(/[\x00-\x1f\\]/g,function(j){if(j in
String.specialChar)return String.specialChar[j];return"\\u00"+j.charCodeAt().toPaddedString(2,16)});if(g)return'"'+i.replace(/"/g,'\\"')+'"';return"'"+i.replace(/'/g,"\\'")+"'"},unfilterJSON:function(g){return this.replace(g||Prototype.JSONFilter,"$1")},isJSON:function(){var g=this;if(g.blank())return false;g=g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");g=g.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");g=g.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(g)},
evalJSON:h?f:e,include:function(g){return this.indexOf(g)>-1},startsWith:function(g){return this.lastIndexOf(g,0)===0},endsWith:function(g){var i=this.length-g.length;return i>=0&&this.indexOf(g,i)===i},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(g,i){return(new Template(this,i)).evaluate(g)}}}());
var Template=Class.create({initialize:function(b,c){this.template=b.toString();this.pattern=c||Template.Pattern},evaluate:function(b){if(b&&Object.isFunction(b.toTemplateReplacements))b=b.toTemplateReplacements();return this.template.gsub(this.pattern,function(c){if(b==null)return c[1]+"";var d=c[1]||"";if(d=="\\")return c[2];var e=b,f=c[3],h=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;c=h.exec(f);if(c==null)return d;for(;c!=null;){var g=c[1].startsWith("[")?c[2].replace(/\\\\]/g,"]"):c[1];e=e[g];if(null==
e||""==c[3])break;f=f.substring("["==c[3]?c[1].length:c[0].length);c=h.exec(f)}return d+String.interpret(e)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function b(i,j){i=i||Prototype.K;var k=true;this.each(function(l,o){k=k&&!!i.call(j,l,o);if(!k)throw $break;});return k}function c(i,j){i=i||Prototype.K;var k=false;this.each(function(l,o){if(k=!!i.call(j,l,o))throw $break;});return k}function d(i,j){i=i||Prototype.K;var k=[];this.each(function(l,o){k.push(i.call(j,l,o))});return k}function e(i,j){var k;this.each(function(l,o){if(i.call(j,l,o)){k=l;throw $break;}});return k}function f(i,j){var k=[];this.each(function(l,
o){i.call(j,l,o)&&k.push(l)});return k}function h(i){if(Object.isFunction(this.indexOf))if(this.indexOf(i)!=-1)return true;var j=false;this.each(function(k){if(k==i){j=true;throw $break;}});return j}function g(){return this.map()}return{each:function(i,j){var k=0;try{this._each(function(o){i.call(j,o,k++)})}catch(l){if(l!=$break)throw l;}return this},eachSlice:function(i,j,k){var l=-i,o=[],q=this.toArray();if(i<1)return q;for(;(l+=i)<q.length;)o.push(q.slice(l,l+i));return o.collect(j,k)},all:b,every:b,
any:c,some:c,collect:d,map:d,detect:e,findAll:f,select:f,filter:f,grep:function(i,j,k){j=j||Prototype.K;var l=[];if(Object.isString(i))i=RegExp(RegExp.escape(i));this.each(function(o,q){i.match(o)&&l.push(j.call(k,o,q))});return l},include:h,member:h,inGroupsOf:function(i,j){j=Object.isUndefined(j)?null:j;return this.eachSlice(i,function(k){for(;k.length<i;)k.push(j);return k})},inject:function(i,j,k){this.each(function(l,o){i=j.call(k,i,l,o)});return i},invoke:function(i){var j=$A(arguments).slice(1);
return this.map(function(k){return k[i].apply(k,j)})},max:function(i,j){i=i||Prototype.K;var k;this.each(function(l,o){l=i.call(j,l,o);if(k==null||l>=k)k=l});return k},min:function(i,j){i=i||Prototype.K;var k;this.each(function(l,o){l=i.call(j,l,o);if(k==null||l<k)k=l});return k},partition:function(i,j){i=i||Prototype.K;var k=[],l=[];this.each(function(o,q){(i.call(j,o,q)?k:l).push(o)});return[k,l]},pluck:function(i){var j=[];this.each(function(k){j.push(k[i])});return j},reject:function(i,j){var k=
[];this.each(function(l,o){i.call(j,l,o)||k.push(l)});return k},sortBy:function(i,j){return this.map(function(k,l){return{value:k,criteria:i.call(j,k,l)}}).sort(function(k,l){var o=k.criteria,q=l.criteria;return o<q?-1:o>q?1:0}).pluck("value")},toArray:g,entries:g,zip:function(){var i=Prototype.K,j=$A(arguments);if(Object.isFunction(j.last()))i=j.pop();var k=[this].concat(j).map($A);return this.map(function(l,o){return i(k.pluck(o))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+
this.toArray().inspect()+">"},find:e}}();function $A(b){if(!b)return[];if("toArray"in Object(b))return b.toArray();for(var c=b.length||0,d=Array(c);c--;)d[c]=b[c];return d}function $w(b){if(!Object.isString(b))return[];return(b=b.strip())?b.split(/\s+/):[]}Array.from=$A;
(function(){function b(j){for(var k=0,l=this.length;k<l;k++)j(this[k])}function c(){return g.call(this,0)}function d(j,k){k||(k=0);var l=this.length;if(k<0)k=l+k;for(;k<l;k++)if(this[k]===j)return k;return-1}function e(j,k){k=isNaN(k)?this.length:(k<0?this.length+k:k)+1;var l=this.slice(0,k).reverse().indexOf(j);return l<0?l:k-l-1}function f(){for(var j=g.call(this,0),k,l=0,o=arguments.length;l<o;l++){k=arguments[l];if(Object.isArray(k)&&!("callee"in k))for(var q=0,t=k.length;q<t;q++)j.push(k[q]);
else j.push(k)}return j}var h=Array.prototype,g=h.slice,i=h.forEach;i||(i=b);Object.extend(h,Enumerable);if(!h._reverse)h._reverse=h.reverse;Object.extend(h,{_each:i,clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(j){return j!=null})},flatten:function(){return this.inject([],function(j,k){if(Object.isArray(k))return j.concat(k.flatten());j.push(k);return j})},without:function(){var j=
g.call(arguments,0);return this.select(function(k){return!j.include(k)})},reverse:function(j){return(j===false?this.toArray():this)._reverse()},uniq:function(j){return this.inject([],function(k,l,o){if(0==o||(j?k.last()!=l:!k.include(l)))k.push(l);return k})},intersect:function(j){return this.uniq().findAll(function(k){return j.detect(function(l){return k===l})})},clone:c,toArray:c,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"}});if(function(){return[].concat(arguments)[0][0]!==
1}(1,2))h.concat=f;if(!h.indexOf)h.indexOf=d;if(!h.lastIndexOf)h.lastIndexOf=e})();function $H(b){return new Hash(b)}
var Hash=Class.create(Enumerable,function(){function b(){return Object.clone(this._object)}function c(d,e){if(Object.isUndefined(e))return d;return d+"="+encodeURIComponent(String.interpret(e))}return{initialize:function(d){this._object=Object.isHash(d)?d.toObject():Object.clone(d)},_each:function(d){for(var e in this._object){var f=this._object[e],h=[e,f];h.key=e;h.value=f;d(h)}},set:function(d,e){return this._object[d]=e},get:function(d){if(this._object[d]!==Object.prototype[d])return this._object[d]},
unset:function(d){var e=this._object[d];delete this._object[d];return e},toObject:b,toTemplateReplacements:b,keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(d){var e=this.detect(function(f){return f.value===d});return e&&e.key},merge:function(d){return this.clone().update(d)},update:function(d){return(new Hash(d)).inject(this,function(e,f){e.set(f.key,f.value);return e})},toQueryString:function(){return this.inject([],function(d,e){var f=encodeURIComponent(e.key),
h=e.value;if(h&&typeof h=="object"){if(Object.isArray(h))return d.concat(h.map(c.curry(f)))}else d.push(c(f,h));return d}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(d){return d.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:b,clone:function(){return new Hash(this)}}}());Hash.from=$H;
Object.extend(Number.prototype,function(){return{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(b,c){$R(0,this,true).each(b,c);return this},toPaddedString:function(b,c){var d=this.toString(c||10);return"0".times(b-d.length)+d},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}}}());function $R(b,c,d){return new ObjectRange(b,c,d)}
var ObjectRange=Class.create(Enumerable,function(){return{initialize:function(b,c,d){this.start=b;this.end=c;this.exclusive=d},_each:function(b){for(var c=this.start;this.include(c);){b(c);c=c.succ()}},include:function(b){if(b<this.start)return false;if(this.exclusive)return b<this.end;return b<=this.end}}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||
false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(b){this.responders._each(b)},register:function(b){this.include(b)||this.responders.push(b)},unregister:function(b){this.responders=this.responders.without(b)},dispatch:function(b,c,d,e){this.each(function(f){if(Object.isFunction(f[b]))try{f[b].apply(f,[c,d,e])}catch(h){}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(b){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,b||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,c,d){$super(d);this.transport=Ajax.getTransport();this.request(c)},request:function(b){this.url=b;this.method=this.options.method;b=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){b._method=this.method;this.method="post"}this.parameters=b;if(b=Object.toQueryString(b))if(this.method=="get")this.url+=(this.url.include("?")?"&":"?")+b;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))b+=
"&_=";try{var c=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(c);Ajax.Responders.dispatch("onCreate",this,c);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||b:null;this.transport.send(this.body);!this.options.asynchronous&&this.transport.overrideMimeType&&
this.onStateChange()}catch(d){this.dispatchException(d)}},onStateChange:function(){var b=this.transport.readyState;b>1&&!(b==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var b={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){b["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:
"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)b.Connection="close"}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(Object.isFunction(c.push))for(var d=0,e=c.length;d<e;d+=2)b[c[d]]=c[d+1];else $H(c).each(function(h){b[h.key]=h.value})}for(var f in b)this.transport.setRequestHeader(f,b[f])},success:function(){var b=this.getStatus();return!b||b>=200&&b<300},getStatus:function(){try{return this.transport.status||
0}catch(b){return 0}},respondToReadyState:function(b){b=Ajax.Request.Events[b];var c=new Ajax.Response(this);if(b=="Complete"){try{this._complete=true;(this.options["on"+c.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(c,c.headerJSON)}catch(d){this.dispatchException(d)}var e=c.getHeader("Content-type");if(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&e&&e.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))this.evalResponse()}try{(this.options["on"+
b]||Prototype.emptyFunction)(c,c.headerJSON);Ajax.Responders.dispatch("on"+b,this,c,c.headerJSON)}catch(f){this.dispatchException(f)}if(b=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var b=this.url.match(/^\s*https?:\/\/[^\/]*/);return!b||b[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(b){try{return this.transport.getResponseHeader(b)||
null}catch(c){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(b){this.dispatchException(b)}},dispatchException:function(b){(this.options.onException||Prototype.emptyFunction)(this,b);Ajax.Responders.dispatch("onException",this,b)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(b){this.request=b;b=this.transport=b.transport;var c=this.readyState=b.readyState;if(c>2&&!Prototype.Browser.IE||c==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(b.responseText);this.headerJSON=this._getHeaderJSON()}if(c==4){b=b.responseXML;this.responseXML=Object.isUndefined(b)?null:b;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,
getStatusText:function(){try{return this.transport.statusText||""}catch(b){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(b){return null}},getResponseHeader:function(b){return this.transport.getResponseHeader(b)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var b=this.getHeader("X-JSON");if(!b)return null;b=decodeURIComponent(escape(b));try{return b.evalJSON(this.request.options.sanitizeJSON||
!this.request.isSameOrigin())}catch(c){this.request.dispatchException(c)}},_getResponseJSON:function(){var b=this.request.options;if(!b.evalJSON||b.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(b.sanitizeJSON||!this.request.isSameOrigin())}catch(c){this.request.dispatchException(c)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,c,d,e){this.container={success:c.success||c,failure:c.failure||(c.success?null:c)};e=Object.clone(e);var f=e.onComplete;e.onComplete=function(h,g){this.updateContent(h.responseText);Object.isFunction(f)&&f(h,g)}.bind(this);$super(d,e)},updateContent:function(b){var c=this.container[this.success()?"success":"failure"],d=this.options;d.evalScripts||(b=b.stripScripts());if(c=$(c))if(d.insertion)if(Object.isString(d.insertion)){var e=
{};e[d.insertion]=b;c.insert(e)}else d.insertion(c,b);else c.update(b)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,c,d,e){$super(e);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=c;this.url=d;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(b){if(this.options.decay){this.decay=b.responseText==this.lastText?this.decay*this.options.decay:1;this.lastText=b.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(b){if(arguments.length>1){for(var c=0,d=[],e=arguments.length;c<e;c++)d.push($(arguments[c]));return d}if(Object.isString(b))b=document.getElementById(b);return Element.extend(b)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(b,c){for(var d=[],e=document.evaluate(b,$(c)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),f=0,h=e.snapshotLength;f<h;f++)d.push(Element.extend(e.snapshotItem(f)));return d};Node||(Node={});
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(b){var c=function(){try{var e=document.createElement('<input name="x">');return e.tagName.toLowerCase()==="input"&&e.name==="x"}catch(f){return false}}(),d=b.Element;b.Element=function(e,f){f=f||{};e=e.toLowerCase();var h=Element.cache;if(c&&f.name){e="<"+e+' name="'+f.name+'">';delete f.name;return Element.writeAttribute(document.createElement(e),f)}h[e]||(h[e]=Element.extend(document.createElement(e)));return Element.writeAttribute(h[e].cloneNode(false),f)};Object.extend(b.Element,d||
{});if(d)b.Element.prototype=d.prototype})(this);Element.idCounter=1;Element.cache={};function purgeElement(b){var c=b._prototypeUID;if(c){Element.stopObserving(b);b._prototypeUID=void 0;delete Element.Storage[c]}}
Element.Methods={visible:function(b){return $(b).style.display!="none"},toggle:function(b){b=$(b);Element[Element.visible(b)?"hide":"show"](b);return b},hide:function(b){b=$(b);b.style.display="none";return b},show:function(b){b=$(b);b.style.display="";return b},remove:function(b){b=$(b);b.parentNode.removeChild(b);return b},update:function(){var b=function(){var e=document.createElement("select"),f=true;e.innerHTML='<option value="test">test</option>';if(e.options&&e.options[0])f=e.options[0].nodeName.toUpperCase()!==
"OPTION";return f}(),c=function(){try{var e=document.createElement("table");if(e&&e.tBodies){e.innerHTML="<tbody><tr><td>test</td></tr></tbody>";return typeof e.tBodies[0]=="undefined"}}catch(f){return true}}(),d=function(){var e=document.createElement("script"),f=false;try{e.appendChild(document.createTextNode(""));f=!e.firstChild||e.firstChild&&e.firstChild.nodeType!==3}catch(h){f=true}return f}();return function(e,f){e=$(e);for(var h=e.getElementsByTagName("*"),g=h.length;g--;)purgeElement(h[g]);
if(f&&f.toElement)f=f.toElement();if(Object.isElement(f))return e.update().insert(f);f=Object.toHTML(f);h=e.tagName.toUpperCase();if(h==="SCRIPT"&&d){e.text=f;return e}if(b||c)if(h in Element._insertionTranslations.tags){for(;e.firstChild;)e.removeChild(e.firstChild);Element._getContentFromAnonymousElement(h,f.stripScripts()).each(function(i){e.appendChild(i)})}else e.innerHTML=f.stripScripts();else e.innerHTML=f.stripScripts();f.evalScripts.bind(f).defer();return e}}(),replace:function(b,c){b=$(b);
if(c&&c.toElement)c=c.toElement();else if(!Object.isElement(c)){c=Object.toHTML(c);var d=b.ownerDocument.createRange();d.selectNode(b);c.evalScripts.bind(c).defer();c=d.createContextualFragment(c.stripScripts())}b.parentNode.replaceChild(c,b);return b},insert:function(b,c){b=$(b);if(Object.isString(c)||Object.isNumber(c)||Object.isElement(c)||c&&(c.toElement||c.toHTML))c={bottom:c};var d,e,f,h;for(h in c){d=c[h];h=h.toLowerCase();e=Element._insertionTranslations[h];if(d&&d.toElement)d=d.toElement();
if(Object.isElement(d))e(b,d);else{d=Object.toHTML(d);f=(h=="before"||h=="after"?b.parentNode:b).tagName.toUpperCase();f=Element._getContentFromAnonymousElement(f,d.stripScripts());if(h=="top"||h=="after")f.reverse();f.each(e.curry(b));d.evalScripts.bind(d).defer()}}return b},wrap:function(b,c,d){b=$(b);if(Object.isElement(c))$(c).writeAttribute(d||{});else c=Object.isString(c)?new Element(c,d):new Element("div",c);b.parentNode&&b.parentNode.replaceChild(c,b);c.appendChild(b);return c},inspect:function(b){b=
$(b);var c="<"+b.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(d){var e=d.first();d=d.last();if(e=(b[e]||"").toString())c+=" "+d+"="+e.inspect(true)});return c+">"},recursivelyCollect:function(b,c,d){b=$(b);d=d||-1;for(var e=[];b=b[c];){b.nodeType==1&&e.push(Element.extend(b));if(e.length==d)break}return e},ancestors:function(b){return Element.recursivelyCollect(b,"parentNode")},descendants:function(b){return Element.select(b,"*")},firstDescendant:function(b){for(b=$(b).firstChild;b&&
b.nodeType!=1;)b=b.nextSibling;return $(b)},immediateDescendants:function(b){var c=[];for(b=$(b).firstChild;b;){b.nodeType===1&&c.push(Element.extend(b));b=b.nextSibling}return c},previousSiblings:function(b){return Element.recursivelyCollect(b,"previousSibling")},nextSiblings:function(b){return Element.recursivelyCollect(b,"nextSibling")},siblings:function(b){b=$(b);return Element.previousSiblings(b).reverse().concat(Element.nextSiblings(b))},match:function(b,c){b=$(b);if(Object.isString(c))return Prototype.Selector.match(b,
c);return c.match(b)},up:function(b,c,d){b=$(b);if(arguments.length==1)return $(b.parentNode);var e=Element.ancestors(b);return Object.isNumber(c)?e[c]:Prototype.Selector.find(e,c,d)},down:function(b,c,d){b=$(b);if(arguments.length==1)return Element.firstDescendant(b);return Object.isNumber(c)?Element.descendants(b)[c]:Element.select(b,c)[d||0]},previous:function(b,c,d){b=$(b);if(Object.isNumber(c)){d=c;c=false}Object.isNumber(d)||(d=0);return c?Prototype.Selector.find(b.previousSiblings(),c,d):b.recursivelyCollect("previousSibling",
d+1)[d]},next:function(b,c,d){b=$(b);if(Object.isNumber(c)){d=c;c=false}Object.isNumber(d)||(d=0);if(c)return Prototype.Selector.find(b.nextSiblings(),c,d);else{Object.isNumber(d);return b.recursivelyCollect("nextSibling",d+1)[d]}},select:function(b){b=$(b);var c=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(c,b)},adjacent:function(b){b=$(b);var c=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(c,b.parentNode).without(b)},identify:function(b){b=
$(b);var c=Element.readAttribute(b,"id");if(c)return c;do c="anonymous_element_"+Element.idCounter++;while($(c));Element.writeAttribute(b,"id",c);return c},readAttribute:function(b,c){b=$(b);if(Prototype.Browser.IE){var d=Element._attributeTranslations.read;if(d.values[c])return d.values[c](b,c);if(d.names[c])c=d.names[c];if(c.include(":"))return!b.attributes||!b.attributes[c]?null:b.attributes[c].value}return b.getAttribute(c)},writeAttribute:function(b,c,d){b=$(b);var e={},f=Element._attributeTranslations.write;
if(typeof c=="object")e=c;else e[c]=Object.isUndefined(d)?true:d;for(var h in e){c=f.names[h]||h;d=e[h];if(f.values[h])c=f.values[h](b,d);if(d===false||d===null)b.removeAttribute(c);else d===true?b.setAttribute(c,c):b.setAttribute(c,d)}return b},getHeight:function(b){return Element.getDimensions(b).height},getWidth:function(b){return Element.getDimensions(b).width},classNames:function(b){return new Element.ClassNames(b)},hasClassName:function(b,c){if(b=$(b)){var d=b.className;return d.length>0&&(d==
c||RegExp("(^|\\s)"+c+"(\\s|$)").test(d))}},addClassName:function(b,c){if(b=$(b)){Element.hasClassName(b,c)||(b.className+=(b.className?" ":"")+c);return b}},removeClassName:function(b,c){if(b=$(b)){b.className=b.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ").strip();return b}},toggleClassName:function(b,c){if(b=$(b))return Element[Element.hasClassName(b,c)?"removeClassName":"addClassName"](b,c)},cleanWhitespace:function(b){b=$(b);for(var c=b.firstChild;c;){var d=c.nextSibling;c.nodeType==
3&&!/\S/.test(c.nodeValue)&&b.removeChild(c);c=d}return b},empty:function(b){return $(b).innerHTML.blank()},descendantOf:function(b,c){b=$(b);c=$(c);if(b.compareDocumentPosition)return(b.compareDocumentPosition(c)&8)===8;if(c.contains)return c.contains(b)&&c!==b;for(;b=b.parentNode;)if(b==c)return true;return false},scrollTo:function(b){b=$(b);var c=Element.cumulativeOffset(b);window.scrollTo(c[0],c[1]);return b},getStyle:function(b,c){b=$(b);c=c=="float"?"cssFloat":c.camelize();var d=b.style[c];
if(!d||d=="auto")d=(d=document.defaultView.getComputedStyle(b,null))?d[c]:null;if(c=="opacity")return d?parseFloat(d):1;return d=="auto"?null:d},getOpacity:function(b){return $(b).getStyle("opacity")},setStyle:function(b,c){b=$(b);var d=b.style;if(Object.isString(c)){b.style.cssText+=";"+c;return c.include("opacity")?b.setOpacity(c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var e in c)if(e=="opacity")b.setOpacity(c[e]);else d[e=="float"||e=="cssFloat"?Object.isUndefined(d.styleFloat)?"cssFloat":"styleFloat":
e]=c[e];return b},setOpacity:function(b,c){b=$(b);b.style.opacity=c==1||c===""?"":c<1.0E-5?0:c;return b},makePositioned:function(b){b=$(b);var c=Element.getStyle(b,"position");if(c=="static"||!c){b._madePositioned=true;b.style.position="relative";if(Prototype.Browser.Opera){b.style.top=0;b.style.left=0}}return b},undoPositioned:function(b){b=$(b);if(b._madePositioned){b._madePositioned=undefined;b.style.position=b.style.top=b.style.left=b.style.bottom=b.style.right=""}return b},makeClipping:function(b){b=
$(b);if(b._overflow)return b;b._overflow=Element.getStyle(b,"overflow")||"auto";if(b._overflow!=="hidden")b.style.overflow="hidden";return b},undoClipping:function(b){b=$(b);if(!b._overflow)return b;b.style.overflow=b._overflow=="auto"?"":b._overflow;b._overflow=null;return b},cumulativeOffset:function(b){var c=0,d=0;if(b.parentNode){do{c+=b.offsetTop||0;d+=b.offsetLeft||0;b=b.offsetParent}while(b)}return Element._returnOffset(d,c)},positionedOffset:function(b){var c=0,d=0;do{c+=b.offsetTop||0;d+=
b.offsetLeft||0;if(b=b.offsetParent){if(b.tagName.toUpperCase()=="BODY")break;if(Element.getStyle(b,"position")!=="static")break}}while(b);return Element._returnOffset(d,c)},absolutize:function(b){b=$(b);if(Element.getStyle(b,"position")=="absolute")return b;var c=Element.positionedOffset(b),d=c[1];c=c[0];var e=b.clientWidth,f=b.clientHeight;b._originalLeft=c-parseFloat(b.style.left||0);b._originalTop=d-parseFloat(b.style.top||0);b._originalWidth=b.style.width;b._originalHeight=b.style.height;b.style.position=
"absolute";b.style.top=d+"px";b.style.left=c+"px";b.style.width=e+"px";b.style.height=f+"px";return b},relativize:function(b){b=$(b);if(Element.getStyle(b,"position")=="relative")return b;b.style.position="relative";var c=parseFloat(b.style.top||0)-(b._originalTop||0),d=parseFloat(b.style.left||0)-(b._originalLeft||0);b.style.top=c+"px";b.style.left=d+"px";b.style.height=b._originalHeight;b.style.width=b._originalWidth;return b},cumulativeScrollOffset:function(b){var c=0,d=0;do{c+=b.scrollTop||0;
d+=b.scrollLeft||0;b=b.parentNode}while(b);return Element._returnOffset(d,c)},getOffsetParent:function(b){if(b.offsetParent)return $(b.offsetParent);if(b==document.body)return $(b);for(;(b=b.parentNode)&&b!=document.body;)if(Element.getStyle(b,"position")!="static")return $(b);return $(document.body)},viewportOffset:function(b){var c=0,d=0,e=b;do{c+=e.offsetTop||0;d+=e.offsetLeft||0;if(e.offsetParent==document.body&&Element.getStyle(e,"position")=="absolute")break}while(e=e.offsetParent);e=b;do if(!Prototype.Browser.Opera||
e.tagName&&e.tagName.toUpperCase()=="BODY"){c-=e.scrollTop||0;d-=e.scrollLeft||0}while(e=e.parentNode);return Element._returnOffset(d,c)},clonePosition:function(b,c,d){d=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},d||{});c=$(c);var e=Element.viewportOffset(c),f=[0,0],h=null;b=$(b);if(Element.getStyle(b,"position")=="absolute"){h=Element.getOffsetParent(b);f=Element.viewportOffset(h)}if(h==document.body){f[0]-=document.body.offsetLeft;f[1]-=document.body.offsetTop}if(d.setLeft)b.style.left=
e[0]-f[0]+d.offsetLeft+"px";if(d.setTop)b.style.top=e[1]-f[1]+d.offsetTop+"px";if(d.setWidth)b.style.width=c.offsetWidth+"px";if(d.setHeight)b.style.height=c.offsetHeight+"px";return b}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(b,c,d){switch(d){case "left":case "top":case "right":case "bottom":if(b(c,"position")==="static")return null;case "height":case "width":if(!Element.visible(c))return null;var e=parseInt(b(c,d),10);if(e!==c["offset"+d.capitalize()])return e+"px";return(d==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(e,
function(f,h){var g=b(c,h);return g===null?f:f-parseInt(g,10)})+"px";default:return b(c,d)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(b,c,d){if(d==="title")return c.title;return b(c,d)})}else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(b,c){c=$(c);if(!c.parentNode)return $(document.body);var d=c.getStyle("position");if(d!=="static")return b(c);c.setStyle({position:"relative"});var e=b(c);c.setStyle({position:d});
return e});$w("positionedOffset viewportOffset").each(function(b){Element.Methods[b]=Element.Methods[b].wrap(function(c,d){d=$(d);if(!d.parentNode)return Element._returnOffset(0,0);var e=d.getStyle("position");if(e!=="static")return c(d);var f=d.getOffsetParent();f&&f.getStyle("position")==="fixed"&&f.setStyle({zoom:1});d.setStyle({position:"relative"});f=c(d);d.setStyle({position:e});return f})});Element.Methods.getStyle=function(b,c){b=$(b);c=c=="float"||c=="cssFloat"?"styleFloat":c.camelize();
var d=b.style[c];if(!d&&b.currentStyle)d=b.currentStyle[c];if(c=="opacity"){if(d=(b.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))if(d[1])return parseFloat(d[1])/100;return 1}if(d=="auto"){if((c=="width"||c=="height")&&b.getStyle("display")!="none")return b["offset"+c.capitalize()]+"px";return null}return d};Element.Methods.setOpacity=function(b,c){b=$(b);var d=b.currentStyle;if(d&&!d.hasLayout||!d&&b.style.zoom=="normal")b.style.zoom=1;d=b.getStyle("filter");var e=b.style;if(c==1||c===""){(d=
d.replace(/alpha\([^\)]*\)/gi,""))?e.filter=d:e.removeAttribute("filter");return b}else if(c<1.0E-5)c=0;e.filter=d.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+c*100+")";return b};Element._attributeTranslations=function(){var b="className",c="for",d=document.createElement("div");d.setAttribute(b,"x");if(d.className!=="x"){d.setAttribute("class","x");if(d.className==="x")b="class"}d=null;d=document.createElement("label");d.setAttribute(c,"x");if(d.htmlFor!=="x"){d.setAttribute("htmlFor","x");if(d.htmlFor===
"x")c="htmlFor"}d=null;return{read:{names:{"class":b,className:b,"for":c,htmlFor:c},values:{_getAttr:function(e,f){return e.getAttribute(f)},_getAttr2:function(e,f){return e.getAttribute(f,2)},_getAttrNode:function(e,f){var h=e.getAttributeNode(f);return h?h.value:""},_getEv:function(){var e=document.createElement("div"),f;e.onclick=Prototype.emptyFunction;e=e.getAttribute("onclick");if(String(e).indexOf("{")>-1)f=function(h,g){g=h.getAttribute(g);if(!g)return null;g=g.toString();g=g.split("{")[1];
g=g.split("}")[0];return g.strip()};else if(e==="")f=function(h,g){g=h.getAttribute(g);if(!g)return null;return g.strip()};e=null;return f}(),_flag:function(e,f){return $(e).hasAttribute(f)?f:null},style:function(e){return e.style.cssText.toLowerCase()},title:function(e){return e.title}}}}}();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(b,c){b.checked=!!c},style:function(b,
c){b.style.cssText=c?c:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(b){Element._attributeTranslations.write.names[b.toLowerCase()]=b;Element._attributeTranslations.has[b.toLowerCase()]=b});(function(b){Object.extend(b,{href:b._getAttr2,src:b._getAttr2,type:b._getAttr,action:b._getAttrNode,disabled:b._flag,checked:b._flag,readonly:b._flag,multiple:b._flag,onload:b._getEv,onunload:b._getEv,
onclick:b._getEv,ondblclick:b._getEv,onmousedown:b._getEv,onmouseup:b._getEv,onmouseover:b._getEv,onmousemove:b._getEv,onmouseout:b._getEv,onfocus:b._getEv,onblur:b._getEv,onkeypress:b._getEv,onkeydown:b._getEv,onkeyup:b._getEv,onsubmit:b._getEv,onreset:b._getEv,onselect:b._getEv,onchange:b._getEv})})(Element._attributeTranslations.read.values);Prototype.BrowserFeatures.ElementExtensions&&function(){Element.Methods.down=function(b,c,d){b=$(b);if(arguments.length==1)return b.firstDescendant();var e;
if(Object.isNumber(c)){e=b.getElementsByTagName("*");for(var f=[],h=0,g;g=e[h];h++)g.tagName!=="!"&&f.push(g);e=f[c]}else e=Element.select(b,c)[d||0];return e}}()}else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=function(b,c){b=$(b);b.style.opacity=c==1?0.999999:c===""?"":c<1.0E-5?0:c;return b};else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(b,c){b=$(b);b.style.opacity=c==1||c===""?"":c<1.0E-5?0:c;if(c==1)if(b.tagName.toUpperCase()==
"IMG"&&b.width){b.width++;b.width--}else try{var d=document.createTextNode(" ");b.appendChild(d);b.removeChild(d)}catch(e){}return b};Element.Methods.cumulativeOffset=function(b){var c=0,d=0;do{c+=b.offsetTop||0;d+=b.offsetLeft||0;if(b.offsetParent==document.body)if(Element.getStyle(b,"position")=="absolute")break;b=b.offsetParent}while(b);return Element._returnOffset(d,c)}}
if("outerHTML"in document.documentElement)Element.Methods.replace=function(b,c){b=$(b);if(c&&c.toElement)c=c.toElement();if(Object.isElement(c)){b.parentNode.replaceChild(c,b);return b}c=Object.toHTML(c);var d=b.parentNode,e=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[e]){var f=b.next();e=Element._getContentFromAnonymousElement(e,c.stripScripts());d.removeChild(b);f?e.each(function(h){d.insertBefore(h,f)}):e.each(function(h){d.appendChild(h)})}else b.outerHTML=c.stripScripts();
c.evalScripts.bind(c).defer();return b};Element._returnOffset=function(b,c){var d=[b,c];d.left=b;d.top=c;return d};Element._getContentFromAnonymousElement=function(b,c){var d=new Element("div"),e=Element._insertionTranslations.tags[b];if(e){d.innerHTML=e[0]+c+e[1];for(e=e[2];e--;)d=d.firstChild}else d.innerHTML=c;return $A(d.childNodes)};
Element._insertionTranslations={before:function(b,c){b.parentNode.insertBefore(c,b)},top:function(b,c){b.insertBefore(c,b.firstChild)},bottom:function(b,c){b.appendChild(c)},after:function(b,c){b.parentNode.insertBefore(c,b.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var b=Element._insertionTranslations.tags;Object.extend(b,{THEAD:b.TBODY,TFOOT:b.TBODY,TH:b.TD})})();Element.Methods.Simulated={hasAttribute:function(b,c){c=Element._attributeTranslations.has[c]||c;var d=$(b).getAttributeNode(c);return!!(d&&d.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(b){if(!Prototype.BrowserFeatures.ElementExtensions&&b.__proto__){window.HTMLElement={};window.HTMLElement.prototype=b.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}})(document.createElement("div"));
Element.extend=function(){function b(f,h){for(var g in h){var i=h[g];if(Object.isFunction(i)&&!(g in f))f[g]=i.methodize()}}var c=function(f){if(typeof window.Element!="undefined"){var h=window.Element.prototype;if(h){var g="_"+(Math.random()+"").slice(2);f=document.createElement(f);h[g]="x";f=f[g]!=="x";delete h[g];return f}}return false}("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(c)return function(f){if(f&&typeof f._extendedByPrototype=="undefined"){var h=f.tagName;if(h&&
/^(?:object|applet|embed)$/i.test(h)){b(f,Element.Methods);b(f,Element.Methods.Simulated);b(f,Element.Methods.ByTag[h.toUpperCase()])}}return f};return Prototype.K}var d={},e=Element.Methods.ByTag;c=Object.extend(function(f){if(!f||typeof f._extendedByPrototype!="undefined"||f.nodeType!=1||f==window)return f;var h=Object.clone(d),g=f.tagName.toUpperCase();e[g]&&Object.extend(h,e[g]);b(f,h);f._extendedByPrototype=Prototype.emptyFunction;return f},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(d,
Element.Methods);Object.extend(d,Element.Methods.Simulated)}}});c.refresh();return c}();Element.hasAttribute=document.documentElement.hasAttribute?function(b,c){return b.hasAttribute(c)}:Element.Methods.Simulated.hasAttribute;
Element.addMethods=function(b){function c(j){j=j.toUpperCase();Element.Methods.ByTag[j]||(Element.Methods.ByTag[j]={});Object.extend(Element.Methods.ByTag[j],b)}function d(j,k,l){l=l||false;for(var o in j){var q=j[o];if(Object.isFunction(q))if(!l||!(o in k))k[o]=q.methodize()}}function e(j){var k,l={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(l[j])k="HTML"+l[j]+"Element";if(window[k])return window[k];k="HTML"+j+"Element";if(window[k])return window[k];k="HTML"+j.capitalize()+"Element";if(window[k])return window[k];j=document.createElement(j);return j.__proto__||j.constructor.prototype}
var f=Prototype.BrowserFeatures,h=Element.Methods.ByTag;if(!b){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var g=b;b=arguments[1]}if(g)Object.isArray(g)?g.each(c):c(g);else Object.extend(Element.Methods,b||{});g=window.HTMLElement?HTMLElement.prototype:
Element.prototype;if(f.ElementExtensions){d(Element.Methods,g);d(Element.Methods.Simulated,g,true)}if(f.SpecificElementExtensions)for(var i in Element.Methods.ByTag){f=e(i);Object.isUndefined(f)||d(h[i],f.prototype)}Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(b){function c(){if(e.WebKit&&!f.evaluate)return document;if(e.Opera&&window.parseFloat(window.opera.version())<9.5)return document.body;return document.documentElement}function d(i){h||(h=c());g[i]="client"+i;b["get"+i]=function(){return h[g[i]]};return b["get"+i]()}var e=Prototype.Browser,f=document,h,g={};b.getWidth=d.curry("Width");b.getHeight=d.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(b){if(b=$(b)){if(b===window)b=0;else{if(typeof b._prototypeUID==="undefined")b._prototypeUID=Element.Storage.UID++;b=b._prototypeUID}Element.Storage[b]||(Element.Storage[b]=$H());return Element.Storage[b]}},store:function(b,c,d){if(b=$(b)){arguments.length===2?Element.getStorage(b).update(c):Element.getStorage(b).set(c,d);return b}},retrieve:function(b,c,d){if(b=$(b)){b=Element.getStorage(b);var e=b.get(c);if(Object.isUndefined(e)){b.set(c,d);e=d}return e}},
clone:function(b,c){if(b=$(b)){var d=b.cloneNode(c);d._prototypeUID=void 0;if(c)for(var e=Element.select(d,"*"),f=e.length;f--;)e[f]._prototypeUID=void 0;return Element.extend(d)}},purge:function(b){if(b=$(b)){purgeElement(b);b=b.getElementsByTagName("*");for(var c=b.length;c--;)purgeElement(b[c]);return null}}});
(function(){function b(g,i){if(Object.isElement(g)){element=g;g=element.getStyle(i)}if(g===null)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(g))return window.parseFloat(g);if(/\d/.test(g)&&element.runtimeStyle){var j=element.style.left,k=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=g||0;g=element.style.pixelLeft;element.style.left=j;element.runtimeStyle.left=k;return g}if(g.include("%")){k=(k=g.match(/^(\d+)%?$/i))?Number(k[1])/100:null;if(i.include("left")||
i.include("right")||i.include("width"))j=$(element.parentNode).measure("width");else if(i.include("top")||i.include("bottom")||i.include("height"))j=$(element.parentNode).measure("height");return j*k}return 0}function c(g){if(f(g))return $(document.body);if(Element.getStyle(g,"display")!=="inline"&&g.offsetParent)return $(g.offsetParent);if(g===document.body)return $(g);for(;(g=g.parentNode)&&g!==document.body;)if(Element.getStyle(g,"position")!=="static")return g.nodeName==="HTML"?$(document.body):
$(g);return $(document.body)}function d(g){var i=g.getLayout(),j=0,k=0;do{j+=g.offsetTop||0;k+=g.offsetLeft||0;if(g=g.offsetParent){if(g.nodeName.toUpperCase()==="BODY")break;if(Element.getStyle(g,"position")!=="static")break}}while(g);k-=i.get("margin-top");j-=i.get("margin-left");return new Element.Offset(k,j)}function e(g){var i=0,j=0,k=document.body,l=g;do{i+=l.offsetTop||0;j+=l.offsetLeft||0;if(l.offsetParent==k&&Element.getStyle(l,"position")=="absolute")break}while(l=l.offsetParent);l=g;do if(l!=
k){i-=l.scrollTop||0;j-=l.scrollLeft||0}while(l=l.parentNode);return new Element.Offset(j,i)}function f(g){return g!==document.body&&!Element.descendantOf(g,document.body)}var h=Prototype.K;if("currentStyle"in document.documentElement)h=function(g){if(!g.currentStyle.hasLayout)g.style.zoom=1;return g};Element.Layout=Class.create(Hash,{initialize:function($super,i,j){$super();this.element=$(i);Element.Layout.PROPERTIES.each(function(k){this._set(k,null)},this);if(j){this._preComputing=true;this._begin();
Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(g,i){return Hash.prototype.set.call(this,g,i)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,i){var j=$super(i);return j===null?this._compute(i):j},_begin:function(){if(!this._prepared){var g=this.element,i;a:{for(i=g;i&&i.parentNode;){if(i.getStyle("display")==="none"){i=false;break a}i=$(i.parentNode)}i=true}if(!i){g.store("prototype_original_styles",
{position:g.style.position||"",width:g.style.width||"",visibility:g.style.visibility||"",display:g.style.display||""});i=g.getStyle("position");var j=g.getStyle("width");g.setStyle({position:"absolute",visibility:"hidden",display:"block"});var k=g.getStyle("width");i=j&&k===j?b(j):j&&(i==="absolute"||i==="fixed")?b(j):$(g.parentNode).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");
g.setStyle({width:i+"px"})}this._prepared=true}},_end:function(){var g=this.element,i=g.retrieve("prototype_original_styles");g.store("prototype_original_styles",null);g.setStyle(i);this._prepared=false},_compute:function(g){var i=Element.Layout.COMPUTATIONS;if(!(g in i))throw"Property not found.";return this._set(g,i[g].call(this,this.element))},toObject:function(){var g=$A(arguments),i={};(g.length===0?Element.Layout.PROPERTIES:g.join(" ").split(" ")).each(function(j){if(Element.Layout.PROPERTIES.include(j)){var k=
this.get(j);if(k!=null)i[j]=k}},this);return i},toHash:function(){var g=this.toObject.apply(this,arguments);return new Hash(g)},toCSS:function(){var g=$A(arguments),i={};(g.length===0?Element.Layout.PROPERTIES:g.join(" ").split(" ")).each(function(j){if(Element.Layout.PROPERTIES.include(j))if(!Element.Layout.COMPOSITE_PROPERTIES.include(j)){var k=this.get(j);if(k!=null){j=j;if(j.include("border"))j+="-width";j=j.camelize();i[j]=k+"px"}}},this);return i},inspect:function(){return"#<Element.Layout>"}});
Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(){this._preComputing||
this._begin();var g=this.get("border-box-height");if(g<=0)return 0;var i=this.get("border-top"),j=this.get("border-bottom"),k=this.get("padding-top"),l=this.get("padding-bottom");this._preComputing||this._end();return g-i-j-k-l},width:function(){this._preComputing||this._begin();var g=this.get("border-box-width");if(g<=0)return 0;var i=this.get("border-left"),j=this.get("border-right"),k=this.get("padding-left"),l=this.get("padding-right");this._preComputing||this._end();return g-i-j-k-l},"padding-box-height":function(){var g=
this.get("height"),i=this.get("padding-top"),j=this.get("padding-bottom");return g+i+j},"padding-box-width":function(){var g=this.get("width"),i=this.get("padding-left"),j=this.get("padding-right");return g+i+j},"border-box-height":function(g){return g.offsetHeight},"border-box-width":function(g){return g.offsetWidth},"margin-box-height":function(){var g=this.get("border-box-height"),i=this.get("margin-top"),j=this.get("margin-bottom");if(g<=0)return 0;return g+i+j},"margin-box-width":function(){var g=
this.get("border-box-width"),i=this.get("margin-left"),j=this.get("margin-right");if(g<=0)return 0;return g+i+j},top:function(g){return g.positionedOffset().top},bottom:function(g){var i=g.positionedOffset();g=g.getOffsetParent().measure("height");var j=this.get("border-box-height");return g-j-i.top},left:function(g){return g.positionedOffset().left},right:function(g){var i=g.positionedOffset();g=g.getOffsetParent().measure("width");var j=this.get("border-box-width");return g-j-i.left},"padding-top":function(g){return b(g,
"paddingTop")},"padding-bottom":function(g){return b(g,"paddingBottom")},"padding-left":function(g){return b(g,"paddingLeft")},"padding-right":function(g){return b(g,"paddingRight")},"border-top":function(g){return Object.isNumber(g.clientTop)?g.clientTop:b(g,"borderTopWidth")},"border-bottom":function(g){return Object.isNumber(g.clientBottom)?g.clientBottom:b(g,"borderBottomWidth")},"border-left":function(g){return Object.isNumber(g.clientLeft)?g.clientLeft:b(g,"borderLeftWidth")},"border-right":function(g){return Object.isNumber(g.clientRight)?
g.clientRight:b(g,"borderRightWidth")},"margin-top":function(g){return b(g,"marginTop")},"margin-bottom":function(g){return b(g,"marginBottom")},"margin-left":function(g){return b(g,"marginLeft")},"margin-right":function(g){return b(g,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(g){var i=h(g.getOffsetParent());g=g.getBoundingClientRect();return(i.getBoundingClientRect().right-g.right).round()},bottom:function(g){var i=
h(g.getOffsetParent());g=g.getBoundingClientRect();return(i.getBoundingClientRect().bottom-g.bottom).round()}});Element.Offset=Class.create({initialize:function(g,i){this.left=g.round();this.top=i.round();this[0]=this.left;this[1]=this.top},relativeTo:function(g){return new Element.Offset(this.left-g.left,this.top-g.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,
this.top]}});Element.addMethods({getLayout:function(g,i){return new Element.Layout(g,i)},measure:function(g,i){return $(g).getLayout().get(i)},getDimensions:function(g){g=$(g).getLayout();return{width:g.get("width"),height:g.get("height")}},getOffsetParent:c,cumulativeOffset:function(g){var i=0,j=0;do{i+=g.offsetTop||0;j+=g.offsetLeft||0;g=g.offsetParent}while(g);return new Element.Offset(j,i)},positionedOffset:d,cumulativeScrollOffset:function(g){var i=0,j=0;do{i+=g.scrollTop||0;j+=g.scrollLeft||
0;g=g.parentNode}while(g);return new Element.Offset(j,i)},viewportOffset:e,absolutize:function(g){g=$(g);if(Element.getStyle(g,"position")==="absolute")return g;var i=c(g),j=g.viewportOffset();i=i.viewportOffset();j=j.relativeTo(i);i=g.getLayout();g.store("prototype_absolutize_original_styles",{left:g.getStyle("left"),top:g.getStyle("top"),width:g.getStyle("width"),height:g.getStyle("height")});g.setStyle({position:"absolute",top:j.top+"px",left:j.left+"px",width:i.get("width")+"px",height:i.get("height")+
"px"});return g},relativize:function(g){g=$(g);if(Element.getStyle(g,"position")==="relative")return g;var i=g.retrieve("prototype_absolutize_original_styles");i&&g.setStyle(i);return g}});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(g){g=$(g);if(f(g))return new Element.Offset(0,0);g=g.getBoundingClientRect();var i=document.documentElement;return new Element.Offset(g.left-i.clientLeft,g.top-i.clientTop)},positionedOffset:function(g){g=$(g);var i=
g.getOffsetParent();if(f(g))return new Element.Offset(0,0);if(g.offsetParent&&g.offsetParent.nodeName.toUpperCase()==="HTML")return d(g);var j=g.viewportOffset();i=i.nodeName.toUpperCase()==="BODY"?e(i):i.viewportOffset();j=j.relativeTo(i);i=g.getLayout();g=j.top-i.get("margin-top");j=j.left-i.get("margin-left");return new Element.Offset(j,g)}})})();window.$$=function(){var b=$A(arguments).join(", ");return Prototype.Selector.select(b,document)};
Prototype.Selector=function(){function b(d){for(var e=0,f=d.length;e<f;e++)Element.extend(d[e]);return d}var c=Prototype.K;return{select:function(){throw Error('Method "Prototype.Selector.select" must be defined.');},match:function(){throw Error('Method "Prototype.Selector.match" must be defined.');},find:function(d,e,f){f=f||0;var h=Prototype.Selector.match,g=d.length,i=0,j;for(j=0;j<g;j++)if(h(d[j],e)&&f==i++)return Element.extend(d[j])},extendElements:Element.extend===c?c:b,extendElement:Element.extend}}();
Prototype._original_property=window.Sizzle;
(function(){function b(n,m,r,p,s,u){s=n=="previousSibling"&&!u;for(var v=0,y=p.length;v<y;v++){var x=p[v];if(x){if(s&&x.nodeType===1){x.sizcache=r;x.sizset=v}x=x[n];for(var B=false;x;){if(x.sizcache===r){B=p[x.sizset];break}if(x.nodeType===1&&!u){x.sizcache=r;x.sizset=v}if(x.nodeName===m){B=x;break}x=x[n]}p[v]=B}}}function c(n,m,r,p,s,u){s=n=="previousSibling"&&!u;for(var v=0,y=p.length;v<y;v++){var x=p[v];if(x){if(s&&x.nodeType===1){x.sizcache=r;x.sizset=v}x=x[n];for(var B=false;x;){if(x.sizcache===
r){B=p[x.sizset];break}if(x.nodeType===1){if(!u){x.sizcache=r;x.sizset=v}if(typeof m!=="string"){if(x===m){B=true;break}}else if(i.filter(m,[x]).length>0){B=x;break}}x=x[n]}p[v]=B}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,f=Object.prototype.toString,h=false,g=true;[0,0].sort(function(){g=false;return 0});var i=function(n,m,r,p){r=r||[];var s=m=m||document;if(m.nodeType!==1&&m.nodeType!==9)return[];
if(!n||typeof n!=="string")return r;for(var u=[],v,y,x,B,C=true,E=z(m),F=n;(d.exec(""),v=d.exec(F))!==null;){F=v[3];u.push(v[1]);if(v[2]){B=v[3];break}}if(u.length>1&&k.exec(n))if(u.length===2&&j.relative[u[0]])y=A(u[0]+u[1],m);else for(y=j.relative[u[0]]?[m]:i(u.shift(),m);u.length;){n=u.shift();if(j.relative[n])n+=u.shift();y=A(n,y)}else{if(!p&&u.length>1&&m.nodeType===9&&!E&&j.match.ID.test(u[0])&&!j.match.ID.test(u[u.length-1])){v=i.find(u.shift(),m,E);m=v.expr?i.filter(v.expr,v.set)[0]:v.set[0]}if(m){v=
p?{expr:u.pop(),set:o(p)}:i.find(u.pop(),u.length===1&&(u[0]==="~"||u[0]==="+")&&m.parentNode?m.parentNode:m,E);y=v.expr?i.filter(v.expr,v.set):v.set;if(u.length>0)x=o(y);else C=false;for(;u.length;){var D=u.pop();v=D;if(j.relative[D])v=u.pop();else D="";if(v==null)v=m;j.relative[D](x,v,E)}}else x=[]}x||(x=y);if(!x)throw"Syntax error, unrecognized expression: "+(D||n);if(f.call(x)==="[object Array]")if(C)if(m&&m.nodeType===1)for(n=0;x[n]!=null;n++){if(x[n]&&(x[n]===true||x[n].nodeType===1&&w(m,x[n])))r.push(y[n])}else for(n=
0;x[n]!=null;n++)x[n]&&x[n].nodeType===1&&r.push(y[n]);else r.push.apply(r,x);else o(x,r);if(B){i(B,s,r,p);i.uniqueSort(r)}return r};i.uniqueSort=function(n){if(t){h=g;n.sort(t);if(h)for(var m=1;m<n.length;m++)n[m]===n[m-1]&&n.splice(m--,1)}return n};i.matches=function(n,m){return i(n,null,null,m)};i.find=function(n,m,r){var p,s;if(!n)return[];for(var u=0,v=j.order.length;u<v;u++){var y=j.order[u];if(s=j.leftMatch[y].exec(n)){var x=s[1];s.splice(1,1);if(x.substr(x.length-1)!=="\\"){s[1]=(s[1]||"").replace(/\\/g,
"");p=j.find[y](s,m,r);if(p!=null){n=n.replace(j.match[y],"");break}}}}p||(p=m.getElementsByTagName("*"));return{set:p,expr:n}};i.filter=function(n,m,r,p){for(var s=n,u=[],v=m,y,x,B=m&&m[0]&&z(m[0]);n&&m.length;){for(var C in j.filter)if((y=j.match[C].exec(n))!=null){var E=j.filter[C],F,D;x=false;if(v==u)u=[];if(j.preFilter[C])if(y=j.preFilter[C](y,v,r,u,p,B)){if(y===true)continue}else x=F=true;if(y)for(var G=0;(D=v[G])!=null;G++)if(D){F=E(D,y,G,v);var H=p^!!F;if(r&&F!=null)if(H)x=true;else v[G]=
false;else if(H){u.push(D);x=true}}if(F!==undefined){r||(v=u);n=n.replace(j.match[C],"");if(!x)return[];break}}if(n==s)if(x==null)throw"Syntax error, unrecognized expression: "+n;else break;s=n}return v};var j=i.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,
CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(n){return n.getAttribute("href")}},relative:{"+":function(n,m,r){var p=typeof m==="string",s=p&&!/\W/.test(m);p=p&&!s;if(s&&!r)m=m.toUpperCase();r=0;s=n.length;for(var u;r<s;r++)if(u=n[r]){for(;(u=u.previousSibling)&&
u.nodeType!==1;);n[r]=p||u&&u.nodeName===m?u||false:u===m}p&&i.filter(m,n,true)},">":function(n,m,r){var p=typeof m==="string";if(p&&!/\W/.test(m)){m=r?m:m.toUpperCase();r=0;for(var s=n.length;r<s;r++){var u=n[r];if(u){p=u.parentNode;n[r]=p.nodeName===m?p:false}}}else{r=0;for(s=n.length;r<s;r++)if(u=n[r])n[r]=p?u.parentNode:u.parentNode===m;p&&i.filter(m,n,true)}},"":function(n,m,r){var p=e++,s=c;if(!/\W/.test(m)){var u=m=r?m:m.toUpperCase();s=b}s("parentNode",m,p,n,u,r)},"~":function(n,m,r){var p=
e++,s=c;if(typeof m==="string"&&!/\W/.test(m)){var u=m=r?m:m.toUpperCase();s=b}s("previousSibling",m,p,n,u,r)}},find:{ID:function(n,m,r){if(typeof m.getElementById!=="undefined"&&!r)return(n=m.getElementById(n[1]))?[n]:[]},NAME:function(n,m){if(typeof m.getElementsByName!=="undefined"){for(var r=[],p=m.getElementsByName(n[1]),s=0,u=p.length;s<u;s++)p[s].getAttribute("name")===n[1]&&r.push(p[s]);return r.length===0?null:r}},TAG:function(n,m){return m.getElementsByTagName(n[1])}},preFilter:{CLASS:function(n,
m,r,p,s,u){n=" "+n[1].replace(/\\/g,"")+" ";if(u)return n;u=0;for(var v;(v=m[u])!=null;u++)if(v)if(s^(v.className&&(" "+v.className+" ").indexOf(n)>=0))r||p.push(v);else if(r)m[u]=false;return false},ID:function(n){return n[1].replace(/\\/g,"")},TAG:function(n,m){for(var r=0;m[r]===false;r++);return m[r]&&z(m[r])?n[1]:n[1].toUpperCase()},CHILD:function(n){if(n[1]=="nth"){var m=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(n[2]=="even"&&"2n"||n[2]=="odd"&&"2n+1"||!/\D/.test(n[2])&&"0n+"+n[2]||n[2]);n[2]=m[1]+(m[2]||
1)-0;n[3]=m[3]-0}n[0]=e++;return n},ATTR:function(n,m,r,p,s,u){m=n[1].replace(/\\/g,"");if(!u&&j.attrMap[m])n[1]=j.attrMap[m];if(n[2]==="~=")n[4]=" "+n[4]+" ";return n},PSEUDO:function(n,m,r,p,s){if(n[1]==="not")if((d.exec(n[3])||"").length>1||/^\w/.test(n[3]))n[3]=i(n[3],null,null,m);else{n=i.filter(n[3],m,r,true^s);r||p.push.apply(p,n);return false}else if(j.match.POS.test(n[0])||j.match.CHILD.test(n[0]))return true;return n},POS:function(n){n.unshift(true);return n}},filters:{enabled:function(n){return n.disabled===
false&&n.type!=="hidden"},disabled:function(n){return n.disabled===true},checked:function(n){return n.checked===true},selected:function(n){return n.selected===true},parent:function(n){return!!n.firstChild},empty:function(n){return!n.firstChild},has:function(n,m,r){return!!i(r[3],n).length},header:function(n){return/h\d/i.test(n.nodeName)},text:function(n){return"text"===n.type},radio:function(n){return"radio"===n.type},checkbox:function(n){return"checkbox"===n.type},file:function(n){return"file"===
n.type},password:function(n){return"password"===n.type},submit:function(n){return"submit"===n.type},image:function(n){return"image"===n.type},reset:function(n){return"reset"===n.type},button:function(n){return"button"===n.type||n.nodeName.toUpperCase()==="BUTTON"},input:function(n){return/input|select|textarea|button/i.test(n.nodeName)}},setFilters:{first:function(n,m){return m===0},last:function(n,m,r,p){return m===p.length-1},even:function(n,m){return m%2===0},odd:function(n,m){return m%2===1},
lt:function(n,m,r){return m<r[3]-0},gt:function(n,m,r){return m>r[3]-0},nth:function(n,m,r){return r[3]-0==m},eq:function(n,m,r){return r[3]-0==m}},filter:{PSEUDO:function(n,m,r,p){var s=m[1],u=j.filters[s];if(u)return u(n,r,m,p);else if(s==="contains")return(n.textContent||n.innerText||"").indexOf(m[3])>=0;else if(s==="not"){m=m[3];r=0;for(p=m.length;r<p;r++)if(m[r]===n)return false;return true}},CHILD:function(n,m){var r=m[1],p=n;switch(r){case "only":case "first":for(;p=p.previousSibling;)if(p.nodeType===
1)return false;if(r=="first")return true;p=n;case "last":for(;p=p.nextSibling;)if(p.nodeType===1)return false;return true;case "nth":r=m[2];var s=m[3];if(r==1&&s==0)return true;var u=m[0],v=n.parentNode;if(v&&(v.sizcache!==u||!n.nodeIndex)){var y=0;for(p=v.firstChild;p;p=p.nextSibling)if(p.nodeType===1)p.nodeIndex=++y;v.sizcache=u}p=n.nodeIndex-s;return r==0?p==0:p%r==0&&p/r>=0}},ID:function(n,m){return n.nodeType===1&&n.getAttribute("id")===m},TAG:function(n,m){return m==="*"&&n.nodeType===1||n.nodeName===
m},CLASS:function(n,m){return(" "+(n.className||n.getAttribute("class"))+" ").indexOf(m)>-1},ATTR:function(n,m){var r=m[1];r=j.attrHandle[r]?j.attrHandle[r](n):n[r]!=null?n[r]:n.getAttribute(r);var p=r+"",s=m[2],u=m[4];return r==null?s==="!=":s==="="?p===u:s==="*="?p.indexOf(u)>=0:s==="~="?(" "+p+" ").indexOf(u)>=0:!u?p&&r!==false:s==="!="?p!=u:s==="^="?p.indexOf(u)===0:s==="$="?p.substr(p.length-u.length)===u:s==="|="?p===u||p.substr(0,u.length+1)===u+"-":false},POS:function(n,m,r,p){var s=j.setFilters[m[2]];
if(s)return s(n,r,m,p)}}},k=j.match.POS,l;for(l in j.match){j.match[l]=RegExp(j.match[l].source+/(?![^\[]*\])(?![^\(]*\))/.source);j.leftMatch[l]=RegExp(/(^(?:.|\r|\n)*?)/.source+j.match[l].source)}var o=function(n,m){n=Array.prototype.slice.call(n,0);if(m){m.push.apply(m,n);return m}return n};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(q){o=function(n,m){var r=m||[];if(f.call(n)==="[object Array]")Array.prototype.push.apply(r,n);else if(typeof n.length==="number")for(var p=
0,s=n.length;p<s;p++)r.push(n[p]);else for(p=0;n[p];p++)r.push(n[p]);return r}}var t;if(document.documentElement.compareDocumentPosition)t=function(n,m){if(!n.compareDocumentPosition||!m.compareDocumentPosition){if(n==m)h=true;return 0}var r=n.compareDocumentPosition(m)&4?-1:n===m?0:1;if(r===0)h=true;return r};else if("sourceIndex"in document.documentElement)t=function(n,m){if(!n.sourceIndex||!m.sourceIndex){if(n==m)h=true;return 0}var r=n.sourceIndex-m.sourceIndex;if(r===0)h=true;return r};else if(document.createRange)t=
function(n,m){if(!n.ownerDocument||!m.ownerDocument){if(n==m)h=true;return 0}var r=n.ownerDocument.createRange(),p=m.ownerDocument.createRange();r.setStart(n,0);r.setEnd(n,0);p.setStart(m,0);p.setEnd(m,0);r=r.compareBoundaryPoints(Range.START_TO_END,p);if(r===0)h=true;return r};(function(){var n=document.createElement("div"),m="script"+(new Date).getTime();n.innerHTML="<a name='"+m+"'/>";var r=document.documentElement;r.insertBefore(n,r.firstChild);if(document.getElementById(m)){j.find.ID=function(p,
s,u){if(typeof s.getElementById!=="undefined"&&!u)return(s=s.getElementById(p[1]))?s.id===p[1]||typeof s.getAttributeNode!=="undefined"&&s.getAttributeNode("id").nodeValue===p[1]?[s]:undefined:[]};j.filter.ID=function(p,s){var u=typeof p.getAttributeNode!=="undefined"&&p.getAttributeNode("id");return p.nodeType===1&&u&&u.nodeValue===s}}r.removeChild(n);r=n=null})();(function(){var n=document.createElement("div");n.appendChild(document.createComment(""));if(n.getElementsByTagName("*").length>0)j.find.TAG=
function(m,r){var p=r.getElementsByTagName(m[1]);if(m[1]==="*"){for(var s=[],u=0;p[u];u++)p[u].nodeType===1&&s.push(p[u]);p=s}return p};n.innerHTML="<a href='#'></a>";if(n.firstChild&&typeof n.firstChild.getAttribute!=="undefined"&&n.firstChild.getAttribute("href")!=="#")j.attrHandle.href=function(m){return m.getAttribute("href",2)};n=null})();document.querySelectorAll&&function(){var n=i,m=document.createElement("div");m.innerHTML="<p class='TEST'></p>";if(!(m.querySelectorAll&&m.querySelectorAll(".TEST").length===
0)){i=function(p,s,u,v){s=s||document;if(!v&&s.nodeType===9&&!z(s))try{return o(s.querySelectorAll(p),u)}catch(y){}return n(p,s,u,v)};for(var r in n)i[r]=n[r];m=null}}();document.getElementsByClassName&&document.documentElement.getElementsByClassName&&function(){var n=document.createElement("div");n.innerHTML="<div class='test e'></div><div class='test'></div>";if(n.getElementsByClassName("e").length!==0){n.lastChild.className="e";if(n.getElementsByClassName("e").length!==1){j.order.splice(1,0,"CLASS");
j.find.CLASS=function(m,r,p){if(typeof r.getElementsByClassName!=="undefined"&&!p)return r.getElementsByClassName(m[1])};n=null}}}();var w=document.compareDocumentPosition?function(n,m){return n.compareDocumentPosition(m)&16}:function(n,m){return n!==m&&(n.contains?n.contains(m):true)},z=function(n){return n.nodeType===9&&n.documentElement.nodeName!=="HTML"||!!n.ownerDocument&&n.ownerDocument.documentElement.nodeName!=="HTML"},A=function(n,m){for(var r=[],p="",s,u=m.nodeType?[m]:m;s=j.match.PSEUDO.exec(n);){p+=
s[0];n=n.replace(j.match.PSEUDO,"")}n=j.relative[n]?n+"*":n;s=0;for(var v=u.length;s<v;s++)i(n,u[s],r);return i.filter(p,r)};window.Sizzle=i})();(function(b){var c=Prototype.Selector.extendElements;Prototype.Selector.engine=b;Prototype.Selector.select=function(d,e){return c(b(d,e||document))};Prototype.Selector.match=function(d,e){return b.matches(e,[d]).length==1}})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(b){b=$(b);b.reset();return b},serializeElements:function(b,c){if(typeof c!="object")c={hash:!!c};else if(Object.isUndefined(c.hash))c.hash=true;var d,e,f=false,h=c.submit,g=b.inject({},function(i,j){if(!j.disabled&&j.name){d=j.name;e=$(j).getValue();if(e!=null&&j.type!="file"&&(j.type!="submit"||!f&&h!==false&&(!h||d==h)&&(f=true)))if(d in i){Object.isArray(i[d])||(i[d]=[i[d]]);i[d].push(e)}else i[d]=e}return i});return c.hash?g:Object.toQueryString(g)}};
Form.Methods={serialize:function(b,c){return Form.serializeElements(Form.getElements(b),c)},getElements:function(b){b=$(b).getElementsByTagName("*");for(var c,d=[],e=Form.Element.Serializers,f=0;c=b[f];f++)d.push(c);return d.inject([],function(h,g){e[g.tagName.toLowerCase()]&&h.push(Element.extend(g));return h})},getInputs:function(b,c,d){b=$(b);b=b.getElementsByTagName("input");if(!c&&!d)return $A(b).map(Element.extend);for(var e=0,f=[],h=b.length;e<h;e++){var g=b[e];c&&g.type!=c||d&&g.name!=d||
f.push(Element.extend(g))}return f},disable:function(b){b=$(b);Form.getElements(b).invoke("disable");return b},enable:function(b){b=$(b);Form.getElements(b).invoke("enable");return b},findFirstElement:function(b){b=$(b).getElements().findAll(function(d){return"hidden"!=d.type&&!d.disabled});var c=b.findAll(function(d){return d.hasAttribute("tabIndex")&&d.tabIndex>=0}).sortBy(function(d){return d.tabIndex}).first();return c?c:b.find(function(d){return/^(?:input|select|textarea)$/i.test(d.tagName)})},
focusFirstElement:function(b){b=$(b);b.findFirstElement().activate();return b},request:function(b,c){b=$(b);c=Object.clone(c||{});var d=c.parameters,e=b.readAttribute("action")||"";if(e.blank())e=window.location.href;c.parameters=b.serialize(true);if(d){if(Object.isString(d))d=d.toQueryParams();Object.extend(c.parameters,d)}if(b.hasAttribute("method")&&!c.method)c.method=b.method;return new Ajax.Request(e,c)}};
Form.Element={focus:function(b){$(b).focus();return b},select:function(b){$(b).select();return b}};
Form.Element.Methods={serialize:function(b){b=$(b);if(!b.disabled&&b.name){var c=b.getValue();if(c!=undefined){var d={};d[b.name]=c;return Object.toQueryString(d)}}return""},getValue:function(b){b=$(b);var c=b.tagName.toLowerCase();return Form.Element.Serializers[c](b)},setValue:function(b,c){b=$(b);var d=b.tagName.toLowerCase();Form.Element.Serializers[d](b,c);return b},clear:function(b){$(b).value="";return b},present:function(b){return $(b).value!=""},activate:function(b){b=$(b);try{b.focus();
if(b.select&&(b.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(b.type)))b.select()}catch(c){}return b},disable:function(b){b=$(b);b.disabled=true;return b},enable:function(b){b=$(b);b.disabled=false;return b}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers={input:function(b,c){switch(b.type.toLowerCase()){case "checkbox":case "radio":return Form.Element.Serializers.inputSelector(b,c);default:return Form.Element.Serializers.textarea(b,c)}},inputSelector:function(b,c){if(Object.isUndefined(c))return b.checked?b.value:null;else b.checked=!!c},textarea:function(b,c){if(Object.isUndefined(c))return b.value;else b.value=c},select:function(b,c){if(Object.isUndefined(c))return this[b.type=="select-one"?"selectOne":"selectMany"](b);
else for(var d,e,f=!Object.isArray(c),h=0,g=b.length;h<g;h++){d=b.options[h];e=this.optionValue(d);if(f){if(e==c){d.selected=true;break}}else d.selected=c.include(e)}},selectOne:function(b){var c=b.selectedIndex;return c>=0?this.optionValue(b.options[c]):null},selectMany:function(b){var c,d=b.length;if(!d)return null;var e=0;for(c=[];e<d;e++){var f=b.options[e];f.selected&&c.push(this.optionValue(f))}return c},optionValue:function(b){return Element.extend(b).hasAttribute("value")?b.value:b.text}};
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,c,d,e){$super(e,d);this.element=$(c);this.lastValue=this.getValue()},execute:function(){var b=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(b)?this.lastValue!=b:String(this.lastValue)!=String(b)){this.callback(this.element,b);this.lastValue=b}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(b,c){this.element=$(b);this.callback=c;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var b=this.getValue();if(this.lastValue!=b){this.callback(this.element,b);this.lastValue=b}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(b){if(b.type)switch(b.type.toLowerCase()){case "checkbox":case "radio":Event.observe(b,
"click",this.onElementEvent.bind(this));break;default:Event.observe(b,"change",this.onElementEvent.bind(this))}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function b(m){var r=document.documentElement,p=document.body||{scrollLeft:0};return m.pageX||m.clientX+(r.scrollLeft||p.scrollLeft)-(r.clientLeft||0)}function c(m){var r=document.documentElement,p=document.body||{scrollTop:0};return m.pageY||m.clientY+(r.scrollTop||p.scrollTop)-(r.clientTop||0)}function d(m,r,p){var s=Element.retrieve(m,"prototype_event_registry");if(Object.isUndefined(s)){z.push(m);s=Element.retrieve(m,"prototype_event_registry",$H())}var u=s.get(r);if(Object.isUndefined(u)){u=
[];s.set(r,u)}if(u.pluck("handler").include(p))return false;var v;if(r.include(":"))v=function(y){if(Object.isUndefined(y.eventName))return false;if(y.eventName!==r)return false;j.extend(y,m);p.call(m,y)};else if(!l&&(r==="mouseenter"||r==="mouseleave")){if(r==="mouseenter"||r==="mouseleave")v=function(y){j.extend(y,m);for(var x=y.relatedTarget;x&&x!==m;)try{x=x.parentNode}catch(B){x=m}x!==m&&p.call(m,y)}}else v=function(y){j.extend(y,m);p.call(m,y)};v.handler=p;u.push(v);return v}function e(){for(var m=
0,r=z.length;m<r;m++){j.stopObserving(z[m]);z[m]=null}}function f(m,r,p){m=$(m);p=d(m,r,p);if(!p)return m;if(r.include(":"))if(m.addEventListener)m.addEventListener("dataavailable",p,false);else{m.attachEvent("ondataavailable",p);m.attachEvent("onfilterchange",p)}else{r=A(r);m.addEventListener?m.addEventListener(r,p,false):m.attachEvent("on"+r,p)}return m}function h(m,r,p){m=$(m);var s=Element.retrieve(m,"prototype_event_registry");if(!s)return m;if(!r){s.each(function(x){h(m,x.key)});return m}var u=
s.get(r);if(!u)return m;if(!p){u.each(function(x){h(m,r,x.handler)});return m}var v=u.find(function(x){return x.handler===p});if(!v)return m;if(r.include(":"))if(m.removeEventListener)m.removeEventListener("dataavailable",v,false);else{m.detachEvent("ondataavailable",v);m.detachEvent("onfilterchange",v)}else{var y=A(r);m.removeEventListener?m.removeEventListener(y,v,false):m.detachEvent("on"+y,v)}s.set(r,u.without(v));return m}function g(m,r,p,s){m=$(m);if(Object.isUndefined(s))s=true;if(m==document&&
document.createEvent&&!m.dispatchEvent)m=document.documentElement;var u;if(document.createEvent){u=document.createEvent("HTMLEvents");u.initEvent("dataavailable",true,true)}else{u=document.createEventObject();u.eventType=s?"ondataavailable":"onfilterchange"}u.eventName=r;u.memo=p||{};document.createEvent?m.dispatchEvent(u):m.fireEvent(u.eventType,u);return j.extend(u)}function i(m,r,p,s){m=$(m);if(Object.isFunction(p)&&Object.isUndefined(s)){s=p;p=null}return(new j.Handler(m,r,p,s)).start()}var j=
{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},k=document.documentElement,l="onmouseenter"in k&&"onmouseleave"in k,o;if(Prototype.Browser.IE){var q={0:1,1:4,2:2};o=function(m,r){return m.button===q[r]}}else o=Prototype.Browser.WebKit?function(m,r){switch(r){case 0:return m.which==1&&!m.metaKey;case 1:return m.which==1&&m.metaKey;default:return false}}:function(m,
r){return m.which?m.which===r+1:m.button===r};j.Methods={isLeftClick:function(m){return o(m,0)},isMiddleClick:function(m){return o(m,1)},isRightClick:function(m){return o(m,2)},element:function(m){m=j.extend(m);var r=m.target,p=m.type;if((m=m.currentTarget)&&m.tagName)if(p==="load"||p==="error"||p==="click"&&m.tagName.toLowerCase()==="input"&&m.type==="radio")r=m;if(r.nodeType==Node.TEXT_NODE)r=r.parentNode;return Element.extend(r)},findElement:function(m,r){var p=j.element(m);if(!r)return p;for(;p;){if(Object.isElement(p)&&
Prototype.Selector.match(p,r))return Element.extend(p);p=p.parentNode}},pointer:function(m){return{x:b(m),y:c(m)}},pointerX:b,pointerY:c,stop:function(m){j.extend(m);m.preventDefault();m.stopPropagation();m.stopped=true}};var t=Object.keys(j.Methods).inject({},function(m,r){m[r]=j.Methods[r].methodize();return m});if(Prototype.Browser.IE){var w=function(m){switch(m.type){case "mouseover":m=m.fromElement;break;case "mouseout":m=m.toElement;break;default:return null}return Element.extend(m)};Object.extend(t,
{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});j.extend=function(m,r){if(!m)return false;if(m._extendedByPrototype)return m;m._extendedByPrototype=Prototype.emptyFunction;var p=j.pointer(m);Object.extend(m,{target:m.srcElement||r,relatedTarget:w(m),pageX:p.x,pageY:p.y});return Object.extend(m,t)}}else{j.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(j.prototype,
t);j.extend=Prototype.K}var z=[];Prototype.Browser.IE&&window.attachEvent("onunload",e);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,false);var A=Prototype.K,n={mouseenter:"mouseover",mouseleave:"mouseout"};l||(A=function(m){return n[m]||m});j.Handler=Class.create({initialize:function(m,r,p,s){this.element=$(m);this.eventName=r;this.selector=p;this.callback=s;this.handler=this.handleEvent.bind(this)},start:function(){j.observe(this.element,this.eventName,this.handler);
return this},stop:function(){j.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(m){var r=m.findElement(this.selector);r&&this.callback.call(this.element,m,r)}});Object.extend(j,j.Methods);Object.extend(j,{fire:g,observe:f,stopObserving:h,on:i});Element.addMethods({fire:g,observe:f,stopObserving:h,on:i});Object.extend(document,{fire:g.methodize(),observe:f.methodize(),stopObserving:h.methodize(),on:i.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,
j);else window.Event=j})();
(function(){function b(){if(!document.loaded){e&&window.clearTimeout(e);document.loaded=true;document.fire("dom:loaded")}}function c(){if(document.readyState==="complete"){document.stopObserving("readystatechange",c);b()}}function d(){try{document.documentElement.doScroll("left")}catch(f){e=d.defer();return}b()}var e;if(document.addEventListener)document.addEventListener("DOMContentLoaded",b,false);else{document.observe("readystatechange",c);if(window==top)e=d.defer()}Event.observe(window,"load",
b)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(b,c){return Element.insert(b,{before:c})},Top:function(b,c){return Element.insert(b,{top:c})},Bottom:function(b,c){return Element.insert(b,{bottom:c})},After:function(b,c){return Element.insert(b,{after:c})}},$continue=Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||
document.body.scrollTop||0},within:function(b,c,d){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(b,c,d);this.xcomp=c;this.ycomp=d;this.offset=Element.cumulativeOffset(b);return d>=this.offset[1]&&d<this.offset[1]+b.offsetHeight&&c>=this.offset[0]&&c<this.offset[0]+b.offsetWidth},withinIncludingScrolloffsets:function(b,c,d){var e=Element.cumulativeScrollOffset(b);this.xcomp=c+e[0]-this.deltaX;this.ycomp=d+e[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return this.ycomp>=
this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth},overlap:function(b,c){if(!b)return 0;if(b=="vertical")return(this.offset[1]+c.offsetHeight-this.ycomp)/c.offsetHeight;if(b=="horizontal")return(this.offset[0]+c.offsetWidth-this.xcomp)/c.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(b){Position.prepare();return Element.absolutize(b)},relativize:function(b){Position.prepare();
return Element.relativize(b)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,c,d){d=d||{};return Element.clonePosition(c,b,d)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(b){function c(d){return d.blank()?null:"[contains(concat(' ', @class, ' '), ' "+d+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(d,e){e=e.toString().strip();var f=/\s/.test(e)?$w(e).map(c).join(""):c(e);return f?document._getElementsByXPath(".//*"+f,d):[]}:function(d,e){e=e.toString().strip();var f=[],h=/\s/.test(e)?$w(e):null;if(!h&&!e)return f;var g=$(d).getElementsByTagName("*");e=" "+e+" ";for(var i=
0,j,k;j=g[i];i++)if(j.className&&(k=" "+j.className+" ")&&(k.include(e)||h&&h.all(function(l){return!l.toString().blank()&&k.include(" "+l+" ")})))f.push(Element.extend(j));return f};return function(d,e){return $(e||document.body).getElementsByClassName(d)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(b){this.element=$(b)},_each:function(b){this.element.className.split(/\s+/).select(function(c){return c.length>0})._each(b)},set:function(b){this.element.className=b},add:function(b){this.include(b)||this.set($A(this).concat(b).join(" "))},remove:function(b){this.include(b)&&this.set($A(this).without(b).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(b){this.expression=b.strip()},findElements:function(b){return Prototype.Selector.select(this.expression,b)},match:function(b){return Prototype.Selector.match(b,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(b,c){for(var d=Prototype.Selector.match,e=[],f=0,h=b.length;f<h;f++){var g=b[f];d(g,c)&&e.push(Element.extend(g))}return e},
findElement:function(b,c,d){d=d||0;for(var e=0,f,h=0,g=b.length;h<g;h++){f=b[h];if(Prototype.Selector.match(f,c)&&d===e++)return Element.extend(f)}},findChildElements:function(b,c){var d=c.toArray().join(", ");return Prototype.Selector.select(d,b||document)}})})();
(function(b){var c=Object.prototype.toString,d={get:function(e){return d.has(e)?d.list()[e]:null},has:function(e){return RegExp("(?:;\\s*|^)"+encodeURIComponent(e)+"=").test(document.cookie)},list:function(e){for(var f=document.cookie.split("; "),h,g={},i=0,j=f.length;i<j;++i){h=f[i].split("=");if("[object RegExp]"!=c.call(e)||e.test(h[0]))g[decodeURIComponent(h[0])]=decodeURIComponent(h[1])}return g},remove:function(e,f){var h={},g;for(g in f||{})opts2[g]=f[g];h.expires=new Date(0);h.maxAge=-1;return d.set(e,
null,h)},set:function(e,f,h){h=h||{};e=[encodeURIComponent(e)+"="+encodeURIComponent(f)];h.path&&e.push("path="+h.path);h.domain&&e.push("domain="+h.path);f="maxAge"in h?h.maxAge:"max_age"in h?h.max_age:h["max-age"];var g;if("undefined"!=typeof f&&"null"!=typeof f&&!isNaN(g=parseFloat(f)))e.push("max-age="+g);(g="[object Date]"==c.call(h.expires)?h.expires.toUTCString():h.expires)&&e.push("expires="+g);h.secure&&e.push("secure");e=e.join("; ");return document.cookie=e},test:function(){d.remove("70ab3d396b85e670f25b93be05e027e4eb655b71");
d.set("70ab3d396b85e670f25b93be05e027e4eb655b71","\u00c9lodie Jaubert");var e="\u00c9lodie Jaubert"==d.get("70ab3d396b85e670f25b93be05e027e4eb655b71");d.remove("70ab3d396b85e670f25b93be05e027e4eb655b71");return e}};b.Cookie=d})(window);var a;function extend(b,c){for(var d in c)b[d]=c[d]}var b2Settings=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){};b2Settings.prototype.__varz=function(){};b2Settings.USHRT_MAX=65535;
b2Settings.b2_pi=Math.PI;b2Settings.b2_maxManifoldPoints=2;b2Settings.b2_maxPolygonVertices=8;b2Settings.b2_maxProxies=1024;b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies;b2Settings.b2_linearSlop=0.005;b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi;b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop;b2Settings.b2_maxTOIContactsPerIsland=32;b2Settings.b2_velocityThreshold=1;b2Settings.b2_maxLinearCorrection=0.2;b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi;
b2Settings.b2_maxLinearVelocity=200;b2Settings.b2_maxLinearVelocitySquared=b2Settings.b2_maxLinearVelocity*b2Settings.b2_maxLinearVelocity;b2Settings.b2_maxAngularVelocity=250;b2Settings.b2_maxAngularVelocitySquared=b2Settings.b2_maxAngularVelocity*b2Settings.b2_maxAngularVelocity;b2Settings.b2_contactBaumgarte=0.2;b2Settings.b2_timeToSleep=0.5;b2Settings.b2_linearSleepTolerance=0.01;b2Settings.b2_angularSleepTolerance=2/180;b2Settings.b2Assert=function(b){b||(void 0).x++};
var b2Vec2=function(b,c){if(arguments.length==2){this.x=b;this.y=c}};b2Vec2.Make=function(b,c){return new b2Vec2(b,c)};a=b2Vec2.prototype;a.x=0;a.y=0;a.SetZero=function(){this.y=this.x=0};a.Set=function(b,c){this.x=b;this.y=c};a.SetV=function(b){this.x=b.x;this.y=b.y};a.Negative=function(){return new b2Vec2(-this.x,-this.y)};a.Copy=function(){return new b2Vec2(this.x,this.y)};a.Add=function(b){this.x+=b.x;this.y+=b.y};a.Subtract=function(b){this.x-=b.x;this.y-=b.y};
a.Multiply=function(b){this.x*=b;this.y*=b};a.MulM=function(b){var c=this.x;this.x=b.col1.x*c+b.col2.x*this.y;this.y=b.col1.y*c+b.col2.y*this.y};a.MulTM=function(b){var c=b2Math.b2Dot(this,b.col1);this.y=b2Math.b2Dot(this,b.col2);this.x=c};a.CrossVF=function(b){var c=this.x;this.x=b*this.y;this.y=-b*c};a.CrossFV=function(b){var c=this.x;this.x=-b*this.y;this.y=b*c};a.MinV=function(b){this.x=this.x<b.x?this.x:b.x;this.y=this.y<b.y?this.y:b.y};
a.MaxV=function(b){this.x=this.x>b.x?this.x:b.x;this.y=this.y>b.y?this.y:b.y};a.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};a.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.LengthSquared=function(){return this.x*this.x+this.y*this.y};a.Normalize=function(){var b=Math.sqrt(this.x*this.x+this.y*this.y);if(b<Number.MIN_VALUE)return 0;var c=1/b;this.x*=c;this.y*=c;return b};a.IsValid=function(){return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y)};
var b2BufferedPair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BufferedPair.prototype.__constructor=function(){};b2BufferedPair.prototype.__varz=function(){};b2BufferedPair.prototype.proxyId1=0;b2BufferedPair.prototype.proxyId2=0;var b2AABB=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2AABB.prototype;a.__constructor=function(){};a.__varz=function(){this.lowerBound=new b2Vec2;this.upperBound=new b2Vec2};a.lowerBound=new b2Vec2;a.upperBound=new b2Vec2;
a.IsValid=function(){var b=this.upperBound.y-this.lowerBound.y;return this.upperBound.x-this.lowerBound.x>=0&&b>=0&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};var b2Pair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){};b2Pair.prototype.__varz=function(){};b2Pair.b2_nullPair=b2Settings.USHRT_MAX;b2Pair.b2_nullProxy=b2Settings.USHRT_MAX;b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs;
b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1;b2Pair.e_pairBuffered=1;b2Pair.e_pairRemoved=2;b2Pair.e_pairFinal=4;a=b2Pair.prototype;a.userData=null;a.proxyId1=0;a.proxyId2=0;a.next=0;a.status=0;a.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered};a.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered};a.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered};a.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved};
a.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved};a.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved};a.SetFinal=function(){this.status|=b2Pair.e_pairFinal};a.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal};var b2TimeStep=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2TimeStep.prototype;a.__constructor=function(){};a.__varz=function(){};a.dt=null;a.inv_dt=null;a.dtRatio=null;a.maxIterations=0;
a.warmStarting=null;a.positionCorrection=null;var b2Manifold=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Manifold.prototype;a.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b]=new b2ManifoldPoint;this.normal=new b2Vec2};a.__varz=function(){};a.points=null;a.normal=null;a.pointCount=0;
a.Reset=function(){for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b].Reset();this.normal.SetZero();this.pointCount=0};a.Set=function(b){this.pointCount=b.pointCount;for(var c=0;c<b2Settings.b2_maxManifoldPoints;c++)this.points[c].Set(b.points[c]);this.normal.SetV(b.normal)};var b2Point=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Point.prototype;a.__constructor=function(){};a.__varz=function(){this.p=new b2Vec2};a.p=new b2Vec2;a.Support=function(){return this.p};
a.GetFirstVertex=function(){return this.p};var b2Bound=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Bound.prototype;a.__constructor=function(){};a.__varz=function(){};a.value=0;a.proxyId=0;a.stabbingCount=0;a.IsLower=function(){return(this.value&1)==0};a.IsUpper=function(){return(this.value&1)==1};
a.Swap=function(b){var c=this.value,d=this.proxyId,e=this.stabbingCount;this.value=b.value;this.proxyId=b.proxyId;this.stabbingCount=b.stabbingCount;b.value=c;b.proxyId=d;b.stabbingCount=e};var b2Mat22=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Mat22.prototype;a.__constructor=function(b,c,d){if(c!=null&&d!=null){this.col1.SetV(c);this.col2.SetV(d)}else{c=Math.cos(b);b=Math.sin(b);this.col1.x=c;this.col2.x=-b;this.col1.y=b;this.col2.y=c}};
a.__varz=function(){this.col1=new b2Vec2;this.col2=new b2Vec2};a.col1=new b2Vec2;a.col2=new b2Vec2;a.Set=function(b){var c=Math.cos(b);b=Math.sin(b);this.col1.x=c;this.col2.x=-b;this.col1.y=b;this.col2.y=c};a.SetVV=function(b,c){this.col1.SetV(b);this.col2.SetV(c)};a.Copy=function(){return new b2Mat22(0,this.col1,this.col2)};a.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2)};a.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y};
a.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};a.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};a.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};a.Invert=function(b){var c=this.col1.x,d=this.col2.x,e=this.col1.y,f=this.col2.y,h=c*f-d*e;h=1/h;b.col1.x=h*f;b.col2.x=-h*d;b.col1.y=-h*e;b.col2.y=h*c;return b};
a.Solve=function(b,c,d){var e=this.col1.x,f=this.col2.x,h=this.col1.y,g=this.col2.y,i=e*g-f*h;i=1/i;b.x=i*(g*c-f*d);b.y=i*(e*d-h*c);return b};a.Abs=function(){this.col1.Abs();this.col2.Abs()};var b2BoundaryListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundaryListener.prototype.__constructor=function(){};b2BoundaryListener.prototype.__varz=function(){};b2BoundaryListener.prototype.Violation=function(){};
var b2MassData=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2MassData.prototype;a.__constructor=function(){};a.__varz=function(){this.center=new b2Vec2(0,0)};a.mass=0;a.center=new b2Vec2(0,0);a.I=0;var b2JointEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2JointEdge.prototype;a.__constructor=function(){};a.__varz=function(){};a.other=null;a.joint=null;a.prev=null;a.next=null;
var b2Collision=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){};b2Collision.prototype.__varz=function(){};b2Collision.b2_nullFeature=255;b2Collision.b2CollidePolyTempVec=new b2Vec2;
b2Collision.ClipSegmentToLine=function(b,c,d,e){var f,h=0;f=c[0];var g=f.v;f=c[1];var i=f.v,j=b2Math.b2Dot(d,g)-e;f=b2Math.b2Dot(d,i)-e;if(j<=0)b[h++]=c[0];if(f<=0)b[h++]=c[1];if(j*f<0){d=j/(j-f);f=b[h];f=f.v;f.x=g.x+d*(i.x-g.x);f.y=g.y+d*(i.y-g.y);f=b[h];f.id=(j>0?c[0]:c[1]).id;++h}return h};
b2Collision.EdgeSeparation=function(b,c,d,e,f){var h=b.m_vertices;b=b.m_normals;var g=e.m_vertexCount,i=e.m_vertices,j,k;j=c.R;k=b[d];b=j.col1.x*k.x+j.col2.x*k.y;e=j.col1.y*k.x+j.col2.y*k.y;j=f.R;var l=j.col1.x*b+j.col1.y*e;j=j.col2.x*b+j.col2.y*e;for(var o=0,q=Number.MAX_VALUE,t=0;t<g;++t){k=i[t];k=k.x*l+k.y*j;if(k<q){q=k;o=t}}k=h[d];j=c.R;d=c.position.x+(j.col1.x*k.x+j.col2.x*k.y);c=c.position.y+(j.col1.y*k.x+j.col2.y*k.y);k=i[o];j=f.R;h=f.position.x+(j.col1.x*k.x+j.col2.x*k.y);f=f.position.y+(j.col1.y*
k.x+j.col2.y*k.y);h-=d;f-=c;return h*b+f*e};
b2Collision.FindMaxSeparation=function(b,c,d,e,f){var h=c.m_vertexCount,g=c.m_normals,i,j;j=f.R;i=e.m_centroid;var k=f.position.x+(j.col1.x*i.x+j.col2.x*i.y),l=f.position.y+(j.col1.y*i.x+j.col2.y*i.y);j=d.R;i=c.m_centroid;k-=d.position.x+(j.col1.x*i.x+j.col2.x*i.y);l-=d.position.y+(j.col1.y*i.x+j.col2.y*i.y);j=k*d.R.col1.x+l*d.R.col1.y;l=k*d.R.col2.x+l*d.R.col2.y;k=0;for(var o=-Number.MAX_VALUE,q=0;q<h;++q){i=g[q];i=i.x*j+i.y*l;if(i>o){o=i;k=q}}g=b2Collision.EdgeSeparation(c,d,k,e,f);if(g>0)return g;
l=k-1>=0?k-1:h-1;o=b2Collision.EdgeSeparation(c,d,l,e,f);if(o>0)return o;q=k+1<h?k+1:0;var t=b2Collision.EdgeSeparation(c,d,q,e,f);if(t>0)return t;if(o>g&&o>t){j=-1;i=l;l=o}else if(t>g){j=1;i=q;l=t}else{b[0]=k;return g}for(;;){k=j==-1?i-1>=0?i-1:h-1:i+1<h?i+1:0;g=b2Collision.EdgeSeparation(c,d,k,e,f);if(g>0)return g;if(g>l){i=k;l=g}else break}b[0]=i;return l};
b2Collision.FindIncidentEdge=function(b,c,d,e,f,h){var g=c.m_normals,i=f.m_vertexCount;c=f.m_vertices;f=f.m_normals;var j;j=d.R;d=g[e];g=j.col1.x*d.x+j.col2.x*d.y;var k=j.col1.y*d.x+j.col2.y*d.y;j=h.R;d=j.col1.x*g+j.col1.y*k;k=j.col2.x*g+j.col2.y*k;g=d;j=0;for(var l=Number.MAX_VALUE,o=0;o<i;++o){d=f[o];d=g*d.x+k*d.y;if(d<l){l=d;j=o}}f=j;g=f+1<i?f+1:0;i=b[0];d=c[f];j=h.R;i.v.x=h.position.x+(j.col1.x*d.x+j.col2.x*d.y);i.v.y=h.position.y+(j.col1.y*d.x+j.col2.y*d.y);i.id.features.referenceEdge=e;i.id.features.incidentEdge=
f;i.id.features.incidentVertex=0;i=b[1];d=c[g];j=h.R;i.v.x=h.position.x+(j.col1.x*d.x+j.col2.x*d.y);i.v.y=h.position.y+(j.col1.y*d.x+j.col2.y*d.y);i.id.features.referenceEdge=e;i.id.features.incidentEdge=g;i.id.features.incidentVertex=1};
b2Collision.b2CollidePolygons=function(b,c,d,e,f){var h=b.pointCount=0,g=[h],i=b2Collision.FindMaxSeparation(g,c,d,e,f);h=g[0];if(!(i>0)){var j=0;g=[j];var k=b2Collision.FindMaxSeparation(g,e,f,c,d);j=g[0];if(!(k>0)){var l=new b2XForm,o=new b2XForm,q=0;if(k>0.98*i+0.001){i=e;e=c;l.Set(f);o.Set(d);q=j;g=1}else{i=c;l.Set(d);o.Set(f);q=h;g=0}c=[new ClipVertex,new ClipVertex];b2Collision.FindIncidentEdge(c,i,l,q,e,o);h=i.m_vertexCount;o=i.m_vertices;i=o[q];e=i.Copy();i=q+1<h?o[parseInt(q+1)]:o[0];i=i.Copy();
b2Math.SubtractVV(i,e);h=b2Math.b2MulMV(l.R,b2Math.SubtractVV(i,e));h.Normalize();q=b2Math.b2CrossVF(h,1);e=b2Math.b2MulX(l,e);i=b2Math.b2MulX(l,i);l=b2Math.b2Dot(q,e);o=-b2Math.b2Dot(h,e);i=b2Math.b2Dot(h,i);j=[new ClipVertex,new ClipVertex];e=[new ClipVertex,new ClipVertex];k=b2Collision.ClipSegmentToLine(j,c,h.Negative(),o);if(!(k<2)){k=b2Collision.ClipSegmentToLine(e,j,h,i);if(!(k<2)){b.normal=g?q.Negative():q.Copy();for(o=h=0;o<b2Settings.b2_maxManifoldPoints;++o){c=e[o];i=b2Math.b2Dot(q,c.v)-
l;if(i<=0){j=b.points[h];j.separation=i;j.localPoint1=b2Math.b2MulXT(d,c.v);j.localPoint2=b2Math.b2MulXT(f,c.v);j.id.key=c.id._key;j.id.features.flip=g;++h}}b.pointCount=h}}}}};
b2Collision.b2CollideCircles=function(b,c,d,e,f){b.pointCount=0;var h,g;h=d.R;g=c.m_localPosition;var i=d.position.x+(h.col1.x*g.x+h.col2.x*g.y),j=d.position.y+(h.col1.y*g.x+h.col2.y*g.y);h=f.R;g=e.m_localPosition;var k=f.position.x+(h.col1.x*g.x+h.col2.x*g.y);h=f.position.y+(h.col1.y*g.x+h.col2.y*g.y);g=k-i;var l=h-j,o=g*g+l*l;c=c.m_radius;e=e.m_radius;var q=c+e;if(!(o>q*q)){if(o<Number.MIN_VALUE){o=-q;b.normal.Set(0,1)}else{var t=Math.sqrt(o);o=t-q;q=1/t;b.normal.x=q*g;b.normal.y=q*l}b.pointCount=
1;g=b.points[0];g.id.key=0;g.separation=o;i+=c*b.normal.x;j+=c*b.normal.y;k-=e*b.normal.x;h-=e*b.normal.y;b=0.5*(i+k);j=0.5*(j+h);i=b-d.position.x;k=j-d.position.y;g.localPoint1.x=i*d.R.col1.x+k*d.R.col1.y;g.localPoint1.y=i*d.R.col2.x+k*d.R.col2.y;i=b-f.position.x;k=j-f.position.y;g.localPoint2.x=i*f.R.col1.x+k*f.R.col1.y;g.localPoint2.y=i*f.R.col2.x+k*f.R.col2.y}};
b2Collision.b2CollidePolygonAndCircle=function(b,c,d,e,f){b.pointCount=0;var h,g,i,j,k,l;l=f.R;k=e.m_localPosition;j=f.position.x+(l.col1.x*k.x+l.col2.x*k.y);var o=f.position.y+(l.col1.y*k.x+l.col2.y*k.y);g=j-d.position.x;i=o-d.position.y;l=d.R;var q=g*l.col1.x+i*l.col1.y;l=g*l.col2.x+i*l.col2.y;var t=0,w=-Number.MAX_VALUE;e=e.m_radius;var z=c.m_vertexCount;h=c.m_vertices;c=c.m_normals;for(var A=0;A<z;++A){k=h[A];g=q-k.x;i=l-k.y;k=c[A];g=k.x*g+k.y*i;if(g>e)return;if(g>w){w=g;t=A}}if(w<Number.MIN_VALUE){b.pointCount=
1;k=c[t];l=d.R;b.normal.x=l.col1.x*k.x+l.col2.x*k.y;b.normal.y=l.col1.y*k.x+l.col2.y*k.y;h=b.points[0];h.id.features.incidentEdge=t;h.id.features.incidentVertex=b2Collision.b2_nullFeature;h.id.features.referenceEdge=0;h.id.features.flip=0;j-=e*b.normal.x;b=o-e*b.normal.y;g=j-d.position.x;i=b-d.position.y;l=d.R;h.localPoint1.x=g*l.col1.x+i*l.col1.y;h.localPoint1.y=g*l.col2.x+i*l.col2.y;g=j-f.position.x;i=b-f.position.y;l=f.R;h.localPoint2.x=g*l.col1.x+i*l.col1.y;h.localPoint2.y=g*l.col2.x+i*l.col2.y;
h.separation=w-e}else{w=t;z=w+1<z?w+1:0;k=h[w];c=h[z];var n=c.x-k.x;A=c.y-k.y;var m=Math.sqrt(n*n+A*A);n/=m;A/=m;g=q-k.x;i=l-k.y;g=g*n+i*A;h=b.points[0];if(g<=0){i=k.x;k=k.y;h.id.features.incidentEdge=b2Collision.b2_nullFeature;h.id.features.incidentVertex=w}else if(g>=m){i=c.x;k=c.y;h.id.features.incidentEdge=b2Collision.b2_nullFeature;h.id.features.incidentVertex=z}else{i=n*g+k.x;k=A*g+k.y;h.id.features.incidentEdge=t;h.id.features.incidentVertex=0}g=q-i;i=l-k;q=Math.sqrt(g*g+i*i);g/=q;i/=q;if(!(q>
e)){b.pointCount=1;l=d.R;b.normal.x=l.col1.x*g+l.col2.x*i;b.normal.y=l.col1.y*g+l.col2.y*i;j-=e*b.normal.x;b=o-e*b.normal.y;g=j-d.position.x;i=b-d.position.y;l=d.R;h.localPoint1.x=g*l.col1.x+i*l.col1.y;h.localPoint1.y=g*l.col2.x+i*l.col2.y;g=j-f.position.x;i=b-f.position.y;l=f.R;h.localPoint2.x=g*l.col1.x+i*l.col1.y;h.localPoint2.y=g*l.col2.x+i*l.col2.y;h.separation=q-e;h.id.features.referenceEdge=0;h.id.features.flip=0}}};
b2Collision.b2TestOverlap=function(b,c){var d=c.lowerBound,e=b.upperBound,f=d.x-e.x,h=d.y-e.y;d=b.lowerBound;e=c.upperBound;b=d.y-e.y;if(f>0||h>0)return false;if(d.x-e.x>0||b>0)return false;return true};var b2ContactListener=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactListener.prototype;a.__constructor=function(){};a.__varz=function(){};a.Add=function(){};a.Persist=function(){};a.Remove=function(){};a.Result=function(){};
var b2PairCallback=function(){this.__varz();this.__constructor.apply(this,arguments)};b2PairCallback.prototype.__constructor=function(){};b2PairCallback.prototype.__varz=function(){};b2PairCallback.prototype.PairAdded=function(){return null};b2PairCallback.prototype.PairRemoved=function(){};var b2JointDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2JointDef.prototype;
a.__constructor=function(){this.type=b2Joint.e_unknownJoint;this.body2=this.body1=this.userData=null;this.collideConnected=false};a.__varz=function(){};a.type=0;a.userData=null;a.body1=null;a.body2=null;a.collideConnected=null;var b2Proxy=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Proxy.prototype;a.__constructor=function(){};a.__varz=function(){this.lowerBounds=[parseInt(0),parseInt(0)];this.upperBounds=[parseInt(0),parseInt(0)]};a.lowerBounds=[parseInt(0),parseInt(0)];
a.upperBounds=[parseInt(0),parseInt(0)];a.overlapCount=0;a.timeStamp=0;a.userData=null;a.GetNext=function(){return this.lowerBounds[0]};a.SetNext=function(b){this.lowerBounds[0]=b%65535};a.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid};var b2Color=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Color.prototype;
a.__constructor=function(b,c,d){this._r=parseInt(255*b2Math.b2Clamp(b,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(d,0,1))};a.__varz=function(){};a._r=0;a._g=0;a._b=0;a.Set=function(b,c,d){this._r=parseInt(255*b2Math.b2Clamp(b,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(d,0,1))};a.set=function(b){this._r=parseInt(255*b2Math.b2Clamp(b,0,1))};a.set=function(b){this._g=parseInt(255*b2Math.b2Clamp(b,0,1))};
a.set=function(b){this._b=parseInt(255*b2Math.b2Clamp(b,0,1))};a.get=function(){return this._r|this._g<<8|this._b<<16};var b2FilterData=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2FilterData.prototype;a.__constructor=function(){};a.__varz=function(){this.categoryBits=1;this.maskBits=65535};a.categoryBits=1;a.maskBits=65535;a.groupIndex=0;a.Copy=function(){var b=new b2FilterData;b.categoryBits=this.categoryBits;b.maskBits=this.maskBits;b.groupIndex=this.groupIndex;return b};
var b2PairManager=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2PairManager.prototype.__constructor=function(){var b=0;this.m_hashTable=Array(b2Pair.b2_tableCapacity);for(b=0;b<b2Pair.b2_tableCapacity;++b)this.m_hashTable[b]=b2Pair.b2_nullPair;this.m_pairs=Array(b2Settings.b2_maxPairs);for(b=0;b<b2Settings.b2_maxPairs;++b)this.m_pairs[b]=new b2Pair;this.m_pairBuffer=Array(b2Settings.b2_maxPairs);for(b=0;b<b2Settings.b2_maxPairs;++b)this.m_pairBuffer[b]=new b2BufferedPair;for(b=0;b<b2Settings.b2_maxPairs;++b){this.m_pairs[b].proxyId1=b2Pair.b2_nullProxy;this.m_pairs[b].proxyId2=
b2Pair.b2_nullProxy;this.m_pairs[b].userData=null;this.m_pairs[b].status=0;this.m_pairs[b].next=b+1}this.m_pairs[parseInt(b2Settings.b2_maxPairs-1)].next=b2Pair.b2_nullPair;this.m_pairBufferCount=this.m_pairCount=0};b2PairManager.prototype.__varz=function(){};b2PairManager.Hash=function(b,c){b=c<<16&4294901760|b;b=~b+(b<<15&4294934528);b^=b>>12&1048575;b+=b<<2&4294967292;b^=b>>4&268435455;b*=2057;b^=(b>>16)%65535;return b};b2PairManager.Equals=function(b,c,d){return b.proxyId1==c&&b.proxyId2==d};
b2PairManager.EqualsPair=function(b,c){return b.proxyId1==c.proxyId1&&b.proxyId2==c.proxyId2};a=b2PairManager.prototype;a.m_broadPhase=null;a.m_callback=null;a.m_pairs=null;a.m_freePair=0;a.m_pairCount=0;a.m_pairBuffer=null;a.m_pairBufferCount=0;a.m_hashTable=null;
a.AddPair=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;var e=e=this.FindHash(b,c,d);if(e!=null)return e;var f=this.m_freePair;e=this.m_pairs[f];this.m_freePair=e.next;e.proxyId1=b;e.proxyId2=c;e.status=0;e.userData=null;e.next=this.m_hashTable[d];this.m_hashTable[d]=f;++this.m_pairCount;return e};
a.RemovePair=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;for(var e=this.m_hashTable[d],f=null;e!=b2Pair.b2_nullPair;)if(b2PairManager.Equals(this.m_pairs[e],b,c)){b=e;c=this.m_pairs[e];if(f)f.next=c.next;else this.m_hashTable[d]=c.next;c=this.m_pairs[b];d=c.userData;c.next=this.m_freePair;c.proxyId1=b2Pair.b2_nullProxy;c.proxyId2=b2Pair.b2_nullProxy;c.userData=null;c.status=0;this.m_freePair=b;--this.m_pairCount;return d}else{f=this.m_pairs[e];e=f.next}return null};
a.Find=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;return this.FindHash(b,c,d)};a.FindHash=function(b,c,d){var e=this.m_hashTable[d];for(d=this.m_pairs[e];e!=b2Pair.b2_nullPair&&b2PairManager.Equals(d,b,c)==false;){e=d.next;d=this.m_pairs[e]}if(e==b2Pair.b2_nullPair)return null;return d};a.ValidateBuffer=function(){};a.ValidateTable=function(){};a.Initialize=function(b,c){this.m_broadPhase=b;this.m_callback=c};
a.AddBufferedPair=function(b,c){c=this.AddPair(b,c);if(c.IsBuffered()==false){c.SetBuffered();b=this.m_pairBuffer[this.m_pairBufferCount];b.proxyId1=c.proxyId1;b.proxyId2=c.proxyId2;++this.m_pairBufferCount}c.ClearRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()};
a.RemoveBufferedPair=function(b,c){c=this.Find(b,c);if(c!=null){if(c.IsBuffered()==false){c.SetBuffered();b=this.m_pairBuffer[this.m_pairBufferCount];b.proxyId1=c.proxyId1;b.proxyId2=c.proxyId2;++this.m_pairBufferCount}c.SetRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()}};
a.Commit=function(){var b,c=0,d=0,e=this.m_broadPhase.m_proxyPool;for(c=0;c<this.m_pairBufferCount;++c){b=this.m_pairBuffer[c];var f=this.Find(b.proxyId1,b.proxyId2);f.ClearBuffered();b=e[f.proxyId1];var h=e[f.proxyId2];if(f.IsRemoved()){f.IsFinal()==true&&this.m_callback.PairRemoved(b.userData,h.userData,f.userData);b=this.m_pairBuffer[d];b.proxyId1=f.proxyId1;b.proxyId2=f.proxyId2;++d}else if(f.IsFinal()==false){f.userData=this.m_callback.PairAdded(b.userData,h.userData);f.SetFinal()}}for(c=0;c<
d;++c){b=this.m_pairBuffer[c];this.RemovePair(b.proxyId1,b.proxyId2)}this.m_pairBufferCount=0;b2BroadPhase.s_validate&&this.ValidateTable()};var b2ContactSolver=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactSolver.prototype;
a.__constructor=function(b,c,d,e){var f;this.m_step.dt=b.dt;this.m_step.inv_dt=b.inv_dt;this.m_step.maxIterations=b.maxIterations;this.m_allocator=e;var h;for(b=this.m_constraintCount=0;b<d;++b){f=c[b];this.m_constraintCount+=f.m_manifoldCount}for(b=0;b<this.m_constraintCount;b++)this.m_constraints[b]=new b2ContactConstraint;for(b=e=0;b<d;++b){f=c[b];var g=f.m_shape1.m_body,i=f.m_shape2.m_body,j=f.m_manifoldCount,k=f.GetManifolds(),l=f.m_friction;f=f.m_restitution;for(var o=g.m_linearVelocity.x,q=
g.m_linearVelocity.y,t=i.m_linearVelocity.x,w=i.m_linearVelocity.y,z=g.m_angularVelocity,A=i.m_angularVelocity,n=0;n<j;++n){var m=k[n],r=m.normal.x,p=m.normal.y,s=this.m_constraints[e];s.body1=g;s.body2=i;s.manifold=m;s.normal.x=r;s.normal.y=p;s.pointCount=m.pointCount;s.friction=l;s.restitution=f;for(var u=0;u<s.pointCount;++u){var v=m.points[u],y=s.points[u];y.normalImpulse=v.normalImpulse;y.tangentImpulse=v.tangentImpulse;y.separation=v.separation;y.positionImpulse=0;y.localAnchor1.SetV(v.localPoint1);
y.localAnchor2.SetV(v.localPoint2);var x;h=g.m_xf.R;var B=v.localPoint1.x-g.m_sweep.localCenter.x,C=v.localPoint1.y-g.m_sweep.localCenter.y;x=h.col1.x*B+h.col2.x*C;C=h.col1.y*B+h.col2.y*C;B=x;y.r1.Set(B,C);h=i.m_xf.R;var E=v.localPoint2.x-i.m_sweep.localCenter.x;v=v.localPoint2.y-i.m_sweep.localCenter.y;x=h.col1.x*E+h.col2.x*v;v=h.col1.y*E+h.col2.y*v;E=x;y.r2.Set(E,v);h=B*B+C*C;x=E*E+v*v;var F=B*r+C*p,D=E*r+v*p,G=g.m_invMass+i.m_invMass;G+=g.m_invI*(h-F*F)+i.m_invI*(x-D*D);y.normalMass=1/G;G=g.m_mass*
g.m_invMass+i.m_mass*i.m_invMass;G+=g.m_mass*g.m_invI*(h-F*F)+i.m_mass*i.m_invI*(x-D*D);y.equalizedMass=1/G;D=-r;F=B*p+C*D;D=E*p+v*D;G=g.m_invMass+i.m_invMass;G+=g.m_invI*(h-F*F)+i.m_invI*(x-D*D);y.tangentMass=1/G;y.velocityBias=0;if(y.separation>0)y.velocityBias=-60*y.separation;x=t+-A*v-o- -z*C;B=s.normal.x*x+s.normal.y*(w+A*E-q-z*B);if(B<-b2Settings.b2_velocityThreshold)y.velocityBias+=-s.restitution*B}++e}}};a.__varz=function(){this.m_step=new b2TimeStep;this.m_constraints=[]};a.m_step=new b2TimeStep;
a.m_allocator=null;a.m_constraints=[];a.m_constraintCount=0;
a.InitVelocityConstraints=function(b){for(var c=0;c<this.m_constraintCount;++c){var d=this.m_constraints[c],e=d.body1,f=d.body2,h=e.m_invMass,g=e.m_invI,i=f.m_invMass,j=f.m_invI,k=d.normal.x,l=d.normal.y,o=-k,q=0,t=0;if(b.warmStarting){t=d.pointCount;for(q=0;q<t;++q){var w=d.points[q];w.normalImpulse*=b.dtRatio;w.tangentImpulse*=b.dtRatio;var z=w.normalImpulse*k+w.tangentImpulse*l,A=w.normalImpulse*l+w.tangentImpulse*o;e.m_angularVelocity-=g*(w.r1.x*A-w.r1.y*z);e.m_linearVelocity.x-=h*z;e.m_linearVelocity.y-=
h*A;f.m_angularVelocity+=j*(w.r2.x*A-w.r2.y*z);f.m_linearVelocity.x+=i*z;f.m_linearVelocity.y+=i*A}}else{t=d.pointCount;for(q=0;q<t;++q){e=d.points[q];e.normalImpulse=0;e.tangentImpulse=0}}}};
a.SolveVelocityConstraints=function(){for(var b=0,c,d,e,f,h,g,i=0;i<this.m_constraintCount;++i){var j=this.m_constraints[i],k=j.body1,l=j.body2,o=k.m_angularVelocity,q=l.m_angularVelocity,t=k.m_linearVelocity,w=l.m_linearVelocity,z=k.m_invMass,A=k.m_invI,n=l.m_invMass,m=l.m_invI,r=j.normal.x,p=j.normal.y,s=-r,u=j.friction,v=j.pointCount;for(b=0;b<v;++b){c=j.points[b];d=w.x+-q*c.r2.y-t.x- -o*c.r1.y;e=w.y+q*c.r2.x-t.y-o*c.r1.x;f=d*r+e*p;f=-c.normalMass*(f-c.velocityBias);d=d*p+e*s;e=c.tangentMass*-d;
d=b2Math.b2Max(c.normalImpulse+f,0);f=d-c.normalImpulse;h=u*c.normalImpulse;h=b2Math.b2Clamp(c.tangentImpulse+e,-h,h);e=h-c.tangentImpulse;g=f*r+e*p;f=f*p+e*s;t.x-=z*g;t.y-=z*f;o-=A*(c.r1.x*f-c.r1.y*g);w.x+=n*g;w.y+=n*f;q+=m*(c.r2.x*f-c.r2.y*g);c.normalImpulse=d;c.tangentImpulse=h}k.m_angularVelocity=o;l.m_angularVelocity=q}};
a.FinalizeVelocityConstraints=function(){for(var b=0;b<this.m_constraintCount;++b)for(var c=this.m_constraints[b],d=c.manifold,e=0;e<c.pointCount;++e){var f=d.points[e],h=c.points[e];f.normalImpulse=h.normalImpulse;f.tangentImpulse=h.tangentImpulse}};
a.SolvePositionConstraints=function(b){for(var c=0,d,e,f=0;f<this.m_constraintCount;++f)for(var h=this.m_constraints[f],g=h.body1,i=h.body2,j=g.m_sweep.c,k=g.m_sweep.a,l=i.m_sweep.c,o=i.m_sweep.a,q=g.m_mass*g.m_invMass,t=g.m_mass*g.m_invI,w=i.m_mass*i.m_invMass,z=i.m_mass*i.m_invI,A=h.normal.x,n=h.normal.y,m=h.pointCount,r=0;r<m;++r){var p=h.points[r];d=g.m_xf.R;e=g.m_sweep.localCenter;var s=p.localAnchor1.x-e.x,u=p.localAnchor1.y-e.y;y=d.col1.x*s+d.col2.x*u;u=d.col1.y*s+d.col2.y*u;s=y;d=i.m_xf.R;
e=i.m_sweep.localCenter;var v=p.localAnchor2.x-e.x;e=p.localAnchor2.y-e.y;var y=d.col1.x*v+d.col2.x*e;e=d.col1.y*v+d.col2.y*e;v=y;d=(l.x+v-(j.x+s))*A+(l.y+e-(j.y+u))*n+p.separation;c=b2Math.b2Min(c,d);d=b*b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);d=-p.equalizedMass*d;y=p.positionImpulse;p.positionImpulse=b2Math.b2Max(y+d,0);d=p.positionImpulse-y;p=d*A;d*=n;j.x-=q*p;j.y-=q*d;k-=t*(s*d-u*p);g.m_sweep.a=k;g.SynchronizeTransform();l.x+=w*p;l.y+=w*d;o+=z*(v*d-e*p);
i.m_sweep.a=o;i.SynchronizeTransform()}return c>=-1.5*b2Settings.b2_linearSlop};var b2BoundValues=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){};b2BoundValues.prototype.__varz=function(){this.lowerValues=[0,0];this.upperValues=[0,0]};b2BoundValues.prototype.lowerValues=[0,0];b2BoundValues.prototype.upperValues=[0,0];var Features=function(){this.__varz();this.__constructor.apply(this,arguments)};
Features.prototype={referenceEdge:function(){return this._referenceEdge},referenceEdge:function(b){this._referenceEdge=b;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255},incidentEdge:function(){return this._incidentEdge},incidentEdge:function(b){this._incidentEdge=b;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280},incidentVertex:function(b){this._incidentVertex=b;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680},incidentVertex:function(){return this._incidentVertex},
flip:function(b){this._flip=b;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080},flip:function(){return this._flip}};a=Features.prototype;a.__constructor=function(){};a.__varz=function(){};a._referenceEdge=0;a._incidentEdge=0;a._incidentVertex=0;a._flip=0;a._m_id=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype);a=b2MouseJointDef.prototype;
a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Joint.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7;this.timeStep=1/60};a.__varz=function(){this.target=new b2Vec2};a.target=new b2Vec2;a.maxForce=null;a.frequencyHz=null;a.dampingRatio=null;a.timeStep=null;var b2ContactConstraintPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactConstraintPoint.prototype;a.__constructor=function(){};
a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.r1=new b2Vec2;this.r2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.r1=new b2Vec2;a.r2=new b2Vec2;a.normalImpulse=null;a.tangentImpulse=null;a.positionImpulse=null;a.normalMass=null;a.tangentMass=null;a.equalizedMass=null;a.separation=null;a.velocityBias=null;var b2ContactRegister=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactRegister.prototype;a.__constructor=function(){};
a.__varz=function(){};a.createFcn=null;a.destroyFcn=null;a.primary=null;var b2DestructionListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){};b2DestructionListener.prototype.__varz=function(){};b2DestructionListener.prototype.SayGoodbyeJoint=function(){};b2DestructionListener.prototype.SayGoodbyeShape=function(){};
var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype);a=b2PulleyJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_pulleyJoint;this.groundAnchor1.Set(-1,1);this.groundAnchor2.Set(1,1);this.localAnchor1.Set(-1,0);this.localAnchor2.Set(1,0);this.maxLength2=this.length2=this.maxLength1=this.length1=0;this.ratio=1;this.collideConnected=true};a.__varz=function(){this.groundAnchor1=new b2Vec2;this.groundAnchor2=new b2Vec2;this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.groundAnchor1=new b2Vec2;a.groundAnchor2=new b2Vec2;a.localAnchor1=new b2Vec2;
a.localAnchor2=new b2Vec2;a.length1=null;a.maxLength1=null;a.length2=null;a.maxLength2=null;a.ratio=null;
a.Initialize=function(b,c,d,e,f,h,g){this.body1=b;this.body2=c;this.groundAnchor1.SetV(d);this.groundAnchor2.SetV(e);this.localAnchor1=this.body1.GetLocalPoint(f);this.localAnchor2=this.body2.GetLocalPoint(h);b=f.x-d.x;d=f.y-d.y;this.length1=Math.sqrt(b*b+d*d);d=h.x-e.x;e=h.y-e.y;this.length2=Math.sqrt(d*d+e*e);this.ratio=g;g=this.length1+this.ratio*this.length2;this.maxLength1=g-this.ratio*b2PulleyJoint.b2_minPulleyLength;this.maxLength2=(g-b2PulleyJoint.b2_minPulleyLength)/this.ratio};
var b2Jacobian=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Jacobian.prototype;a.__constructor=function(){};a.__varz=function(){this.linear1=new b2Vec2;this.linear2=new b2Vec2};a.linear1=new b2Vec2;a.angular1=null;a.linear2=new b2Vec2;a.angular2=null;a.SetZero=function(){this.linear1.SetZero();this.angular1=0;this.linear2.SetZero();this.angular2=0};a.Set=function(b,c,d,e){this.linear1.SetV(b);this.angular1=c;this.linear2.SetV(d);this.angular2=e};
a.Compute=function(b,c,d,e){return this.linear1.x*b.x+this.linear1.y*b.y+this.angular1*c+(this.linear2.x*d.x+this.linear2.y*d.y)+this.angular2*e};var b2DebugDraw=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0};b2DebugDraw.prototype.__varz=function(){};b2DebugDraw.e_shapeBit=1;b2DebugDraw.e_jointBit=2;b2DebugDraw.e_coreShapeBit=4;b2DebugDraw.e_aabbBit=8;b2DebugDraw.e_obbBit=16;b2DebugDraw.e_pairBit=32;
b2DebugDraw.e_centerOfMassBit=64;a=b2DebugDraw.prototype;a.m_drawFlags=0;a.m_sprite=null;a.m_drawScale=1;a.m_lineThickness=1;a.m_alpha=1;a.m_fillAlpha=1;a.m_xformScale=1;a.SetFlags=function(b){this.m_drawFlags=b};a.GetFlags=function(){return this.m_drawFlags};a.AppendFlags=function(b){this.m_drawFlags|=b};a.ClearFlags=function(b){this.m_drawFlags&=~b};
a.DrawPolygon=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);for(d=1;d<c;d++)this.m_sprite.graphics.lineTo(b[d].x*this.m_drawScale,b[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale)};
a.DrawSolidPolygon=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);this.m_sprite.graphics.beginFill(d.color,this.m_fillAlpha);for(d=1;d<c;d++)this.m_sprite.graphics.lineTo(b[d].x*this.m_drawScale,b[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);this.m_sprite.graphics.endFill()};
a.DrawCircle=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.drawCircle(b.x*this.m_drawScale,b.y*this.m_drawScale,c*this.m_drawScale)};
a.DrawSolidCircle=function(b,c,d,e){this.m_sprite.graphics.lineStyle(this.m_lineThickness,e.color,this.m_alpha);this.m_sprite.graphics.moveTo(0,0);this.m_sprite.graphics.beginFill(e.color,this.m_fillAlpha);this.m_sprite.graphics.drawCircle(b.x*this.m_drawScale,b.y*this.m_drawScale,c*this.m_drawScale);this.m_sprite.graphics.endFill();this.m_sprite.graphics.moveTo(b.x*this.m_drawScale,b.y*this.m_drawScale);this.m_sprite.graphics.lineTo((b.x+d.x*c)*this.m_drawScale,(b.y+d.y*c)*this.m_drawScale)};
a.DrawSegment=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b.x*this.m_drawScale,b.y*this.m_drawScale);this.m_sprite.graphics.lineTo(c.x*this.m_drawScale,c.y*this.m_drawScale)};
a.DrawXForm=function(b){this.m_sprite.graphics.lineStyle(this.m_lineThickness,16711680,this.m_alpha);this.m_sprite.graphics.moveTo(b.position.x*this.m_drawScale,b.position.y*this.m_drawScale);this.m_sprite.graphics.lineTo((b.position.x+this.m_xformScale*b.R.col1.x)*this.m_drawScale,(b.position.y+this.m_xformScale*b.R.col1.y)*this.m_drawScale);this.m_sprite.graphics.lineStyle(this.m_lineThickness,65280,this.m_alpha);this.m_sprite.graphics.moveTo(b.position.x*this.m_drawScale,b.position.y*this.m_drawScale);
this.m_sprite.graphics.lineTo((b.position.x+this.m_xformScale*b.R.col2.x)*this.m_drawScale,(b.position.y+this.m_xformScale*b.R.col2.y)*this.m_drawScale)};var b2ContactEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactEdge.prototype;a.__constructor=function(){};a.__varz=function(){};a.other=null;a.contact=null;a.prev=null;a.next=null;var b2Sweep=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Sweep.prototype;a.__constructor=function(){};
a.__varz=function(){this.localCenter=new b2Vec2;this.c0=new b2Vec2;this.c=new b2Vec2};a.localCenter=new b2Vec2;a.c0=new b2Vec2;a.c=new b2Vec2;a.a0=null;a.a=null;a.t0=null;
a.GetXForm=function(b,c){if(1-this.t0>Number.MIN_VALUE){c=(c-this.t0)/(1-this.t0);b.position.x=(1-c)*this.c0.x+c*this.c.x;b.position.y=(1-c)*this.c0.y+c*this.c.y;b.R.Set((1-c)*this.a0+c*this.a)}else{b.position.SetV(this.c);b.R.Set(this.a)}c=b.R;b.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y;b.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y};
a.Advance=function(b){if(this.t0<b&&1-this.t0>Number.MIN_VALUE){var c=(b-this.t0)/(1-this.t0);this.c0.x=(1-c)*this.c0.x+c*this.c.x;this.c0.y=(1-c)*this.c0.y+c*this.c.y;this.a0=(1-c)*this.a0+c*this.a;this.t0=b}};var b2ContactConstraint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactConstraint.prototype;a.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b]=new b2ContactConstraintPoint};
a.__varz=function(){this.normal=new b2Vec2};a.points=null;a.normal=new b2Vec2;a.manifold=null;a.body1=null;a.body2=null;a.friction=null;a.restitution=null;a.pointCount=0;var b2Distance=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){};b2Distance.prototype.__varz=function(){};b2Distance.g_GJK_Iterations=0;b2Distance.s_p1s=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.s_p2s=[new b2Vec2,new b2Vec2,new b2Vec2];
b2Distance.s_points=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.gPoint=new b2Point;b2Distance.ProcessTwo=function(b,c,d,e,f){var h=f[0];f=f[1];var g=d[0];d=d[1];var i=e[0];e=e[1];var j=-f.x,k=-f.y,l=h.x-f.x,o=h.y-f.y,q=Math.sqrt(l*l+o*o);l/=q;o/=q;j=j*l+k*o;if(j<=0||q<Number.MIN_VALUE){b.SetV(d);c.SetV(e);g.SetV(d);i.SetV(e);h.SetV(f);return 1}j/=q;b.x=d.x+j*(g.x-d.x);b.y=d.y+j*(g.y-d.y);c.x=e.x+j*(i.x-e.x);c.y=e.y+j*(i.y-e.y);return 2};
b2Distance.ProcessThree=function(b,c,d,e,f){var h=f[0],g=f[1],i=f[2];f=d[0];var j=d[1];d=d[2];var k=e[0],l=e[1];e=e[2];var o=h.x,q=h.y,t=g.x,w=g.y,z=i.x,A=i.y,n=t-o,m=w-q,r=z-o,p=A-q,s=z-t,u=A-w,v=-(o*r+q*p),y=z*r+A*p,x=-(t*s+w*u);s=z*s+A*u;if(y<=0&&s<=0){b.SetV(d);c.SetV(e);f.SetV(d);k.SetV(e);h.SetV(i);return 1}m=n*p-m*r;n=m*(o*w-q*t);t=m*(t*A-w*z);if(t<=0&&x>=0&&s>=0&&x+s>0){v=x/(x+s);b.x=j.x+v*(d.x-j.x);b.y=j.y+v*(d.y-j.y);c.x=l.x+v*(e.x-l.x);c.y=l.y+v*(e.y-l.y);f.SetV(d);k.SetV(e);h.SetV(i);
return 2}h=m*(z*q-A*o);if(h<=0&&v>=0&&y>=0&&v+y>0){v/=v+y;b.x=f.x+v*(d.x-f.x);b.y=f.y+v*(d.y-f.y);c.x=k.x+v*(e.x-k.x);c.y=k.y+v*(e.y-k.y);j.SetV(d);l.SetV(e);g.SetV(i);return 2}i=t+h+n;i=1/i;g=t*i;h*=i;i=1-g-h;b.x=g*f.x+h*j.x+i*d.x;b.y=g*f.y+h*j.y+i*d.y;c.x=g*k.x+h*l.x+i*e.x;c.y=g*k.y+h*l.y+i*e.y;return 3};
b2Distance.InPoints=function(b,c,d){for(var e=100*Number.MIN_VALUE,f=0;f<d;++f){var h=c[f],g=Math.abs(b.x-h.x),i=Math.abs(b.y-h.y),j=Math.max(Math.abs(b.x),Math.abs(h.x));h=Math.max(Math.abs(b.y),Math.abs(h.y));if(g<e*(j+1)&&i<e*(h+1))return true}return false};
b2Distance.DistanceGeneric=function(b,c,d,e,f,h){var g,i=b2Distance.s_p1s,j=b2Distance.s_p2s,k=b2Distance.s_points,l=0;b.SetV(d.GetFirstVertex(e));c.SetV(f.GetFirstVertex(h));for(var o=0,q=0;q<20;++q){g=c.x-b.x;var t=c.y-b.y,w=d.Support(e,g,t),z=f.Support(h,-g,-t);o=g*g+t*t;var A=z.x-w.x,n=z.y-w.y;if(o-(g*A+t*n)<=0.01*o){if(l==0){b.SetV(w);c.SetV(z)}b2Distance.g_GJK_Iterations=q;return Math.sqrt(o)}switch(l){case 0:g=i[0];g.SetV(w);g=j[0];g.SetV(z);g=k[0];g.x=A;g.y=n;b.SetV(i[0]);c.SetV(j[0]);++l;
break;case 1:g=i[1];g.SetV(w);g=j[1];g.SetV(z);g=k[1];g.x=A;g.y=n;l=b2Distance.ProcessTwo(b,c,i,j,k);break;case 2:g=i[2];g.SetV(w);g=j[2];g.SetV(z);g=k[2];g.x=A;g.y=n;l=b2Distance.ProcessThree(b,c,i,j,k)}if(l==3){b2Distance.g_GJK_Iterations=q;return 0}w=-Number.MAX_VALUE;for(z=0;z<l;++z){g=k[z];w=b2Math.b2Max(w,g.x*g.x+g.y*g.y)}if(l==3||o<=100*Number.MIN_VALUE*w){b2Distance.g_GJK_Iterations=q;g=c.x-b.x;t=c.y-b.y;o=g*g+t*t;return Math.sqrt(o)}}b2Distance.g_GJK_Iterations=20;return Math.sqrt(o)};
b2Distance.DistanceCC=function(b,c,d,e,f,h){var g,i;g=e.R;i=d.m_localPosition;var j=e.position.x+(g.col1.x*i.x+g.col2.x*i.y);e=e.position.y+(g.col1.y*i.x+g.col2.y*i.y);g=h.R;i=f.m_localPosition;var k=h.position.x+(g.col1.x*i.x+g.col2.x*i.y);h=h.position.y+(g.col1.y*i.x+g.col2.y*i.y);g=k-j;i=h-e;var l=g*g+i*i;d=d.m_radius-b2Settings.b2_toiSlop;f=f.m_radius-b2Settings.b2_toiSlop;var o=d+f;if(l>o*o){l=Math.sqrt(g*g+i*i);g/=l;i/=l;l-=o;b.x=j+d*g;b.y=e+d*i;c.x=k-f*g;c.y=h-f*i;return l}else if(l>Number.MIN_VALUE*
Number.MIN_VALUE){l=Math.sqrt(g*g+i*i);g/=l;i/=l;b.x=j+d*g;b.y=e+d*i;c.x=b.x;c.y=b.y;return 0}b.x=j;b.y=e;c.x=b.x;c.y=b.y;return 0};
b2Distance.DistancePC=function(b,c,d,e,f,h){var g,i,j=b2Distance.gPoint;i=f.m_localPosition;g=h.R;j.p.x=h.position.x+(g.col1.x*i.x+g.col2.x*i.y);j.p.y=h.position.y+(g.col1.y*i.x+g.col2.y*i.y);d=b2Distance.DistanceGeneric(b,c,d,e,j,b2Math.b2XForm_identity);f=f.m_radius-b2Settings.b2_toiSlop;if(d>f){d-=f;e=c.x-b.x;b=c.y-b.y;h=Math.sqrt(e*e+b*b);e/=h;b/=h;c.x-=f*e;c.y-=f*b}else{d=0;c.x=b.x;c.y=b.y}return d};
b2Distance.Distance=function(b,c,d,e,f,h){var g=d.m_type,i=f.m_type;if(g==b2Shape.e_circleShape&&i==b2Shape.e_circleShape)return b2Distance.DistanceCC(b,c,d,e,f,h);if(g==b2Shape.e_polygonShape&&i==b2Shape.e_circleShape)return b2Distance.DistancePC(b,c,d,e,f,h);if(g==b2Shape.e_circleShape&&i==b2Shape.e_polygonShape)return b2Distance.DistancePC(c,b,f,h,d,e);if(g==b2Shape.e_polygonShape&&i==b2Shape.e_polygonShape)return b2Distance.DistanceGeneric(b,c,d,e,f,h);return 0};
var b2Shape=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(b){this.m_userData=b.userData;this.m_friction=b.friction;this.m_restitution=b.restitution;this.m_density=b.density;this.m_body=null;this.m_sweepRadius=0;this.m_next=null;this.m_proxyId=b2Pair.b2_nullProxy;this.m_filter=b.filter.Copy();this.m_isSensor=b.isSensor};b2Shape.prototype.__varz=function(){};b2Shape.e_unknownShape=-1;b2Shape.e_circleShape=0;b2Shape.e_polygonShape=1;
b2Shape.e_shapeTypeCount=2;b2Shape.e_hitCollide=1;b2Shape.e_missCollide=0;b2Shape.e_startsInsideCollide=-1;b2Shape.s_proxyAABB=new b2AABB;b2Shape.s_syncAABB=new b2AABB;b2Shape.s_resetAABB=new b2AABB;b2Shape.Create=function(b){switch(b.type){case b2Shape.e_circleShape:return new b2CircleShape(b);case b2Shape.e_polygonShape:return new b2PolygonShape(b);default:return null}};b2Shape.Destroy=function(){};a=b2Shape.prototype;a.m_type=0;a.m_next=null;a.m_body=null;a.m_sweepRadius=null;a.m_density=null;
a.m_friction=null;a.m_restitution=null;a.m_proxyId=0;a.m_filter=null;a.m_isSensor=null;a.m_userData=null;a.GetType=function(){return this.m_type};a.IsSensor=function(){return this.m_isSensor};a.SetFilterData=function(b){this.m_filter=b.Copy()};a.GetFilterData=function(){return this.m_filter.Copy()};a.GetBody=function(){return this.m_body};a.GetNext=function(){return this.m_next};a.GetUserData=function(){return this.m_userData};a.SetUserData=function(b){this.m_userData=b};a.TestPoint=function(){return false};
a.TestSegment=function(){return b2Shape.e_missCollide};a.ComputeAABB=function(){};a.ComputeSweptAABB=function(){};a.ComputeMass=function(){};a.GetSweepRadius=function(){return this.m_sweepRadius};a.GetFriction=function(){return this.m_friction};a.GetRestitution=function(){return this.m_restitution};a.CreateProxy=function(b,c){var d=b2Shape.s_proxyAABB;this.ComputeAABB(d,c);this.m_proxyId=b.InRange(d)?b.CreateProxy(d,this):b2Pair.b2_nullProxy};
a.DestroyProxy=function(b){if(this.m_proxyId!=b2Pair.b2_nullProxy){b.DestroyProxy(this.m_proxyId);this.m_proxyId=b2Pair.b2_nullProxy}};a.Synchronize=function(b,c,d){if(this.m_proxyId==b2Pair.b2_nullProxy)return false;var e=b2Shape.s_syncAABB;this.ComputeSweptAABB(e,c,d);if(b.InRange(e)){b.MoveProxy(this.m_proxyId,e);return true}else return false};
a.RefilterProxy=function(b,c){if(this.m_proxyId!=b2Pair.b2_nullProxy){b.DestroyProxy(this.m_proxyId);var d=b2Shape.s_resetAABB;this.ComputeAABB(d,c);this.m_proxyId=b.InRange(d)?b.CreateProxy(d,this):b2Pair.b2_nullProxy}};a.UpdateSweepRadius=function(){};var b2XForm=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2XForm.prototype;a.__constructor=function(b,c){if(b){this.position.SetV(b);this.R.SetM(c)}};a.__varz=function(){this.position=new b2Vec2;this.R=new b2Mat22};
a.position=new b2Vec2;a.R=new b2Mat22;a.Initialize=function(b,c){this.position.SetV(b);this.R.SetM(c)};a.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};a.Set=function(b){this.position.SetV(b.position);this.R.SetM(b.R)};var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype);a=b2DistanceJointDef.prototype;
a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Joint.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.length=null;a.frequencyHz=null;a.dampingRatio=null;
a.Initialize=function(b,c,d,e){this.body1=b;this.body2=c;this.localAnchor1.SetV(this.body1.GetLocalPoint(d));this.localAnchor2.SetV(this.body2.GetLocalPoint(e));b=e.x-d.x;d=e.y-d.y;this.length=Math.sqrt(b*b+d*d);this.dampingRatio=this.frequencyHz=0};var b2OBB=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2OBB.prototype;a.__constructor=function(){};a.__varz=function(){this.R=new b2Mat22;this.center=new b2Vec2;this.extents=new b2Vec2};a.R=new b2Mat22;a.center=new b2Vec2;
a.extents=new b2Vec2;var b2BodyDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2BodyDef.prototype;a.__constructor=function(){this.massData.center.SetZero();this.massData.mass=0;this.massData.I=0;this.userData=null;this.position.Set(0,0);this.angularDamping=this.linearDamping=this.angle=0;this.allowSleep=true;this.isBullet=this.fixedRotation=this.isSleeping=false};a.__varz=function(){this.massData=new b2MassData;this.position=new b2Vec2};a.massData=new b2MassData;
a.userData=null;a.position=new b2Vec2;a.angle=null;a.linearDamping=null;a.angularDamping=null;a.allowSleep=null;a.isSleeping=null;a.fixedRotation=null;a.isBullet=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype);a=b2PrismaticJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_prismaticJoint;this.localAxis1.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.localAxis1=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.localAxis1=new b2Vec2;a.referenceAngle=null;a.enableLimit=null;a.lowerTranslation=null;
a.upperTranslation=null;a.enableMotor=null;a.maxMotorForce=null;a.motorSpeed=null;a.Initialize=function(b,c,d,e){this.body1=b;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(d);this.localAnchor2=this.body2.GetLocalPoint(d);this.localAxis1=this.body1.GetLocalVector(e);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2ContactID=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2ContactID.prototype={key:function(){return this._key},key:function(b){this._key=b;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}};a=b2ContactID.prototype;a.__constructor=function(){this.features._m_id=this};a.__varz=function(){this.features=new Features};a.features=new Features;a._key=0;a.Set=function(b){this.key=b._key};
a.Copy=function(){var b=new b2ContactID;b.key=this._key;return b};var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype);a=b2RevoluteJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_revoluteJoint;this.localAnchor1.Set(0,0);this.localAnchor2.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=false};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.referenceAngle=null;a.enableLimit=null;a.lowerAngle=null;a.upperAngle=null;a.enableMotor=null;a.motorSpeed=null;
a.maxMotorTorque=null;a.Initialize=function(b,c,d){this.body1=b;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(d);this.localAnchor2=this.body2.GetLocalPoint(d);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2CircleShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype);a=b2CircleShape.prototype;a._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_type=b2Shape.e_circleShape;this.m_localPosition.SetV(b.localPosition);this.m_radius=b.radius};a.__varz=function(){this.m_localPosition=new b2Vec2};a.m_localPosition=new b2Vec2;a.m_radius=null;a.TestPoint=function(b,c){var d=b.R,e=b.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y);b=b.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);e=c.x-e;b=c.y-b;return e*e+b*b<=this.m_radius*this.m_radius};
a.TestSegment=function(b,c,d,e,f){var h=b.R,g=e.p1.x-(b.position.x+(h.col1.x*this.m_localPosition.x+h.col2.x*this.m_localPosition.y));b=e.p1.y-(b.position.y+(h.col1.y*this.m_localPosition.x+h.col2.y*this.m_localPosition.y));var i=g*g+b*b-this.m_radius*this.m_radius;if(i<0){c[0]=0;return b2Shape.e_startsInsideCollide}h=e.p2.x-e.p1.x;e=e.p2.y-e.p1.y;var j=g*h+b*e,k=h*h+e*e;i=j*j-k*i;if(i<0||k<Number.MIN_VALUE)return b2Shape.e_missCollide;i=-(j+Math.sqrt(i));if(0<=i&&i<=f*k){i/=k;c[0]=i;d.x=g+i*h;d.y=
b+i*e;d.Normalize();return b2Shape.e_hitCollide}return b2Shape.e_missCollide};a.ComputeAABB=function(b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y);c=c.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);b.lowerBound.Set(e-this.m_radius,c-this.m_radius);b.upperBound.Set(e+this.m_radius,c+this.m_radius)};
a.ComputeSweptAABB=function(b,c,d){var e;e=c.R;var f=c.position.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y);c=c.position.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y);e=d.R;var h=d.position.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y);d=d.position.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y);b.lowerBound.Set((f<h?f:h)-this.m_radius,(c<d?c:d)-this.m_radius);b.upperBound.Set((f>h?f:h)+this.m_radius,(c>d?c:d)+
this.m_radius)};a.ComputeMass=function(b){b.mass=this.m_density*b2Settings.b2_pi*this.m_radius*this.m_radius;b.center.SetV(this.m_localPosition);b.I=b.mass*(0.5*this.m_radius*this.m_radius+(this.m_localPosition.x*this.m_localPosition.x+this.m_localPosition.y*this.m_localPosition.y))};a.GetLocalPosition=function(){return this.m_localPosition};a.GetRadius=function(){return this.m_radius};
a.UpdateSweepRadius=function(b){var c=this.m_localPosition.x-b.x;b=this.m_localPosition.y-b.y;c=Math.sqrt(c*c+b*b);this.m_sweepRadius=c+this.m_radius-b2Settings.b2_toiSlop};var b2Joint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(b){this.m_type=b.type;this.m_next=this.m_prev=null;this.m_body1=b.body1;this.m_body2=b.body2;this.m_collideConnected=b.collideConnected;this.m_islandFlag=false;this.m_userData=b.userData};
b2Joint.prototype.__varz=function(){this.m_node1=new b2JointEdge;this.m_node2=new b2JointEdge};b2Joint.e_unknownJoint=0;b2Joint.e_revoluteJoint=1;b2Joint.e_prismaticJoint=2;b2Joint.e_distanceJoint=3;b2Joint.e_pulleyJoint=4;b2Joint.e_mouseJoint=5;b2Joint.e_gearJoint=6;b2Joint.e_inactiveLimit=0;b2Joint.e_atLowerLimit=1;b2Joint.e_atUpperLimit=2;b2Joint.e_equalLimits=3;
b2Joint.Create=function(b){var c=null;switch(b.type){case b2Joint.e_distanceJoint:c=new b2DistanceJoint(b);break;case b2Joint.e_mouseJoint:c=new b2MouseJoint(b);break;case b2Joint.e_prismaticJoint:c=new b2PrismaticJoint(b);break;case b2Joint.e_revoluteJoint:c=new b2RevoluteJoint(b);break;case b2Joint.e_pulleyJoint:c=new b2PulleyJoint(b);break;case b2Joint.e_gearJoint:c=new b2GearJoint(b)}return c};b2Joint.Destroy=function(){};a=b2Joint.prototype;a.m_type=0;a.m_prev=null;a.m_next=null;a.m_node1=new b2JointEdge;
a.m_node2=new b2JointEdge;a.m_body1=null;a.m_body2=null;a.m_inv_dt=null;a.m_islandFlag=null;a.m_collideConnected=null;a.m_userData=null;a.GetType=function(){return this.m_type};a.GetAnchor1=function(){return null};a.GetAnchor2=function(){return null};a.GetReactionForce=function(){return null};a.GetReactionTorque=function(){return 0};a.GetBody1=function(){return this.m_body1};a.GetBody2=function(){return this.m_body2};a.GetNext=function(){return this.m_next};a.GetUserData=function(){return this.m_userData};
a.SetUserData=function(b){this.m_userData=b};a.InitVelocityConstraints=function(){};a.SolveVelocityConstraints=function(){};a.InitPositionConstraints=function(){};a.SolvePositionConstraints=function(){return false};var b2GearJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype);a=b2GearJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);var c=b.joint1.m_type,d=b.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;this.m_ground1=b.joint1.m_body1;this.m_body1=b.joint1.m_body2;if(c==b2Joint.e_revoluteJoint){this.m_revolute1=b.joint1;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);c=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=b.joint1;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);c=this.m_prismatic1.GetJointTranslation()}this.m_ground2=b.joint2.m_body1;this.m_body2=b.joint2.m_body2;if(d==b2Joint.e_revoluteJoint){this.m_revolute2=b.joint2;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);d=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=b.joint2;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);
d=this.m_prismatic2.GetJointTranslation()}this.m_ratio=b.ratio;this.m_constant=c+this.m_ratio*d;this.m_force=0};a.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_J=new b2Jacobian};a.m_ground1=null;a.m_ground2=null;a.m_revolute1=null;a.m_prismatic1=null;a.m_revolute2=null;a.m_prismatic2=null;a.m_groundAnchor1=new b2Vec2;a.m_groundAnchor2=new b2Vec2;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;
a.m_J=new b2Jacobian;a.m_constant=null;a.m_ratio=null;a.m_mass=null;a.m_force=null;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){return new b2Vec2(this.m_force*this.m_J.linear2.x,this.m_force*this.m_J.linear2.y)};
a.GetReactionTorque=function(){var b=this.m_body2.m_xf.R,c=this.m_localAnchor1.x-this.m_body2.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_body2.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d;c=e;return this.m_force*this.m_J.angular2-(c*this.m_force*this.m_J.linear2.y-d*this.m_force*this.m_J.linear2.x)};a.GetRatio=function(){return this.m_ratio};
a.InitVelocityConstraints=function(b){var c=this.m_ground1,d=this.m_ground2,e=this.m_body1,f=this.m_body2,h,g,i,j,k,l=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angular1=-1;l+=e.m_invI}else{j=c.m_xf.R;h=this.m_prismatic1.m_localXAxis1;c=j.col1.x*h.x+j.col2.x*h.y;h=j.col1.y*h.x+j.col2.y*h.y;j=e.m_xf.R;g=this.m_localAnchor1.x-e.m_sweep.localCenter.x;i=this.m_localAnchor1.y-e.m_sweep.localCenter.y;k=j.col1.x*g+j.col2.x*i;i=j.col1.y*g+j.col2.y*i;g=k;j=g*h-i*c;this.m_J.linear1.Set(-c,-h);this.m_J.angular1=
-j;l+=e.m_invMass+e.m_invI*j*j}if(this.m_revolute2){this.m_J.angular2=-this.m_ratio;l+=this.m_ratio*this.m_ratio*f.m_invI}else{j=d.m_xf.R;h=this.m_prismatic2.m_localXAxis1;c=j.col1.x*h.x+j.col2.x*h.y;h=j.col1.y*h.x+j.col2.y*h.y;j=f.m_xf.R;g=this.m_localAnchor2.x-f.m_sweep.localCenter.x;i=this.m_localAnchor2.y-f.m_sweep.localCenter.y;k=j.col1.x*g+j.col2.x*i;i=j.col1.y*g+j.col2.y*i;g=k;j=g*h-i*c;this.m_J.linear2.Set(-this.m_ratio*c,-this.m_ratio*h);this.m_J.angular2=-this.m_ratio*j;l+=this.m_ratio*
this.m_ratio*(f.m_invMass+f.m_invI*j*j)}this.m_mass=1/l;if(b.warmStarting){b=b.dt*this.m_force;e.m_linearVelocity.x+=e.m_invMass*b*this.m_J.linear1.x;e.m_linearVelocity.y+=e.m_invMass*b*this.m_J.linear1.y;e.m_angularVelocity+=e.m_invI*b*this.m_J.angular1;f.m_linearVelocity.x+=f.m_invMass*b*this.m_J.linear2.x;f.m_linearVelocity.y+=f.m_invMass*b*this.m_J.linear2.y;f.m_angularVelocity+=f.m_invI*b*this.m_J.angular2}else this.m_force=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e=this.m_J.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);e=-b.inv_dt*this.m_mass*e;this.m_force+=e;b=b.dt*e;c.m_linearVelocity.x+=c.m_invMass*b*this.m_J.linear1.x;c.m_linearVelocity.y+=c.m_invMass*b*this.m_J.linear1.y;c.m_angularVelocity+=c.m_invI*b*this.m_J.angular1;d.m_linearVelocity.x+=d.m_invMass*b*this.m_J.linear2.x;d.m_linearVelocity.y+=d.m_invMass*b*this.m_J.linear2.y;d.m_angularVelocity+=
d.m_invI*b*this.m_J.angular2};
a.SolvePositionConstraints=function(){var b=this.m_body1,c=this.m_body2,d,e;d=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();e=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();d=-this.m_mass*(this.m_constant-(d+this.m_ratio*e));b.m_sweep.c.x+=b.m_invMass*d*this.m_J.linear1.x;b.m_sweep.c.y+=b.m_invMass*d*this.m_J.linear1.y;b.m_sweep.a+=b.m_invI*d*this.m_J.angular1;c.m_sweep.c.x+=c.m_invMass*d*this.m_J.linear2.x;c.m_sweep.c.y+=
c.m_invMass*d*this.m_J.linear2.y;c.m_sweep.a+=c.m_invI*d*this.m_J.angular2;b.SynchronizeTransform();c.SynchronizeTransform();return 0<b2Settings.b2_linearSlop};var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype);a=b2GearJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};a.__varz=function(){};a.joint1=null;a.joint2=null;a.ratio=null;var b2BroadPhase=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2BroadPhase.prototype.__constructor=function(b,c){var d=0;this.m_pairManager.Initialize(this,c);this.m_worldAABB=b;for(d=this.m_proxyCount=0;d<b2Settings.b2_maxProxies;d++){this.m_queryResults[d]=0;this.m_querySortKeys[d]=0}this.m_bounds=Array(2);for(d=0;d<2;d++){this.m_bounds[d]=Array(2*b2Settings.b2_maxProxies);for(c=0;c<2*b2Settings.b2_maxProxies;c++)this.m_bounds[d][c]=new b2Bound}d=b.upperBound.y-b.lowerBound.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/(b.upperBound.x-b.lowerBound.x);
this.m_quantizationFactor.y=b2Settings.USHRT_MAX/d;for(d=0;d<b2Settings.b2_maxProxies-1;++d){b=new b2Proxy;this.m_proxyPool[d]=b;b.SetNext(d+1);b.timeStamp=0;b.overlapCount=b2BroadPhase.b2_invalid;b.userData=null}b=new b2Proxy;this.m_proxyPool[parseInt(b2Settings.b2_maxProxies-1)]=b;b.SetNext(b2Pair.b2_nullProxy);b.timeStamp=0;b.overlapCount=b2BroadPhase.b2_invalid;b.userData=null;this.m_freeProxy=0;this.m_timeStamp=1;this.m_queryResultCount=0};
b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager;this.m_proxyPool=Array(b2Settings.b2_maxPairs);this.m_bounds=Array(2*b2Settings.b2_maxProxies);this.m_querySortKeys=Array(b2Settings.b2_maxProxies);this.m_queryResults=Array(b2Settings.b2_maxProxies);this.m_quantizationFactor=new b2Vec2};b2BroadPhase.s_validate=false;b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX;b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX;
b2BroadPhase.BinarySearch=function(b,c,d){var e=0;for(c-=1;e<=c;){var f=Math.round((e+c)/2),h=b[f];if(h.value>d)c=f-1;else if(h.value<d)e=f+1;else return parseInt(f)}return parseInt(e)};a=b2BroadPhase.prototype;a.m_pairManager=new b2PairManager;a.m_proxyPool=Array(b2Settings.b2_maxPairs);a.m_freeProxy=0;a.m_bounds=Array(2*b2Settings.b2_maxProxies);a.m_querySortKeys=Array(b2Settings.b2_maxProxies);a.m_queryResults=Array(b2Settings.b2_maxProxies);a.m_queryResultCount=0;a.m_worldAABB=null;
a.m_quantizationFactor=new b2Vec2;a.m_proxyCount=0;a.m_timeStamp=0;
a.ComputeBounds=function(b,c,d){var e=d.lowerBound.x,f=d.lowerBound.y;e=b2Math.b2Min(e,this.m_worldAABB.upperBound.x);f=b2Math.b2Min(f,this.m_worldAABB.upperBound.y);e=b2Math.b2Max(e,this.m_worldAABB.lowerBound.x);f=b2Math.b2Max(f,this.m_worldAABB.lowerBound.y);var h=d.upperBound.x;d=d.upperBound.y;h=b2Math.b2Min(h,this.m_worldAABB.upperBound.x);d=b2Math.b2Min(d,this.m_worldAABB.upperBound.y);h=b2Math.b2Max(h,this.m_worldAABB.lowerBound.x);d=b2Math.b2Max(d,this.m_worldAABB.lowerBound.y);b[0]=parseInt(this.m_quantizationFactor.x*
(e-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1;c[0]=parseInt(this.m_quantizationFactor.x*(h-this.m_worldAABB.lowerBound.x))%65535|1;b[1]=parseInt(this.m_quantizationFactor.y*(f-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1;c[1]=parseInt(this.m_quantizationFactor.y*(d-this.m_worldAABB.lowerBound.y))%65535|1};
a.TestOverlapValidate=function(b,c){for(var d=0;d<2;++d){var e=this.m_bounds[d],f=e[b.lowerBounds[d]],h=e[c.upperBounds[d]];if(f.value>h.value)return false;f=e[b.upperBounds[d]];h=e[c.lowerBounds[d]];if(f.value<h.value)return false}return true};
a.Query=function(b,c,d,e,f,h,g){d=b2BroadPhase.BinarySearch(f,h,d);e=b2BroadPhase.BinarySearch(f,h,e);for(var i=d;i<e;++i){h=f[i];h.IsLower()&&this.IncrementOverlapCount(h.proxyId)}if(d>0){i=d-1;h=f[i];for(var j=h.stabbingCount;j>0;){h=f[i];if(h.IsLower())if(d<=this.m_proxyPool[h.proxyId].upperBounds[g]){this.IncrementOverlapCount(h.proxyId);--j}--i}}b[0]=d;c[0]=e};
a.IncrementOverlapCount=function(b){var c=this.m_proxyPool[b];if(c.timeStamp<this.m_timeStamp){c.timeStamp=this.m_timeStamp;c.overlapCount=1}else{c.overlapCount=2;this.m_queryResults[this.m_queryResultCount]=b;++this.m_queryResultCount}};a.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var b=0;b<b2Settings.b2_maxProxies;++b)this.m_proxyPool[b].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp};
a.AddProxyResult=function(b,c,d,e){e=e(c.userData);if(!(e<0)){for(c=0;c<this.m_queryResultCount&&this.m_querySortKeys[c]<e;)c++;this.m_queryResultCount+=1;if(this.m_queryResultCount>d)this.m_queryResultCount=d;for(;c<this.m_queryResultCount;){d=this.m_querySortKeys[c];var f=this.m_queryResults[c];this.m_querySortKeys[c]=e;this.m_queryResults[c]=b;e=d;b=f;c++}}};
a.InRange=function(b){var c,d,e,f;c=b.lowerBound.x;d=b.lowerBound.y;c-=this.m_worldAABB.upperBound.x;d-=this.m_worldAABB.upperBound.y;e=this.m_worldAABB.lowerBound.x;f=this.m_worldAABB.lowerBound.y;e-=b.upperBound.x;f-=b.upperBound.y;c=b2Math.b2Max(c,e);d=b2Math.b2Max(d,f);return b2Math.b2Max(c,d)<0};a.GetProxy=function(b){var c=this.m_proxyPool[b];if(b==b2Pair.b2_nullProxy||c.IsValid()==false)return null;return c};
a.CreateProxy=function(b,c){var d=0,e,f=this.m_freeProxy;e=this.m_proxyPool[f];this.m_freeProxy=e.GetNext();e.overlapCount=0;e.userData=c;c=2*this.m_proxyCount;e=[];var h=[];this.ComputeBounds(e,h,b);for(b=0;b<2;++b){var g=this.m_bounds[b],i=0,j=0;i=[i];j=[j];this.Query(i,j,e[b],h[b],g,c,b);i=i[0];j=j[0];var k=[],l=0,o=c-j,q;for(l=0;l<o;l++){k[l]=new b2Bound;q=k[l];d=g[parseInt(j+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}o=k.length;var t=j+2;for(l=0;l<o;l++){d=k[l];q=
g[parseInt(t+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}k=[];o=j-i;for(l=0;l<o;l++){k[l]=new b2Bound;q=k[l];d=g[parseInt(i+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}o=k.length;t=i+1;for(l=0;l<o;l++){d=k[l];q=g[parseInt(t+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}++j;q=g[i];d=g[j];q.value=e[b];q.proxyId=f;d.value=h[b];d.proxyId=f;k=g[parseInt(i-1)];q.stabbingCount=i==0?0:k.stabbingCount;k=g[parseInt(j-1)];d.stabbingCount=
k.stabbingCount;for(d=i;d<j;++d){k=g[d];k.stabbingCount++}for(d=i;d<c+2;++d){q=g[d];i=this.m_proxyPool[q.proxyId];if(q.IsLower())i.lowerBounds[b]=d;else i.upperBounds[b]=d}}++this.m_proxyCount;for(c=0;c<this.m_queryResultCount;++c)this.m_pairManager.AddBufferedPair(f,this.m_queryResults[c]);this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();return f};
a.DestroyProxy=function(b){for(var c,d,e=this.m_proxyPool[b],f=2*this.m_proxyCount,h=0;h<2;++h){var g=this.m_bounds[h],i=e.lowerBounds[h],j=e.upperBounds[h];c=g[i];var k=c.value;d=g[j];var l=d.value,o=[],q=0,t=j-i-1;for(q=0;q<t;q++){o[q]=new b2Bound;c=o[q];d=g[parseInt(i+1+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}t=o.length;var w=i;for(q=0;q<t;q++){d=o[q];c=g[parseInt(w+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}o=[];t=f-j-1;for(q=0;q<t;q++){o[q]=
new b2Bound;c=o[q];d=g[parseInt(j+1+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}t=o.length;w=j-1;for(q=0;q<t;q++){d=o[q];c=g[parseInt(w+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}t=f-2;for(d=i;d<t;++d){c=g[d];o=this.m_proxyPool[c.proxyId];if(c.IsLower())o.lowerBounds[h]=d;else o.upperBounds[h]=d}for(t=j-1;i<t;++i){c=g[i];c.stabbingCount--}this.Query([0],[0],k,l,g,f-2,h)}for(c=0;c<this.m_queryResultCount;++c)this.m_pairManager.RemoveBufferedPair(b,
this.m_queryResults[c]);this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();e.userData=null;e.overlapCount=b2BroadPhase.b2_invalid;e.lowerBounds[0]=b2BroadPhase.b2_invalid;e.lowerBounds[1]=b2BroadPhase.b2_invalid;e.upperBounds[0]=b2BroadPhase.b2_invalid;e.upperBounds[1]=b2BroadPhase.b2_invalid;e.SetNext(this.m_freeProxy);this.m_freeProxy=b;--this.m_proxyCount};
a.MoveProxy=function(b,c){var d,e,f=0,h=0,g;if(!(b==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=b))if(c.IsValid()!=false){var i=2*this.m_proxyCount,j=this.m_proxyPool[b],k=new b2BoundValues;this.ComputeBounds(k.lowerValues,k.upperValues,c);var l=new b2BoundValues;for(f=0;f<2;++f){c=this.m_bounds[f][j.lowerBounds[f]];l.lowerValues[f]=c.value;c=this.m_bounds[f][j.upperBounds[f]];l.upperValues[f]=c.value}for(f=0;f<2;++f){var o=this.m_bounds[f],q=j.lowerBounds[f],t=j.upperBounds[f],w=k.lowerValues[f],
z=k.upperValues[f];c=o[q];var A=w-c.value;c.value=w;c=o[t];var n=z-c.value;c.value=z;if(A<0)for(h=q;h>0&&w<o[parseInt(h-1)].value;){c=o[h];g=o[parseInt(h-1)];d=g.proxyId;e=this.m_proxyPool[g.proxyId];g.stabbingCount++;if(g.IsUpper()==true){this.TestOverlap(k,e)&&this.m_pairManager.AddBufferedPair(b,d);d=e.upperBounds;e=d[f];e++;d[f]=e;c.stabbingCount++}else{d=e.lowerBounds;e=d[f];e++;d[f]=e;c.stabbingCount--}d=j.lowerBounds;e=d[f];e--;d[f]=e;c.Swap(g);--h}if(n>0)for(h=t;h<i-1&&o[parseInt(h+1)].value<=
z;){c=o[h];g=o[parseInt(h+1)];d=g.proxyId;e=this.m_proxyPool[d];g.stabbingCount++;if(g.IsLower()==true){this.TestOverlap(k,e)&&this.m_pairManager.AddBufferedPair(b,d);d=e.lowerBounds;e=d[f];e--;d[f]=e;c.stabbingCount++}else{d=e.upperBounds;e=d[f];e--;d[f]=e;c.stabbingCount--}d=j.upperBounds;e=d[f];e++;d[f]=e;c.Swap(g);h++}if(A>0)for(h=q;h<i-1&&o[parseInt(h+1)].value<=w;){c=o[h];g=o[parseInt(h+1)];d=g.proxyId;e=this.m_proxyPool[d];g.stabbingCount--;if(g.IsUpper()){this.TestOverlap(l,e)&&this.m_pairManager.RemoveBufferedPair(b,
d);d=e.upperBounds;e=d[f];e--;d[f]=e;c.stabbingCount--}else{d=e.lowerBounds;e=d[f];e--;d[f]=e;c.stabbingCount++}d=j.lowerBounds;e=d[f];e++;d[f]=e;c.Swap(g);h++}if(n<0)for(h=t;h>0&&z<o[parseInt(h-1)].value;){c=o[h];g=o[parseInt(h-1)];d=g.proxyId;e=this.m_proxyPool[d];g.stabbingCount--;if(g.IsLower()==true){this.TestOverlap(l,e)&&this.m_pairManager.RemoveBufferedPair(b,d);d=e.lowerBounds;e=d[f];e++;d[f]=e;c.stabbingCount--}else{d=e.upperBounds;e=d[f];e++;d[f]=e;c.stabbingCount++}d=j.upperBounds;e=d[f];
e--;d[f]=e;c.Swap(g);h--}}}};a.Commit=function(){this.m_pairManager.Commit()};a.QueryAABB=function(b,c,d){var e=[],f=[];this.ComputeBounds(e,f,b);b=[0];var h=[0];this.Query(b,h,e[0],f[0],this.m_bounds[0],2*this.m_proxyCount,0);this.Query(b,h,e[1],f[1],this.m_bounds[1],2*this.m_proxyCount,1);for(f=e=0;f<this.m_queryResultCount&&e<d;++f,++e)c[f]=this.m_proxyPool[this.m_queryResults[f]].userData;this.m_queryResultCount=0;this.IncrementTimeStamp();return e};
a.Validate=function(){for(var b=0;b<2;++b)for(var c=this.m_bounds[b],d=2*this.m_proxyCount,e=0,f=0;f<d;++f)if(c[f].IsLower()==true)e++;else e--};
a.QuerySegment=function(b,c,d,e){var f=(b.p2.x-b.p1.x)*this.m_quantizationFactor.x,h=(b.p2.y-b.p1.y)*this.m_quantizationFactor.y,g=f<-Number.MIN_VALUE?-1:f>Number.MIN_VALUE?1:0,i=h<-Number.MIN_VALUE?-1:h>Number.MIN_VALUE?1:0,j=this.m_quantizationFactor.x*(b.p1.x-this.m_worldAABB.lowerBound.x);b=this.m_quantizationFactor.y*(b.p1.y-this.m_worldAABB.lowerBound.y);var k=[],l=[];k[0]=parseInt(j)&b2Settings.USHRT_MAX-1;k[1]=parseInt(b)&b2Settings.USHRT_MAX-1;l[0]=k[0]+1;l[1]=k[1]+1;var o=0,q=0,t=0;q=[0];
t=[0];this.Query(q,t,k[0],l[0],this.m_bounds[0],2*this.m_proxyCount,0);o=g>=0?t[0]-1:q[0];this.Query(q,t,k[1],l[1],this.m_bounds[1],2*this.m_proxyCount,1);q=i>=0?t[0]-1:q[0];if(e!=null){for(k=0;k<this.m_queryResultCount;k++)this.m_querySortKeys[k]=e(this.m_proxyPool[this.m_queryResults[k]].userData);for(k=0;k<this.m_queryResultCount-1;){l=this.m_querySortKeys[k];t=this.m_querySortKeys[k+1];if(l<0?t>=0:l>t&&t>=0){this.m_querySortKeys[k+1]=l;this.m_querySortKeys[k]=t;l=this.m_queryResults[k+1];this.m_queryResults[k+
1]=this.m_queryResults[k];this.m_queryResults[k]=l;k--;if(k==-1)k=1}else k++}for(;this.m_queryResultCount>0&&this.m_querySortKeys[this.m_queryResultCount-1]<0;)this.m_queryResultCount--}k=true;var w,z;if(o<0||o>=this.m_proxyCount*2)k=false;if(q<0||q>=this.m_proxyCount*2)k=false;if(k){if(g!=0){if(g>0){o++;if(o==this.m_proxyCount*2)k=false}else{o--;if(o<0)k=false}w=(this.m_bounds[0][o].value-j)/f}if(i!=0){if(i>0){q++;if(q==this.m_proxyCount*2)k=false}else{q--;if(q<0)k=false}z=(this.m_bounds[1][q].value-
b)/h}}for(;k;)if(i==0||g!=0&&w<z){if(w>1)break;if(g>0?this.m_bounds[0][o].IsLower():this.m_bounds[0][o].IsUpper()){t=this.m_bounds[0][o].proxyId;l=this.m_proxyPool[t];if(i>=0){if(l.lowerBounds[1]<=q-1&&l.upperBounds[1]>=q)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;++this.m_queryResultCount}}else if(l.lowerBounds[1]<=q&&l.upperBounds[1]>=q+1)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;++this.m_queryResultCount}}if(e!=
null&&this.m_queryResultCount==d&&this.m_queryResultCount>0&&w>this.m_querySortKeys[this.m_queryResultCount-1])break;if(g>0){o++;if(o==this.m_proxyCount*2)break}else{o--;if(o<0)break}w=(this.m_bounds[0][o].value-j)/f}else{if(z>1)break;if(i>0?this.m_bounds[1][q].IsLower():this.m_bounds[1][q].IsUpper()){t=this.m_bounds[1][q].proxyId;l=this.m_proxyPool[t];if(g>=0){if(l.lowerBounds[0]<=o-1&&l.upperBounds[0]>=o)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;
++this.m_queryResultCount}}else if(l.lowerBounds[0]<=o&&l.upperBounds[0]>=o+1)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;++this.m_queryResultCount}}if(e!=null&&this.m_queryResultCount==d&&this.m_queryResultCount>0&&z>this.m_querySortKeys[this.m_queryResultCount-1])break;if(i>0){q++;if(q==this.m_proxyCount*2)break}else{q--;if(q<0)break}z=(this.m_bounds[1][q].value-b)/h}for(k=e=0;k<this.m_queryResultCount&&e<d;++k,++e){l=this.m_proxyPool[this.m_queryResults[k]];
c[k]=l.userData}this.m_queryResultCount=0;this.IncrementTimeStamp();return e};a.TestOverlap=function(b,c){for(var d=0;d<2;++d){var e=this.m_bounds[d],f=e[c.upperBounds[d]];if(b.lowerValues[d]>f.value)return false;f=e[c.lowerBounds[d]];if(b.upperValues[d]<f.value)return false}return true};var b2TimeOfImpact=function(){this.__varz();this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){};b2TimeOfImpact.prototype.__varz=function(){};b2TimeOfImpact.s_p1=new b2Vec2;
b2TimeOfImpact.s_p2=new b2Vec2;b2TimeOfImpact.s_xf1=new b2XForm;b2TimeOfImpact.s_xf2=new b2XForm;
b2TimeOfImpact.TimeOfImpact=function(b,c,d,e){var f,h,g=b.m_sweepRadius,i=d.m_sweepRadius,j=c.t0,k=c.c.x-c.c0.x,l=c.c.y-c.c0.y,o=e.c.x-e.c0.x,q=e.c.y-e.c0.y,t=c.a-c.a0,w=e.a-e.a0,z=0,A=b2TimeOfImpact.s_p1,n=b2TimeOfImpact.s_p2,m=0,r=0,p=0;for(f=0;;){p=(1-z)*j+z;h=b2TimeOfImpact.s_xf1;r=b2TimeOfImpact.s_xf2;c.GetXForm(h,p);e.GetXForm(r,p);p=b2Distance.Distance(A,n,b,h,d,r);if(m==0)if(p>2*b2Settings.b2_toiSlop)f=1.5*b2Settings.b2_toiSlop;else{f=0.05*b2Settings.b2_toiSlop;h=p-0.5*b2Settings.b2_toiSlop;
f=f>h?f:h}if(p-f<0.05*b2Settings.b2_toiSlop||m==20)break;h=n.x-A.x;r=n.y-A.y;var s=Math.sqrt(h*h+r*r);h/=s;r/=s;h=h*(k-o)+r*(l-q)+(t<0?-t:t)*g+(w<0?-w:w)*i;if(h==0){z=1;break}p=z+(p-f)/h;if(p<0||1<p){z=1;break}if(p<(1+100*Number.MIN_VALUE)*z)break;z=p;++m}return z};var b2ShapeDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ShapeDef.prototype;a.__constructor=function(){};a.__varz=function(){this.type=b2Shape.e_unknownShape;this.filter=new b2FilterData};a.type=b2Shape.e_unknownShape;
a.userData=null;a.friction=0.2;a.restitution=0;a.density=0;a.isSensor=false;a.filter=new b2FilterData;var b2PolygonDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonDef.prototype,b2ShapeDef.prototype);b2PolygonDef.prototype._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};
b2PolygonDef.prototype.__constructor=function(){this.type=b2Shape.e_polygonShape;for(var b=this.vertexCount=0;b<b2Settings.b2_maxPolygonVertices;b++)this.vertices[b]=new b2Vec2};b2PolygonDef.prototype.__varz=function(){this.vertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonDef.s_mat=new b2Mat22;b2PolygonDef.prototype.vertices=Array(b2Settings.b2_maxPolygonVertices);b2PolygonDef.prototype.vertexCount=0;
b2PolygonDef.prototype.SetAsBox=function(b,c){this.vertexCount=4;this.vertices[0].Set(-b,-c);this.vertices[1].Set(b,-c);this.vertices[2].Set(b,c);this.vertices[3].Set(-b,c)};
b2PolygonDef.prototype.SetAsOrientedBox=function(b,c,d,e){this.vertexCount=4;this.vertices[0].Set(-b,-c);this.vertices[1].Set(b,-c);this.vertices[2].Set(b,c);this.vertices[3].Set(-b,c);if(d){c=d;var f=b2PolygonDef.s_mat;f.Set(e);for(e=0;e<this.vertexCount;++e){d=this.vertices[e];b=c.x+(f.col1.x*d.x+f.col2.x*d.y);d.y=c.y+(f.col1.y*d.x+f.col2.y*d.y);d.x=b}}};var b2Contact=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Contact.prototype.__constructor=function(b,c){this.m_flags=0;if(!b||!c)this.m_shape2=this.m_shape1=null;else{if(b.IsSensor()||c.IsSensor())this.m_flags|=b2Contact.e_nonSolidFlag;this.m_shape1=b;this.m_shape2=c;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_next=this.m_prev=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;
this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null}};b2Contact.prototype.__varz=function(){this.m_node1=new b2ContactEdge;this.m_node2=new b2ContactEdge};b2Contact.e_nonSolidFlag=1;b2Contact.e_slowFlag=2;b2Contact.e_islandFlag=4;b2Contact.e_toiFlag=8;b2Contact.s_registers=null;b2Contact.s_initialized=false;
b2Contact.AddType=function(b,c,d,e){b2Contact.s_registers[d][e].createFcn=b;b2Contact.s_registers[d][e].destroyFcn=c;b2Contact.s_registers[d][e].primary=true;if(d!=e){b2Contact.s_registers[e][d].createFcn=b;b2Contact.s_registers[e][d].destroyFcn=c;b2Contact.s_registers[e][d].primary=false}};
b2Contact.InitializeRegisters=function(){b2Contact.s_registers=Array(b2Shape.e_shapeTypeCount);for(var b=0;b<b2Shape.e_shapeTypeCount;b++){b2Contact.s_registers[b]=Array(b2Shape.e_shapeTypeCount);for(var c=0;c<b2Shape.e_shapeTypeCount;c++)b2Contact.s_registers[b][c]=new b2ContactRegister}b2Contact.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,
b2Shape.e_circleShape);b2Contact.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape)};b2Contact.Create=function(b,c,d){if(b2Contact.s_initialized==false){b2Contact.InitializeRegisters();b2Contact.s_initialized=true}var e=b2Contact.s_registers[b.m_type][c.m_type],f=e.createFcn;if(f!=null)if(e.primary)return f(b,c,d);else{b=f(c,b,d);for(c=0;c<b.m_manifoldCount;++c){d=b.GetManifolds()[c];d.normal=d.normal.Negative()}return b}else return null};
b2Contact.Destroy=function(b,c){if(b.m_manifoldCount>0){b.m_shape1.m_body.WakeUp();b.m_shape2.m_body.WakeUp()}var d=b2Contact.s_registers[b.m_shape1.m_type][b.m_shape2.m_type].destroyFcn;d(b,c)};a=b2Contact.prototype;a.m_flags=0;a.m_prev=null;a.m_next=null;a.m_node1=new b2ContactEdge;a.m_node2=new b2ContactEdge;a.m_shape1=null;a.m_shape2=null;a.m_manifoldCount=0;a.m_friction=null;a.m_restitution=null;a.m_toi=null;a.GetManifolds=function(){return null};a.GetManifoldCount=function(){return this.m_manifoldCount};
a.IsSolid=function(){return(this.m_flags&b2Contact.e_nonSolidFlag)==0};a.GetNext=function(){return this.m_next};a.GetShape1=function(){return this.m_shape1};a.GetShape2=function(){return this.m_shape2};a.Update=function(b){var c=this.m_manifoldCount;this.Evaluate(b);b=this.m_shape1.m_body;var d=this.m_shape2.m_body;if(this.m_manifoldCount==0&&c>0){b.WakeUp();d.WakeUp()}if(b.IsStatic()||b.IsBullet()||d.IsStatic()||d.IsBullet())this.m_flags&=~b2Contact.e_slowFlag;else this.m_flags|=b2Contact.e_slowFlag};
a.Evaluate=function(){};var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype);a=b2DistanceJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_length=b.length;this.m_frequencyHz=b.frequencyHz;this.m_dampingRatio=b.dampingRatio;this.m_inv_dt=this.m_bias=this.m_gamma=this.m_impulse=0};a.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u=new b2Vec2};a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_u=new b2Vec2;a.m_frequencyHz=null;a.m_dampingRatio=null;
a.m_gamma=null;a.m_bias=null;a.m_impulse=null;a.m_mass=null;a.m_length=null;
a.InitVelocityConstraints=function(b){var c,d;this.m_inv_dt=b.inv_dt;var e=this.m_body1,f=this.m_body2;c=e.m_xf.R;var h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,g=this.m_localAnchor1.y-e.m_sweep.localCenter.y;d=c.col1.x*h+c.col2.x*g;g=c.col1.y*h+c.col2.y*g;h=d;c=f.m_xf.R;var i=this.m_localAnchor2.x-f.m_sweep.localCenter.x,j=this.m_localAnchor2.y-f.m_sweep.localCenter.y;d=c.col1.x*i+c.col2.x*j;j=c.col1.y*i+c.col2.y*j;i=d;this.m_u.x=f.m_sweep.c.x+i-e.m_sweep.c.x-h;this.m_u.y=f.m_sweep.c.y+j-e.m_sweep.c.y-
g;d=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);d>b2Settings.b2_linearSlop?this.m_u.Multiply(1/d):this.m_u.SetZero();c=h*this.m_u.y-g*this.m_u.x;var k=i*this.m_u.y-j*this.m_u.x;c=e.m_invMass+e.m_invI*c*c+f.m_invMass+f.m_invI*k*k;this.m_mass=1/c;if(this.m_frequencyHz>0){d-=this.m_length;k=2*Math.PI*this.m_frequencyHz;var l=this.m_mass*k*k;this.m_gamma=1/(b.dt*(2*this.m_mass*this.m_dampingRatio*k+b.dt*l));this.m_bias=d*b.dt*l*this.m_gamma;this.m_mass=1/(c+this.m_gamma)}if(b.warmStarting){this.m_impulse*=
b.dtRatio;b=this.m_impulse*this.m_u.x;c=this.m_impulse*this.m_u.y;e.m_linearVelocity.x-=e.m_invMass*b;e.m_linearVelocity.y-=e.m_invMass*c;e.m_angularVelocity-=e.m_invI*(h*c-g*b);f.m_linearVelocity.x+=f.m_invMass*b;f.m_linearVelocity.y+=f.m_invMass*c;f.m_angularVelocity+=f.m_invI*(i*c-j*b)}else this.m_impulse=0};
a.SolveVelocityConstraints=function(){var b,c=this.m_body1,d=this.m_body2;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f;e=h;b=d.m_xf.R;var g=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=b.col1.x*g+b.col2.x*i;i=b.col1.y*g+b.col2.y*i;g=h;h=-this.m_mass*(this.m_u.x*(d.m_linearVelocity.x+-d.m_angularVelocity*i-(c.m_linearVelocity.x+-c.m_angularVelocity*
f))+this.m_u.y*(d.m_linearVelocity.y+d.m_angularVelocity*g-(c.m_linearVelocity.y+c.m_angularVelocity*e))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;b=h*this.m_u.x;h*=this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*b;c.m_linearVelocity.y-=c.m_invMass*h;c.m_angularVelocity-=c.m_invI*(e*h-f*b);d.m_linearVelocity.x+=d.m_invMass*b;d.m_linearVelocity.y+=d.m_invMass*h;d.m_angularVelocity+=d.m_invI*(g*h-i*b)};
a.SolvePositionConstraints=function(){var b;if(this.m_frequencyHz>0)return true;var c=this.m_body1,d=this.m_body2;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f;e=h;b=d.m_xf.R;var g=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=b.col1.x*g+b.col2.x*i;i=b.col1.y*g+b.col2.y*i;g=h;h=d.m_sweep.c.x+g-c.m_sweep.c.x-e;var j=d.m_sweep.c.y+i-c.m_sweep.c.y-
f;b=Math.sqrt(h*h+j*j);h/=b;j/=b;b-=this.m_length;b=b2Math.b2Clamp(b,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var k=-this.m_mass*b;this.m_u.Set(h,j);h=k*this.m_u.x;j=k*this.m_u.y;c.m_sweep.c.x-=c.m_invMass*h;c.m_sweep.c.y-=c.m_invMass*j;c.m_sweep.a-=c.m_invI*(e*j-f*h);d.m_sweep.c.x+=d.m_invMass*h;d.m_sweep.c.y+=d.m_invMass*j;d.m_sweep.a+=d.m_invI*(g*j-i*h);c.SynchronizeTransform();d.SynchronizeTransform();return b2Math.b2Abs(b)<b2Settings.b2_linearSlop};a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};
a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){var b=new b2Vec2;b.SetV(this.m_u);b.Multiply(this.m_inv_dt*this.m_impulse);return b};a.GetReactionTorque=function(){return 0};var b2Body=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Body.prototype.__constructor=function(b,c){this.m_flags=0;if(b.isBullet)this.m_flags|=b2Body.e_bulletFlag;if(b.fixedRotation)this.m_flags|=b2Body.e_fixedRotationFlag;if(b.allowSleep)this.m_flags|=b2Body.e_allowSleepFlag;if(b.isSleeping)this.m_flags|=b2Body.e_sleepFlag;this.m_world=c;this.m_xf.position.SetV(b.position);this.m_xf.R.Set(b.angle);this.m_sweep.localCenter.SetV(b.massData.center);this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=b.angle;c=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=
c.col1.x*d.x+c.col2.x*d.y;this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_next=this.m_prev=this.m_contactList=this.m_jointList=null;this.m_linearDamping=b.linearDamping;this.m_angularDamping=b.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_linearVelocity.SetZero();this.m_invI=this.m_I=this.m_invMass=this.m_sleepTime=this.m_angularVelocity=0;this.m_mass=b.massData.mass;
if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=b.massData.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;this.m_userData=b.userData;this.m_shapeList=null;this.m_shapeCount=0};b2Body.prototype.__varz=function(){this.m_xf=new b2XForm;this.m_sweep=new b2Sweep;this.m_linearVelocity=new b2Vec2;this.m_force=new b2Vec2};b2Body.e_frozenFlag=2;b2Body.e_islandFlag=4;
b2Body.e_sleepFlag=8;b2Body.e_allowSleepFlag=16;b2Body.e_bulletFlag=32;b2Body.e_fixedRotationFlag=64;b2Body.e_staticType=1;b2Body.e_dynamicType=2;b2Body.e_maxTypes=3;b2Body.s_massData=new b2MassData;b2Body.s_xf1=new b2XForm;a=b2Body.prototype;a.m_flags=0;a.m_type=0;a.m_xf=new b2XForm;a.m_sweep=new b2Sweep;a.m_linearVelocity=new b2Vec2;a.m_angularVelocity=null;a.m_force=new b2Vec2;a.m_torque=null;a.m_world=null;a.m_prev=null;a.m_next=null;a.m_shapeList=null;a.m_shapeCount=0;a.m_jointList=null;
a.m_contactList=null;a.m_mass=null;a.m_invMass=null;a.m_I=null;a.m_invI=null;a.m_linearDamping=null;a.m_angularDamping=null;a.m_sleepTime=null;a.m_userData=null;a.CreateShape=function(b){if(this.m_world.m_lock==true)return null;b=b2Shape.Create(b,this.m_world.m_blockAllocator);b.m_next=this.m_shapeList;this.m_shapeList=b;++this.m_shapeCount;b.m_body=this;b.CreateProxy(this.m_world.m_broadPhase,this.m_xf);b.UpdateSweepRadius(this.m_sweep.localCenter);return b};
a.DestroyShape=function(b){if(this.m_world.m_lock!=true){b.DestroyProxy(this.m_world.m_broadPhase);for(var c=this.m_shapeList;c!=null;){if(c==b)break;c=c.m_next}b.m_body=null;b.m_next=null;--this.m_shapeCount;b2Shape.Destroy(b,this.m_world.m_blockAllocator)}};
a.SetMass=function(b){if(this.m_world.m_lock!=true){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=b.mass;if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=b.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_sweep.localCenter.SetV(b.center);b=this.m_xf.R;var c=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*c.x+b.col2.x*c.y;this.m_sweep.c.y=b.col1.y*c.x+b.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;
this.m_sweep.c0.SetV(this.m_sweep.c);for(b=this.m_shapeList;b;b=b.m_next)b.UpdateSweepRadius(this.m_sweep.localCenter);b=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(b!=this.m_type)for(b=this.m_shapeList;b;b=b.m_next)b.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}};
a.SetMassFromShapes=function(){var b;if(this.m_world.m_lock!=true){var c=this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,d=0,e=b2Body.s_massData;for(b=this.m_shapeList;b;b=b.m_next){b.ComputeMass(e);this.m_mass+=e.mass;c+=e.mass*e.center.x;d+=e.mass*e.center.y;this.m_I+=e.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;c*=this.m_invMass;d*=this.m_invMass}if(this.m_I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(c*c+d*d);this.m_invI=1/this.m_I}else this.m_invI=this.m_I=
0;this.m_sweep.localCenter.Set(c,d);b=this.m_xf.R;c=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*c.x+b.col2.x*c.y;this.m_sweep.c.y=b.col1.y*c.x+b.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);for(b=this.m_shapeList;b;b=b.m_next)b.UpdateSweepRadius(this.m_sweep.localCenter);b=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(b!=this.m_type)for(b=this.m_shapeList;b;b=
b.m_next)b.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}};
a.SetXForm=function(b,c){if(this.m_world.m_lock==true)return true;if(this.IsFrozen())return false;this.m_xf.R.Set(c);this.m_xf.position.SetV(b);b=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*d.x+b.col2.x*d.y;this.m_sweep.c.y=b.col1.y*d.x+b.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=c;b=false;for(c=this.m_shapeList;c;c=c.m_next)if(c.Synchronize(this.m_world.m_broadPhase,
this.m_xf,this.m_xf)==false){b=true;break}if(b==true){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(c=this.m_shapeList;c;c=c.m_next)c.DestroyProxy(this.m_world.m_broadPhase);return false}this.m_world.m_broadPhase.Commit();return true};a.GetXForm=function(){return this.m_xf};a.GetPosition=function(){return this.m_xf.position};a.GetAngle=function(){return this.m_sweep.a};a.GetWorldCenter=function(){return this.m_sweep.c};a.GetLocalCenter=function(){return this.m_sweep.localCenter};
a.SetLinearVelocity=function(b){this.m_linearVelocity.SetV(b)};a.GetLinearVelocity=function(){return this.m_linearVelocity};a.SetAngularVelocity=function(b){this.m_angularVelocity=b};a.GetAngularVelocity=function(){return this.m_angularVelocity};a.ApplyForce=function(b,c){this.IsSleeping()&&this.WakeUp();this.m_force.x+=b.x;this.m_force.y+=b.y;this.m_torque+=(c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x};a.ApplyTorque=function(b){this.IsSleeping()&&this.WakeUp();this.m_torque+=b};
a.ApplyImpulse=function(b,c){this.IsSleeping()&&this.WakeUp();this.m_linearVelocity.x+=this.m_invMass*b.x;this.m_linearVelocity.y+=this.m_invMass*b.y;this.m_angularVelocity+=this.m_invI*((c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x)};a.GetMass=function(){return this.m_mass};a.GetInertia=function(){return this.m_I};a.GetWorldPoint=function(b){var c=this.m_xf.R;b=new b2Vec2(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;return b};
a.GetWorldVector=function(b){return b2Math.b2MulMV(this.m_xf.R,b)};a.GetLocalPoint=function(b){return b2Math.b2MulXT(this.m_xf,b)};a.GetLocalVector=function(b){return b2Math.b2MulTMV(this.m_xf.R,b)};a.GetLinearVelocityFromWorldPoint=function(b){return new b2Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(b.x-this.m_sweep.c.x))};
a.GetLinearVelocityFromLocalPoint=function(b){var c=this.m_xf.R;b=new b2Vec2(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;return new b2Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(b.x-this.m_sweep.c.x))};a.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag};
a.SetBullet=function(b){if(b)this.m_flags|=b2Body.e_bulletFlag;else this.m_flags&=~b2Body.e_bulletFlag};a.IsStatic=function(){return this.m_type==b2Body.e_staticType};a.IsDynamic=function(){return this.m_type==b2Body.e_dynamicType};a.IsFrozen=function(){return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag};a.IsSleeping=function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag};
a.AllowSleeping=function(b){if(b)this.m_flags|=b2Body.e_allowSleepFlag;else{this.m_flags&=~b2Body.e_allowSleepFlag;this.WakeUp()}};a.WakeUp=function(){this.m_flags&=~b2Body.e_sleepFlag;this.m_sleepTime=0};a.PutToSleep=function(){this.m_flags|=b2Body.e_sleepFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0};a.GetShapeList=function(){return this.m_shapeList};a.GetJointList=function(){return this.m_jointList};a.GetNext=function(){return this.m_next};
a.GetUserData=function(){return this.m_userData};a.SetUserData=function(b){this.m_userData=b};a.GetWorld=function(){return this.m_world};
a.SynchronizeShapes=function(){var b=b2Body.s_xf1;b.R.Set(this.m_sweep.a0);var c=b.R,d=this.m_sweep.localCenter;b.position.x=this.m_sweep.c0.x-(c.col1.x*d.x+c.col2.x*d.y);b.position.y=this.m_sweep.c0.y-(c.col1.y*d.x+c.col2.y*d.y);d=true;for(c=this.m_shapeList;c;c=c.m_next){d=c.Synchronize(this.m_world.m_broadPhase,b,this.m_xf);if(d==false)break}if(d==false){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(c=this.m_shapeList;c;c=c.m_next)c.DestroyProxy(this.m_world.m_broadPhase);
return false}return true};a.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var b=this.m_xf.R,c=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(b.col1.x*c.x+b.col2.x*c.y);this.m_xf.position.y=this.m_sweep.c.y-(b.col1.y*c.x+b.col2.y*c.y)};a.IsConnected=function(b){for(var c=this.m_jointList;c;c=c.next)if(c.other==b)return c.joint.m_collideConnected==false;return false};
a.Advance=function(b){this.m_sweep.Advance(b);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};var b2ContactFilter=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){};b2ContactFilter.prototype.__varz=function(){};b2ContactFilter.b2_defaultFilter=new b2ContactFilter;
b2ContactFilter.prototype.ShouldCollide=function(b,c){b=b.GetFilterData();c=c.GetFilterData();if(b.groupIndex==c.groupIndex&&b.groupIndex!=0)return b.groupIndex>0;return(b.maskBits&c.categoryBits)!=0&&(b.categoryBits&c.maskBits)!=0};b2ContactFilter.prototype.RayCollide=function(b,c){if(!b)return true;return this.ShouldCollide(b,c)};var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype);
b2PolygonShape.prototype._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};
b2PolygonShape.prototype.__constructor=function(b){this._super(b);this.m_type=b2Shape.e_polygonShape;this.m_vertexCount=b.vertexCount;var c=0,d=c,e=c;for(c=0;c<this.m_vertexCount;++c)this.m_vertices[c]=b.vertices[c].Copy();for(c=0;c<this.m_vertexCount;++c){d=c;e=c+1<this.m_vertexCount?c+1:0;var f=this.m_vertices[e].x-this.m_vertices[d].x;d=this.m_vertices[e].y-this.m_vertices[d].y;e=Math.sqrt(f*f+d*d);this.m_normals[c]=new b2Vec2(d/e,-f/e)}this.m_centroid=b2PolygonShape.ComputeCentroid(b.vertices,
b.vertexCount);b2PolygonShape.ComputeOBB(this.m_obb,this.m_vertices,this.m_vertexCount);for(c=0;c<this.m_vertexCount;++c){d=c-1>=0?c-1:this.m_vertexCount-1;e=c;b=this.m_normals[d].x;f=this.m_normals[d].y;d=this.m_normals[e].x;e=this.m_normals[e].y;var h=this.m_vertices[c].x-this.m_centroid.x,g=this.m_vertices[c].y-this.m_centroid.y,i=b*h+f*g-b2Settings.b2_toiSlop;h=d*h+e*g-b2Settings.b2_toiSlop;g=1/(b*e-f*d);this.m_coreVertices[c]=new b2Vec2(g*(e*i-f*h)+this.m_centroid.x,g*(b*h-d*i)+this.m_centroid.y)}};
b2PolygonShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2;this.m_obb=new b2OBB;this.m_vertices=Array(b2Settings.b2_maxPolygonVertices);this.m_normals=Array(b2Settings.b2_maxPolygonVertices);this.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonShape.s_computeMat=new b2Mat22;b2PolygonShape.s_sweptAABB1=new b2AABB;b2PolygonShape.s_sweptAABB2=new b2AABB;
b2PolygonShape.ComputeCentroid=function(b,c){for(var d=new b2Vec2,e=0,f=1/3,h=0;h<c;++h){var g=b[h],i=h+1<c?b[parseInt(h+1)]:b[0],j=0.5*((g.x-0)*(i.y-0)-(g.y-0)*(i.x-0));e+=j;d.x+=j*f*(0+g.x+i.x);d.y+=j*f*(0+g.y+i.y)}d.x*=1/e;d.y*=1/e;return d};
b2PolygonShape.ComputeOBB=function(b,c,d){var e=0,f=Array(b2Settings.b2_maxPolygonVertices+1);for(e=0;e<d;++e)f[e]=c[e];f[d]=f[0];c=Number.MAX_VALUE;for(e=1;e<=d;++e){var h=f[parseInt(e-1)],g=f[e].x-h.x,i=f[e].y-h.y,j=Math.sqrt(g*g+i*i);g/=j;i/=j;for(var k=-i,l=g,o=j=Number.MAX_VALUE,q=-Number.MAX_VALUE,t=-Number.MAX_VALUE,w=0;w<d;++w){var z=f[w].x-h.x,A=f[w].y-h.y,n=g*z+i*A;z=k*z+l*A;if(n<j)j=n;if(z<o)o=z;if(n>q)q=n;if(z>t)t=z}w=(q-j)*(t-o);if(w<0.95*c){c=w;b.R.col1.x=g;b.R.col1.y=i;b.R.col2.x=k;
b.R.col2.y=l;g=0.5*(j+q);i=0.5*(o+t);k=b.R;b.center.x=h.x+(k.col1.x*g+k.col2.x*i);b.center.y=h.y+(k.col1.y*g+k.col2.y*i);b.extents.x=0.5*(q-j);b.extents.y=0.5*(t-o)}}};a=b2PolygonShape.prototype;a.s_supportVec=new b2Vec2;a.m_centroid=null;a.m_obb=new b2OBB;a.m_vertices=Array(b2Settings.b2_maxPolygonVertices);a.m_normals=Array(b2Settings.b2_maxPolygonVertices);a.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices);a.m_vertexCount=0;
a.TestPoint=function(b,c){var d;d=b.R;var e=c.x-b.position.x;b=c.y-b.position.y;c=e*d.col1.x+b*d.col1.y;for(var f=e*d.col2.x+b*d.col2.y,h=0;h<this.m_vertexCount;++h){d=this.m_vertices[h];e=c-d.x;b=f-d.y;d=this.m_normals[h];if(d.x*e+d.y*b>0)return false}return true};
a.TestSegment=function(b,c,d,e,f){var h=0,g,i,j,k;g=e.p1.x-b.position.x;i=e.p1.y-b.position.y;j=b.R;var l=g*j.col1.x+i*j.col1.y,o=g*j.col2.x+i*j.col2.y;g=e.p2.x-b.position.x;i=e.p2.y-b.position.y;j=b.R;e=g*j.col1.x+i*j.col1.y-l;j=g*j.col2.x+i*j.col2.y-o;for(var q=-1,t=0;t<this.m_vertexCount;++t){k=this.m_vertices[t];g=k.x-l;i=k.y-o;k=this.m_normals[t];g=k.x*g+k.y*i;i=k.x*e+k.y*j;if(i<0&&g<h*i){h=g/i;q=t}else if(i>0&&g<f*i)f=g/i;if(f<h)return b2Shape.e_missCollide}if(q>=0){c[0]=h;j=b.R;k=this.m_normals[q];
d.x=j.col1.x*k.x+j.col2.x*k.y;d.y=j.col1.y*k.x+j.col2.y*k.y;return b2Shape.e_hitCollide}c[0]=0;return b2Shape.e_startsInsideCollide};
a.ComputeAABB=function(b,c){var d,e,f=b2PolygonShape.s_computeMat;d=c.R;e=this.m_obb.R.col1;f.col1.x=d.col1.x*e.x+d.col2.x*e.y;f.col1.y=d.col1.y*e.x+d.col2.y*e.y;e=this.m_obb.R.col2;f.col2.x=d.col1.x*e.x+d.col2.x*e.y;f.col2.y=d.col1.y*e.x+d.col2.y*e.y;f.Abs();e=this.m_obb.extents;var h=f.col1.x*e.x+f.col2.x*e.y;f=f.col1.y*e.x+f.col2.y*e.y;d=c.R;e=this.m_obb.center;var g=c.position.x+(d.col1.x*e.x+d.col2.x*e.y);c=c.position.y+(d.col1.y*e.x+d.col2.y*e.y);b.lowerBound.Set(g-h,c-f);b.upperBound.Set(g+
h,c+f)};a.ComputeSweptAABB=function(b,c,d){var e=b2PolygonShape.s_sweptAABB1,f=b2PolygonShape.s_sweptAABB2;this.ComputeAABB(e,c);this.ComputeAABB(f,d);b.lowerBound.Set(e.lowerBound.x<f.lowerBound.x?e.lowerBound.x:f.lowerBound.x,e.lowerBound.y<f.lowerBound.y?e.lowerBound.y:f.lowerBound.y);b.upperBound.Set(e.upperBound.x>f.upperBound.x?e.upperBound.x:f.upperBound.x,e.upperBound.y>f.upperBound.y?e.upperBound.y:f.upperBound.y)};
a.ComputeMass=function(b){for(var c=0,d=0,e=0,f=0,h=1/3,g=0;g<this.m_vertexCount;++g){var i=this.m_vertices[g],j=g+1<this.m_vertexCount?this.m_vertices[parseInt(g+1)]:this.m_vertices[0],k=i.x-0,l=i.y-0,o=j.x-0,q=j.y-0,t=k*q-l*o,w=0.5*t;e+=w;c+=w*h*(0+i.x+j.x);d+=w*h*(0+i.y+j.y);f+=t*(h*(0.25*(k*k+o*k+o*o)+(0*k+0*o))+0+(h*(0.25*(l*l+q*l+q*q)+(0*l+0*q))+0))}b.mass=this.m_density*e;c*=1/e;d*=1/e;b.center.Set(c,d);b.I=this.m_density*f};a.GetOBB=function(){return this.m_obb};a.GetCentroid=function(){return this.m_centroid};
a.GetVertexCount=function(){return this.m_vertexCount};a.GetVertices=function(){return this.m_vertices};a.GetCoreVertices=function(){return this.m_coreVertices};a.GetNormals=function(){return this.m_normals};a.GetFirstVertex=function(b){return b2Math.b2MulX(b,this.m_coreVertices[0])};a.Centroid=function(b){return b2Math.b2MulX(b,this.m_centroid)};
a.Support=function(b,c,d){var e;e=b.R;var f=c*e.col1.x+d*e.col1.y;e=c*e.col2.x+d*e.col2.y;c=0;d=this.m_coreVertices[0];for(var h=d.x*f+d.y*e,g=1;g<this.m_vertexCount;++g){d=this.m_coreVertices[g];d=d.x*f+d.y*e;if(d>h){c=g;h=d}}e=b.R;d=this.m_coreVertices[c];this.s_supportVec.x=b.position.x+(e.col1.x*d.x+e.col2.x*d.y);this.s_supportVec.y=b.position.y+(e.col1.y*d.x+e.col2.y*d.y);return this.s_supportVec};
a.UpdateSweepRadius=function(b){for(var c,d=this.m_sweepRadius=0;d<this.m_vertexCount;++d){c=this.m_coreVertices[d];var e=c.x-b.x;c=c.y-b.y;e=Math.sqrt(e*e+c*c);if(e>this.m_sweepRadius)this.m_sweepRadius=e}};var b2ContactResult=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactResult.prototype;a.__constructor=function(){};a.__varz=function(){this.position=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};a.shape1=null;a.shape2=null;a.position=new b2Vec2;
a.normal=new b2Vec2;a.normalImpulse=null;a.tangentImpulse=null;a.id=new b2ContactID;var b2Island=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Island.prototype.__constructor=function(b,c,d,e,f){var h=0;this.m_bodyCapacity=b;this.m_contactCapacity=c;this.m_jointCapacity=d;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=e;this.m_listener=f;this.m_bodies=Array(b);for(h=0;h<b;h++)this.m_bodies[h]=null;this.m_contacts=Array(c);for(h=0;h<c;h++)this.m_contacts[h]=null;this.m_joints=Array(d);for(h=0;h<d;h++)this.m_joints[h]=null;this.m_positionIterationCount=0};b2Island.prototype.__varz=function(){};
b2Island.s_reportCR=new b2ContactResult;a=b2Island.prototype;a.m_allocator=null;a.m_listener=null;a.m_bodies=null;a.m_contacts=null;a.m_joints=null;a.m_bodyCount=0;a.m_jointCount=0;a.m_contactCount=0;a.m_bodyCapacity=0;a.m_contactCapacity=0;a.m_jointCapacity=0;a.m_positionIterationCount=0;a.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};
a.Solve=function(b,c,d,e){var f=0,h;for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];if(!h.IsStatic()){h.m_linearVelocity.x+=b.dt*(c.x+h.m_invMass*h.m_force.x);h.m_linearVelocity.y+=b.dt*(c.y+h.m_invMass*h.m_force.y);h.m_angularVelocity+=b.dt*h.m_invI*h.m_torque;h.m_force.SetZero();h.m_torque=0;h.m_linearVelocity.Multiply(b2Math.b2Clamp(1-b.dt*h.m_linearDamping,0,1));h.m_angularVelocity*=b2Math.b2Clamp(1-b.dt*h.m_angularDamping,0,1);if(h.m_linearVelocity.LengthSquared()>b2Settings.b2_maxLinearVelocitySquared){h.m_linearVelocity.Normalize();
h.m_linearVelocity.x*=b2Settings.b2_maxLinearVelocity;h.m_linearVelocity.y*=b2Settings.b2_maxLinearVelocity}if(h.m_angularVelocity*h.m_angularVelocity>b2Settings.b2_maxAngularVelocitySquared)h.m_angularVelocity=h.m_angularVelocity<0?-b2Settings.b2_maxAngularVelocity:b2Settings.b2_maxAngularVelocity}}c=new b2ContactSolver(b,this.m_contacts,this.m_contactCount,this.m_allocator);c.InitVelocityConstraints(b);for(f=0;f<this.m_jointCount;++f){h=this.m_joints[f];h.InitVelocityConstraints(b)}for(f=0;f<b.maxIterations;++f){c.SolveVelocityConstraints();
for(var g=0;g<this.m_jointCount;++g){h=this.m_joints[g];h.SolveVelocityConstraints(b)}}c.FinalizeVelocityConstraints();for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];if(!h.IsStatic()){h.m_sweep.c0.SetV(h.m_sweep.c);h.m_sweep.a0=h.m_sweep.a;h.m_sweep.c.x+=b.dt*h.m_linearVelocity.x;h.m_sweep.c.y+=b.dt*h.m_linearVelocity.y;h.m_sweep.a+=b.dt*h.m_angularVelocity;h.SynchronizeTransform()}}if(d){for(f=0;f<this.m_jointCount;++f){h=this.m_joints[f];h.InitPositionConstraints()}for(this.m_positionIterationCount=
0;this.m_positionIterationCount<b.maxIterations;++this.m_positionIterationCount){d=c.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);g=true;for(f=0;f<this.m_jointCount;++f){h=this.m_joints[f];h=h.SolvePositionConstraints();g=g&&h}if(d&&g)break}}this.Report(c.m_constraints);if(e){e=Number.MAX_VALUE;c=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance;d=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];
if(h.m_invMass!=0){if((h.m_flags&b2Body.e_allowSleepFlag)==0)e=h.m_sleepTime=0;if((h.m_flags&b2Body.e_allowSleepFlag)==0||h.m_angularVelocity*h.m_angularVelocity>d||b2Math.b2Dot(h.m_linearVelocity,h.m_linearVelocity)>c)e=h.m_sleepTime=0;else{h.m_sleepTime+=b.dt;e=b2Math.b2Min(e,h.m_sleepTime)}}}if(e>=b2Settings.b2_timeToSleep)for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];h.m_flags|=b2Body.e_sleepFlag;h.m_linearVelocity.SetZero();h.m_angularVelocity=0}}};
a.SolveTOI=function(b){var c=0,d=new b2ContactSolver(b,this.m_contacts,this.m_contactCount,this.m_allocator);for(c=0;c<b.maxIterations;++c)d.SolveVelocityConstraints();for(c=0;c<this.m_bodyCount;++c){var e=this.m_bodies[c];if(!e.IsStatic()){e.m_sweep.c0.SetV(e.m_sweep.c);e.m_sweep.a0=e.m_sweep.a;e.m_sweep.c.x+=b.dt*e.m_linearVelocity.x;e.m_sweep.c.y+=b.dt*e.m_linearVelocity.y;e.m_sweep.a+=b.dt*e.m_angularVelocity;e.SynchronizeTransform()}}for(c=0;c<b.maxIterations;++c)if(d.SolvePositionConstraints(0.75))break;
this.Report(d.m_constraints)};
a.Report=function(b){if(this.m_listener!=null)for(var c=0;c<this.m_contactCount;++c){var d=this.m_contacts[c],e=b[c],f=b2Island.s_reportCR;f.shape1=d.m_shape1;f.shape2=d.m_shape2;var h=f.shape1.m_body,g=d.m_manifoldCount;d=d.GetManifolds();for(var i=0;i<g;++i){var j=d[i];f.normal.SetV(j.normal);for(var k=0;k<j.pointCount;++k){var l=j.points[k],o=e.points[k];f.position=h.GetWorldPoint(l.localPoint1);f.normalImpulse=o.normalImpulse;f.tangentImpulse=o.tangentImpulse;f.id.key=l.id.key;this.m_listener.Result(f)}}}};
a.AddBody=function(b){this.m_bodies[this.m_bodyCount++]=b};a.AddContact=function(b){this.m_contacts[this.m_contactCount++]=b};a.AddJoint=function(b){this.m_joints[this.m_jointCount++]=b};var b2ManifoldPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ManifoldPoint.prototype;a.__constructor=function(){};a.__varz=function(){this.localPoint1=new b2Vec2;this.localPoint2=new b2Vec2;this.id=new b2ContactID};a.localPoint1=new b2Vec2;a.localPoint2=new b2Vec2;a.separation=null;
a.normalImpulse=null;a.tangentImpulse=null;a.id=new b2ContactID;a.Reset=function(){this.localPoint1.SetZero();this.localPoint2.SetZero();this.tangentImpulse=this.normalImpulse=this.separation=0;this.id.key=0};a.Set=function(b){this.localPoint1.SetV(b.localPoint1);this.localPoint2.SetV(b.localPoint2);this.separation=b.separation;this.normalImpulse=b.normalImpulse;this.tangentImpulse=b.tangentImpulse;this.id.key=b.id.key};var b2Math=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Math.prototype.__constructor=function(){};b2Math.prototype.__varz=function(){};b2Math.b2Vec2_zero=new b2Vec2(0,0);b2Math.b2Mat22_identity=new b2Mat22(0,new b2Vec2(1,0),new b2Vec2(0,1));b2Math.b2XForm_identity=new b2XForm(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);b2Math.b2IsValid=function(b){return isFinite(b)};b2Math.b2Dot=function(b,c){return b.x*c.x+b.y*c.y};b2Math.b2CrossVV=function(b,c){return b.x*c.y-b.y*c.x};b2Math.b2CrossVF=function(b,c){return new b2Vec2(c*b.y,-c*b.x)};
b2Math.b2CrossFV=function(b,c){return new b2Vec2(-b*c.y,b*c.x)};b2Math.b2MulMV=function(b,c){return new b2Vec2(b.col1.x*c.x+b.col2.x*c.y,b.col1.y*c.x+b.col2.y*c.y)};b2Math.b2MulTMV=function(b,c){return new b2Vec2(b2Math.b2Dot(c,b.col1),b2Math.b2Dot(c,b.col2))};b2Math.b2MulX=function(b,c){c=b2Math.b2MulMV(b.R,c);c.x+=b.position.x;c.y+=b.position.y;return c};b2Math.b2MulXT=function(b,c){c=b2Math.SubtractVV(c,b.position);var d=c.x*b.R.col1.x+c.y*b.R.col1.y;c.y=c.x*b.R.col2.x+c.y*b.R.col2.y;c.x=d;return c};
b2Math.AddVV=function(b,c){return new b2Vec2(b.x+c.x,b.y+c.y)};b2Math.SubtractVV=function(b,c){return new b2Vec2(b.x-c.x,b.y-c.y)};b2Math.b2Distance=function(b,c){var d=b.x-c.x;b=b.y-c.y;return Math.sqrt(d*d+b*b)};b2Math.b2DistanceSquared=function(b,c){var d=b.x-c.x;b=b.y-c.y;return d*d+b*b};b2Math.MulFV=function(b,c){return new b2Vec2(b*c.x,b*c.y)};b2Math.AddMM=function(b,c){return new b2Mat22(0,b2Math.AddVV(b.col1,c.col1),b2Math.AddVV(b.col2,c.col2))};
b2Math.b2MulMM=function(b,c){return new b2Mat22(0,b2Math.b2MulMV(b,c.col1),b2Math.b2MulMV(b,c.col2))};b2Math.b2MulTMM=function(b,c){var d=new b2Vec2(b2Math.b2Dot(b.col1,c.col1),b2Math.b2Dot(b.col2,c.col1));b=new b2Vec2(b2Math.b2Dot(b.col1,c.col2),b2Math.b2Dot(b.col2,c.col2));return new b2Mat22(0,d,b)};b2Math.b2Abs=function(b){return b>0?b:-b};b2Math.b2AbsV=function(b){return new b2Vec2(b2Math.b2Abs(b.x),b2Math.b2Abs(b.y))};b2Math.b2AbsM=function(b){return new b2Mat22(0,b2Math.b2AbsV(b.col1),b2Math.b2AbsV(b.col2))};
b2Math.b2Min=function(b,c){return b<c?b:c};b2Math.b2MinV=function(b,c){return new b2Vec2(b2Math.b2Min(b.x,c.x),b2Math.b2Min(b.y,c.y))};b2Math.b2Max=function(b,c){return b>c?b:c};b2Math.b2MaxV=function(b,c){return new b2Vec2(b2Math.b2Max(b.x,c.x),b2Math.b2Max(b.y,c.y))};b2Math.b2Clamp=function(b,c,d){return b2Math.b2Max(c,b2Math.b2Min(b,d))};b2Math.b2ClampV=function(b,c,d){return b2Math.b2MaxV(c,b2Math.b2MinV(b,d))};b2Math.b2Swap=function(b,c){var d=b[0];b[0]=c[0];c[0]=d};
b2Math.b2Random=function(){return Math.random()*2-1};b2Math.b2RandomRange=function(b,c){return(c-b)*Math.random()+b};b2Math.b2NextPowerOfTwo=function(b){b|=b>>1&2147483647;b|=b>>2&1073741823;b|=b>>4&268435455;b|=b>>8&16777215;b|=b>>16&65535;return b+1};b2Math.b2IsPowerOfTwo=function(b){return b>0&&(b&b-1)==0};var b2CircleDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleDef.prototype,b2ShapeDef.prototype);a=b2CircleDef.prototype;
a._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Shape.e_circleShape;this.radius=1};a.__varz=function(){this.localPosition=new b2Vec2(0,0)};a.localPosition=new b2Vec2(0,0);a.radius=null;var b2ContactPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactPoint.prototype;a.__constructor=function(){};a.__varz=function(){this.position=new b2Vec2;this.velocity=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};
a.shape1=null;a.shape2=null;a.position=new b2Vec2;a.velocity=new b2Vec2;a.normal=new b2Vec2;a.separation=null;a.friction=null;a.restitution=null;a.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype);b2PolygonContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};
b2PolygonContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0};b2PolygonContact.prototype.__varz=function(){this.m0=new b2Manifold;this.m_manifolds=[new b2Manifold]};b2PolygonContact.s_evalCP=new b2ContactPoint;b2PolygonContact.Create=function(b,c){return new b2PolygonContact(b,c)};b2PolygonContact.Destroy=function(){};a=b2PolygonContact.prototype;a.m0=new b2Manifold;a.m_manifolds=[new b2Manifold];a.m_manifold=null;
a.Evaluate=function(b){var c,d,e,f=this.m_shape1.m_body,h=this.m_shape2.m_body,g,i=0;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygons(this.m_manifold,this.m_shape1,f.m_xf,this.m_shape2,h.m_xf);var j=[false,false];g=b2PolygonContact.s_evalCP;g.shape1=this.m_shape1;g.shape2=this.m_shape2;g.friction=this.m_friction;g.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(i=0;i<this.m_manifold.pointCount;++i){var k=this.m_manifold.points[i];k.normalImpulse=0;k.tangentImpulse=0;
var l=false,o=k.id._key;for(c=0;c<this.m0.pointCount;++c)if(j[c]!=true){e=this.m0.points[c];if(e.id._key==o){j[c]=true;k.normalImpulse=e.normalImpulse;k.tangentImpulse=e.tangentImpulse;l=true;if(b!=null){g.position=f.GetWorldPoint(k.localPoint1);c=f.GetLinearVelocityFromLocalPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint2);g.velocity.Set(d.x-c.x,d.y-c.y);g.normal.SetV(this.m_manifold.normal);g.separation=k.separation;g.id.key=o;b.Persist(g)}break}}if(l==false&&b!=null){g.position=
f.GetWorldPoint(k.localPoint1);c=f.GetLinearVelocityFromLocalPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint2);g.velocity.Set(d.x-c.x,d.y-c.y);g.normal.SetV(this.m_manifold.normal);g.separation=k.separation;g.id.key=o;b.Add(g)}}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(b!=null)for(i=0;i<this.m0.pointCount;++i)if(!j[i]){e=this.m0.points[i];g.position=f.GetWorldPoint(e.localPoint1);c=f.GetLinearVelocityFromLocalPoint(e.localPoint1);d=h.GetLinearVelocityFromLocalPoint(e.localPoint2);
g.velocity.Set(d.x-c.x,d.y-c.y);g.normal.SetV(this.m0.normal);g.separation=e.separation;g.id.key=e.id._key;b.Remove(g)}};a.GetManifolds=function(){return this.m_manifolds};var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype);a=b2MouseJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_target.SetV(b.target);var c=this.m_target.x-this.m_body2.m_xf.position.x,d=this.m_target.y-this.m_body2.m_xf.position.y,e=this.m_body2.m_xf.R;this.m_localAnchor.x=c*e.col1.x+d*e.col1.y;this.m_localAnchor.y=c*e.col2.x+d*e.col2.y;this.m_maxForce=b.maxForce;this.m_impulse.SetZero();d=this.m_body2.m_mass;e=2*b2Settings.b2_pi*b.frequencyHz;c=2*d*b.dampingRatio*e;b=b.timeStep*d*e*e;this.m_gamma=1/(c+b);this.m_beta=b/(c+b)};
a.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.m_localAnchor=new b2Vec2;this.m_target=new b2Vec2;this.m_impulse=new b2Vec2;this.m_mass=new b2Mat22;this.m_C=new b2Vec2};a.K=new b2Mat22;a.K1=new b2Mat22;a.K2=new b2Mat22;a.m_localAnchor=new b2Vec2;a.m_target=new b2Vec2;a.m_impulse=new b2Vec2;a.m_mass=new b2Mat22;a.m_C=new b2Vec2;a.m_maxForce=null;a.m_beta=null;a.m_gamma=null;a.GetAnchor1=function(){return this.m_target};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor)};
a.GetReactionForce=function(){return this.m_impulse};a.GetReactionTorque=function(){return 0};a.SetTarget=function(b){this.m_body2.IsSleeping()&&this.m_body2.WakeUp();this.m_target=b};
a.InitVelocityConstraints=function(b){var c=this.m_body2,d;d=c.m_xf.R;var e=this.m_localAnchor.x-c.m_sweep.localCenter.x,f=this.m_localAnchor.y-c.m_sweep.localCenter.y,h=d.col1.x*e+d.col2.x*f;f=d.col1.y*e+d.col2.y*f;e=h;d=c.m_invMass;h=c.m_invI;this.K1.col1.x=d;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=d;this.K2.col1.x=h*f*f;this.K2.col2.x=-h*e*f;this.K2.col1.y=-h*e*f;this.K2.col2.y=h*e*e;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.Invert(this.m_mass);
this.m_C.x=c.m_sweep.c.x+e-this.m_target.x;this.m_C.y=c.m_sweep.c.y+f-this.m_target.y;c.m_angularVelocity*=0.98;var g=b.dt*this.m_impulse.x;b=b.dt*this.m_impulse.y;c.m_linearVelocity.x+=d*g;c.m_linearVelocity.y+=d*b;c.m_angularVelocity+=h*(e*b-f*g)};
a.SolveVelocityConstraints=function(b){var c=this.m_body2,d,e,f;d=c.m_xf.R;var h=this.m_localAnchor.x-c.m_sweep.localCenter.x,g=this.m_localAnchor.y-c.m_sweep.localCenter.y;e=d.col1.x*h+d.col2.x*g;g=d.col1.y*h+d.col2.y*g;h=e;e=c.m_linearVelocity.x+-c.m_angularVelocity*g;var i=c.m_linearVelocity.y+c.m_angularVelocity*h;d=this.m_mass;e=e+this.m_beta*b.inv_dt*this.m_C.x+this.m_gamma*b.dt*this.m_impulse.x;f=i+this.m_beta*b.inv_dt*this.m_C.y+this.m_gamma*b.dt*this.m_impulse.y;i=-b.inv_dt*(d.col1.x*e+d.col2.x*
f);d=-b.inv_dt*(d.col1.y*e+d.col2.y*f);e=this.m_impulse.x;f=this.m_impulse.y;this.m_impulse.x+=i;this.m_impulse.y+=d;i=this.m_impulse.Length();i>this.m_maxForce&&this.m_impulse.Multiply(this.m_maxForce/i);i=this.m_impulse.x-e;d=this.m_impulse.y-f;i=b.dt*i;b=b.dt*d;c.m_linearVelocity.x+=c.m_invMass*i;c.m_linearVelocity.y+=c.m_invMass*b;c.m_angularVelocity+=c.m_invI*(h*b-g*i)};a.SolvePositionConstraints=function(){return true};
var b2CircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype);b2CircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};b2CircleContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0;b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};
b2CircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2CircleContact.s_evalCP=new b2ContactPoint;b2CircleContact.Create=function(b,c){return new b2CircleContact(b,c)};b2CircleContact.Destroy=function(){};a=b2CircleContact.prototype;a.m_manifolds=[new b2Manifold];a.m0=new b2Manifold;a.m_manifold=null;
a.Evaluate=function(b){var c,d,e;c=this.m_shape1.m_body;d=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollideCircles(this.m_manifold,this.m_shape1,c.m_xf,this.m_shape2,d.m_xf);var f=b2CircleContact.s_evalCP;f.shape1=this.m_shape1;f.shape2=this.m_shape2;f.friction=this.m_friction;f.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){this.m_manifoldCount=1;var h=this.m_manifold.points[0];if(this.m0.pointCount==0){h.normalImpulse=0;h.tangentImpulse=0;if(b){f.position=
c.GetWorldPoint(h.localPoint1);c=c.GetLinearVelocityFromLocalPoint(h.localPoint1);d=d.GetLinearVelocityFromLocalPoint(h.localPoint2);f.velocity.Set(d.x-c.x,d.y-c.y);f.normal.SetV(this.m_manifold.normal);f.separation=h.separation;f.id.key=h.id._key;b.Add(f)}}else{e=this.m0.points[0];h.normalImpulse=e.normalImpulse;h.tangentImpulse=e.tangentImpulse;if(b){f.position=c.GetWorldPoint(h.localPoint1);c=c.GetLinearVelocityFromLocalPoint(h.localPoint1);d=d.GetLinearVelocityFromLocalPoint(h.localPoint2);f.velocity.Set(d.x-
c.x,d.y-c.y);f.normal.SetV(this.m_manifold.normal);f.separation=h.separation;f.id.key=h.id._key;b.Persist(f)}}}else{this.m_manifoldCount=0;if(this.m0.pointCount>0&&b){e=this.m0.points[0];f.position=c.GetWorldPoint(e.localPoint1);c=c.GetLinearVelocityFromLocalPoint(e.localPoint1);d=d.GetLinearVelocityFromLocalPoint(e.localPoint2);f.velocity.Set(d.x-c.x,d.y-c.y);f.normal.SetV(this.m0.normal);f.separation=e.separation;f.id.key=e.id._key;b.Remove(f)}}};a.GetManifolds=function(){return this.m_manifolds};
var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype);b2PulleyJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2PulleyJoint.prototype.__constructor=function(b){this._super(b);this.m_ground=this.m_body1.m_world.m_groundBody;this.m_groundAnchor1.x=b.groundAnchor1.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=b.groundAnchor1.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=b.groundAnchor2.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=b.groundAnchor2.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_ratio=b.ratio;this.m_constant=
b.length1+this.m_ratio*b.length2;this.m_maxLength1=b2Math.b2Min(b.maxLength1,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=b2Math.b2Min(b.maxLength2,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_limitForce2=this.m_limitForce1=this.m_force=0};
b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u1=new b2Vec2;this.m_u2=new b2Vec2};b2PulleyJoint.b2_minPulleyLength=2;a=b2PulleyJoint.prototype;a.m_ground=null;a.m_groundAnchor1=new b2Vec2;a.m_groundAnchor2=new b2Vec2;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_u1=new b2Vec2;a.m_u2=new b2Vec2;a.m_constant=null;a.m_ratio=null;a.m_maxLength1=null;
a.m_maxLength2=null;a.m_pulleyMass=null;a.m_limitMass1=null;a.m_limitMass2=null;a.m_force=null;a.m_limitForce1=null;a.m_limitForce2=null;a.m_positionImpulse=null;a.m_limitPositionImpulse1=null;a.m_limitPositionImpulse2=null;a.m_state=0;a.m_limitState1=0;a.m_limitState2=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
a.GetReactionForce=function(){var b=this.m_u2.Copy();b.Multiply(this.m_force);return b};a.GetReactionTorque=function(){return 0};a.GetGroundAnchor1=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor1);return b};a.GetGroundAnchor2=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor2);return b};
a.GetLength1=function(){var b=this.m_body1.GetWorldPoint(this.m_localAnchor1),c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(c*c+b*b)};a.GetLength2=function(){var b=this.m_body2.GetWorldPoint(this.m_localAnchor2),c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(c*c+b*b)};a.GetRatio=function(){return this.m_ratio};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*h;h=e.col1.y*f+e.col2.y*h;f=g;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=g;e=d.m_sweep.c.x+i;g=d.m_sweep.c.y+j;var k=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+
this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+f-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+h-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(e-k,g-l);e=this.m_u1.Length();g=this.m_u2.Length();e>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero();g>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/g):this.m_u2.SetZero();if(this.m_constant-e-this.m_ratio*g>0){this.m_state=b2Joint.e_inactiveLimit;this.m_force=0}else{this.m_state=b2Joint.e_atUpperLimit;
this.m_positionImpulse=0}if(e<this.m_maxLength1){this.m_limitState1=b2Joint.e_inactiveLimit;this.m_limitForce1=0}else{this.m_limitState1=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse1=0}if(g<this.m_maxLength2){this.m_limitState2=b2Joint.e_inactiveLimit;this.m_limitForce2=0}else{this.m_limitState2=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse2=0}e=f*this.m_u1.y-h*this.m_u1.x;g=i*this.m_u2.y-j*this.m_u2.x;this.m_limitMass1=c.m_invMass+c.m_invI*e*e;this.m_limitMass2=d.m_invMass+d.m_invI*g*
g;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(b.warmStarting){e=b.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.x;g=b.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.y;k=b.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.x;b=b.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*e;c.m_linearVelocity.y+=
c.m_invMass*g;c.m_angularVelocity+=c.m_invI*(f*g-h*e);d.m_linearVelocity.x+=d.m_invMass*k;d.m_linearVelocity.y+=d.m_invMass*b;d.m_angularVelocity+=d.m_invI*(i*b-j*k)}else this.m_limitForce2=this.m_limitForce1=this.m_force=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*h;h=e.col1.y*f+e.col2.y*h;f=g;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=g;var k,l;if(this.m_state==b2Joint.e_atUpperLimit){e=c.m_linearVelocity.x+-c.m_angularVelocity*h;g=c.m_linearVelocity.y+
c.m_angularVelocity*f;k=d.m_linearVelocity.x+-d.m_angularVelocity*j;l=d.m_linearVelocity.y+d.m_angularVelocity*i;e=-(this.m_u1.x*e+this.m_u1.y*g)-this.m_ratio*(this.m_u2.x*k+this.m_u2.y*l);l=-b.inv_dt*this.m_pulleyMass*e;e=this.m_force;this.m_force=b2Math.b2Max(0,this.m_force+l);l=this.m_force-e;e=-b.dt*l*this.m_u1.x;g=-b.dt*l*this.m_u1.y;k=-b.dt*this.m_ratio*l*this.m_u2.x;l=-b.dt*this.m_ratio*l*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*e;c.m_linearVelocity.y+=c.m_invMass*g;c.m_angularVelocity+=
c.m_invI*(f*g-h*e);d.m_linearVelocity.x+=d.m_invMass*k;d.m_linearVelocity.y+=d.m_invMass*l;d.m_angularVelocity+=d.m_invI*(i*l-j*k)}if(this.m_limitState1==b2Joint.e_atUpperLimit){e=c.m_linearVelocity.x+-c.m_angularVelocity*h;g=c.m_linearVelocity.y+c.m_angularVelocity*f;e=-(this.m_u1.x*e+this.m_u1.y*g);l=-b.inv_dt*this.m_limitMass1*e;e=this.m_limitForce1;this.m_limitForce1=b2Math.b2Max(0,this.m_limitForce1+l);l=this.m_limitForce1-e;e=-b.dt*l*this.m_u1.x;g=-b.dt*l*this.m_u1.y;c.m_linearVelocity.x+=c.m_invMass*
e;c.m_linearVelocity.y+=c.m_invMass*g;c.m_angularVelocity+=c.m_invI*(f*g-h*e)}if(this.m_limitState2==b2Joint.e_atUpperLimit){k=d.m_linearVelocity.x+-d.m_angularVelocity*j;l=d.m_linearVelocity.y+d.m_angularVelocity*i;e=-(this.m_u2.x*k+this.m_u2.y*l);l=-b.inv_dt*this.m_limitMass2*e;e=this.m_limitForce2;this.m_limitForce2=b2Math.b2Max(0,this.m_limitForce2+l);l=this.m_limitForce2-e;k=-b.dt*l*this.m_u2.x;l=-b.dt*l*this.m_u2.y;d.m_linearVelocity.x+=d.m_invMass*k;d.m_linearVelocity.y+=d.m_invMass*l;d.m_angularVelocity+=
d.m_invI*(i*l-j*k)}};
a.SolvePositionConstraints=function(){var b=this.m_body1,c=this.m_body2,d,e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,h=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,i,j,k,l,o,q,t,w=0;if(this.m_state==b2Joint.e_atUpperLimit){d=b.m_xf.R;i=this.m_localAnchor1.x-b.m_sweep.localCenter.x;j=this.m_localAnchor1.y-b.m_sweep.localCenter.y;o=d.col1.x*i+d.col2.x*j;j=d.col1.y*i+d.col2.y*
j;i=o;d=c.m_xf.R;k=this.m_localAnchor2.x-c.m_sweep.localCenter.x;l=this.m_localAnchor2.y-c.m_sweep.localCenter.y;o=d.col1.x*k+d.col2.x*l;l=d.col1.y*k+d.col2.y*l;k=o;o=b.m_sweep.c.x+i;q=b.m_sweep.c.y+j;t=c.m_sweep.c.x+k;d=c.m_sweep.c.y+l;this.m_u1.Set(o-e,q-f);this.m_u2.Set(t-h,d-g);d=this.m_u1.Length();o=this.m_u2.Length();d>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/d):this.m_u1.SetZero();o>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/o):this.m_u2.SetZero();d=this.m_constant-d-this.m_ratio*o;
w=b2Math.b2Max(w,-d);d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);d=-this.m_pulleyMass*d;o=this.m_positionImpulse;this.m_positionImpulse=b2Math.b2Max(0,this.m_positionImpulse+d);d=this.m_positionImpulse-o;o=-d*this.m_u1.x;q=-d*this.m_u1.y;t=-this.m_ratio*d*this.m_u2.x;d=-this.m_ratio*d*this.m_u2.y;b.m_sweep.c.x+=b.m_invMass*o;b.m_sweep.c.y+=b.m_invMass*q;b.m_sweep.a+=b.m_invI*(i*q-j*o);c.m_sweep.c.x+=c.m_invMass*t;c.m_sweep.c.y+=c.m_invMass*d;c.m_sweep.a+=c.m_invI*
(k*d-l*t);b.SynchronizeTransform();c.SynchronizeTransform()}if(this.m_limitState1==b2Joint.e_atUpperLimit){d=b.m_xf.R;i=this.m_localAnchor1.x-b.m_sweep.localCenter.x;j=this.m_localAnchor1.y-b.m_sweep.localCenter.y;o=d.col1.x*i+d.col2.x*j;j=d.col1.y*i+d.col2.y*j;i=o;o=b.m_sweep.c.x+i;q=b.m_sweep.c.y+j;this.m_u1.Set(o-e,q-f);d=this.m_u1.Length();if(d>b2Settings.b2_linearSlop){this.m_u1.x*=1/d;this.m_u1.y*=1/d}else this.m_u1.SetZero();d=this.m_maxLength1-d;w=b2Math.b2Max(w,-d);d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,
-b2Settings.b2_maxLinearCorrection,0);d=-this.m_limitMass1*d;e=this.m_limitPositionImpulse1;this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+d);d=this.m_limitPositionImpulse1-e;o=-d*this.m_u1.x;q=-d*this.m_u1.y;b.m_sweep.c.x+=b.m_invMass*o;b.m_sweep.c.y+=b.m_invMass*q;b.m_sweep.a+=b.m_invI*(i*q-j*o);b.SynchronizeTransform()}if(this.m_limitState2==b2Joint.e_atUpperLimit){d=c.m_xf.R;k=this.m_localAnchor2.x-c.m_sweep.localCenter.x;l=this.m_localAnchor2.y-c.m_sweep.localCenter.y;
o=d.col1.x*k+d.col2.x*l;l=d.col1.y*k+d.col2.y*l;k=o;t=c.m_sweep.c.x+k;d=c.m_sweep.c.y+l;this.m_u2.Set(t-h,d-g);o=this.m_u2.Length();if(o>b2Settings.b2_linearSlop){this.m_u2.x*=1/o;this.m_u2.y*=1/o}else this.m_u2.SetZero();d=this.m_maxLength2-o;w=b2Math.b2Max(w,-d);d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);d=-this.m_limitMass2*d;e=this.m_limitPositionImpulse2;this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+d);d=this.m_limitPositionImpulse2-
e;t=-d*this.m_u2.x;d=-d*this.m_u2.y;c.m_sweep.c.x+=c.m_invMass*t;c.m_sweep.c.y+=c.m_invMass*d;c.m_sweep.a+=c.m_invI*(k*d-l*t);c.SynchronizeTransform()}return w<b2Settings.b2_linearSlop};var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype);b2RevoluteJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2RevoluteJoint.prototype.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_referenceAngle=b.referenceAngle;this.m_pivotForce.Set(0,0);this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=0;this.m_lowerAngle=b.lowerAngle;this.m_upperAngle=b.upperAngle;this.m_maxMotorTorque=b.maxMotorTorque;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor};
b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.K3=new b2Mat22;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_pivotForce=new b2Vec2;this.m_pivotMass=new b2Mat22};b2RevoluteJoint.tImpulse=new b2Vec2;a=b2RevoluteJoint.prototype;a.K=new b2Mat22;a.K1=new b2Mat22;a.K2=new b2Mat22;a.K3=new b2Mat22;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_pivotForce=new b2Vec2;a.m_motorForce=null;a.m_limitForce=null;
a.m_limitPositionImpulse=null;a.m_pivotMass=new b2Mat22;a.m_motorMass=null;a.m_enableMotor=null;a.m_maxMotorTorque=null;a.m_motorSpeed=null;a.m_enableLimit=null;a.m_referenceAngle=null;a.m_lowerAngle=null;a.m_upperAngle=null;a.m_limitState=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){return this.m_pivotForce};a.GetReactionTorque=function(){return this.m_limitForce};
a.GetJointAngle=function(){return this.m_body2.m_sweep.a-this.m_body1.m_sweep.a-this.m_referenceAngle};a.GetJointSpeed=function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity};a.IsLimitEnabled=function(){return this.m_enableLimit};a.EnableLimit=function(b){this.m_enableLimit=b};a.GetLowerLimit=function(){return this.m_lowerAngle};a.GetUpperLimit=function(){return this.m_upperAngle};a.SetLimits=function(b,c){this.m_lowerAngle=b;this.m_upperAngle=c};a.IsMotorEnabled=function(){return this.m_enableMotor};
a.EnableMotor=function(b){this.m_enableMotor=b};a.SetMotorSpeed=function(b){this.m_motorSpeed=b};a.GetMotorSpeed=function(){return this.m_motorSpeed};a.SetMaxMotorTorque=function(b){this.m_maxMotorTorque=b};a.GetMotorTorque=function(){return this.m_motorForce};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var h=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*h+e.col2.x*g;g=e.col1.y*h+e.col2.y*g;h=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;e=c.m_invMass;f=d.m_invMass;var k=c.m_invI,l=d.m_invI;this.K1.col1.x=e+f;this.K1.col2.x=0;this.K1.col1.y=
0;this.K1.col2.y=e+f;this.K2.col1.x=k*g*g;this.K2.col2.x=-k*h*g;this.K2.col1.y=-k*h*g;this.K2.col2.y=k*h*h;this.K3.col1.x=l*j*j;this.K3.col2.x=-l*i*j;this.K3.col1.y=-l*i*j;this.K3.col2.y=l*i*i;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Invert(this.m_pivotMass);this.m_motorMass=1/(k+l);if(this.m_enableMotor==false)this.m_motorForce=0;if(this.m_enableLimit){var o=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;if(b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop)this.m_limitState=
b2Joint.e_equalLimits;else if(o<=this.m_lowerAngle){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atLowerLimit}else if(o>=this.m_upperAngle){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitForce=0}}else this.m_limitForce=0;if(b.warmStarting){c.m_linearVelocity.x-=b.dt*e*this.m_pivotForce.x;c.m_linearVelocity.y-=b.dt*e*this.m_pivotForce.y;
c.m_angularVelocity-=b.dt*k*(h*this.m_pivotForce.y-g*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce);d.m_linearVelocity.x+=b.dt*f*this.m_pivotForce.x;d.m_linearVelocity.y+=b.dt*f*this.m_pivotForce.y;d.m_angularVelocity+=b.dt*l*(i*this.m_pivotForce.y-j*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce)}else{this.m_pivotForce.SetZero();this.m_limitForce=this.m_motorForce=0}this.m_limitPositionImpulse=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var h=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*h+e.col2.x*g;g=e.col1.y*h+e.col2.y*g;h=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;f=d.m_linearVelocity.x+-d.m_angularVelocity*j-c.m_linearVelocity.x- -c.m_angularVelocity*g;var k=d.m_linearVelocity.y+
d.m_angularVelocity*i-c.m_linearVelocity.y-c.m_angularVelocity*h;e=-b.inv_dt*(this.m_pivotMass.col1.x*f+this.m_pivotMass.col2.x*k);f=-b.inv_dt*(this.m_pivotMass.col1.y*f+this.m_pivotMass.col2.y*k);this.m_pivotForce.x+=e;this.m_pivotForce.y+=f;e=b.dt*e;f=b.dt*f;c.m_linearVelocity.x-=c.m_invMass*e;c.m_linearVelocity.y-=c.m_invMass*f;c.m_angularVelocity-=c.m_invI*(h*f-g*e);d.m_linearVelocity.x+=d.m_invMass*e;d.m_linearVelocity.y+=d.m_invMass*f;d.m_angularVelocity+=d.m_invI*(i*f-j*e);if(this.m_enableMotor&&
this.m_limitState!=b2Joint.e_equalLimits){h=-b.inv_dt*this.m_motorMass*(d.m_angularVelocity-c.m_angularVelocity-this.m_motorSpeed);g=this.m_motorForce;this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+h,-this.m_maxMotorTorque,this.m_maxMotorTorque);h=this.m_motorForce-g;c.m_angularVelocity-=c.m_invI*b.dt*h;d.m_angularVelocity+=d.m_invI*b.dt*h}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){g=-b.inv_dt*this.m_motorMass*(d.m_angularVelocity-c.m_angularVelocity);if(this.m_limitState==
b2Joint.e_equalLimits)this.m_limitForce+=g;else if(this.m_limitState==b2Joint.e_atLowerLimit){h=this.m_limitForce;this.m_limitForce=b2Math.b2Max(this.m_limitForce+g,0);g=this.m_limitForce-h}else if(this.m_limitState==b2Joint.e_atUpperLimit){h=this.m_limitForce;this.m_limitForce=b2Math.b2Min(this.m_limitForce+g,0);g=this.m_limitForce-h}c.m_angularVelocity-=c.m_invI*b.dt*g;d.m_angularVelocity+=d.m_invI*b.dt*g}};
a.SolvePositionConstraints=function(){var b,c=this.m_body1,d=this.m_body2,e=0;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*h;h=e.col1.y*f+e.col2.y*h;f=g;e=d.m_xf.R;b=this.m_localAnchor2.x-d.m_sweep.localCenter.x;var i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=e.col1.x*b+e.col2.x*i;i=e.col1.y*b+e.col2.y*i;b=g;g=d.m_sweep.c.x+b-(c.m_sweep.c.x+f);var j=d.m_sweep.c.y+i-(c.m_sweep.c.y+h);e=Math.sqrt(g*g+j*j);
var k=c.m_invMass,l=d.m_invMass,o=c.m_invI,q=d.m_invI;this.K1.col1.x=k+l;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=k+l;this.K2.col1.x=o*h*h;this.K2.col2.x=-o*f*h;this.K2.col1.y=-o*f*h;this.K2.col2.y=o*f*f;this.K3.col1.x=q*i*i;this.K3.col2.x=-q*b*i;this.K3.col1.y=-q*b*i;this.K3.col2.y=q*b*b;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(b2RevoluteJoint.tImpulse,-g,-j);g=b2RevoluteJoint.tImpulse.x;j=b2RevoluteJoint.tImpulse.y;c.m_sweep.c.x-=c.m_invMass*g;c.m_sweep.c.y-=
c.m_invMass*j;c.m_sweep.a-=c.m_invI*(f*j-h*g);d.m_sweep.c.x+=d.m_invMass*g;d.m_sweep.c.y+=d.m_invMass*j;d.m_sweep.a+=d.m_invI*(b*j-i*g);c.SynchronizeTransform();d.SynchronizeTransform();f=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){b=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;h=0;if(this.m_limitState==b2Joint.e_equalLimits){b=b2Math.b2Clamp(b,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);h=-this.m_motorMass*b;f=b2Math.b2Abs(b)}else if(this.m_limitState==
b2Joint.e_atLowerLimit){b-=this.m_lowerAngle;f=b2Math.b2Max(0,-b);b=b2Math.b2Clamp(b+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0);h=-this.m_motorMass*b;b=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+h,0);h=this.m_limitPositionImpulse-b}else if(this.m_limitState==b2Joint.e_atUpperLimit){b-=this.m_upperAngle;f=b2Math.b2Max(0,b);b=b2Math.b2Clamp(b-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection);h=-this.m_motorMass*
b;b=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+h,0);h=this.m_limitPositionImpulse-b}c.m_sweep.a-=c.m_invI*h;d.m_sweep.a+=d.m_invI*h;c.SynchronizeTransform();d.SynchronizeTransform()}return e<=b2Settings.b2_linearSlop&&f<=b2Settings.b2_angularSlop};var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype);a=b2PrismaticJoint.prototype;
a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_localXAxis1.SetV(b.localAxis1);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=b.referenceAngle;this.m_linearJacobian.SetZero();this.m_torque=this.m_angularMass=this.m_force=this.m_linearMass=0;this.m_motorJacobian.SetZero();this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=this.m_motorMass=0;this.m_lowerTranslation=
b.lowerTranslation;this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor};a.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_localXAxis1=new b2Vec2;this.m_localYAxis1=new b2Vec2;this.m_linearJacobian=new b2Jacobian;this.m_motorJacobian=new b2Jacobian};a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_localXAxis1=new b2Vec2;
a.m_localYAxis1=new b2Vec2;a.m_refAngle=null;a.m_linearJacobian=new b2Jacobian;a.m_linearMass=null;a.m_force=null;a.m_angularMass=null;a.m_torque=null;a.m_motorJacobian=new b2Jacobian;a.m_motorMass=null;a.m_motorForce=null;a.m_limitForce=null;a.m_limitPositionImpulse=null;a.m_lowerTranslation=null;a.m_upperTranslation=null;a.m_maxMotorForce=null;a.m_motorSpeed=null;a.m_enableLimit=null;a.m_enableMotor=null;a.m_limitState=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};
a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
a.GetReactionForce=function(){var b=this.m_body1.m_xf.R;return new b2Vec2(this.m_limitForce*this.m_limitForce*(b.col1.x*this.m_localXAxis1.x+b.col2.x*this.m_localXAxis1.y)+this.m_force*this.m_force*(b.col1.x*this.m_localYAxis1.x+b.col2.x*this.m_localYAxis1.y),this.m_limitForce*this.m_limitForce*(b.col1.y*this.m_localXAxis1.x+b.col2.y*this.m_localXAxis1.y)+this.m_force*this.m_force*(b.col1.y*this.m_localYAxis1.x+b.col2.y*this.m_localYAxis1.y))};a.GetReactionTorque=function(){return this.m_torque};
a.GetJointTranslation=function(){var b=this.m_body1,c=this.m_body2,d=b.GetWorldPoint(this.m_localAnchor1),e=c.GetWorldPoint(this.m_localAnchor2);c=e.x-d.x;d=e.y-d.y;b=b.GetWorldVector(this.m_localXAxis1);return b.x*c+b.y*d};
a.GetJointSpeed=function(){var b=this.m_body1,c=this.m_body2,d;d=b.m_xf.R;var e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=d.col1.x*e+d.col2.x*f;f=d.col1.y*e+d.col2.y*f;e=h;d=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,i=this.m_localAnchor2.y-c.m_sweep.localCenter.y;h=d.col1.x*g+d.col2.x*i;i=d.col1.y*g+d.col2.y*i;g=h;d=c.m_sweep.c.x+g-(b.m_sweep.c.x+e);h=c.m_sweep.c.y+i-(b.m_sweep.c.y+f);var j=b.GetWorldVector(this.m_localXAxis1),
k=b.m_linearVelocity,l=c.m_linearVelocity;b=b.m_angularVelocity;c=c.m_angularVelocity;return d*-b*j.y+h*b*j.x+(j.x*(l.x+-c*i-k.x- -b*f)+j.y*(l.y+c*g-k.y-b*e))};a.IsLimitEnabled=function(){return this.m_enableLimit};a.EnableLimit=function(b){this.m_enableLimit=b};a.GetLowerLimit=function(){return this.m_lowerTranslation};a.GetUpperLimit=function(){return this.m_upperTranslation};a.SetLimits=function(b,c){this.m_lowerTranslation=b;this.m_upperTranslation=c};a.IsMotorEnabled=function(){return this.m_enableMotor};
a.EnableMotor=function(b){this.m_enableMotor=b};a.SetMotorSpeed=function(b){this.m_motorSpeed=b};a.GetMotorSpeed=function(){return this.m_motorSpeed};a.SetMaxMotorForce=function(b){this.m_maxMotorForce=b};a.GetMotorForce=function(){return this.m_motorForce};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var h=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*h+e.col2.x*g;g=e.col1.y*h+e.col2.y*g;h=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;f=c.m_invMass;var k=d.m_invMass,l=c.m_invI,o=d.m_invI;e=c.m_xf.R;var q=e.col1.x*this.m_localYAxis1.x+
e.col2.x*this.m_localYAxis1.y;e=e.col1.y*this.m_localYAxis1.x+e.col2.y*this.m_localYAxis1.y;var t=d.m_sweep.c.x+i-c.m_sweep.c.x,w=d.m_sweep.c.y+j-c.m_sweep.c.y;this.m_linearJacobian.linear1.x=-q;this.m_linearJacobian.linear1.y=-e;this.m_linearJacobian.linear2.x=q;this.m_linearJacobian.linear2.y=e;this.m_linearJacobian.angular1=-(t*e-w*q);this.m_linearJacobian.angular2=i*e-j*q;this.m_linearMass=f+l*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+k+o*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2;
this.m_linearMass=1/this.m_linearMass;this.m_angularMass=l+o;if(this.m_angularMass>Number.MIN_VALUE)this.m_angularMass=1/this.m_angularMass;if(this.m_enableLimit||this.m_enableMotor){e=c.m_xf.R;q=e.col1.x*this.m_localXAxis1.x+e.col2.x*this.m_localXAxis1.y;e=e.col1.y*this.m_localXAxis1.x+e.col2.y*this.m_localXAxis1.y;this.m_motorJacobian.linear1.x=-q;this.m_motorJacobian.linear1.y=-e;this.m_motorJacobian.linear2.x=q;this.m_motorJacobian.linear2.y=e;this.m_motorJacobian.angular1=-(t*e-w*q);this.m_motorJacobian.angular2=
i*e-j*q;this.m_motorMass=f+l*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+k+o*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2;this.m_motorMass=1/this.m_motorMass;if(this.m_enableLimit){h=q*(t-h)+e*(w-g);if(b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop)this.m_limitState=b2Joint.e_equalLimits;else if(h<=this.m_lowerTranslation){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atLowerLimit}else if(h>=
this.m_upperTranslation){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitForce=0}}}if(this.m_enableMotor==false)this.m_motorForce=0;if(this.m_enableLimit==false)this.m_limitForce=0;if(b.warmStarting){h=b.dt*(this.m_force*this.m_linearJacobian.linear1.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.y);g=b.dt*(this.m_force*this.m_linearJacobian.linear2.x+(this.m_motorForce+
this.m_limitForce)*this.m_motorJacobian.linear2.x);i=b.dt*(this.m_force*this.m_linearJacobian.linear2.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear2.y);j=b.dt*(this.m_force*this.m_linearJacobian.angular1-this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular1);t=b.dt*(this.m_force*this.m_linearJacobian.angular2+this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular2);c.m_linearVelocity.x+=f*b.dt*(this.m_force*this.m_linearJacobian.linear1.x+
(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.x);c.m_linearVelocity.y+=f*h;c.m_angularVelocity+=l*j;d.m_linearVelocity.x+=k*g;d.m_linearVelocity.y+=k*i;d.m_angularVelocity+=o*t}else this.m_motorForce=this.m_limitForce=this.m_torque=this.m_force=0;this.m_limitPositionImpulse=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e=c.m_invMass,f=d.m_invMass,h=c.m_invI,g=d.m_invI,i;i=this.m_linearJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);i=-b.inv_dt*this.m_linearMass*i;this.m_force+=i;i=b.dt*i;c.m_linearVelocity.x+=e*i*this.m_linearJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_linearJacobian.linear1.y;c.m_angularVelocity+=h*i*this.m_linearJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_linearJacobian.linear2.x;
d.m_linearVelocity.y+=f*i*this.m_linearJacobian.linear2.y;d.m_angularVelocity+=g*i*this.m_linearJacobian.angular2;i=-b.inv_dt*this.m_angularMass*(d.m_angularVelocity-c.m_angularVelocity);this.m_torque+=i;i=b.dt*i;c.m_angularVelocity-=h*i;d.m_angularVelocity+=g*i;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){i=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity)-this.m_motorSpeed;i=-b.inv_dt*this.m_motorMass*i;var j=this.m_motorForce;
this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+i,-this.m_maxMotorForce,this.m_maxMotorForce);i=this.m_motorForce-j;i=b.dt*i;c.m_linearVelocity.x+=e*i*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=h*i*this.m_motorJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_motorJacobian.linear2.x;d.m_linearVelocity.y+=f*i*this.m_motorJacobian.linear2.y;d.m_angularVelocity+=g*i*this.m_motorJacobian.angular2}if(this.m_enableLimit&&this.m_limitState!=
b2Joint.e_inactiveLimit){i=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);j=-b.inv_dt*this.m_motorMass*i;if(this.m_limitState==b2Joint.e_equalLimits)this.m_limitForce+=j;else if(this.m_limitState==b2Joint.e_atLowerLimit){i=this.m_limitForce;this.m_limitForce=b2Math.b2Max(this.m_limitForce+j,0);j=this.m_limitForce-i}else if(this.m_limitState==b2Joint.e_atUpperLimit){i=this.m_limitForce;this.m_limitForce=b2Math.b2Min(this.m_limitForce+j,0);
j=this.m_limitForce-i}i=b.dt*j;c.m_linearVelocity.x+=e*i*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=h*i*this.m_motorJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_motorJacobian.linear2.x;d.m_linearVelocity.y+=f*i*this.m_motorJacobian.linear2.y;d.m_angularVelocity+=g*i*this.m_motorJacobian.angular2}};
a.SolvePositionConstraints=function(){var b,c,d=this.m_body1,e=this.m_body2,f=d.m_invMass,h=e.m_invMass,g=d.m_invI,i=e.m_invI,j,k;j=d.m_xf.R;var l=this.m_localAnchor1.x-d.m_sweep.localCenter.x,o=this.m_localAnchor1.y-d.m_sweep.localCenter.y;k=j.col1.x*l+j.col2.x*o;o=j.col1.y*l+j.col2.y*o;l=k;j=e.m_xf.R;var q=this.m_localAnchor2.x-e.m_sweep.localCenter.x;b=this.m_localAnchor2.y-e.m_sweep.localCenter.y;k=j.col1.x*q+j.col2.x*b;b=j.col1.y*q+j.col2.y*b;q=k;j=d.m_sweep.c.x+l;o=d.m_sweep.c.y+o;q=e.m_sweep.c.x+
q;b=e.m_sweep.c.y+b;q-=j;b-=o;j=d.m_xf.R;var t=(j.col1.x*this.m_localYAxis1.x+j.col2.x*this.m_localYAxis1.y)*q+(j.col1.y*this.m_localYAxis1.x+j.col2.y*this.m_localYAxis1.y)*b;t=b2Math.b2Clamp(t,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);c=-this.m_linearMass*t;d.m_sweep.c.x+=f*c*this.m_linearJacobian.linear1.x;d.m_sweep.c.y+=f*c*this.m_linearJacobian.linear1.y;d.m_sweep.a+=g*c*this.m_linearJacobian.angular1;e.m_sweep.c.x+=h*c*this.m_linearJacobian.linear2.x;e.m_sweep.c.y+=
h*c*this.m_linearJacobian.linear2.y;e.m_sweep.a+=i*c*this.m_linearJacobian.angular2;t=b2Math.b2Abs(t);c=e.m_sweep.a-d.m_sweep.a-this.m_refAngle;c=b2Math.b2Clamp(c,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var w=-this.m_angularMass*c;d.m_sweep.a-=d.m_invI*w;e.m_sweep.a+=e.m_invI*w;d.SynchronizeTransform();e.SynchronizeTransform();w=b2Math.b2Abs(c);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){j=d.m_xf.R;l=this.m_localAnchor1.x-d.m_sweep.localCenter.x;
o=this.m_localAnchor1.y-d.m_sweep.localCenter.y;k=j.col1.x*l+j.col2.x*o;o=j.col1.y*l+j.col2.y*o;l=k;j=e.m_xf.R;q=this.m_localAnchor2.x-e.m_sweep.localCenter.x;b=this.m_localAnchor2.y-e.m_sweep.localCenter.y;k=j.col1.x*q+j.col2.x*b;b=j.col1.y*q+j.col2.y*b;q=k;j=d.m_sweep.c.x+l;o=d.m_sweep.c.y+o;q=e.m_sweep.c.x+q;b=e.m_sweep.c.y+b;q-=j;b-=o;j=d.m_xf.R;j=(j.col1.x*this.m_localXAxis1.x+j.col2.x*this.m_localXAxis1.y)*q+(j.col1.y*this.m_localXAxis1.x+j.col2.y*this.m_localXAxis1.y)*b;b=0;if(this.m_limitState==
b2Joint.e_equalLimits){b=b2Math.b2Clamp(j,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);b=-this.m_motorMass*b;t=b2Math.b2Max(t,b2Math.b2Abs(c))}else if(this.m_limitState==b2Joint.e_atLowerLimit){b=j-this.m_lowerTranslation;t=b2Math.b2Max(t,-b);b=b2Math.b2Clamp(b+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);b=-this.m_motorMass*b;c=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+b,0);b=this.m_limitPositionImpulse-
c}else if(this.m_limitState==b2Joint.e_atUpperLimit){b=j-this.m_upperTranslation;t=b2Math.b2Max(t,b);b=b2Math.b2Clamp(b-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection);b=-this.m_motorMass*b;c=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+b,0);b=this.m_limitPositionImpulse-c}d.m_sweep.c.x+=f*b*this.m_motorJacobian.linear1.x;d.m_sweep.c.y+=f*b*this.m_motorJacobian.linear1.y;d.m_sweep.a+=g*b*this.m_motorJacobian.angular1;e.m_sweep.c.x+=
h*b*this.m_motorJacobian.linear2.x;e.m_sweep.c.y+=h*b*this.m_motorJacobian.linear2.y;e.m_sweep.a+=i*b*this.m_motorJacobian.angular2;d.SynchronizeTransform();e.SynchronizeTransform()}return t<=b2Settings.b2_linearSlop&&w<=b2Settings.b2_angularSlop};var ClipVertex=function(){this.__varz();this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){};ClipVertex.prototype.__varz=function(){this.v=new b2Vec2;this.id=new b2ContactID};ClipVertex.prototype.v=new b2Vec2;
ClipVertex.prototype.id=new b2ContactID;var b2NullContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype);a=b2NullContact.prototype;a._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){};a.__varz=function(){};a.Evaluate=function(){};a.GetManifolds=function(){return null};
var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype);b2PolyAndCircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};
b2PolyAndCircleContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polygonShape);b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape);this.m_manifold.pointCount=0;b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};b2PolyAndCircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2PolyAndCircleContact.s_evalCP=new b2ContactPoint;
b2PolyAndCircleContact.Create=function(b,c){return new b2PolyAndCircleContact(b,c)};b2PolyAndCircleContact.Destroy=function(){};a=b2PolyAndCircleContact.prototype;a.m_manifolds=[new b2Manifold];a.m0=new b2Manifold;a.m_manifold=null;
a.Evaluate=function(b){var c=0,d,e,f,h=this.m_shape1.m_body,g=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygonAndCircle(this.m_manifold,this.m_shape1,h.m_xf,this.m_shape2,g.m_xf);var i=[false,false],j=b2PolyAndCircleContact.s_evalCP;j.shape1=this.m_shape1;j.shape2=this.m_shape2;j.friction=this.m_friction;j.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(c=0;c<this.m_manifold.pointCount;++c){var k=this.m_manifold.points[c];k.normalImpulse=0;k.tangentImpulse=
0;var l=false,o=k.id._key;for(d=0;d<this.m0.pointCount;++d)if(i[d]!=true){f=this.m0.points[d];if(f.id._key==o){i[d]=true;k.normalImpulse=f.normalImpulse;k.tangentImpulse=f.tangentImpulse;l=true;if(b!=null){j.position=h.GetWorldPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint1);e=g.GetLinearVelocityFromLocalPoint(k.localPoint2);j.velocity.Set(e.x-d.x,e.y-d.y);j.normal.SetV(this.m_manifold.normal);j.separation=k.separation;j.id.key=o;b.Persist(j)}break}}if(l==false&&b!=null){j.position=
h.GetWorldPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint1);e=g.GetLinearVelocityFromLocalPoint(k.localPoint2);j.velocity.Set(e.x-d.x,e.y-d.y);j.normal.SetV(this.m_manifold.normal);j.separation=k.separation;j.id.key=o;b.Add(j)}}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(b!=null)for(c=0;c<this.m0.pointCount;++c)if(!i[c]){f=this.m0.points[c];j.position=h.GetWorldPoint(f.localPoint1);d=h.GetLinearVelocityFromLocalPoint(f.localPoint1);e=g.GetLinearVelocityFromLocalPoint(f.localPoint2);
j.velocity.Set(e.x-d.x,e.y-d.y);j.normal.SetV(this.m0.normal);j.separation=f.separation;j.id.key=f.id._key;b.Remove(j)}};a.GetManifolds=function(){return this.m_manifolds};var b2ContactManager=function(){b2PairCallback.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2ContactManager.prototype,b2PairCallback.prototype);b2ContactManager.prototype._super=function(){b2PairCallback.prototype.__constructor.apply(this,arguments)};
b2ContactManager.prototype.__constructor=function(){this.m_world=null;this.m_destroyImmediate=false};b2ContactManager.prototype.__varz=function(){this.m_nullContact=new b2NullContact};b2ContactManager.s_evalCP=new b2ContactPoint;a=b2ContactManager.prototype;a.m_world=null;a.m_nullContact=new b2NullContact;a.m_destroyImmediate=null;
a.PairAdded=function(b,c){var d=b.m_body,e=c.m_body;if(d.IsStatic()&&e.IsStatic())return this.m_nullContact;if(b.m_body==c.m_body)return this.m_nullContact;if(e.IsConnected(d))return this.m_nullContact;if(this.m_world.m_contactFilter!=null&&this.m_world.m_contactFilter.ShouldCollide(b,c)==false)return this.m_nullContact;var f=b2Contact.Create(b,c,this.m_world.m_blockAllocator);if(f==null)return this.m_nullContact;b=f.m_shape1;c=f.m_shape2;d=b.m_body;e=c.m_body;f.m_prev=null;f.m_next=this.m_world.m_contactList;
if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=f;this.m_world.m_contactList=f;f.m_node1.contact=f;f.m_node1.other=e;f.m_node1.prev=null;f.m_node1.next=d.m_contactList;if(d.m_contactList!=null)d.m_contactList.prev=f.m_node1;d.m_contactList=f.m_node1;f.m_node2.contact=f;f.m_node2.other=d;f.m_node2.prev=null;f.m_node2.next=e.m_contactList;if(e.m_contactList!=null)e.m_contactList.prev=f.m_node2;e.m_contactList=f.m_node2;++this.m_world.m_contactCount;return f};
a.PairRemoved=function(b,c,d){d!=null&&d!=this.m_nullContact&&this.Destroy(d)};
a.Destroy=function(b){var c=b.m_shape1,d=b.m_shape2,e=b.m_manifoldCount;if(e>0&&this.m_world.m_contactListener){var f=c.m_body,h=d.m_body,g=b.GetManifolds(),i=b2ContactManager.s_evalCP;i.shape1=b.m_shape1;i.shape2=b.m_shape1;i.friction=b.m_friction;i.restitution=b.m_restitution;for(var j=0;j<e;++j){var k=g[j];i.normal.SetV(k.normal);for(var l=0;l<k.pointCount;++l){var o=k.points[l];i.position=f.GetWorldPoint(o.localPoint1);var q=f.GetLinearVelocityFromLocalPoint(o.localPoint1),t=h.GetLinearVelocityFromLocalPoint(o.localPoint2);
i.velocity.Set(t.x-q.x,t.y-q.y);i.separation=o.separation;i.id.key=o.id._key;this.m_world.m_contactListener.Remove(i)}}}if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_world.m_contactList)this.m_world.m_contactList=b.m_next;c=c.m_body;d=d.m_body;if(b.m_node1.prev)b.m_node1.prev.next=b.m_node1.next;if(b.m_node1.next)b.m_node1.next.prev=b.m_node1.prev;if(b.m_node1==c.m_contactList)c.m_contactList=b.m_node1.next;if(b.m_node2.prev)b.m_node2.prev.next=b.m_node2.next;
if(b.m_node2.next)b.m_node2.next.prev=b.m_node2.prev;if(b.m_node2==d.m_contactList)d.m_contactList=b.m_node2.next;b2Contact.Destroy(b,this.m_world.m_blockAllocator);--this.m_world.m_contactCount};a.Collide=function(){for(var b=this.m_world.m_contactList;b;b=b.m_next){var c=b.m_shape2.m_body;b.m_shape1.m_body.IsSleeping()&&c.IsSleeping()||b.Update(this.m_world.m_contactListener)}};var b2World=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2World.prototype.__constructor=function(b,c,d){this.m_boundaryListener=this.m_destructionListener=null;this.m_contactFilter=b2ContactFilter.b2_defaultFilter;this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_contactListener=null;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;b2World.m_positionCorrection=true;b2World.m_warmStarting=true;b2World.m_continuousPhysics=true;this.m_allowSleep=d;this.m_gravity=c;this.m_lock=false;this.m_inv_dt0=0;this.m_contactManager.m_world=
this;this.m_broadPhase=new b2BroadPhase(b,this.m_contactManager);this.m_groundBody=this.CreateBody(new b2BodyDef)};b2World.prototype.__varz=function(){this.m_raycastNormal=new b2Vec2;this.m_contactManager=new b2ContactManager};b2World.m_positionCorrection=null;b2World.m_warmStarting=null;b2World.m_continuousPhysics=null;b2World.s_jointColor=new b2Color(0.5,0.8,0.8);b2World.s_coreColor=new b2Color(0.9,0.6,0.6);b2World.s_xf=new b2XForm;a=b2World.prototype;a.m_raycastUserData=null;
a.m_raycastSegment=null;a.m_raycastNormal=new b2Vec2;a.m_blockAllocator=null;a.m_stackAllocator=null;a.m_lock=null;a.m_broadPhase=null;a.m_contactManager=new b2ContactManager;a.m_bodyList=null;a.m_jointList=null;a.m_contactList=null;a.m_bodyCount=0;a.m_contactCount=0;a.m_jointCount=0;a.m_gravity=null;a.m_allowSleep=null;a.m_groundBody=null;a.m_destructionListener=null;a.m_boundaryListener=null;a.m_contactFilter=null;a.m_contactListener=null;a.m_debugDraw=null;a.m_inv_dt0=null;
a.m_positionIterationCount=0;a.SetDestructionListener=function(b){this.m_destructionListener=b};a.SetBoundaryListener=function(b){this.m_boundaryListener=b};a.SetContactFilter=function(b){this.m_contactFilter=b};a.SetContactListener=function(b){this.m_contactListener=b};a.SetDebugDraw=function(b){this.m_debugDraw=b};a.Validate=function(){this.m_broadPhase.Validate()};a.GetProxyCount=function(){return this.m_broadPhase.m_proxyCount};a.GetPairCount=function(){return this.m_broadPhase.m_pairManager.m_pairCount};
a.CreateBody=function(b){if(this.m_lock==true)return null;b=new b2Body(b,this);b.m_prev=null;if(b.m_next=this.m_bodyList)this.m_bodyList.m_prev=b;this.m_bodyList=b;++this.m_bodyCount;return b};
a.DestroyBody=function(b){if(this.m_lock!=true){for(var c=b.m_jointList;c;){var d=c;c=c.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(d.joint);this.DestroyJoint(d.joint)}for(c=b.m_shapeList;c;){d=c;c=c.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeShape(d);d.DestroyProxy(this.m_broadPhase);b2Shape.Destroy(d,this.m_blockAllocator)}if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_bodyList)this.m_bodyList=b.m_next;
--this.m_bodyCount}};
a.CreateJoint=function(b){var c=b2Joint.Create(b,this.m_blockAllocator);c.m_prev=null;if(c.m_next=this.m_jointList)this.m_jointList.m_prev=c;this.m_jointList=c;++this.m_jointCount;c.m_node1.joint=c;c.m_node1.other=c.m_body2;c.m_node1.prev=null;if(c.m_node1.next=c.m_body1.m_jointList)c.m_body1.m_jointList.prev=c.m_node1;c.m_body1.m_jointList=c.m_node1;c.m_node2.joint=c;c.m_node2.other=c.m_body1;c.m_node2.prev=null;if(c.m_node2.next=c.m_body2.m_jointList)c.m_body2.m_jointList.prev=c.m_node2;c.m_body2.m_jointList=
c.m_node2;if(b.collideConnected==false){b=b.body1.m_shapeCount<b.body2.m_shapeCount?b.body1:b.body2;for(var d=b.m_shapeList;d;d=d.m_next)d.RefilterProxy(this.m_broadPhase,b.m_xf)}return c};
a.DestroyJoint=function(b){var c=b.m_collideConnected;if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_jointList)this.m_jointList=b.m_next;var d=b.m_body1,e=b.m_body2;d.WakeUp();e.WakeUp();if(b.m_node1.prev)b.m_node1.prev.next=b.m_node1.next;if(b.m_node1.next)b.m_node1.next.prev=b.m_node1.prev;if(b.m_node1==d.m_jointList)d.m_jointList=b.m_node1.next;b.m_node1.prev=null;b.m_node1.next=null;if(b.m_node2.prev)b.m_node2.prev.next=b.m_node2.next;if(b.m_node2.next)b.m_node2.next.prev=
b.m_node2.prev;if(b.m_node2==e.m_jointList)e.m_jointList=b.m_node2.next;b.m_node2.prev=null;b.m_node2.next=null;b2Joint.Destroy(b,this.m_blockAllocator);--this.m_jointCount;if(c==false){b=d.m_shapeCount<e.m_shapeCount?d:e;for(c=b.m_shapeList;c;c=c.m_next)c.RefilterProxy(this.m_broadPhase,b.m_xf)}};a.Refilter=function(b){b.RefilterProxy(this.m_broadPhase,b.m_body.m_xf)};a.SetWarmStarting=function(b){b2World.m_warmStarting=b};a.SetPositionCorrection=function(b){b2World.m_positionCorrection=b};
a.SetContinuousPhysics=function(b){b2World.m_continuousPhysics=b};a.GetBodyCount=function(){return this.m_bodyCount};a.GetJointCount=function(){return this.m_jointCount};a.GetContactCount=function(){return this.m_contactCount};a.SetGravity=function(b){this.m_gravity=b};a.GetGroundBody=function(){return this.m_groundBody};
a.Step=function(b,c){this.m_lock=true;var d=new b2TimeStep;d.dt=b;d.maxIterations=c;d.inv_dt=b>0?1/b:0;d.dtRatio=this.m_inv_dt0*b;d.positionCorrection=b2World.m_positionCorrection;d.warmStarting=b2World.m_warmStarting;this.m_contactManager.Collide();d.dt>0&&this.Solve(d);b2World.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d);this.DrawDebugData();this.m_inv_dt0=d.inv_dt;this.m_lock=false};a.Query=function(b,c,d){var e=Array(d);b=this.m_broadPhase.QueryAABB(b,e,d);for(d=0;d<b;++d)c[d]=e[d];return b};
a.Raycast=function(b,c,d,e,f){var h=Array(d);this.m_raycastSegment=b;this.m_raycastUserData=f;f=e?this.m_broadPhase.QuerySegment(b,h,d,this.RaycastSortKey):this.m_broadPhase.QuerySegment(b,h,d,this.RaycastSortKey2);for(b=0;b<f;++b)c[b]=h[b];return f};a.RaycastOne=function(b,c,d,e,f){var h=Array(1);e=this.Raycast(b,h,1,e,f);if(e==0)return null;e>1&&trace(e);h=h[0];e=h.GetBody().GetXForm();h.TestSegment(e,c,d,b,1);return h};a.GetBodyList=function(){return this.m_bodyList};a.GetJointList=function(){return this.m_jointList};
a.Solve=function(b){var c;this.m_positionIterationCount=0;var d=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator,this.m_contactListener);for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~b2Body.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~b2Contact.e_islandFlag;for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=false;e=Array(this.m_bodyCount);for(var f=this.m_bodyList;f;f=f.m_next)if(!(f.m_flags&(b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag)))if(!f.IsStatic()){d.Clear();
var h=0;e[h++]=f;for(f.m_flags|=b2Body.e_islandFlag;h>0;){c=e[--h];d.AddBody(c);c.m_flags&=~b2Body.e_sleepFlag;if(!c.IsStatic()){for(var g,i=c.m_contactList;i;i=i.next)if(!(i.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_nonSolidFlag)))if(i.contact.m_manifoldCount!=0){d.AddContact(i.contact);i.contact.m_flags|=b2Contact.e_islandFlag;g=i.other;if(!(g.m_flags&b2Body.e_islandFlag)){e[h++]=g;g.m_flags|=b2Body.e_islandFlag}}for(c=c.m_jointList;c;c=c.next)if(c.joint.m_islandFlag!=true){d.AddJoint(c.joint);
c.joint.m_islandFlag=true;g=c.other;if(!(g.m_flags&b2Body.e_islandFlag)){e[h++]=g;g.m_flags|=b2Body.e_islandFlag}}}}d.Solve(b,this.m_gravity,b2World.m_positionCorrection,this.m_allowSleep);if(d.m_positionIterationCount>this.m_positionIterationCount)this.m_positionIterationCount=d.m_positionIterationCount;for(h=0;h<d.m_bodyCount;++h){c=d.m_bodies[h];if(c.IsStatic())c.m_flags&=~b2Body.e_islandFlag}}for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag)||c.IsStatic()||
c.SynchronizeShapes()==false&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(c);this.m_broadPhase.Commit()};
a.SolveTOI=function(b){var c,d,e,f=new b2Island(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,0,this.m_stackAllocator,this.m_contactListener),h=Array(this.m_bodyCount);for(c=this.m_bodyList;c;c=c.m_next){c.m_flags&=~b2Body.e_islandFlag;c.m_sweep.t0=0}var g;for(g=this.m_contactList;g;g=g.m_next)g.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(;;){c=null;var i=1;for(g=this.m_contactList;g;g=g.m_next)if(!(g.m_flags&(b2Contact.e_slowFlag|b2Contact.e_nonSolidFlag))){if(g.m_flags&b2Contact.e_toiFlag)d=
g.m_toi;else{d=g.m_shape1;e=g.m_shape2;d=d.m_body;e=e.m_body;if((d.IsStatic()||d.IsSleeping())&&(e.IsStatic()||e.IsSleeping()))continue;var j=d.m_sweep.t0;if(d.m_sweep.t0<e.m_sweep.t0){j=e.m_sweep.t0;d.m_sweep.Advance(j)}else if(e.m_sweep.t0<d.m_sweep.t0){j=d.m_sweep.t0;e.m_sweep.Advance(j)}d=b2TimeOfImpact.TimeOfImpact(g.m_shape1,d.m_sweep,g.m_shape2,e.m_sweep);if(d>0&&d<1){d=(1-d)*j+d;if(d>1)d=1}g.m_toi=d;g.m_flags|=b2Contact.e_toiFlag}if(Number.MIN_VALUE<d&&d<i){c=g;i=d}}if(c==null||1-100*Number.MIN_VALUE<
i)break;d=c.m_shape1;e=c.m_shape2;d=d.m_body;e=e.m_body;d.Advance(i);e.Advance(i);c.Update(this.m_contactListener);c.m_flags&=~b2Contact.e_toiFlag;if(c.m_manifoldCount!=0){c=d;if(c.IsStatic())c=e;f.Clear();g=0;h[g++]=c;for(c.m_flags|=b2Body.e_islandFlag;g>0;){c=h[--g];f.AddBody(c);c.m_flags&=~b2Body.e_sleepFlag;if(!c.IsStatic())for(c=c.m_contactList;c;c=c.next)if(f.m_contactCount!=f.m_contactCapacity)if(!(c.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_slowFlag|b2Contact.e_nonSolidFlag)))if(c.contact.m_manifoldCount!=
0){f.AddContact(c.contact);c.contact.m_flags|=b2Contact.e_islandFlag;d=c.other;if(!(d.m_flags&b2Body.e_islandFlag)){if(d.IsStatic()==false){d.Advance(i);d.WakeUp()}h[g++]=d;d.m_flags|=b2Body.e_islandFlag}}}g=new b2TimeStep;g.dt=(1-i)*b.dt;g.inv_dt=1/g.dt;g.maxIterations=b.maxIterations;f.SolveTOI(g);for(i=i=0;i<f.m_bodyCount;++i){c=f.m_bodies[i];c.m_flags&=~b2Body.e_islandFlag;if(!(c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag)))if(!c.IsStatic()){c.SynchronizeShapes()==false&&this.m_boundaryListener!=
null&&this.m_boundaryListener.Violation(c);for(c=c.m_contactList;c;c=c.next)c.contact.m_flags&=~b2Contact.e_toiFlag}}for(i=0;i<f.m_contactCount;++i){g=f.m_contacts[i];g.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag)}this.m_broadPhase.Commit()}}};
a.DrawJoint=function(b){var c=b.m_body1,d=b.m_body2,e=c.m_xf.position,f=d.m_xf.position,h=b.GetAnchor1(),g=b.GetAnchor2(),i=b2World.s_jointColor;switch(b.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(h,g,i);break;case b2Joint.e_pulleyJoint:c=b.GetGroundAnchor1();b=b.GetGroundAnchor2();this.m_debugDraw.DrawSegment(c,h,i);this.m_debugDraw.DrawSegment(b,g,i);this.m_debugDraw.DrawSegment(c,b,i);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(h,g,i);break;default:c!=this.m_groundBody&&
this.m_debugDraw.DrawSegment(e,h,i);this.m_debugDraw.DrawSegment(h,g,i);d!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,g,i)}};
a.DrawShape=function(b,c,d,e){var f=b2World.s_coreColor;switch(b.m_type){case b2Shape.e_circleShape:var h=b2Math.b2MulX(c,b.m_localPosition);b=b.m_radius;this.m_debugDraw.DrawSolidCircle(h,b,c.R.col1,d);e&&this.m_debugDraw.DrawCircle(h,b-b2Settings.b2_toiSlop,f);break;case b2Shape.e_polygonShape:var g=b.GetVertexCount(),i=b.GetVertices(),j=Array(b2Settings.b2_maxPolygonVertices);for(h=0;h<g;++h)j[h]=b2Math.b2MulX(c,i[h]);this.m_debugDraw.DrawSolidPolygon(j,g,d);if(e){d=b.GetCoreVertices();for(h=0;h<
g;++h)j[h]=b2Math.b2MulX(c,d[h]);this.m_debugDraw.DrawPolygon(j,g,f)}}};
a.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var b=this.m_debugDraw.GetFlags(),c=0,d,e,f=new b2Vec2,h=new b2Vec2,g=new b2Vec2,i=new b2Color(0,0,0),j,k=new b2AABB,l=new b2AABB,o=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];if(b&b2DebugDraw.e_shapeBit){c=(b&b2DebugDraw.e_coreShapeBit)==b2DebugDraw.e_coreShapeBit;for(d=this.m_bodyList;d;d=d.m_next){j=d.m_xf;for(e=d.GetShapeList();e;e=e.m_next)if(d.IsStatic())this.DrawShape(e,j,new b2Color(0.5,0.9,
0.5),c);else d.IsSleeping()?this.DrawShape(e,j,new b2Color(0.5,0.5,0.9),c):this.DrawShape(e,j,new b2Color(0.9,0.9,0.9),c)}}if(b&b2DebugDraw.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(b&b2DebugDraw.e_pairBit){d=this.m_broadPhase;f.Set(1/d.m_quantizationFactor.x,1/d.m_quantizationFactor.y);i.Set(0.9,0.9,0.3);for(c=0;c<b2Pair.b2_tableCapacity;++c)for(e=d.m_pairManager.m_hashTable[c];e!=b2Pair.b2_nullPair;){e=d.m_pairManager.m_pairs[e];j=d.m_proxyPool[e.proxyId1];var q=d.m_proxyPool[e.proxyId2];
k.lowerBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][j.lowerBounds[0]].value;k.lowerBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][j.lowerBounds[1]].value;k.upperBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][j.upperBounds[0]].value;k.upperBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][j.upperBounds[1]].value;l.lowerBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][q.lowerBounds[0]].value;l.lowerBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][q.lowerBounds[1]].value;
l.upperBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][q.upperBounds[0]].value;l.upperBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][q.upperBounds[1]].value;h.x=0.5*(k.lowerBound.x+k.upperBound.x);h.y=0.5*(k.lowerBound.y+k.upperBound.y);g.x=0.5*(l.lowerBound.x+l.upperBound.x);g.y=0.5*(l.lowerBound.y+l.upperBound.y);this.m_debugDraw.DrawSegment(h,g,i);e=e.next}}if(b&b2DebugDraw.e_aabbBit){d=this.m_broadPhase;h=d.m_worldAABB.lowerBound;g=d.m_worldAABB.upperBound;f.Set(1/d.m_quantizationFactor.x,
1/d.m_quantizationFactor.y);i.Set(0.9,0.3,0.9);for(c=0;c<b2Settings.b2_maxProxies;++c){l=d.m_proxyPool[c];if(l.IsValid()!=false){k.lowerBound.x=h.x+f.x*d.m_bounds[0][l.lowerBounds[0]].value;k.lowerBound.y=h.y+f.y*d.m_bounds[1][l.lowerBounds[1]].value;k.upperBound.x=h.x+f.x*d.m_bounds[0][l.upperBounds[0]].value;k.upperBound.y=h.y+f.y*d.m_bounds[1][l.upperBounds[1]].value;o[0].Set(k.lowerBound.x,k.lowerBound.y);o[1].Set(k.upperBound.x,k.lowerBound.y);o[2].Set(k.upperBound.x,k.upperBound.y);o[3].Set(k.lowerBound.x,
k.upperBound.y);this.m_debugDraw.DrawPolygon(o,4,i)}}o[0].Set(h.x,h.y);o[1].Set(g.x,h.y);o[2].Set(g.x,g.y);o[3].Set(h.x,g.y);this.m_debugDraw.DrawPolygon(o,4,new b2Color(0.3,0.9,0.9))}if(b&b2DebugDraw.e_obbBit){i.Set(0.5,0.3,0.5);for(d=this.m_bodyList;d;d=d.m_next){j=d.m_xf;for(e=d.GetShapeList();e;e=e.m_next)if(e.m_type==b2Shape.e_polygonShape){f=e.GetOBB();c=f.extents;o[0].Set(-c.x,-c.y);o[1].Set(c.x,-c.y);o[2].Set(c.x,c.y);o[3].Set(-c.x,c.y);for(c=0;c<4;++c){k=f.R;h=o[c];g=f.center.x+(k.col1.x*
h.x+k.col2.x*h.y);o[c].y=f.center.y+(k.col1.y*h.x+k.col2.y*h.y);o[c].x=g;k=j.R;g=j.position.x+(k.col1.x*h.x+k.col2.x*h.y);o[c].y=j.position.y+(k.col1.y*h.x+k.col2.y*h.y);o[c].x=g}this.m_debugDraw.DrawPolygon(o,4,i)}}}if(b&b2DebugDraw.e_centerOfMassBit)for(d=this.m_bodyList;d;d=d.m_next){j=b2World.s_xf;j.R=d.m_xf.R;j.position=d.GetWorldCenter();this.m_debugDraw.DrawXForm(j)}}};
a.RaycastSortKey=function(b){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,b))return-1;var c=b.GetBody().GetXForm(),d=[0];if(b.TestSegment(c,d,this.m_raycastNormal,this.m_raycastSegment,1)==b2Shape.e_missCollide)return-1;return d[0]};
a.RaycastSortKey2=function(b){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,b))return-1;var c=b.GetBody().GetXForm(),d=[0];if(b.TestSegment(c,d,this.m_raycastNormal,this.m_raycastSegment,1)!=b2Shape.e_hitCollide)return-1;return d[0]};var Rectangle=function(b,c,d,e){this.x=b;this.y=c;this.width=d;this.height=e};Rectangle.prototype.draw=function(b){b.fillRect(this.x,this.y,this.width,this.height);b.addClearRectangle(this)};
CanvasRenderingContext2D.prototype.dashedLine=function(b,c,d,e,f){var h=d-b,g=e-c,i=Math.sqrt(h*h+g*g),j=f*h/i;f=f*g/i;i=j;var k=f,l=true;for(this.moveTo(b,c);Math.abs(h)>Math.abs(i)||Math.abs(g)>Math.abs(k);){l?this.lineTo(b+i,c+k):this.moveTo(b+i,c+k);l=!l;i+=j;k+=f}l?this.lineTo(d,e):this.moveTo(d,e)};CanvasRenderingContext2D.prototype.clearRects=[];CanvasRenderingContext2D.prototype.addClearRectangle=function(b){this.clearRects.push(b)};
CanvasRenderingContext2D.prototype.clearRectangles=function(){var b;for(b=0;b<this.clearRects.length;b++)this.clearRect(this.clearRects[b].x-1,this.clearRects[b].y-1,this.clearRects[b].width+2,this.clearRects[b].height+2);this.clearRects=[]};CanvasRenderingContext2D.prototype.clearShadow=function(){this.shadowColor="rgba(0, 0, 0, 0)"};Array.prototype.shuffle=function(){var b=this.length;if(b<2)return false;do{var c=Math.floor(Math.random()*b),d=this[c];this[c]=this[--b];this[b]=d}while(b);return true};
Date.prototype.getMonthName=function(){return["January","February","March","April","May","June","July","August","September","October","November","December"][this.getMonth()]};Date.prototype.getFormatHours=function(){if(this.getHours()===12)return 12;return this.fullString(this.getHours()%12)};Date.prototype.getFormatMinutes=function(){return this.fullString(this.getMinutes())};Date.prototype.fullString=function(b){b=b.toString();if(b.length===1)return"0"+b;return b};
Date.prototype.getDayTime=function(){if(this.getHours()>11)return"PM";return"AM"};function getAbsolutePosition(b){var c={x:b.offsetLeft,y:b.offsetTop};if(b.offsetParent){b=getAbsolutePosition(b.offsetParent);c.x+=b.x;c.y+=b.y}return c}
function getRelativeCoordinates(b,c){var d,e,f,h;b=b||window.event;var g=b.target||b.srcElement;if(!window.opera&&typeof b.offsetX!=="undefined"){h={x:b.offsetX,y:b.offsetY};for(f=g;f;){f.mouseX=h.x;f.mouseY=h.y;h.x+=f.offsetLeft;h.y+=f.offsetTop;f=f.offsetParent}f=c;for(h={x:0,y:0};f;){if(typeof f.mouseX!=="undefined"){d=f.mouseX-h.x;e=f.mouseY-h.y;break}h.x+=f.offsetLeft;h.y+=f.offsetTop;f=f.offsetParent}for(f=g;f;){f.mouseX=undefined;f.mouseY=undefined;f=f.offsetParent}}else{h=getAbsolutePosition(c);
d=b.pageX-h.x;e=b.pageY-h.y}return{x:d,y:e}}function testShadowOffsetTransform(){var b=document.createElement("canvas");b.width=b.height=8;b=b.getContext("2d");b.shadowColor="rgba(255, 255, 255, 1.0)";b.shadowOffsetX=4;b.translate(1.5,1.5);b.rotate(Math.PI/2);b.fillStyle="#000000";b.fillRect(-2,-2,4,4);return b.getImageData(1,5,1,1).data[0]===255}
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,25)}}();var Pattern={};Pattern.image={};Pattern.onload=null;Pattern.loaded=0;Pattern.total=0;Pattern.onLoaded=function(){Pattern.loaded++;Pattern.loaded===Pattern.total&&Pattern.onload&&Pattern.onload()};
Pattern.loadPattern=function(b){var c,d=function(){if(Pattern.context.createPattern){Pattern[this.name]=Pattern.context.createPattern(this,"repeat");Pattern.onLoaded()}};Pattern.total=b.length;for(c=0;c<b.length;c++){var e=new Image;e.src=b[c].path;e.name=b[c].name;Pattern.image[b[c].name]=e;e.onload=d}};Event=Class.create({initialize:function(b){this.type=b;this.mouseY=this.mouseX=this.parameter=null}});
EventEngine=Class.create({initialize:function(){this.listeners=[];this.state={type:"unknown"};this.clickTimeout=this.latestEvent=null;this.clickTime=250;var b=this;document.body.onmousedown=function(c){b.onMouseDown.call(b,c)};document.body.onmouseup=function(c){b.onMouseUp.call(b,c)};document.body.onmousemove=function(c){b.onMouseMove.call(b,c)}},addListener:function(b,c,d){this.listeners.push({type:b,closure:c,thisArgument:d})},removeListener:function(b,c){var d;for(d=0;d<this.listeners.length;d++)this.listeners[d].type===
b&&this.listeners[d].closure===c&&this.listeners.splice(d,1)},dispatchEvent:function(b){var c;this.latestEvent=b;for(c=0;c<this.listeners.length;c++)this.listeners[c].type===b.type&&this.listeners[c].closure.call(this.listeners[c].thisArgument,b)},onMouseDown:function(b){var c=getRelativeCoordinates(b,$("editor")),d=new Event("mouseDown");d.parameter=b;d.mouseX=c.x;d.mouseY=c.y;this.dispatchEvent(d);this.state={type:"down",x:c.x,y:c.y};var e=this;this.clickTimeoutID=setTimeout(function(f,h){e.onClickTimeout(f,
h)},this.clickTime,c,b)},onMouseUp:function(b){if(this.clickTimeoutID){clearTimeout(this.clickTimeoutID);this.clickTimeoutID=null}var c;if(this.state.type==="drag")c="stopDrag";else if(this.state.type==="down")c="click";var d=getRelativeCoordinates(b,$("editor"));c=new Event(c);c.parameter=b;c.mouseX=d.x;c.mouseY=d.y;this.state.type="up";this.dispatchEvent(c)},onMouseMove:function(b){var c=getRelativeCoordinates(b,$("editor")),d=new Event("mouseMove");d.parameter=b;d.mouseX=c.x;d.mouseY=c.y;this.dispatchEvent(d);
if(this.state.type!=="up"){d.type="drag";this.dispatchEvent(d)}this.state.type==="down"&&function(e,f,h,g){e=h-e;f=g-f;return Math.sqrt(e*e+f*f)}(this.state.x,this.state.y,c.x,c.y)>5&&this.onClickTimeout({x:this.state.x,y:this.state.y})},onClickTimeout:function(b,c){if(this.state.type==="down"){this.clickTimeoutID=null;this.state.type="drag";var d=new Event("startDrag");d.parameter=c;d.mouseX=b.x;d.mouseY=b.y;this.dispatchEvent(d)}}});
var DisplayObject=Class.create({initialize:function(){this.parent=this.height=this.width=this.y=this.x=null},hitTest:function(b,c){return b<this.x||c<this.y||b>this.x+this.width||c>this.y+this.height?false:true},parentToLocal:function(b){return{x:b.x-this.x,y:b.y-this.y}}}),Brick=Class.create(DisplayObject,{initialize:function($super){$super();this.targetRotation=this.rotation=this.y=this.x=0;this.rotateID=null;this.isRemoveable=this.isDraggable=this.isVisible=true;this.isPreview=false;this.isInFront=
true;this.isDynamic=false;this.hasShadow=true;this.cell={row:0,col:0}},update:function(){},draw:function(b){if(this.isVisible){this.rotation!==0&&this.applyRotation(b);b.drawShadows&&this.hasShadow&&!this.isPreview&&this.applyShadow(b);if(this.isPreview)b.globalAlpha=0.3;this.drawShape(b);this.isPreview&&this.applyStyle(b);this.rotateID&&this.applyClearing(b);b.beginPath()}},reset:function(){},drawShape:function(b){b.fillRect(0,0,Brick.SIZE,Brick.SIZE);b.clearShadow();b.strokeRect(0,0,Brick.SIZE,
Brick.SIZE)},applyStyle:function(b){b.fillStyle=Brick.FILL;b.strokeStyle=Brick.STROKE;b.lineJoing="miter";b.lineWidth=1},applyShadow:function(b){var c=new b2Vec2(Math.cos(Math.PI/4)*-Brick.SIZE/4,Math.sin(Math.PI/4)*Brick.SIZE/4);if(shadowOffsetGetsTransformed)c=this.rotateVector(c,-this.rotation);b.shadowOffsetX=c.x;b.shadowOffsetY=c.y;b.shadowBlur=5;b.shadowColor="rgba(0, 0, 0, 0.5)"},applyScale:function(b){b.translate(Brick.SIZE/2,Brick.SIZE/2);b.scale(1.1,1.1);b.translate(-Brick.SIZE/2,-Brick.SIZE/
2)},applyRotation:function(b){b.translate(Brick.SIZE/2,Brick.SIZE/2);b.rotate(this.rotation);b.translate(-Brick.SIZE/2,-Brick.SIZE/2)},applyClearing:function(b){var c=new Rectangle(this.x-Brick.SIZE*0.4,this.y-Brick.SIZE*0.2,Brick.SIZE*1.6,Brick.SIZE*1.6);b.addClearRectangle(c)},drawGlobal:function(b){var c=Brick.SIZE;Brick.SIZE=Brick.BIG_SIZE;b.save();b.translate(this.x,this.y);this.applyStyle(b);this.draw(b);b.restore();this.applyClearing(b);Brick.SIZE=c},createBody:function(b){var c=new b2BodyDef;
c.position.Set(this.cell.col+0.5,this.cell.row+0.5);this.body=b.CreateBody(c);this.createShapes(this.body);this.body.SetMassFromShapes();this.setRotation(this.rotation)},createShapes:function(b){var c=new b2PolygonDef;c.SetAsBox(0.5,0.5);c.restitution=0;c.friction=0.9;b.CreateShape(c)},removeBody:function(b){b.DestroyBody(this.body)},moveToCell:function(b){this.cell=b;this.body&&this.body.SetXForm(new b2Vec2(b.col+0.5,b.row+0.5),this.body.GetAngle())},rotate:function(b){if(this.rotateID){clearTimeout(this.rotateID);
this.targetRotation+=b}else{this.storedDynamic=this.isDynamic;this.isDynamic=true;this.parent.renderNew=true;this.targetRotation=this.rotation+b}var c=this;this.rotateID=setTimeout(function(){c.rotateTimeout()},30)},rotateTimeout:function(){this.rotation+=(this.targetRotation-this.rotation)/3;if(Math.abs(this.rotation-this.targetRotation)<0.03)this.rotateStop();else{var b=this;this.rotateID=setTimeout(function(){b.rotateTimeout()},30)}},rotateStop:function(){this.setRotation(this.targetRotation);
this.isDynamic=this.storedDynamic;this.parent.renderNew=true;this.rotateID=null},setRotation:function(b){if(this.body){this.body.SetXForm(this.body.GetPosition(),b);this.rotation=this.body.GetAngle()}else this.rotation=b},rotateVector:function(b,c){return new b2Vec2(b.x*Math.cos(c)-b.y*Math.sin(c),b.x*Math.sin(c)+b.y*Math.cos(c))}});Brick.SIZE=28;Brick.BIG_SIZE=32;Brick.TINY_SIZE=12;Brick.FILL="#1E1E1E";Brick.STROKE="#F2E049";Brick.prototype.type="Brick";
var Kicker=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(1,0);b.bezierCurveTo(1,Brick.SIZE/2,Brick.SIZE/2,Brick.SIZE-1,Brick.SIZE,Brick.SIZE-1);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=[],d;for(d=0;d<6;d++){c[d]=new b2PolygonDef;c[d].vertexCount=4;c[d].restitution=0;c[d].friction=0.9}var e=Math.PI/2/6,f={x:-Math.cos(e),y:Math.sin(e)},h={x:-1,y:Math.tan(e)};
c[0].vertexCount=3;c[0].vertices[0].Set(-0.5,-0.5);c[0].vertices[1].Set(f.x+0.5,f.y-0.5);c[0].vertices[2].Set(h.x+0.5,h.y-0.5);for(d=1;d<5;d++){var g={x:-Math.cos((d+1)*e),y:Math.sin((d+1)*e)},i;i=d>=3?{x:-Math.tan((6-d-1)*e),y:1}:{x:-1,y:Math.tan((d+1)*e)};c[d].vertices[0].Set(f.x+0.5,f.y-0.5);c[d].vertices[1].Set(g.x+0.5,g.y-0.5);c[d].vertices[2].Set(i.x+0.5,i.y-0.5);c[d].vertices[3].Set(h.x+0.5,h.y-0.5);f=g;h=i}c[5].vertexCount=3;c[5].vertices[0].Set(0.5,0.5);c[5].vertices[1].Set(h.x+0.5,h.y-0.5);
c[5].vertices[2].Set(f.x+0.5,f.y-0.5);for(d=0;d<6;d++)b.CreateShape(c[d])}});Kicker.prototype.type="Kicker";var Ramp=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,-0.5);c.vertices[1].Set(0.5,0.5);c.vertices[2].Set(-0.5,0.5);b.CreateShape(c)}});
Ramp.prototype.type="Ramp";
var Curve=new Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.bezierCurveTo(Brick.SIZE/2,0,Brick.SIZE,Brick.SIZE/2,Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef,d=Math.PI/2/6,e,f;c.vertexCount=8;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,0.5);e=6;for(f=0;e>=0;e--,f++)c.vertices[f].Set(Math.cos(d*e)-0.5,-Math.sin(d*e)+0.5);c.vertices[7].Set(-0.5,0.5);b.CreateShape(c)}});
Curve.prototype.type="Curve";
var Line=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(Brick.SIZE,0);b.lineTo(Brick.SIZE,Brick.SIZE/7);b.lineTo(0,Brick.SIZE/7);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=8;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,-0.499);c.vertices[1].Set(-0.49,-0.5);c.vertices[2].Set(0.49,-0.5);c.vertices[3].Set(0.5,-0.499);c.vertices[4].Set(0.5,-0.376);c.vertices[5].Set(0.49,-0.375);
c.vertices[6].Set(-0.49,-0.375);c.vertices[7].Set(-0.5,-0.376);b.CreateShape(c)}});Line.prototype.type="Line";
var Exit=Class.create(Brick,{initialize:function($super){$super();this.hasShadow=this.isInFront=this.isRemoveable=this.isDraggable=false},drawShape:function(b){var c=Brick.SIZE/5,d=0,e,f;for(e=0;e<5;e++)for(f=0;f<5;f++){d%2===0&&b.fillRect(c*f,c*e,c,c);d++}},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=4;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0.3,0.3);c.vertices[1].Set(-0.3,0.3);c.vertices[2].Set(-0.3,-0.3);c.vertices[3].Set(0.3,-0.3);c.isSensor=true;b.CreateShape(c);var d=
this;b.onCollision=function(e){d.onCollision(e)}},onCollision:function(b){if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance){this.parent.parent.onBallExit();if(this.parent.trackLength&&this.parent.bricks.length>2){this.parent.validTrack=true;$("publishButton").addClassName("activePublish");$("publishButtonWarning").style.visibility="hidden"}}},rotate:function(){}});Exit.prototype.type="Exit";
var Spring=new Class.create(Brick,{drawShape:function(b){b.strokeStyle=b.fillStyle;b.lineWidth=2;b.beginPath();b.moveTo(Brick.SIZE/5,Brick.SIZE*0.22);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.07);b.moveTo(Brick.SIZE/5,Brick.SIZE*0.37);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.22);b.moveTo(Brick.SIZE/5,Brick.SIZE*0.52);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.37);b.stroke();b.fillRect(0,0,Brick.SIZE,Brick.SIZE/8);b.fillRect(0,Brick.SIZE/2,Brick.SIZE,Brick.SIZE/2);b.clearShadow();this.applyStyle(b);b.strokeRect(0,
0,Brick.SIZE,Brick.SIZE)},createBody:function($super,c){$super(c);var d=this;this.body.onCollision=function(e){d.onCollision(e)}},onCollision:function(b){var c;if(b.shape1.GetBody().ballInstance)c=b.shape1.GetBody().ballInstance;else if(b.shape2.GetBody().ballInstance)c=b.shape2.GetBody().ballInstance;else return;var d=this.body.GetPosition();b=this.rotateVector(new b2Vec2(b.position.x-d.x,b.position.y-d.y),-this.body.GetAngle());if(b.x>-0.5&&b.x<0.5&&b.y>-0.6&&b.y<-0.4){b=new b2Vec2(0,-6);c.impulseVector.Add(this.rotateVector(b,
this.body.GetAngle()))}}});Spring.prototype.type="Spring";
var Boost=new Class.create(Brick,{initialize:function($super){$super();this.hasShadow=this.isInFront=false},drawShape:function(b){b.beginPath();b.moveTo(Brick.SIZE/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*2/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*4/7,Brick.SIZE/2);b.lineTo(Brick.SIZE*2/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*3/7,Brick.SIZE/2);b.closePath();b.fill();b.beginPath();b.moveTo(Brick.SIZE*3/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*4/7,Brick.SIZE*3/14);
b.lineTo(Brick.SIZE*6/7,Brick.SIZE/2);b.lineTo(Brick.SIZE*4/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*3/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*5/7,Brick.SIZE/2);b.closePath();b.fill()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=4;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.4,-0.4);c.vertices[1].Set(0.4,-0.4);c.vertices[2].Set(0.4,0.4);c.vertices[3].Set(-0.4,0.4);c.isSensor=true;c.filter.maskBits=2;b.CreateShape(c);var d=this;b.whileCollision=function(e){d.whileCollision(e)}},
whileCollision:function(b){b=b.shape1.GetBody().ballInstance?b.shape1.GetBody().ballInstance:b.shape2.GetBody().ballInstance;var c=new b2Vec2(0.3,0);b.impulseVector.Add(this.rotateVector(c,this.body.GetAngle()))}});Boost.prototype.type="Boost";
var Ball=Class.create(Brick,{initialize:function($super){$super();this.impulseVector=new b2Vec2;this.positionVector=new b2Vec2;this.velocityVector=new b2Vec2;this.rollLength=0;this.lastPosition=new b2Vec2;this.isRemoveable=this.isDraggable=false;this.isDynamic=true;this.hasShadow=false},update:function(){if(this.impulseVector.Length()>0){this.body.ApplyImpulse(this.impulseVector,this.body.GetPosition());this.impulseVector.Set(0,0)}if(this.positionVector.Length()>0){this.body.SetXForm(this.positionVector,
this.body.GetAngle());this.body.SetLinearVelocity(this.velocityVector);this.lastPosition.Set(this.positionVector.x,this.positionVector.y);this.positionVector.Set(0,0)}this.rollLength+=this.minus(this.lastPosition,this.body.GetPosition()).Length();this.lastPosition.Set(this.body.GetPosition().x,this.body.GetPosition().y);if(this.rollLength>9999)this.rollLength=9999;$("lengthDisplay").update(this.getFormatString(this.rollLength));this.parent.trackLength=this.rollLength/10},minus:function(b,c){return new b2Vec2(b.x-
c.x,b.y-c.y)},getFormatString:function(b){for(b=parseInt(b,10).toString();b.length<4;)b="0"+b;return b.toString()},reset:function(){this.rollLength=0;this.lastPosition.Set(this.cell.col+0.5,this.cell.row+0.5);this.body.SetXForm(this.lastPosition,0);this.body.SetLinearVelocity({x:0,y:0});this.body.SetAngularVelocity(0);this.impulseVector.Set(0,0)},drawShape:function(b){var c;if(this.body){c=this.body.GetPosition();b.addClearRectangle(new Rectangle(this.x+(c.x-this.cell.col-Ball.radius)*Brick.SIZE,
this.y+(c.y-this.cell.row-Ball.radius)*Brick.SIZE,Ball.radius*2*Brick.SIZE,Ball.radius*2*Brick.SIZE))}else c={x:this.cell.col+0.5,y:this.cell.row+0.5};b.save();b.translate((c.x-this.cell.col)*Brick.SIZE,(c.y-this.cell.row)*Brick.SIZE);this.body&&b.rotate(this.body.GetAngle());b.fillStyle="#800000";b.beginPath();b.arc(0,0,Ball.radius*Brick.SIZE,0,Math.PI*2,true);b.lineTo(Ball.radius*Brick.SIZE,0);b.fill();b.restore()},createShapes:function(b){var c=new b2CircleDef;c.radius=Ball.radius;c.restitution=
0;c.density=2;c.friction=0.9;c.filter.categoryBits=2;b.CreateShape(c);b.SetMassFromShapes();b.ballInstance=this},rotate:function(){}});Ball.prototype.type="Ball";Ball.radius=0.25;
var Breaker=new Class.create(Brick,{initialize:function($super){$super();this.bodies=null;this.isBroken=false;this.timeoutID=0;this.isDynamic=false;this.hasShadow=true;this.generateShapes()},reset:function(){this.isBroken=this.isDynamic=false;if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=0}this.bodies&&this.removeBodies(this.world);this.body||this.createBody(this.world)},createBody:function($super,c){this.world=c;$super(c);var d=this;this.body.onCollision=function(e){d.onCollision(e)};
this.body.afterCollision=function(e){d.afterCollision(e)}},createBodies:function(b){this.bodies=[];var c;for(c=0;c<this.shapes.length;c++){var d=new b2BodyDef;d.position.Set(this.cell.col+0.5,this.cell.row+0.5);d=b.CreateBody(d);this.createShape(d,c);d.SetMassFromShapes();this.bodies.push(d)}},removeBody:function($super,c){$super(c);this.bodies&&this.removeBodies(c);this.body=null},removeBodies:function(b){var c=b.m_bodyCount,d;for(d=0;d<this.bodies.length;d++)b.DestroyBody(this.bodies[d]);c===b.m_bodyCount&&
console.error("Bodies were not removed");this.bodies=null},drawShape:function(b){if(!this.isBroken){var c,d,e;b.save();this.bodies&&b.clearShadow();b.translate(-this.cell.col*Brick.SIZE,-this.cell.row*Brick.SIZE);for(c=0;c<this.shapes.length;c++){b.save();e=this.bodies?this.bodies[c].GetPosition():{x:this.cell.col+0.5,y:this.cell.row+0.5};b.translate(e.x*Brick.SIZE,e.y*Brick.SIZE);this.bodies&&b.rotate(this.bodies[c].GetAngle());b.beginPath();b.moveTo(this.shapes[c][0].x*Brick.SIZE,this.shapes[c][0].y*
Brick.SIZE);for(d=1;d<this.shapes[c].length;d++)b.lineTo(this.shapes[c][d].x*Brick.SIZE,this.shapes[c][d].y*Brick.SIZE);b.closePath();b.fill();b.stroke();b.restore();if(this.bodies){d=this.x+(e.x-this.cell.col-0.7)*Brick.SIZE;e=this.y+(e.y-this.cell.row-0.7)*Brick.SIZE;b.addClearRectangle(new Rectangle(d,e,Brick.SIZE*1.4,Brick.SIZE*1.4))}}b.restore()}},createShape:function(b,c){var d=new b2PolygonDef,e;d.vertexCount=this.shapes[c].length;d.restitution=0;d.friction=0.9;for(e=0;e<this.shapes[c].length;e++)d.vertices[e]=
this.shapes[c][e];d.density=2;d.filter.maskBits=1;b.CreateShape(d)},onCollision:function(b){if(this.timeoutID&&(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance)){clearTimeout(this.timeoutID);this.timeoutID=0}},afterCollision:function(b){if(!this.isBroken)if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance){if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=0}var c=this;this.timeoutID=setTimeout(function(){c.onTimeout()},200)}},onTimeout:function(){this.isDynamic=
true;this.parent.renderNew=true;this.removeBody(this.world);this.createBodies(this.world);this.applyImpulse();var b=this;this.timeoutID=setTimeout(function(){b.removeBodies(b.world);b.isBroken=true},500)},applyImpulse:function(){var b,c=new b2Vec2(0,-Math.random());c=this.rotateVector(c,-Math.PI/3);for(b=0;b<this.bodies.length;b++){this.bodies[b].ApplyImpulse(c,this.bodies[b].GetPosition());c=this.rotateVector(c,Math.PI/3)}},generateShapes:function(){this.shapes=[];var b=new b2Vec2(Math.random()/
2-0.25,Math.random()/2-0.25),c=[new b2Vec2(-0.5,Math.random()/2-0.25),new b2Vec2(-0.5,-0.5),new b2Vec2(-Math.random()/2,-0.501),new b2Vec2(Math.random()/2,-0.501),new b2Vec2(0.5,-0.5),new b2Vec2(0.501,Math.random()/2-0.25),new b2Vec2(0.5,0.5),new b2Vec2(Math.random()/2,0.501),new b2Vec2(-Math.random()/2,0.501),new b2Vec2(-0.501,0.5)],d=[3,2,3,3,2,3],e=0,f,h;d.shuffle();for(f=0;f<6;f++){var g=[];g.push(b);for(h=0;h<d[f];h++){g.push(c[e%10]);e++}e--;this.shapes.push(g)}},rotate:function(){}});
Breaker.prototype.type="Breaker";
var Beamer=new Class.create(Brick,{initialize:function($super){$super();this.partner=null;this.hasBeamed=false},reset:function(){this.hasBeamed=false},drawShape:function(b){b.beginPath();b.moveTo(0,Brick.SIZE/2);b.lineTo(Brick.SIZE/5,Brick.SIZE/2);b.bezierCurveTo(Brick.SIZE/5,Brick.SIZE*9/10,Brick.SIZE*4/5,Brick.SIZE*9/10,Brick.SIZE*4/5,Brick.SIZE/2);b.lineTo(Brick.SIZE,Brick.SIZE/2);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=
new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,0);c.vertices[1].Set(0.2,0.5);c.vertices[2].Set(-0.5,0.5);b.CreateShape(c);c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0.5,0);c.vertices[1].Set(0.5,0.5);c.vertices[2].Set(-0.2,0.5);b.CreateShape(c);c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0,0);c.vertices[1].Set(0.2,0.2);c.vertices[2].Set(-0.2,0.2);c.isSensor=true;c.filter.maskBits=
2;b.CreateShape(c);var d=this;b.onCollision=function(e){d.onCollision(e)};b.afterCollision=function(e){d.afterCollision(e)};this.divorce()},removeBody:function($super,c){$super(c);if(this.partner){this.partner.divorce();this.partner=null}else if(this.parent.singles[this.pairType]===this)this.parent.singles[this.pairType]=null},divorce:function(){this.partner=null;this.parent.findPartner(this)},onCollision:function(b){if(b.shape1.m_isSensor)b=b.shape2.GetBody().ballInstance;else if(b.shape2.m_isSensor)b=
b.shape1.GetBody().ballInstance;else return;if(this.partner&&!this.hasBeamed){var c=this.rotateVector(new b2Vec2(0,-0.1),this.partner.rotation);b.positionVector.Set(this.partner.cell.col+0.5+c.x,this.partner.cell.row+0.5+c.y);c.Multiply(10);c.Multiply(b.body.GetLinearVelocity().Length());b.velocityVector=c;this.hasBeamed=this.partner.hasBeamed=true}},afterCollision:function(b){if(this.hasBeamed&&this.partner&&(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance))this.hasBeamed=this.partner.hasBeamed=
false}});Beamer.prototype.type="Beamer";Beamer.prototype.pairType="Beamer";
var OneWay=Class.create(Line,{initialize:function($super){$super();this.isActive=false},reset:function(){this.isActive=false},drawShape:function($super,c){$super(c);c.beginPath();c.moveTo(Brick.SIZE/2,Brick.SIZE*7/20);c.lineTo(Brick.SIZE*7/10,Brick.SIZE*13/20);c.lineTo(Brick.SIZE*3/10,Brick.SIZE*13/20);c.closePath();c.fill()},createShapes:function($super,c){$super(c);var d=new b2PolygonDef;d.vertexCount=4;d.restitution=0;d.friction=0.9;d.vertices[0].Set(-1.5,-0.45);d.vertices[1].Set(1.5,-0.45);d.vertices[2].Set(1.5,
0);d.vertices[3].Set(-1.5,0);d.isSensor=true;d.filter.maskBits=2;c.CreateShape(d);var e=this;c.beforeCollision=function(f,h){return e.beforeCollision(f,h)};c.onCollision=function(f){e.onCollision(f)};c.afterCollision=function(f){e.afterCollision(f)}},removeBody:function($super,c){$super(c)},beforeCollision:function(b,c){if(b.GetBody().ballInstance&&this.isActive)return false;else if(c.GetBody().ballInstance&&this.isActive)return false;return true},onCollision:function(b){if(b.shape1.GetBody().ballInstance&&
b.shape2.m_isSensor)this.isActive=true;else if(b.shape2.GetBody().ballInstance&&b.shape1.m_isSensor)this.isActive=true},afterCollision:function(b){if(b.shape1.GetBody().ballInstance&&b.shape2.m_isSensor)this.isActive=false;else if(b.shape2.GetBody().ballInstance&&b.shape1.m_isSensor)this.isActive=false}});OneWay.prototype.type="OneWay";
var Graviton=new Class.create(Brick,{initialize:function($super){$super();this.isActive=false;this.timeoutID=0;this.isDynamic=false;this.hasShadow=true},reset:function(){this.isActive=false;if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=0}},createBody:function($super,c){$super(c);var d=this;this.body.onCollision=function(e){d.onCollision(e)}},drawShape:function($super,c){$super(c);c.beginPath();c.moveTo(Brick.SIZE/2,Brick.SIZE/7);c.lineTo(Brick.SIZE*6/7,Brick.SIZE/2);c.lineTo(Brick.SIZE*
5/7,Brick.SIZE/2);c.lineTo(Brick.SIZE*5/7,Brick.SIZE*6/7);c.lineTo(Brick.SIZE*2/7,Brick.SIZE*6/7);c.lineTo(Brick.SIZE*2/7,Brick.SIZE/2);c.lineTo(Brick.SIZE/7,Brick.SIZE/2);c.closePath();if(this.isActive){c.save();c.fillStyle=c.strokeStyle;c.fill();c.restore()}else c.stroke()},onCollision:function(b){if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance){this.parent.setActiveGraviton(this);this.isActive=true;this.parent.renderNew=true;var c=this;this.timeoutID=setTimeout(function(){var d=
new b2Vec2(0,-9.81);c.body.GetWorld().SetGravity(c.rotateVector(d,c.body.GetAngle()));c.timeoutID=0},50)}}});Graviton.prototype.type="Graviton";
Grid=Class.create(DisplayObject,{initialize:function($super){$super();this.cols=this.rows=0;this.bricks=[];this.renderDynamics=this.renderStatics=this.renderNew=false},draw:function(b){this.drawStatics(b);this.drawDynamics(b)},drawStatics:function(b){this.setClipping(b);b.translate(this.x,this.y);this.drawStaticElements(b);this.drawFrame(b);this.releaseClipping(b)},drawDynamics:function(b){this.setClipping(b);b.translate(this.x,this.y);this.renderDynamics=true;b.drawShadows=true;this.drawElements(b,
true);this.renderDynamics=false;this.releaseClipping(b)},setClipping:function(b){b.save();b.translate(0.5,0.5);b.beginPath();b.moveTo(this.x-2,this.y-2);b.lineTo(this.x+this.width,this.y-2);b.lineTo(this.x+this.width,this.y+this.height);b.lineTo(this.x-2,this.y+this.height);b.closePath();b.translate(-0.5,-0.5);b.clip()},releaseClipping:function(b){b.restore();this.renderNew=false},drawFrame:function(b){b.save();b.translate(-0.5,-0.5);b.strokeStyle="#2D2D2D";b.lineWidth=2;b.strokeRect(0,0,this.width,
this.height);b.restore()},drawGrid:function(b){b.strokeStyle="#000000";b.lineWidth=0.5;var c;for(c=1;c<this.rows;c++){b.beginPath();b.dashedLine(0,c*Brick.SIZE,this.cols*Brick.SIZE,c*Brick.SIZE,3);b.closePath();b.stroke()}for(c=1;c<this.cols;c++){b.beginPath();b.dashedLine(c*Brick.SIZE,0,c*Brick.SIZE,this.rows*Brick.SIZE,3);b.closePath();b.stroke()}b.beginPath()},drawFieldShadow:function(b){b.save();b.beginPath();b.moveTo(-10,0);b.lineTo(this.width,0);b.lineTo(this.width,this.height);b.lineTo(this.width+
10,this.height);b.lineTo(this.width+10,-10);b.lineTo(-10,-10);b.closePath();b.shadowOffsetX=-6;b.shadowOffsetY=6;b.shadowBlur=5;b.shadowColor="rgba(0, 0, 0, 0.4)";b.fill();b.restore()},drawStaticElements:function(b){this.drawGrid(b);this.drawFieldShadow(b);this.renderStatics=true;b.drawShadows=true;this.drawElements(b);b.drawShadows=false;this.drawElements(b);this.renderStatics=false},drawElements:function(b){if(this.bricks.length!==0){this.bricks[0].applyStyle(b);var c;for(c=0;c<this.bricks.length;c++)if(this.bricks[c].isDynamic&&
this.renderDynamics||!this.bricks[c].isDynamic&&this.renderStatics){b.save();b.translate(this.bricks[c].cell.col*Brick.SIZE,this.bricks[c].cell.row*Brick.SIZE);this.bricks[c].draw(b);b.restore()}}},getCell:function(b,c){if(b>0&&c>0&&b<this.width&&c<this.height)return{row:parseInt(c/Brick.SIZE,10),col:parseInt(b/Brick.SIZE,10)};return null},checkCell:function(b){return b&&b.row>=0&&b.row<this.rows&&b.col>=0&&b.col<this.cols},getCellBox:function(b){if(!this.checkCell(b))return null;return new Rectangle(this.x+
b.col*Brick.SIZE,this.y+b.row*Brick.SIZE,Brick.SIZE,Brick.SIZE)},getBrickAt:function(b){var c;if(this.checkCell(b))for(c=0;c<this.bricks.length;c++)if(this.bricks[c].cell.row===b.row&&this.bricks[c].cell.col===b.col)return this.bricks[c];return null},removeBrickAt:function(b){if(!this.checkCell(b))return false;var c;for(c=0;c<this.bricks.length;c++)if(this.bricks[c].cell.row===b.row&&this.bricks[c].cell.col===b.col){this.bricks.splice(c,1);this.renderNew=true;break}return true},dropBrickAt:function(b,
c){if(!this.checkCell(c))return false;b.cell=c;return this.insertBrick(b)},insertBrick:function(b){b.parent=this;if(!this.removeBrickAt(b.cell))return false;b.x=this.x+b.cell.col*Brick.SIZE;b.y=this.y+b.cell.row*Brick.SIZE;b.width=b.height=Brick.SIZE;b.isInFront?this.bricks.push(b):this.bricks.unshift(b);return this.renderNew=true}});
var Toolbox=Class.create(Grid,{initialize:function($super){$super();this.rows=15;this.cols=3;this.width=Brick.SIZE*this.cols;this.height=Brick.SIZE*this.rows;this.brickCounter=0},addBrick:function(b){var c=new b;c.cell={row:this.brickCounter*2+1,col:1};c.parent=this;this.dropBrickAt(c,c.cell);this.brickCounter++;if(c.pairType){b=new b;b.parent=this;b.setRotation(Math.PI);b.cell=c.cell;this.bricks.push(b);c.partner=b}return c},addPreviewBrick:function(b){b=this.addBrick(b);b.isDraggable=false;b.isPreview=
true;if(b.partner){b.partner.isDraggable=false;b.partner.isPreview=true}},onClick:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e&&e.isDraggable&&this.parent.selectElement&&this.parent.selectElement.brick===e){e.rotate(Math.PI/2);this.renderNew=true;e.partner&&e.partner.rotate(Math.PI/2)}this.select(d)},onStartDrag:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e&&e.isDraggable){var f=new (eval(e.type));f.rotation=e.rotation;this.parent.dragBrick(f)}this.select(d)},
select:function(b){var c=this.getBrickAt(b),d=null;d=this.getCellBox(b);if(c&&c.isDraggable)d.brick=c;this.parent.selectElement=d}});
Field=Class.create(Grid,{initialize:function($super){$super();this.rows=15;this.cols=10;this.width=Brick.SIZE*this.cols;this.height=Brick.SIZE*this.rows;this.bricks=[];this.singles={};this.debugMode=false;this.trackLength=0},setup:function(){$("lengthDisplay").update("0000");this.trackLength=0;this.initializeBox2D();this.clearTrack(true)},draw:function($super,c){this.debugMode?this.drawBodies(c):$super(c)},drawStatics:function($super,c){if(this.parent.tweenTimeoutID){this.setClipping(c);c.translate(this.x,
this.y);c.save();c.translate(10,0);this.drawFieldShadow(c);c.restore();c.save();c.translate(0,this.parent.fieldOffset);this.drawStaticElements(c);c.restore();this.parent.drawTweenMode(c);this.drawFrame(c);this.releaseClipping(c)}else $super(c)},drawBodies:function(b){b.strokeStyle="#FF0000";b.lineWidth=1;b.save();b.translate(this.x,this.y);var c;for(c=this.world.GetBodyList();c!==null;c=c.GetNext())this.drawBody(b,c);b.restore();b.addClearRectangle(new Rectangle(this.x-Brick.SIZE,this.y-Brick.SIZE,
(this.cols+2)*Brick.SIZE,(this.rows+2)*Brick.SIZE))},drawBody:function(b,c){b.save();var d=c.GetPosition(),e;b.translate(Brick.SIZE*d.x,Brick.SIZE*d.y);b.rotate(c.GetAngle());b.beginPath();b.moveTo(0,0);b.lineTo(0,-Brick.SIZE/2);for(d=c.GetShapeList();d!==null;d=d.GetNext())if(d.m_vertices&&d.m_vertices[0]){b.moveTo(d.m_vertices[0].x*Brick.SIZE,d.m_vertices[0].y*Brick.SIZE);for(e=1;e<d.m_vertexCount;e++)b.lineTo(d.m_vertices[e].x*Brick.SIZE,d.m_vertices[e].y*Brick.SIZE);b.lineTo(d.m_vertices[0].x*
Brick.SIZE,d.m_vertices[0].y*Brick.SIZE)}else{b.moveTo(Ball.radius*Brick.SIZE,0);b.arc(0,0,Ball.radius*Brick.SIZE,0,Math.PI*2,true)}b.stroke();b.restore()},initializeBox2D:function(){var b=new b2AABB,c=new b2Vec2(0,9.81);b.lowerBound.Set(-10,-10);b.upperBound.Set(20,25);this.world=new b2World(b,c,true);this.createBorders();this.initContactListener();this.initContactFilter();this.intervalLength=1/120},startBox2D:function(){this.resetTrack();var b=this;this.world.SetGravity(new b2Vec2(0,9.81));this.intervalID=
setInterval(function(){b.calculateBox2D()},this.intervalLength*1E3);$("lengthDisplay").update("0000");this.trackLength=0},stopBox2D:function(){this.intervalID&&clearInterval(this.intervalID);this.intervalID=null},calculateBox2D:function(){var b;for(b=0;b<this.bricks.length;b++)this.bricks[b].update();this.world.Step(0.02,20)},createBorders:function(){var b=new b2BodyDef,c;b.position.Set(0,0);b=this.world.CreateBody(b);var d=function(f,h){var g=new b2PolygonDef;g.vertexCount=4;g.restitution=0;g.friction=
0.9;g.vertices[0].Set(f.x,f.y);g.vertices[1].Set(h.x,f.y);g.vertices[2].Set(h.x,h.y);g.vertices[3].Set(f.x,h.y);return g},e=[{A:new b2Vec2(0,-1),B:new b2Vec2(this.cols,0)},{A:new b2Vec2(this.cols,0),B:new b2Vec2(this.cols+1,this.rows)},{A:new b2Vec2(0,this.rows),B:new b2Vec2(this.cols,this.rows+1)},{A:new b2Vec2(-1,0),B:new b2Vec2(0,this.rows)}];for(c=0;c<4;c++)b.CreateShape(d(e[c].A,e[c].B));b.SetMassFromShapes()},initContactListener:function(){var b=new b2ContactListener;b.Add=function(c){if(c.shape1.GetBody().onCollision)c.shape1.GetBody().onCollision(c);
else c.shape2.GetBody().onCollision&&c.shape2.GetBody().onCollision(c)};b.Persist=function(c){if(c.shape1.GetBody().whileCollision)c.shape1.GetBody().whileCollision(c);else c.shape2.GetBody().whileCollision&&c.shape2.GetBody().whileCollision(c)};b.Remove=function(c){if(c.shape1.GetBody().afterCollision)c.shape1.GetBody().afterCollision(c);else c.shape2.GetBody().afterCollision&&c.shape2.GetBody().afterCollision(c)};this.world.SetContactListener(b)},initContactFilter:function(){var b=new b2ContactFilter;
b.ShouldCollide=function(c,d){if(c.GetBody().beforeCollision)return c.GetBody().beforeCollision(c,d);else if(d.GetBody().beforeCollision)return d.GetBody().beforeCollision(c,d);var e=c.GetFilterData(),f=d.GetFilterData();if(e.groupIndex===f.groupIndex&&e.groupIndex!==0)return e.groupIndex>0;return(e.maskBits&f.categoryBits)!==0&&(e.categoryBits&f.maskBits)!==0};this.world.SetContactFilter(b)},findPartner:function(b){if(this.singles[b.pairType]){if(this.singles[b.pairType]!==b){b.partner=this.singles[b.pairType];
this.singles[b.pairType].partner=b;this.singles[b.pairType]=null}}else this.singles[b.type]=b},setActiveGraviton:function(b){if(this.activeGraviton)this.activeGraviton.isActive=false;this.activeGraviton=b},dropBrickAt:function($super,c,d){if($super(c,d)){c.createBody(this.world);this.validTrack=false;$("publishButton").removeClassName("activePublish")}},removeBrickAt:function($super,c){var d=this.getBrickAt(c);if(d)if($super(c)){d.removeBody(this.world);this.validTrack=false;$("publishButton").removeClassName("activePublish");
return true}else return false;return true},onClick:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e){e.rotate(Math.PI/2);this.validTrack=false;$("publishButton").removeClassName("activePublish")}else if(d&&this.parent.selectElement&&this.parent.selectElement.brick){e=new (eval(this.parent.selectElement.brick.type));e.setRotation(this.parent.selectElement.brick.rotation);this.dropBrickAt(e,d)}this.renderNew=true},onStartDrag:function(b,c){var d=this.getBrickAt(this.getCell(b,c));if(d){if(d.isDraggable){d.isVisible=
false;this.renderNew=true;var e=new (eval(d.type));e.setRotation(d.rotation);e.origin=d;this.parent.dragBrick(e);this.validTrack=false;$("publishButton").removeClassName("activePublish")}}else{this.onDrag(b,c);this.parent.startDragBricking()}},onDrag:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(d&&this.parent.selectElement){if(this.parent.selectElement.brick){if(e&&(!e.isRemoveable||e.type===this.parent.selectElement.brick.type&&e.rotation===this.parent.selectElement.brick.rotation))return;
e=new (eval(this.parent.selectElement.brick.type));e.setRotation(this.parent.selectElement.brick.rotation);this.dropBrickAt(e,d)}else e&&e.isRemoveable&&this.removeBrickAt(d);this.renderNew=true}},onStopDrag:function(b,c){var d=this.getCell(c.x-this.x+Brick.SIZE/2,c.y-this.y+Brick.SIZE/2);if(d){var e=this.getBrickAt(d);this.intervalID&&this.resetTrack();if(e&&!e.isRemoveable){if(c.origin)this.renderNew=c.origin.isVisible=true}else{e&&c.origin!==e&&this.removeBrickAt(d);if(c.origin){c.origin.x=this.x+
d.col*Brick.SIZE;c.origin.y=this.y+d.row*Brick.SIZE;c.origin.moveToCell(d);this.renderNew=c.origin.isVisible=true}else this.dropBrickAt(c,d)}}else if(c.origin)if(c.isRemoveable)this.removeBrickAt(c.origin.cell);else this.renderNew=c.origin.isVisible=true;this.validTrack=false;$("publishButton").removeClassName("activePublish")},resetTrack:function(){this.stopBox2D();this.renderNew=true;var b;for(b=0;b<this.bricks.length;b++)this.bricks[b].reset()},setTrack:function(b){var c;this.clearTrack();for(c in b.bricks)if(b.bricks.hasOwnProperty(c)){var d=
b.bricks[c],e=new (eval(d.type));e.setRotation(d.rotation*Math.PI/2);this.dropBrickAt(e,{row:d.row,col:d.col})}if(b.pairs)for(c=0;c<b.pairs.length;c++){d=this.getBrickAt(b.pairs[c].girl);e=this.getBrickAt(b.pairs[c].boy);if(d&&e&&d.pairType===e.type){d.partner=e;e.partner=d}}return true},getTrack:function(){this.resetTrack();var b={bricks:{},pairs:[]},c,d,e=function(g){for(var i=0;g-0.5>0;){g-=Math.PI/2;i++}return i%4};for(c=0;c<this.bricks.length;c++){var f=this.bricks[c];b.bricks[f.cell.row*this.cols+
f.cell.col]={type:f.type,rotation:e(f.rotation),row:f.cell.row,col:f.cell.col};if(f.pairType&&f.partner){var h=false;for(d=0;d<b.pairs.length;d++)if(b.pairs[d].girl===f||b.pairs[d].boy===f){h=true;break}h||b.pairs.push({girl:{row:f.cell.row,col:f.cell.col},boy:{row:f.partner.cell.row,col:f.partner.cell.col}})}}return b},clearTrack:function(b){this.resetTrack();var c;for(c=0;c<this.bricks.length;c++)this.bricks[c].removeBody(this.world);this.bricks=[];this.singles={};if(b){this.dropBrickAt(new Ball,
{row:0,col:0});this.dropBrickAt(new Exit,{row:this.rows-1,col:0})}},getTrackImage:function(b){this.resetTrack();var c=b.getContext("2d"),d=Brick.SIZE,e;Brick.SIZE=Brick.TINY_SIZE;b.width=Brick.SIZE*this.cols+2;b.height=Brick.SIZE*this.rows+2;c.save();c.translate(0.5,0.5);c.lineWidth=0.5;c.beginPath();for(e=1;e<this.rows;e++)c.dashedLine(0,Brick.SIZE*e,Brick.SIZE*this.cols,Brick.SIZE*e,2);for(e=1;e<this.cols;e++)c.dashedLine(Brick.SIZE*e,0,Brick.SIZE*e,Brick.SIZE*this.rows,2);c.stroke();c.beginPath();
if(this.bricks.length){this.bricks[0].applyStyle(c);c.lineWidth=0.5;for(e=0;e<this.bricks.length;e++){c.save();c.translate(this.bricks[e].cell.col*Brick.SIZE,this.bricks[e].cell.row*Brick.SIZE);this.bricks[e].draw(c);c.restore()}}c.strokeStyle="#000000";c.lineWidth=1;c.strokeRect(0,0,Brick.SIZE*this.cols,Brick.SIZE*this.rows);c.restore();Brick.SIZE=d;return b.toDataURL("image/png")}});
var Renderer=Class.create(DisplayObject,{initialize:function($super,c,d,e){$super();this.staticCanvas=c;this.dynamicCanvas=d;this.bufferCanvas=e;this.staticContext=this.staticCanvas.getContext("2d");this.dynamicContext=this.dynamicCanvas.getContext("2d");this.bufferContext=this.bufferCanvas.getContext("2d");this.initField();this.timeoutID=null;this.isAnimated=false},initField:function(){this.field=new Field;this.field.parent=this;this.field.x=64;this.field.y=Brick.SIZE;this.field.setup()},initializeHTMLInterface:function(){},
debug:function(){this.field.debugMode=!this.field.debugMode},startRender:function(){if(!this.isAnimated){this.isAnimated=true;this.animate()}},stopRender:function(){this.isAnimated=false},quit:function(){this.stopRender();this.field.stopBox2D();if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=null}},init:function(){this.startRender()},onBallExit:function(){this.field.stopBox2D()},clearCanvas:function(b){var c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);c.beginPath()},animate:function(){if(this.isAnimated){var b=
this;requestAnimFrame(function(){b.animate()})}this.draw()},draw:function(){this.drawStatics();this.drawDynamics();this.dynamicContext.drawImage(this.bufferCanvas,0,0)},drawStatics:function(){if(this.field.renderNew){this.clearCanvas(this.staticCanvas);this.staticContext.save();this.staticContext.translate(0.5,0.5);this.field.drawStatics(this.staticContext);this.staticContext.restore()}},drawDynamics:function(){this.dynamicContext.save();this.dynamicContext.clearRectangles();this.dynamicContext.translate(0.5,
0.5);this.field.drawDynamics(this.dynamicContext);this.field.debugMode&&this.field.draw(this.dynamicContext);this.dynamicContext.restore()}}),Editor=Class.create(Renderer,{initialize:function($super,c,d,e,f){$super(c,d,e);this.imageCanvas=f;this.baseToolbox=new Toolbox;this.baseToolbox.parent=this;this.baseToolbox.x=this.field.x+this.field.width+3*Brick.SIZE;this.baseToolbox.y=this.field.y;this.specialToolbox=new Toolbox;this.specialToolbox.parent=this;this.specialToolbox.x=this.baseToolbox.x+this.baseToolbox.width+
Brick.SIZE;this.specialToolbox.y=this.baseToolbox.y;this.eventEngine=new EventEngine;this.dragElement=this.hoverElement=this.selectElement=null;this.setSize();this.addBricksToToolboxes();this.initializeHTMLInterface()},quit:function($super){$super();this.removeEventListening()},init:function($super){$super();this.addEventListening();this.field.resetTrack()},setSize:function(){var b=this.field.y+this.field.height+Brick.SIZE;this.width=this.staticCanvas.width=this.dynamicCanvas.width=this.bufferCanvas.width=
this.specialToolbox.x+this.specialToolbox.width+3;this.height=this.staticCanvas.height=this.dynamicCanvas.height=this.bufferCanvas.height=b},addEventListening:function(){this.eventEngine.addListener("click",this.onClick,this);this.eventEngine.addListener("mouseMove",this.onMouseMove,this);this.eventEngine.addListener("startDrag",this.onStartDrag,this);this.eventEngine.addListener("stopDrag",this.onStopDrag,this)},removeEventListening:function(){this.eventEngine.removeListener("click",this.onClick);
this.eventEngine.removeListener("mouseMove",this.onMouseMove);this.eventEngine.removeListener("startDrag",this.onStartDrag);this.eventEngine.removeListener("stopDrag",this.onStopDrag)},addBricksToToolboxes:function(){var b=[Brick,Ramp,Kicker,Curve,Line],c;for(c=0;c<b.length;c++)this.baseToolbox.addBrick(b[c]);var d=this;new Ajax.Request("/unlocks",{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(e){for(c=5;c<e.responseJSON.unlocks.length;c++)d.specialToolbox.addBrick(eval(e.responseJSON.unlocks[c]));
e.responseJSON.locks&&d.specialToolbox.addPreviewBrick(eval(e.responseJSON.locks[0]))},onFailure:function(){}})},initializeHTMLInterface:function(){var b=this;$("runButton").observe("click",function(){b.field.startBox2D()});$("clearButton").observe("click",function(){b.field.clearTrack(true)});$("publishButton").observe("click",function(){if($("publishButton").hasClassName("activePublish")&&b.field.validTrack){b.publishTrack();$("publishButtonWarning").style.visibility="hidden"}else $("publishButtonWarning").style.visibility=
"visible"})},drawStatics:function(){if(this.field.renderNew||this.baseToolbox.renderNew||this.specialToolbox.renderNew){this.clearCanvas(this.staticCanvas);this.staticContext.save();this.staticContext.translate(0.5,0.5);this.field.drawStatics(this.staticContext);this.baseToolbox.drawStatics(this.staticContext);this.specialToolbox.drawStatics(this.staticContext);this.staticContext.restore()}},drawDynamics:function(){this.dynamicContext.save();this.dynamicContext.clearRectangles();this.dynamicContext.translate(0.5,
0.5);this.field.drawDynamics(this.dynamicContext);this.baseToolbox.drawDynamics(this.dynamicContext);this.specialToolbox.drawDynamics(this.dynamicContext);if(this.hoverElement){this.dynamicContext.save();this.dynamicContext.fillStyle="#333333";this.dynamicContext.globalAlpha=0.15;this.hoverElement.draw(this.dynamicContext);this.dynamicContext.restore()}if(this.selectElement){this.dynamicContext.save();this.dynamicContext.fillStyle="#800000";this.dynamicContext.globalAlpha=0.3;this.selectElement.draw(this.dynamicContext);
this.dynamicContext.restore()}this.field.debugMode&&this.field.draw(this.dynamicContext);if(this.dragElement){this.dynamicContext.drawShadows=true;this.dragElement.drawGlobal(this.dynamicContext);this.dynamicContext.drawShadows=false}this.dynamicContext.restore()},onClick:function(b){if(this.field.hitTest(b.mouseX,b.mouseY)){this.field.intervalID||this.field.onClick(b.mouseX-this.field.x,b.mouseY-this.field.y);this.field.resetTrack()}else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.baseToolbox.onClick(b.mouseX-
this.baseToolbox.x,b.mouseY-this.baseToolbox.y);else this.specialToolbox.hitTest(b.mouseX,b.mouseY)&&this.specialToolbox.onClick(b.mouseX-this.specialToolbox.x,b.mouseY-this.specialToolbox.y)},onMouseMove:function(b){this.hoverElement=null;if(this.field.hitTest(b.mouseX,b.mouseY))this.hoverElement=this.getCellBox(this.field,b.mouseX,b.mouseY);else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.hoverElement=this.getCellBox(this.baseToolbox,b.mouseX,b.mouseY);else if(this.specialToolbox.hitTest(b.mouseX,
b.mouseY))this.hoverElement=this.getCellBox(this.specialToolbox,b.mouseX,b.mouseY)},getCellBox:function(b,c,d){return b.getCellBox(b.getCell(c-b.x,d-b.y))},onStartDrag:function(b){this.field.resetTrack();if(this.field.hitTest(b.mouseX,b.mouseY)){this.field.resetTrack();this.field.onStartDrag(b.mouseX-this.field.x,b.mouseY-this.field.y)}else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.baseToolbox.onStartDrag(b.mouseX-this.baseToolbox.x,b.mouseY-this.baseToolbox.y);else this.specialToolbox.hitTest(b.mouseX,
b.mouseY)&&this.specialToolbox.onStartDrag(b.mouseX-this.specialToolbox.x,b.mouseY-this.specialToolbox.y)},onDrag:function(b){if(this.dragElement&&b.mouseX&&b.mouseY){this.dragElement.x=parseInt(b.mouseX-Brick.SIZE/2,10);this.dragElement.y=parseInt(b.mouseY-Brick.SIZE/2,10)}},dragBrick:function(b){var c={x:this.eventEngine.latestEvent.mouseX,y:this.eventEngine.latestEvent.mouseY};b.x=c.x-Brick.BIG_SIZE/2;b.y=c.y-Brick.BIG_SIZE/2;this.dragElement=b;this.eventEngine.addListener("drag",this.onDrag,this)},
startDragBricking:function(){this.eventEngine.addListener("drag",this.onDragBricking,this)},onDragBricking:function(b){this.field.hitTest(b.mouseX,b.mouseY)&&this.field.onDrag(b.mouseX-this.field.x,b.mouseY-this.field.y)},onStopDrag:function(b){if(this.dragElement){this.field.onStopDrag(b,this.dragElement);this.dragElement=null}this.eventEngine.removeListener("drag",this.onDragBricking);this.eventEngine.removeListener("drag",this.onDrag)},publishTrack:function(){if(this.field.validTrack){contentLoader.parseResponse({responseJSON:{mode:"load"}});
var b={},c=this.field.trackLength;b["track[json]"]=Object.toJSON(this.field.getTrack());b["track[length]"]=c;b["track[imagedata]"]=this.field.getTrackImage(this.imageCanvas);b["track[username]"]=$("userName").value;b["track[trackname]"]=$("trackName").value;new Ajax.Request("/tracks",{method:"post",parameters:b,requestHeaders:{Accept:"application/json"},onSuccess:function(d){contentLoader.parseResponse(d,true)},onFailure:function(d){contentLoader.parseResponse(d,false)}});this.field.clearTrack(true)}}}),
Showroom=Class.create(Renderer,{initialize:function($super,c,d,e){$super(c,d,e);this.initializeHTMLInterface();this.trackID=null;this.autoMode=false;this.fieldOffset=0;this.fieldImage=null},quit:function($super){$super();if(this.tweenTimeoutID){clearTimeout(this.tweenTimeoutID);this.tweeTimeoutID=null}$("showroomLikeButton").stopObserving();$("showroomFlagButton").stopObserving()},drawDynamics:function($super,c){this.tweenTimeoutID?this.dynamicContext.clearRectangles():$super(c)},drawTweenMode:function(b){var c;
b.save();c=this.fieldOffset+(this.field.height+Brick.SIZE)*(this.fieldOffset<0?1:-1);b.translate(-0.5,c-0.5);b.drawImage(this.fieldImage,this.field.x,this.field.y,this.field.width,this.field.height,0,0,this.field.width,this.field.height);b.restore();b.save();c=this.fieldOffset+(this.fieldOffset>0?-Brick.SIZE:this.field.height);b.translate(0,c);this.drawInlay(b);b.restore()},drawInlay:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(this.field.width,0);b.lineTo(this.field.width,Brick.SIZE);b.lineTo(0,
Brick.SIZE);b.closePath();b.clip();b.fillStyle=Brick.FILL;b.strokeStyle=Brick.STROKE;b.lineWidth=3;b.fillRect(0,0,this.field.width,Brick.SIZE);b.beginPath();var c;for(c=0;c<this.field.width+Brick.SIZE;c+=Brick.SIZE/3){b.moveTo(c,0);b.lineTo(c-Brick.SIZE,Brick.SIZE)}b.stroke();b.lineWidth=1;b.beginPath();for(c=1;c<this.field.cols;c++){b.moveTo(c*Brick.SIZE,0);b.lineTo(c*Brick.SIZE,Brick.SIZE)}b.stroke();b.beginPath()},onBallExit:function($super){$super();if(this.autoMode)trackStore.hasNext(this.trackID)?
this.fadeTrack(trackStore.next(this.trackID),true):contentLoader.loadContent("/tracks/"+this.trackID+"/next",true)},parseTrack:function(b){this.initField();this.trackID=b.id;this.field.setTrack(b.json);trackStore.loadNext(this.trackID);trackStore.loadPrevious(this.trackID);this.setLikeBlameButtons();this.autoMode&&!this.tweenTimeoutID&&this.field.startBox2D()},initializeHTMLInterface:function(){var b=this;$("showButton").observe("click",function(){b.field.startBox2D()});$("autoButton").observe("click",
function(){$("autoButton").toggleClassName("active");b.autoMode=$("autoButton").hasClassName("active")});$("nextButton").observe("click",function(){trackStore.hasNext(b.trackID)?b.fadeTrack(trackStore.next(b.trackID),true):contentLoader.loadContent("/tracks/"+b.trackID+"/next")});$("previousButton").observe("click",function(){trackStore.hasPrevious(b.trackID)?b.fadeTrack(trackStore.previous(b.trackID),false):contentLoader.loadContent("/tracks/"+b.trackID+"/previous")})},setLikeBlameButtons:function(){var b=
this;if(Cookie.likedTracks.indexOf(this.trackID)===-1){$("showroomLikeButton").observe("click",function(){b.like()});$("showroomLikeButton").setStyle({display:"block"})}else{$("showroomLikeButton").stopObserving();$("showroomLikeButton").setStyle({display:"none"})}if(Cookie.flagedTracks.indexOf(this.trackID)===-1){$("showroomFlagButton").observe("click",function(){b.flag()});$("showroomFlag").setStyle({display:"block"})}else{$("showroomFlagButton").stopObserving();$("showroomFlag").setStyle({display:"none"})}},
startRender:function($super){$super();this.autoMode&&!this.tweenTimeoutID&&this.field.startBox2D()},like:function(){if(this.trackID){var b={},c=this;b.likes=1;new Ajax.Request("/tracks/"+this.trackID,{method:"put",parameters:b,requestHeaders:{Accept:"application/json"},onSuccess:function(){Cookie.likedTracks.push(c.trackID);Cookie.set("likes",JSON.stringify(Cookie.likedTracks),{maxAge:31536E3});$("tableLikes").update(parseInt($("tableLikes").innerHTML,10)+1);$("showroomLikeButton").setStyle({display:"none"})},
onFailure:function(){$("showroomLikeButton").setStyle({display:"none"})}})}},flag:function(){if(this.trackID){var b={},c=this;b.flags=1;new Ajax.Request("/tracks/"+this.trackID,{method:"put",parameters:b,requestHeaders:{Accept:"application/json"},onSuccess:function(){Cookie.flagedTracks.push(c.trackID);Cookie.set("flags",JSON.stringify(Cookie.flagedTracks),{maxAge:31536E3});$("showroomFlag").setStyle({display:"none"})},onFailure:function(){$("showroomFlag").setStyle({display:"none"})}})}},fadeTrack:function(b,
c){this.tweenPercent=0;this.tweenTimeoutID=true;this.fieldOffset=this.totalHeight=(this.field.height+Brick.SIZE)*(c?1:-1);this.fieldImage=new Image;var d=this;this.fieldImage.onload=function(){trackStore.loadTrack(b,contentLoader.parseResponse,contentLoader,true);d.tween()};this.fieldImage.src=this.staticCanvas.toDataURL("image/png")},tween:function(){if(this.tweenPercent>=1){this.fieldOffset=0;this.tweenTimeoutID=null;this.autoMode&&this.field.startBox2D()}else{this.fieldOffset=(Math.cos(this.tweenPercent*
Math.PI)+1)/2*this.totalHeight;this.tweenPercent+=0.05;var b=this;this.tweenTimeoutID=setTimeout(function(){b.tween();b.field.renderNew=true},50)}}}),Meter=Class.create(DisplayObject,{initialize:function($super,c){$super();this.canvas=c;this.context=c.getContext("2d");this.context.translate(0.5,0.5);this.width=218;this.height=185;this.angle=-Math.PI/4;this.timeINT=this.targetAngle=null},setSize:function(){this.canvas.width=this.width;this.canvas.height=this.height},setRotation:function(b){clearTimeout(this.timeINT);
this.targetAngle=b*Math.PI/2-Math.PI/4;var c=this;setTimeout(function(){c.calculateRotation()},1E3)},calculateRotation:function(){this.angle+=(this.targetAngle-this.angle)/8;if(Math.abs(this.angle-this.targetAngle)<0.01){this.angle=this.targetAngle;this.draw();this.timeINT=null}else{this.draw();var b=this;this.timeINT=setTimeout(function(){b.calculateRotation()},50)}},draw:function(){this.setSize();this.context.fillStyle=Pattern.meterBackground;this.context.fillRect(0,0,this.width,this.height);this.context.save();
this.context.translate(109,120);this.context.rotate(this.angle);this.context.translate(-19,-65);this.context.drawImage(Pattern.image.meterPointer,0,0,22,92);this.context.restore();this.context.fillStyle=Pattern.meterForeground;this.context.fillRect(0,0,this.width,this.height)}}),SidebarController=Class.create({initialize:function(){this.meter=new Meter(meterCanvas);this.meter.setRotation(0);var b=this;new Ajax.PeriodicalUpdater("","/tracks/info",{method:"get",frequency:6,decay:1,onSuccess:function(c){b.onInfoUpdate.call(b,
c)},onFailure:function(){console.error("Periodical Update failed!")}});this.targetMeters=null;this.meters=0},onInfoUpdate:function(b){response=JSON.parse(b.responseText);this.meter.setRotation(response.percentage);this.setMeters(parseInt(response.total_length/100,10));this.setLatestTrack(response.latest_track)},setMeters:function(b){this.targetMeters=b;var c=this;setTimeout(function(){c.updateMeters()},100)},updateMeters:function(){if(this.targetMeters-this.meters>1){this.meters+=(this.targetMeters-
this.meters)/9;var b=this;setTimeout(function(){b.updateMeters()},50)}else this.meters=this.targetMeters;for(var c=parseInt(this.meters,10).toString();c.length<7;)c="0"+c;$("lengthMeter").update(c)},setLatestTrack:function(b){$("lastTrackHolder").writeAttribute({onclick:"contentLoader.loadContent('/tracks/"+b.id+"', true)"});$("latestTrackReflection").writeAttribute({onclick:"contentLoader.loadContent('/tracks/"+b.id+"', true)"});var c='<div><img width="122" height="182" src="';c+=b.imagedata;c+=
'" /><div class="background"></div><div><div class="header">LATEST TRACK</div><div id="latestInfo">';c+=b.trackname.toUpperCase()+"<br>";c+=b.username.toUpperCase()+"<br>";c+=(Math.round(b.length*10)/10).toString()+" METER";c+="</div></div></div>";$("lastTrackHolder").update(c)}}),ContentLoader=Class.create({initialize:function(){this.oldContent=this.oldMode=this.loadingInterval=this.visibleList=null;this.setInitialScreen();this.editor=new Editor(staticCanvas,dynamicCanvas,bufferCanvas,imageCanvas);
this.editor.x=editorPosition.left;this.editor.y=editorPosition.top;this.showroom=new Showroom(staticCanvas,dynamicCanvas,bufferCanvas);this.showroom.x=editorPosition.left;this.showroom.y=editorPosition.top;var b=this;Pattern.context=meterCanvas.getContext("2d");Pattern.loadPattern([{name:"meterBackground",path:"../images/sidebar-meter-background.png"},{name:"meterForeground",path:"../images/sidebar-meter-foreground.png"},{name:"meterPointer",path:"../images/sidebar-meter-pointer.png"}]);Pattern.onload=
function(){sidebarController=new SidebarController;var c=window.location.href,d=c.substr(c.indexOf("/",7));if(d.substr(0,8)=="/tracks?"){d=d.substr(8);d=d.split("&");for(var e=0;e<d.length;e++){var f=d[e].split("="),h=f[0];f=f[1];if(h=="page")currentPage=f;else if(h=="search"){currentKeyWord=f;document.getElementById("searchField").value=f}else if(h=="sorting")currentSorting=f}}b.loadContent(c)}},loadContent:function(b,c){this.parseResponse({responseJSON:{mode:"load"}});if(b==="/about"||b==="/imprint"||
b==="/contact")this.parseResponse({responseJSON:{mode:b.substr(1)}},c);else{var d=this;new Ajax.Request(b,{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(e){d.parseResponse.call(d,e,c)},onFailure:function(e){d.parseResponse.call(d,e,false)}})}},parseResponse:function(b,c){this.loadingInterval&&clearInterval(this.loadingInterval);if(typeof c==="undefined")c=true;var d=b.responseJSON,e;this.visibleList=[];this.oldContent&&this.oldContent.quit();switch(d.mode){case "build":this.oldContent=
this.editor;this.createBuildMode(d);e="/tracks/new";break;case "show":this.oldContent=this.showroom;this.createShowMode(d);trackStore.addTrack(d.track);e="/tracks/"+d.track.id;setSwitchMode("none");break;case "overview":this.oldContent=null;this.createOverviewMode(d);e="/tracks?page="+currentPage;if(currentKeyWord.length>0)e+="&search="+currentKeyWord;if(currentSorting.length>0)e+="&sorting="+currentSorting;break;case "about":case "imprint":case "contact":this.oldContent=null;this.visibleList=[d.mode+
"Page"];e="/"+d.mode;break;case "load":this.oldContent=null;c=false;this.visibleList=["loadingPage"];this.loadingInterval=setInterval(function(){$("loadingPage").toggleClassName("blink")},500);break;case "failure":this.oldContent=null;this.visibleList=["errorPage"];$("errorMessage").update(d.message.toUpperCase())}this.oldMode=d.mode;setToggleElementsVisibility(this.visibleList);c&&this.pushURL(e,b);$("helpBox").setStyle({display:"none"});$("helpButton").removeClassName("active")},createBuildMode:function(){setBuildTweetButton();
setSwitchMode("build");this.editor.init();$("editor").setStyle({height:"560px"});this.visibleList=["editorControlsTop","editorControlsBottom","editorToolboxTop","editorToolboxBottom","staticCanvas","dynamicCanvas","editorRuler"]},createShowMode:function(b){setTrackTweetButton(b.track.id);setSwitchMode("view");this.showroom.parseTrack(b.track);this.showroom.init();$("tableTrack").update(b.track.trackname.toUpperCase());$("tableBuilder").update(b.track.username.toUpperCase());$("tableLength").update(parseInt(b.track.length*
10,10)/10+" METER");$("tableDate").update(b.track.date);$("tableTime").update(b.track.time);$("tableLikes").update(b.track.likes);$("editor").setStyle({height:"520px"});this.visibleList=["showroomControlsTop","showroomControlsBottom","showroomDetail","staticCanvas","dynamicCanvas"]},createOverviewMode:function(b){setSwitchMode("view");currentPage=b.current_page;$("overviewPageDisplay").update(""+b.current_page+" / "+b.total_pages);$("overviewPreviousButton").removeClassName("inactive");$("overviewNextButton").removeClassName("inactive");
b.current_page<=1&&$("overviewPreviousButton").addClassName("inactive");b.current_page>=b.total_pages&&$("overviewNextButton").addClassName("inactive");var c="<ul>",d,e=null,f=null;if(b.tracks.length==0)c='<p class="no-track-warning">No track found</p>';for(d=0;d<b.tracks.length;d++){e=d===b.tracks.length-1?null:b.tracks[d+1].id;trackStore.addTrack(b.tracks[d],e,f);f=b.tracks[d].id;e="<li>";e+='<a onclick="trackStore.loadTrack('+b.tracks[d].id+', contentLoader.parseResponse, contentLoader)"><img src="'+
b.tracks[d].imagedata+'"></a>';e+="<ul>";e+='<li class="trackname">'+b.tracks[d].trackname+"</li>";e+='<li class="username">'+b.tracks[d].username+"</li>";e+='<li class="length">'+Math.round(b.tracks[d].length*10)/10+" Meter | LIKES "+b.tracks[d].likes+"</li>";e+="</ul>";e+="</li>";c+=e}c+="</ul>";$("overviewGrid").update(c);this.visibleList=["overviewControls","overviewGrid"]},pushURL:function(b,c){history&&history.pushState&&history.pushState(c,"",b)},onPopState:function(b){this.parseResponse(b.state,
false)},setInitialScreen:function(){if(Cookie.get("isFirstVisit")){$("firstVisitContainer").setStyle({visibility:"hidden"});$("firstVisitText").setStyle({visibility:"hidden"});$("firstVisitCloseButton").setStyle({visibility:"hidden"})}else{$("firstVisitContainer").setStyle({visibility:"visible"});$("firstVisitText").setStyle({visibility:"visible"});$("firstVisitCloseButton").setStyle({visibility:"visible"});$("firstVisitCloseButton").observe("click",function(){$("firstVisitContainer").setStyle({visibility:"hidden"});
$("firstVisitText").setStyle({visibility:"hidden"});$("firstVisitCloseButton").setStyle({visibility:"hidden"})})}Cookie.set("isFirstVisit",true,{maxAge:5184E3});Cookie.likedTracks=JSON.parse(Cookie.get("likes"))||[];Cookie.flagedTracks=JSON.parse(Cookie.get("flags"))||[]}}),TrackStore=Class.create({initialize:function(){this.tracks={}},addTrack:function(b,c,d){if(this.tracks[b.id]){if(c)this.tracks[b.id].next=c;if(d)this.tracks[b.id].previous=d}else this.tracks[b.id]={track:b,next:c,previous:d}},
getTrack:function(b){if(!this.tracks[b])return null;return this.tracks[b].track},loadTrack:function(b,c,d,e){if(this.tracks[b])if(c){c.call(d,{responseJSON:{mode:"show",track:this.tracks[b].track}},e);return}var f=this;new Ajax.Request("/tracks/"+b,{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(h){f.addTrack.call(f,h.responseJSON.track);c&&c.call(d,h,e)},onFailure:function(){}})},loadNext:function(b){if(!(this.tracks[b]&&this.tracks[b].next&&this.tracks[this.tracks[b].next])){var c=
this;new Ajax.Request("/tracks/"+b+"/next",{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(d){c.tracks[b].next=d.responseJSON.track.id;c.addTrack.call(c,d.responseJSON.track,null,b)},onFailure:function(){c.tracks[b].next=b}})}},loadPrevious:function(b){if(!(this.tracks[b]&&this.tracks[b].previous&&this.tracks[this.tracks[b].previous])){var c=this;new Ajax.Request("/tracks/"+b+"/previous",{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(d){c.tracks[b].previous=
d.responseJSON.track.id;c.addTrack.call(c,d.responseJSON.track,b,null)},onFailure:function(){c.tracks[b].previous=b}})}},hasNext:function(b){return this.tracks[b].next!==null},next:function(b){if(this.hasNext(b))return this.tracks[b].next;return null},hasPrevious:function(b){return this.tracks[b].previous!==null},previous:function(b){if(this.hasPrevious(b))return this.tracks[b].previous;return null}});var Prototype={Version:"1.7_rc2",Browser:function(){var b=navigator.userAgent,c=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!c,Opera:c,WebKit:b.indexOf("AppleWebKit/")>-1,Gecko:b.indexOf("Gecko")>-1&&b.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(b)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var b=window.Element||window.HTMLElement;return!!(b&&b.prototype)}(),SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!==
"undefined")return true;var b=document.createElement("div"),c=document.createElement("form"),d=false;if(b.__proto__&&b.__proto__!==c.__proto__)d=true;return d}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(b){return b}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;
var Abstract={},Try={these:function(){for(var b,c=0,d=arguments.length;c<d;c++){var e=arguments[c];try{b=e();break}catch(f){}}return b}},Class=function(){function b(){}var c=function(){for(var d in{toString:1})if(d==="toString")return false;return true}();return{create:function(){function d(){this.initialize.apply(this,arguments)}var e=null,f=$A(arguments);if(Object.isFunction(f[0]))e=f.shift();Object.extend(d,Class.Methods);d.superclass=e;d.subclasses=[];if(e){b.prototype=e.prototype;d.prototype=
new b;e.subclasses.push(d)}e=0;for(var h=f.length;e<h;e++)d.addMethods(f[e]);if(!d.prototype.initialize)d.prototype.initialize=Prototype.emptyFunction;return d.prototype.constructor=d},Methods:{addMethods:function(d){var e=this.superclass&&this.superclass.prototype,f=Object.keys(d);if(c){d.toString!=Object.prototype.toString&&f.push("toString");d.valueOf!=Object.prototype.valueOf&&f.push("valueOf")}for(var h=0,g=f.length;h<g;h++){var i=f[h],j=d[i];if(e&&Object.isFunction(j)&&j.argumentNames()[0]==
"$super"){var k=j;j=function(l){return function(){return e[l].apply(this,arguments)}}(i).wrap(k);j.valueOf=k.valueOf.bind(k);j.toString=k.toString.bind(k)}this.prototype[i]=j}return this}}}}();
(function(){function b(p){switch(p){case null:return k;case void 0:return l}switch(typeof p){case "boolean":return o;case "number":return q;case "string":return t}return w}function c(p,s){for(var u in s)p[u]=s[u];return p}function d(p){return e("",{"":p},[])}function e(p,s,u){s=s[p];var v=typeof s;if(b(s)===w&&typeof s.toJSON==="function")s=s.toJSON(p);p=j.call(s);switch(p){case A:case z:case n:s=s.valueOf()}switch(s){case null:return"null";case true:return"true";case false:return"false"}v=typeof s;
switch(v){case "string":return s.inspect(true);case "number":return isFinite(s)?String(s):"null";case "object":v=0;for(var y=u.length;v<y;v++)if(u[v]===s)throw new TypeError;u.push(s);var x=[];if(p===m){v=0;for(y=s.length;v<y;v++){var B=e(v,s,u);x.push(typeof B==="undefined"?"null":B)}x="["+x.join(",")+"]"}else{var C=Object.keys(s);v=0;for(y=C.length;v<y;v++){p=C[v];B=e(p,s,u);typeof B!=="undefined"&&x.push(p.inspect(true)+":"+B)}x="{"+x.join(",")+"}"}u.pop();return x}}function f(p){return JSON.stringify(p)}
function h(p){if(b(p)!==w)throw new TypeError;var s=[],u;for(u in p)p.hasOwnProperty(u)&&s.push(u);return s}function g(p){return j.call(p)===m}function i(p){return typeof p==="undefined"}var j=Object.prototype.toString,k="Null",l="Undefined",o="Boolean",q="Number",t="String",w="Object",z="[object Boolean]",A="[object Number]",n="[object String]",m="[object Array]",r=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";if(typeof Array.isArray==
"function"&&Array.isArray([])&&!Array.isArray({}))g=Array.isArray;c(Object,{extend:c,inspect:function(p){try{if(i(p))return"undefined";if(p===null)return"null";return p.inspect?p.inspect():String(p)}catch(s){if(s instanceof RangeError)return"...";throw s;}},toJSON:r?f:d,toQueryString:function(p){return $H(p).toQueryString()},toHTML:function(p){return p&&p.toHTML?p.toHTML():String.interpret(p)},keys:Object.keys||h,values:function(p){var s=[],u;for(u in p)s.push(p[u]);return s},clone:function(p){return c({},
p)},isElement:function(p){return!!(p&&p.nodeType==1)},isArray:g,isHash:function(p){return p instanceof Hash},isFunction:function(p){return typeof p==="function"},isString:function(p){return j.call(p)===n},isNumber:function(p){return j.call(p)===A},isUndefined:i})})();
Object.extend(Function.prototype,function(){function b(e,f){for(var h=e.length,g=f.length;g--;)e[h+g]=f[g];return e}function c(e,f){e=d.call(e,0);return b(e,f)}var d=Array.prototype.slice;return{argumentNames:function(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e},bind:function(e){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var f=this,h=d.call(arguments,
1);return function(){var g=c(h,arguments);return f.apply(e,g)}},bindAsEventListener:function(e){var f=this,h=d.call(arguments,1);return function(g){g=b([g||window.event],h);return f.apply(e,g)}},curry:function(){if(!arguments.length)return this;var e=this,f=d.call(arguments,0);return function(){var h=c(f,arguments);return e.apply(this,h)}},delay:function(e){var f=this,h=d.call(arguments,1);e*=1E3;return window.setTimeout(function(){return f.apply(f,h)},e)},defer:function(){return this.delay.apply(this,
b([0.01],arguments))},wrap:function(e){var f=this;return function(){var h=b([f.bind(this)],arguments);return e.apply(this,h)}},methodize:function(){if(this._methodized)return this._methodized;var e=this;return this._methodized=function(){var f=b([this],arguments);return e.apply(null,f)}}}}());
(function(b){function c(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function d(){return this.toISOString()}if(!b.toISOString)b.toISOString=c;if(!b.toJSON)b.toJSON=d})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(b){return String(b).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(b,c){this.callback=b;this.frequency=c;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(b){this.currentlyExecuting=
false;throw b;}}});Object.extend(String,{interpret:function(b){return b==null?"":String(b)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function b(g){if(Object.isFunction(g))return g;var i=new Template(g);return function(j){return i.evaluate(j)}}function c(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function d(g){var i=this.strip().match(/([^?#]*)(#.*)?$/);if(!i)return{};return i[1].split(g||"&").inject({},function(j,k){if((k=k.split("="))[0]){var l=decodeURIComponent(k.shift()),o=k.length>1?k.join("="):k[0];if(o!=undefined)o=decodeURIComponent(o);if(l in j){Object.isArray(j[l])||
(j[l]=[j[l]]);j[l].push(o)}else j[l]=o}return j})}function e(g){var i=this.unfilterJSON(),j=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(j.test(i))i=i.replace(j,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});try{if(!g||i.isJSON())return eval("("+i+")")}catch(k){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function f(){var g=this.unfilterJSON();return JSON.parse(g)}var h=window.JSON&&
typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;return{gsub:function(g,i){var j="",k=this,l;i=b(i);if(Object.isString(g))g=RegExp.escape(g);if(!(g.length||g.source)){i=i("");return i+k.split("").join(i)+i}for(;k.length>0;)if(l=k.match(g)){j+=k.slice(0,l.index);j+=String.interpret(i(l));k=k.slice(l.index+l[0].length)}else{j+=k;k=""}return j},sub:function(g,i,j){i=b(i);j=Object.isUndefined(j)?1:j;return this.gsub(g,function(k){if(--j<0)return k[0];return i(k)})},scan:function(g,i){this.gsub(g,
i);return String(this)},truncate:function(g,i){g=g||30;i=Object.isUndefined(i)?"...":i;return this.length>g?this.slice(0,g-i.length)+i:String(this)},strip:String.prototype.trim||c,stripTags:function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripScripts:function(){return this.replace(RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var g=RegExp(Prototype.ScriptFragment,"im");return(this.match(RegExp(Prototype.ScriptFragment,"img"))||[]).map(function(i){return(i.match(g)||
["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(g){return eval(g)})},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},toQueryParams:d,parseQuery:d,toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(g){return g<
1?"":Array(g+1).join(this)},camelize:function(){return this.replace(/-+(.)?/g,function(g,i){return i?i.toUpperCase():""})},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/_/g,"-")},inspect:function(g){var i=this.replace(/[\x00-\x1f\\]/g,function(j){if(j in
String.specialChar)return String.specialChar[j];return"\\u00"+j.charCodeAt().toPaddedString(2,16)});if(g)return'"'+i.replace(/"/g,'\\"')+'"';return"'"+i.replace(/'/g,"\\'")+"'"},unfilterJSON:function(g){return this.replace(g||Prototype.JSONFilter,"$1")},isJSON:function(){var g=this;if(g.blank())return false;g=g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");g=g.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");g=g.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(g)},
evalJSON:h?f:e,include:function(g){return this.indexOf(g)>-1},startsWith:function(g){return this.lastIndexOf(g,0)===0},endsWith:function(g){var i=this.length-g.length;return i>=0&&this.indexOf(g,i)===i},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(g,i){return(new Template(this,i)).evaluate(g)}}}());
var Template=Class.create({initialize:function(b,c){this.template=b.toString();this.pattern=c||Template.Pattern},evaluate:function(b){if(b&&Object.isFunction(b.toTemplateReplacements))b=b.toTemplateReplacements();return this.template.gsub(this.pattern,function(c){if(b==null)return c[1]+"";var d=c[1]||"";if(d=="\\")return c[2];var e=b,f=c[3],h=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;c=h.exec(f);if(c==null)return d;for(;c!=null;){var g=c[1].startsWith("[")?c[2].replace(/\\\\]/g,"]"):c[1];e=e[g];if(null==
e||""==c[3])break;f=f.substring("["==c[3]?c[1].length:c[0].length);c=h.exec(f)}return d+String.interpret(e)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function b(i,j){i=i||Prototype.K;var k=true;this.each(function(l,o){k=k&&!!i.call(j,l,o);if(!k)throw $break;});return k}function c(i,j){i=i||Prototype.K;var k=false;this.each(function(l,o){if(k=!!i.call(j,l,o))throw $break;});return k}function d(i,j){i=i||Prototype.K;var k=[];this.each(function(l,o){k.push(i.call(j,l,o))});return k}function e(i,j){var k;this.each(function(l,o){if(i.call(j,l,o)){k=l;throw $break;}});return k}function f(i,j){var k=[];this.each(function(l,
o){i.call(j,l,o)&&k.push(l)});return k}function h(i){if(Object.isFunction(this.indexOf))if(this.indexOf(i)!=-1)return true;var j=false;this.each(function(k){if(k==i){j=true;throw $break;}});return j}function g(){return this.map()}return{each:function(i,j){var k=0;try{this._each(function(o){i.call(j,o,k++)})}catch(l){if(l!=$break)throw l;}return this},eachSlice:function(i,j,k){var l=-i,o=[],q=this.toArray();if(i<1)return q;for(;(l+=i)<q.length;)o.push(q.slice(l,l+i));return o.collect(j,k)},all:b,every:b,
any:c,some:c,collect:d,map:d,detect:e,findAll:f,select:f,filter:f,grep:function(i,j,k){j=j||Prototype.K;var l=[];if(Object.isString(i))i=RegExp(RegExp.escape(i));this.each(function(o,q){i.match(o)&&l.push(j.call(k,o,q))});return l},include:h,member:h,inGroupsOf:function(i,j){j=Object.isUndefined(j)?null:j;return this.eachSlice(i,function(k){for(;k.length<i;)k.push(j);return k})},inject:function(i,j,k){this.each(function(l,o){i=j.call(k,i,l,o)});return i},invoke:function(i){var j=$A(arguments).slice(1);
return this.map(function(k){return k[i].apply(k,j)})},max:function(i,j){i=i||Prototype.K;var k;this.each(function(l,o){l=i.call(j,l,o);if(k==null||l>=k)k=l});return k},min:function(i,j){i=i||Prototype.K;var k;this.each(function(l,o){l=i.call(j,l,o);if(k==null||l<k)k=l});return k},partition:function(i,j){i=i||Prototype.K;var k=[],l=[];this.each(function(o,q){(i.call(j,o,q)?k:l).push(o)});return[k,l]},pluck:function(i){var j=[];this.each(function(k){j.push(k[i])});return j},reject:function(i,j){var k=
[];this.each(function(l,o){i.call(j,l,o)||k.push(l)});return k},sortBy:function(i,j){return this.map(function(k,l){return{value:k,criteria:i.call(j,k,l)}}).sort(function(k,l){var o=k.criteria,q=l.criteria;return o<q?-1:o>q?1:0}).pluck("value")},toArray:g,entries:g,zip:function(){var i=Prototype.K,j=$A(arguments);if(Object.isFunction(j.last()))i=j.pop();var k=[this].concat(j).map($A);return this.map(function(l,o){return i(k.pluck(o))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+
this.toArray().inspect()+">"},find:e}}();function $A(b){if(!b)return[];if("toArray"in Object(b))return b.toArray();for(var c=b.length||0,d=Array(c);c--;)d[c]=b[c];return d}function $w(b){if(!Object.isString(b))return[];return(b=b.strip())?b.split(/\s+/):[]}Array.from=$A;
(function(){function b(j){for(var k=0,l=this.length;k<l;k++)j(this[k])}function c(){return g.call(this,0)}function d(j,k){k||(k=0);var l=this.length;if(k<0)k=l+k;for(;k<l;k++)if(this[k]===j)return k;return-1}function e(j,k){k=isNaN(k)?this.length:(k<0?this.length+k:k)+1;var l=this.slice(0,k).reverse().indexOf(j);return l<0?l:k-l-1}function f(){for(var j=g.call(this,0),k,l=0,o=arguments.length;l<o;l++){k=arguments[l];if(Object.isArray(k)&&!("callee"in k))for(var q=0,t=k.length;q<t;q++)j.push(k[q]);
else j.push(k)}return j}var h=Array.prototype,g=h.slice,i=h.forEach;i||(i=b);Object.extend(h,Enumerable);if(!h._reverse)h._reverse=h.reverse;Object.extend(h,{_each:i,clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(j){return j!=null})},flatten:function(){return this.inject([],function(j,k){if(Object.isArray(k))return j.concat(k.flatten());j.push(k);return j})},without:function(){var j=
g.call(arguments,0);return this.select(function(k){return!j.include(k)})},reverse:function(j){return(j===false?this.toArray():this)._reverse()},uniq:function(j){return this.inject([],function(k,l,o){if(0==o||(j?k.last()!=l:!k.include(l)))k.push(l);return k})},intersect:function(j){return this.uniq().findAll(function(k){return j.detect(function(l){return k===l})})},clone:c,toArray:c,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"}});if(function(){return[].concat(arguments)[0][0]!==
1}(1,2))h.concat=f;if(!h.indexOf)h.indexOf=d;if(!h.lastIndexOf)h.lastIndexOf=e})();function $H(b){return new Hash(b)}
var Hash=Class.create(Enumerable,function(){function b(){return Object.clone(this._object)}function c(d,e){if(Object.isUndefined(e))return d;return d+"="+encodeURIComponent(String.interpret(e))}return{initialize:function(d){this._object=Object.isHash(d)?d.toObject():Object.clone(d)},_each:function(d){for(var e in this._object){var f=this._object[e],h=[e,f];h.key=e;h.value=f;d(h)}},set:function(d,e){return this._object[d]=e},get:function(d){if(this._object[d]!==Object.prototype[d])return this._object[d]},
unset:function(d){var e=this._object[d];delete this._object[d];return e},toObject:b,toTemplateReplacements:b,keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(d){var e=this.detect(function(f){return f.value===d});return e&&e.key},merge:function(d){return this.clone().update(d)},update:function(d){return(new Hash(d)).inject(this,function(e,f){e.set(f.key,f.value);return e})},toQueryString:function(){return this.inject([],function(d,e){var f=encodeURIComponent(e.key),
h=e.value;if(h&&typeof h=="object"){if(Object.isArray(h))return d.concat(h.map(c.curry(f)))}else d.push(c(f,h));return d}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(d){return d.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:b,clone:function(){return new Hash(this)}}}());Hash.from=$H;
Object.extend(Number.prototype,function(){return{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(b,c){$R(0,this,true).each(b,c);return this},toPaddedString:function(b,c){var d=this.toString(c||10);return"0".times(b-d.length)+d},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}}}());function $R(b,c,d){return new ObjectRange(b,c,d)}
var ObjectRange=Class.create(Enumerable,function(){return{initialize:function(b,c,d){this.start=b;this.end=c;this.exclusive=d},_each:function(b){for(var c=this.start;this.include(c);){b(c);c=c.succ()}},include:function(b){if(b<this.start)return false;if(this.exclusive)return b<this.end;return b<=this.end}}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||
false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(b){this.responders._each(b)},register:function(b){this.include(b)||this.responders.push(b)},unregister:function(b){this.responders=this.responders.without(b)},dispatch:function(b,c,d,e){this.each(function(f){if(Object.isFunction(f[b]))try{f[b].apply(f,[c,d,e])}catch(h){}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(b){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,b||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,c,d){$super(d);this.transport=Ajax.getTransport();this.request(c)},request:function(b){this.url=b;this.method=this.options.method;b=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){b._method=this.method;this.method="post"}this.parameters=b;if(b=Object.toQueryString(b))if(this.method=="get")this.url+=(this.url.include("?")?"&":"?")+b;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))b+=
"&_=";try{var c=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(c);Ajax.Responders.dispatch("onCreate",this,c);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||b:null;this.transport.send(this.body);!this.options.asynchronous&&this.transport.overrideMimeType&&
this.onStateChange()}catch(d){this.dispatchException(d)}},onStateChange:function(){var b=this.transport.readyState;b>1&&!(b==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var b={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){b["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:
"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)b.Connection="close"}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(Object.isFunction(c.push))for(var d=0,e=c.length;d<e;d+=2)b[c[d]]=c[d+1];else $H(c).each(function(h){b[h.key]=h.value})}for(var f in b)this.transport.setRequestHeader(f,b[f])},success:function(){var b=this.getStatus();return!b||b>=200&&b<300},getStatus:function(){try{return this.transport.status||
0}catch(b){return 0}},respondToReadyState:function(b){b=Ajax.Request.Events[b];var c=new Ajax.Response(this);if(b=="Complete"){try{this._complete=true;(this.options["on"+c.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(c,c.headerJSON)}catch(d){this.dispatchException(d)}var e=c.getHeader("Content-type");if(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&e&&e.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))this.evalResponse()}try{(this.options["on"+
b]||Prototype.emptyFunction)(c,c.headerJSON);Ajax.Responders.dispatch("on"+b,this,c,c.headerJSON)}catch(f){this.dispatchException(f)}if(b=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var b=this.url.match(/^\s*https?:\/\/[^\/]*/);return!b||b[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(b){try{return this.transport.getResponseHeader(b)||
null}catch(c){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(b){this.dispatchException(b)}},dispatchException:function(b){(this.options.onException||Prototype.emptyFunction)(this,b);Ajax.Responders.dispatch("onException",this,b)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(b){this.request=b;b=this.transport=b.transport;var c=this.readyState=b.readyState;if(c>2&&!Prototype.Browser.IE||c==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(b.responseText);this.headerJSON=this._getHeaderJSON()}if(c==4){b=b.responseXML;this.responseXML=Object.isUndefined(b)?null:b;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,
getStatusText:function(){try{return this.transport.statusText||""}catch(b){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(b){return null}},getResponseHeader:function(b){return this.transport.getResponseHeader(b)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var b=this.getHeader("X-JSON");if(!b)return null;b=decodeURIComponent(escape(b));try{return b.evalJSON(this.request.options.sanitizeJSON||
!this.request.isSameOrigin())}catch(c){this.request.dispatchException(c)}},_getResponseJSON:function(){var b=this.request.options;if(!b.evalJSON||b.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(b.sanitizeJSON||!this.request.isSameOrigin())}catch(c){this.request.dispatchException(c)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,c,d,e){this.container={success:c.success||c,failure:c.failure||(c.success?null:c)};e=Object.clone(e);var f=e.onComplete;e.onComplete=function(h,g){this.updateContent(h.responseText);Object.isFunction(f)&&f(h,g)}.bind(this);$super(d,e)},updateContent:function(b){var c=this.container[this.success()?"success":"failure"],d=this.options;d.evalScripts||(b=b.stripScripts());if(c=$(c))if(d.insertion)if(Object.isString(d.insertion)){var e=
{};e[d.insertion]=b;c.insert(e)}else d.insertion(c,b);else c.update(b)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,c,d,e){$super(e);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=c;this.url=d;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(b){if(this.options.decay){this.decay=b.responseText==this.lastText?this.decay*this.options.decay:1;this.lastText=b.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(b){if(arguments.length>1){for(var c=0,d=[],e=arguments.length;c<e;c++)d.push($(arguments[c]));return d}if(Object.isString(b))b=document.getElementById(b);return Element.extend(b)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(b,c){for(var d=[],e=document.evaluate(b,$(c)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),f=0,h=e.snapshotLength;f<h;f++)d.push(Element.extend(e.snapshotItem(f)));return d};Node||(Node={});
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(b){var c=function(){try{var e=document.createElement('<input name="x">');return e.tagName.toLowerCase()==="input"&&e.name==="x"}catch(f){return false}}(),d=b.Element;b.Element=function(e,f){f=f||{};e=e.toLowerCase();var h=Element.cache;if(c&&f.name){e="<"+e+' name="'+f.name+'">';delete f.name;return Element.writeAttribute(document.createElement(e),f)}h[e]||(h[e]=Element.extend(document.createElement(e)));return Element.writeAttribute(h[e].cloneNode(false),f)};Object.extend(b.Element,d||
{});if(d)b.Element.prototype=d.prototype})(this);Element.idCounter=1;Element.cache={};function purgeElement(b){var c=b._prototypeUID;if(c){Element.stopObserving(b);b._prototypeUID=void 0;delete Element.Storage[c]}}
Element.Methods={visible:function(b){return $(b).style.display!="none"},toggle:function(b){b=$(b);Element[Element.visible(b)?"hide":"show"](b);return b},hide:function(b){b=$(b);b.style.display="none";return b},show:function(b){b=$(b);b.style.display="";return b},remove:function(b){b=$(b);b.parentNode.removeChild(b);return b},update:function(){var b=function(){var e=document.createElement("select"),f=true;e.innerHTML='<option value="test">test</option>';if(e.options&&e.options[0])f=e.options[0].nodeName.toUpperCase()!==
"OPTION";return f}(),c=function(){try{var e=document.createElement("table");if(e&&e.tBodies){e.innerHTML="<tbody><tr><td>test</td></tr></tbody>";return typeof e.tBodies[0]=="undefined"}}catch(f){return true}}(),d=function(){var e=document.createElement("script"),f=false;try{e.appendChild(document.createTextNode(""));f=!e.firstChild||e.firstChild&&e.firstChild.nodeType!==3}catch(h){f=true}return f}();return function(e,f){e=$(e);for(var h=e.getElementsByTagName("*"),g=h.length;g--;)purgeElement(h[g]);
if(f&&f.toElement)f=f.toElement();if(Object.isElement(f))return e.update().insert(f);f=Object.toHTML(f);h=e.tagName.toUpperCase();if(h==="SCRIPT"&&d){e.text=f;return e}if(b||c)if(h in Element._insertionTranslations.tags){for(;e.firstChild;)e.removeChild(e.firstChild);Element._getContentFromAnonymousElement(h,f.stripScripts()).each(function(i){e.appendChild(i)})}else e.innerHTML=f.stripScripts();else e.innerHTML=f.stripScripts();f.evalScripts.bind(f).defer();return e}}(),replace:function(b,c){b=$(b);
if(c&&c.toElement)c=c.toElement();else if(!Object.isElement(c)){c=Object.toHTML(c);var d=b.ownerDocument.createRange();d.selectNode(b);c.evalScripts.bind(c).defer();c=d.createContextualFragment(c.stripScripts())}b.parentNode.replaceChild(c,b);return b},insert:function(b,c){b=$(b);if(Object.isString(c)||Object.isNumber(c)||Object.isElement(c)||c&&(c.toElement||c.toHTML))c={bottom:c};var d,e,f,h;for(h in c){d=c[h];h=h.toLowerCase();e=Element._insertionTranslations[h];if(d&&d.toElement)d=d.toElement();
if(Object.isElement(d))e(b,d);else{d=Object.toHTML(d);f=(h=="before"||h=="after"?b.parentNode:b).tagName.toUpperCase();f=Element._getContentFromAnonymousElement(f,d.stripScripts());if(h=="top"||h=="after")f.reverse();f.each(e.curry(b));d.evalScripts.bind(d).defer()}}return b},wrap:function(b,c,d){b=$(b);if(Object.isElement(c))$(c).writeAttribute(d||{});else c=Object.isString(c)?new Element(c,d):new Element("div",c);b.parentNode&&b.parentNode.replaceChild(c,b);c.appendChild(b);return c},inspect:function(b){b=
$(b);var c="<"+b.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(d){var e=d.first();d=d.last();if(e=(b[e]||"").toString())c+=" "+d+"="+e.inspect(true)});return c+">"},recursivelyCollect:function(b,c,d){b=$(b);d=d||-1;for(var e=[];b=b[c];){b.nodeType==1&&e.push(Element.extend(b));if(e.length==d)break}return e},ancestors:function(b){return Element.recursivelyCollect(b,"parentNode")},descendants:function(b){return Element.select(b,"*")},firstDescendant:function(b){for(b=$(b).firstChild;b&&
b.nodeType!=1;)b=b.nextSibling;return $(b)},immediateDescendants:function(b){var c=[];for(b=$(b).firstChild;b;){b.nodeType===1&&c.push(Element.extend(b));b=b.nextSibling}return c},previousSiblings:function(b){return Element.recursivelyCollect(b,"previousSibling")},nextSiblings:function(b){return Element.recursivelyCollect(b,"nextSibling")},siblings:function(b){b=$(b);return Element.previousSiblings(b).reverse().concat(Element.nextSiblings(b))},match:function(b,c){b=$(b);if(Object.isString(c))return Prototype.Selector.match(b,
c);return c.match(b)},up:function(b,c,d){b=$(b);if(arguments.length==1)return $(b.parentNode);var e=Element.ancestors(b);return Object.isNumber(c)?e[c]:Prototype.Selector.find(e,c,d)},down:function(b,c,d){b=$(b);if(arguments.length==1)return Element.firstDescendant(b);return Object.isNumber(c)?Element.descendants(b)[c]:Element.select(b,c)[d||0]},previous:function(b,c,d){b=$(b);if(Object.isNumber(c)){d=c;c=false}Object.isNumber(d)||(d=0);return c?Prototype.Selector.find(b.previousSiblings(),c,d):b.recursivelyCollect("previousSibling",
d+1)[d]},next:function(b,c,d){b=$(b);if(Object.isNumber(c)){d=c;c=false}Object.isNumber(d)||(d=0);if(c)return Prototype.Selector.find(b.nextSiblings(),c,d);else{Object.isNumber(d);return b.recursivelyCollect("nextSibling",d+1)[d]}},select:function(b){b=$(b);var c=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(c,b)},adjacent:function(b){b=$(b);var c=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(c,b.parentNode).without(b)},identify:function(b){b=
$(b);var c=Element.readAttribute(b,"id");if(c)return c;do c="anonymous_element_"+Element.idCounter++;while($(c));Element.writeAttribute(b,"id",c);return c},readAttribute:function(b,c){b=$(b);if(Prototype.Browser.IE){var d=Element._attributeTranslations.read;if(d.values[c])return d.values[c](b,c);if(d.names[c])c=d.names[c];if(c.include(":"))return!b.attributes||!b.attributes[c]?null:b.attributes[c].value}return b.getAttribute(c)},writeAttribute:function(b,c,d){b=$(b);var e={},f=Element._attributeTranslations.write;
if(typeof c=="object")e=c;else e[c]=Object.isUndefined(d)?true:d;for(var h in e){c=f.names[h]||h;d=e[h];if(f.values[h])c=f.values[h](b,d);if(d===false||d===null)b.removeAttribute(c);else d===true?b.setAttribute(c,c):b.setAttribute(c,d)}return b},getHeight:function(b){return Element.getDimensions(b).height},getWidth:function(b){return Element.getDimensions(b).width},classNames:function(b){return new Element.ClassNames(b)},hasClassName:function(b,c){if(b=$(b)){var d=b.className;return d.length>0&&(d==
c||RegExp("(^|\\s)"+c+"(\\s|$)").test(d))}},addClassName:function(b,c){if(b=$(b)){Element.hasClassName(b,c)||(b.className+=(b.className?" ":"")+c);return b}},removeClassName:function(b,c){if(b=$(b)){b.className=b.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ").strip();return b}},toggleClassName:function(b,c){if(b=$(b))return Element[Element.hasClassName(b,c)?"removeClassName":"addClassName"](b,c)},cleanWhitespace:function(b){b=$(b);for(var c=b.firstChild;c;){var d=c.nextSibling;c.nodeType==
3&&!/\S/.test(c.nodeValue)&&b.removeChild(c);c=d}return b},empty:function(b){return $(b).innerHTML.blank()},descendantOf:function(b,c){b=$(b);c=$(c);if(b.compareDocumentPosition)return(b.compareDocumentPosition(c)&8)===8;if(c.contains)return c.contains(b)&&c!==b;for(;b=b.parentNode;)if(b==c)return true;return false},scrollTo:function(b){b=$(b);var c=Element.cumulativeOffset(b);window.scrollTo(c[0],c[1]);return b},getStyle:function(b,c){b=$(b);c=c=="float"?"cssFloat":c.camelize();var d=b.style[c];
if(!d||d=="auto")d=(d=document.defaultView.getComputedStyle(b,null))?d[c]:null;if(c=="opacity")return d?parseFloat(d):1;return d=="auto"?null:d},getOpacity:function(b){return $(b).getStyle("opacity")},setStyle:function(b,c){b=$(b);var d=b.style;if(Object.isString(c)){b.style.cssText+=";"+c;return c.include("opacity")?b.setOpacity(c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var e in c)if(e=="opacity")b.setOpacity(c[e]);else d[e=="float"||e=="cssFloat"?Object.isUndefined(d.styleFloat)?"cssFloat":"styleFloat":
e]=c[e];return b},setOpacity:function(b,c){b=$(b);b.style.opacity=c==1||c===""?"":c<1.0E-5?0:c;return b},makePositioned:function(b){b=$(b);var c=Element.getStyle(b,"position");if(c=="static"||!c){b._madePositioned=true;b.style.position="relative";if(Prototype.Browser.Opera){b.style.top=0;b.style.left=0}}return b},undoPositioned:function(b){b=$(b);if(b._madePositioned){b._madePositioned=undefined;b.style.position=b.style.top=b.style.left=b.style.bottom=b.style.right=""}return b},makeClipping:function(b){b=
$(b);if(b._overflow)return b;b._overflow=Element.getStyle(b,"overflow")||"auto";if(b._overflow!=="hidden")b.style.overflow="hidden";return b},undoClipping:function(b){b=$(b);if(!b._overflow)return b;b.style.overflow=b._overflow=="auto"?"":b._overflow;b._overflow=null;return b},cumulativeOffset:function(b){var c=0,d=0;if(b.parentNode){do{c+=b.offsetTop||0;d+=b.offsetLeft||0;b=b.offsetParent}while(b)}return Element._returnOffset(d,c)},positionedOffset:function(b){var c=0,d=0;do{c+=b.offsetTop||0;d+=
b.offsetLeft||0;if(b=b.offsetParent){if(b.tagName.toUpperCase()=="BODY")break;if(Element.getStyle(b,"position")!=="static")break}}while(b);return Element._returnOffset(d,c)},absolutize:function(b){b=$(b);if(Element.getStyle(b,"position")=="absolute")return b;var c=Element.positionedOffset(b),d=c[1];c=c[0];var e=b.clientWidth,f=b.clientHeight;b._originalLeft=c-parseFloat(b.style.left||0);b._originalTop=d-parseFloat(b.style.top||0);b._originalWidth=b.style.width;b._originalHeight=b.style.height;b.style.position=
"absolute";b.style.top=d+"px";b.style.left=c+"px";b.style.width=e+"px";b.style.height=f+"px";return b},relativize:function(b){b=$(b);if(Element.getStyle(b,"position")=="relative")return b;b.style.position="relative";var c=parseFloat(b.style.top||0)-(b._originalTop||0),d=parseFloat(b.style.left||0)-(b._originalLeft||0);b.style.top=c+"px";b.style.left=d+"px";b.style.height=b._originalHeight;b.style.width=b._originalWidth;return b},cumulativeScrollOffset:function(b){var c=0,d=0;do{c+=b.scrollTop||0;
d+=b.scrollLeft||0;b=b.parentNode}while(b);return Element._returnOffset(d,c)},getOffsetParent:function(b){if(b.offsetParent)return $(b.offsetParent);if(b==document.body)return $(b);for(;(b=b.parentNode)&&b!=document.body;)if(Element.getStyle(b,"position")!="static")return $(b);return $(document.body)},viewportOffset:function(b){var c=0,d=0,e=b;do{c+=e.offsetTop||0;d+=e.offsetLeft||0;if(e.offsetParent==document.body&&Element.getStyle(e,"position")=="absolute")break}while(e=e.offsetParent);e=b;do if(!Prototype.Browser.Opera||
e.tagName&&e.tagName.toUpperCase()=="BODY"){c-=e.scrollTop||0;d-=e.scrollLeft||0}while(e=e.parentNode);return Element._returnOffset(d,c)},clonePosition:function(b,c,d){d=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},d||{});c=$(c);var e=Element.viewportOffset(c),f=[0,0],h=null;b=$(b);if(Element.getStyle(b,"position")=="absolute"){h=Element.getOffsetParent(b);f=Element.viewportOffset(h)}if(h==document.body){f[0]-=document.body.offsetLeft;f[1]-=document.body.offsetTop}if(d.setLeft)b.style.left=
e[0]-f[0]+d.offsetLeft+"px";if(d.setTop)b.style.top=e[1]-f[1]+d.offsetTop+"px";if(d.setWidth)b.style.width=c.offsetWidth+"px";if(d.setHeight)b.style.height=c.offsetHeight+"px";return b}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(b,c,d){switch(d){case "left":case "top":case "right":case "bottom":if(b(c,"position")==="static")return null;case "height":case "width":if(!Element.visible(c))return null;var e=parseInt(b(c,d),10);if(e!==c["offset"+d.capitalize()])return e+"px";return(d==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(e,
function(f,h){var g=b(c,h);return g===null?f:f-parseInt(g,10)})+"px";default:return b(c,d)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(b,c,d){if(d==="title")return c.title;return b(c,d)})}else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(b,c){c=$(c);if(!c.parentNode)return $(document.body);var d=c.getStyle("position");if(d!=="static")return b(c);c.setStyle({position:"relative"});var e=b(c);c.setStyle({position:d});
return e});$w("positionedOffset viewportOffset").each(function(b){Element.Methods[b]=Element.Methods[b].wrap(function(c,d){d=$(d);if(!d.parentNode)return Element._returnOffset(0,0);var e=d.getStyle("position");if(e!=="static")return c(d);var f=d.getOffsetParent();f&&f.getStyle("position")==="fixed"&&f.setStyle({zoom:1});d.setStyle({position:"relative"});f=c(d);d.setStyle({position:e});return f})});Element.Methods.getStyle=function(b,c){b=$(b);c=c=="float"||c=="cssFloat"?"styleFloat":c.camelize();
var d=b.style[c];if(!d&&b.currentStyle)d=b.currentStyle[c];if(c=="opacity"){if(d=(b.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))if(d[1])return parseFloat(d[1])/100;return 1}if(d=="auto"){if((c=="width"||c=="height")&&b.getStyle("display")!="none")return b["offset"+c.capitalize()]+"px";return null}return d};Element.Methods.setOpacity=function(b,c){b=$(b);var d=b.currentStyle;if(d&&!d.hasLayout||!d&&b.style.zoom=="normal")b.style.zoom=1;d=b.getStyle("filter");var e=b.style;if(c==1||c===""){(d=
d.replace(/alpha\([^\)]*\)/gi,""))?e.filter=d:e.removeAttribute("filter");return b}else if(c<1.0E-5)c=0;e.filter=d.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+c*100+")";return b};Element._attributeTranslations=function(){var b="className",c="for",d=document.createElement("div");d.setAttribute(b,"x");if(d.className!=="x"){d.setAttribute("class","x");if(d.className==="x")b="class"}d=null;d=document.createElement("label");d.setAttribute(c,"x");if(d.htmlFor!=="x"){d.setAttribute("htmlFor","x");if(d.htmlFor===
"x")c="htmlFor"}d=null;return{read:{names:{"class":b,className:b,"for":c,htmlFor:c},values:{_getAttr:function(e,f){return e.getAttribute(f)},_getAttr2:function(e,f){return e.getAttribute(f,2)},_getAttrNode:function(e,f){var h=e.getAttributeNode(f);return h?h.value:""},_getEv:function(){var e=document.createElement("div"),f;e.onclick=Prototype.emptyFunction;e=e.getAttribute("onclick");if(String(e).indexOf("{")>-1)f=function(h,g){g=h.getAttribute(g);if(!g)return null;g=g.toString();g=g.split("{")[1];
g=g.split("}")[0];return g.strip()};else if(e==="")f=function(h,g){g=h.getAttribute(g);if(!g)return null;return g.strip()};e=null;return f}(),_flag:function(e,f){return $(e).hasAttribute(f)?f:null},style:function(e){return e.style.cssText.toLowerCase()},title:function(e){return e.title}}}}}();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(b,c){b.checked=!!c},style:function(b,
c){b.style.cssText=c?c:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(b){Element._attributeTranslations.write.names[b.toLowerCase()]=b;Element._attributeTranslations.has[b.toLowerCase()]=b});(function(b){Object.extend(b,{href:b._getAttr2,src:b._getAttr2,type:b._getAttr,action:b._getAttrNode,disabled:b._flag,checked:b._flag,readonly:b._flag,multiple:b._flag,onload:b._getEv,onunload:b._getEv,
onclick:b._getEv,ondblclick:b._getEv,onmousedown:b._getEv,onmouseup:b._getEv,onmouseover:b._getEv,onmousemove:b._getEv,onmouseout:b._getEv,onfocus:b._getEv,onblur:b._getEv,onkeypress:b._getEv,onkeydown:b._getEv,onkeyup:b._getEv,onsubmit:b._getEv,onreset:b._getEv,onselect:b._getEv,onchange:b._getEv})})(Element._attributeTranslations.read.values);Prototype.BrowserFeatures.ElementExtensions&&function(){Element.Methods.down=function(b,c,d){b=$(b);if(arguments.length==1)return b.firstDescendant();var e;
if(Object.isNumber(c)){e=b.getElementsByTagName("*");for(var f=[],h=0,g;g=e[h];h++)g.tagName!=="!"&&f.push(g);e=f[c]}else e=Element.select(b,c)[d||0];return e}}()}else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=function(b,c){b=$(b);b.style.opacity=c==1?0.999999:c===""?"":c<1.0E-5?0:c;return b};else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(b,c){b=$(b);b.style.opacity=c==1||c===""?"":c<1.0E-5?0:c;if(c==1)if(b.tagName.toUpperCase()==
"IMG"&&b.width){b.width++;b.width--}else try{var d=document.createTextNode(" ");b.appendChild(d);b.removeChild(d)}catch(e){}return b};Element.Methods.cumulativeOffset=function(b){var c=0,d=0;do{c+=b.offsetTop||0;d+=b.offsetLeft||0;if(b.offsetParent==document.body)if(Element.getStyle(b,"position")=="absolute")break;b=b.offsetParent}while(b);return Element._returnOffset(d,c)}}
if("outerHTML"in document.documentElement)Element.Methods.replace=function(b,c){b=$(b);if(c&&c.toElement)c=c.toElement();if(Object.isElement(c)){b.parentNode.replaceChild(c,b);return b}c=Object.toHTML(c);var d=b.parentNode,e=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[e]){var f=b.next();e=Element._getContentFromAnonymousElement(e,c.stripScripts());d.removeChild(b);f?e.each(function(h){d.insertBefore(h,f)}):e.each(function(h){d.appendChild(h)})}else b.outerHTML=c.stripScripts();
c.evalScripts.bind(c).defer();return b};Element._returnOffset=function(b,c){var d=[b,c];d.left=b;d.top=c;return d};Element._getContentFromAnonymousElement=function(b,c){var d=new Element("div"),e=Element._insertionTranslations.tags[b];if(e){d.innerHTML=e[0]+c+e[1];for(e=e[2];e--;)d=d.firstChild}else d.innerHTML=c;return $A(d.childNodes)};
Element._insertionTranslations={before:function(b,c){b.parentNode.insertBefore(c,b)},top:function(b,c){b.insertBefore(c,b.firstChild)},bottom:function(b,c){b.appendChild(c)},after:function(b,c){b.parentNode.insertBefore(c,b.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var b=Element._insertionTranslations.tags;Object.extend(b,{THEAD:b.TBODY,TFOOT:b.TBODY,TH:b.TD})})();Element.Methods.Simulated={hasAttribute:function(b,c){c=Element._attributeTranslations.has[c]||c;var d=$(b).getAttributeNode(c);return!!(d&&d.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(b){if(!Prototype.BrowserFeatures.ElementExtensions&&b.__proto__){window.HTMLElement={};window.HTMLElement.prototype=b.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}})(document.createElement("div"));
Element.extend=function(){function b(f,h){for(var g in h){var i=h[g];if(Object.isFunction(i)&&!(g in f))f[g]=i.methodize()}}var c=function(f){if(typeof window.Element!="undefined"){var h=window.Element.prototype;if(h){var g="_"+(Math.random()+"").slice(2);f=document.createElement(f);h[g]="x";f=f[g]!=="x";delete h[g];return f}}return false}("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(c)return function(f){if(f&&typeof f._extendedByPrototype=="undefined"){var h=f.tagName;if(h&&
/^(?:object|applet|embed)$/i.test(h)){b(f,Element.Methods);b(f,Element.Methods.Simulated);b(f,Element.Methods.ByTag[h.toUpperCase()])}}return f};return Prototype.K}var d={},e=Element.Methods.ByTag;c=Object.extend(function(f){if(!f||typeof f._extendedByPrototype!="undefined"||f.nodeType!=1||f==window)return f;var h=Object.clone(d),g=f.tagName.toUpperCase();e[g]&&Object.extend(h,e[g]);b(f,h);f._extendedByPrototype=Prototype.emptyFunction;return f},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(d,
Element.Methods);Object.extend(d,Element.Methods.Simulated)}}});c.refresh();return c}();Element.hasAttribute=document.documentElement.hasAttribute?function(b,c){return b.hasAttribute(c)}:Element.Methods.Simulated.hasAttribute;
Element.addMethods=function(b){function c(j){j=j.toUpperCase();Element.Methods.ByTag[j]||(Element.Methods.ByTag[j]={});Object.extend(Element.Methods.ByTag[j],b)}function d(j,k,l){l=l||false;for(var o in j){var q=j[o];if(Object.isFunction(q))if(!l||!(o in k))k[o]=q.methodize()}}function e(j){var k,l={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(l[j])k="HTML"+l[j]+"Element";if(window[k])return window[k];k="HTML"+j+"Element";if(window[k])return window[k];k="HTML"+j.capitalize()+"Element";if(window[k])return window[k];j=document.createElement(j);return j.__proto__||j.constructor.prototype}
var f=Prototype.BrowserFeatures,h=Element.Methods.ByTag;if(!b){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var g=b;b=arguments[1]}if(g)Object.isArray(g)?g.each(c):c(g);else Object.extend(Element.Methods,b||{});g=window.HTMLElement?HTMLElement.prototype:
Element.prototype;if(f.ElementExtensions){d(Element.Methods,g);d(Element.Methods.Simulated,g,true)}if(f.SpecificElementExtensions)for(var i in Element.Methods.ByTag){f=e(i);Object.isUndefined(f)||d(h[i],f.prototype)}Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(b){function c(){if(e.WebKit&&!f.evaluate)return document;if(e.Opera&&window.parseFloat(window.opera.version())<9.5)return document.body;return document.documentElement}function d(i){h||(h=c());g[i]="client"+i;b["get"+i]=function(){return h[g[i]]};return b["get"+i]()}var e=Prototype.Browser,f=document,h,g={};b.getWidth=d.curry("Width");b.getHeight=d.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(b){if(b=$(b)){if(b===window)b=0;else{if(typeof b._prototypeUID==="undefined")b._prototypeUID=Element.Storage.UID++;b=b._prototypeUID}Element.Storage[b]||(Element.Storage[b]=$H());return Element.Storage[b]}},store:function(b,c,d){if(b=$(b)){arguments.length===2?Element.getStorage(b).update(c):Element.getStorage(b).set(c,d);return b}},retrieve:function(b,c,d){if(b=$(b)){b=Element.getStorage(b);var e=b.get(c);if(Object.isUndefined(e)){b.set(c,d);e=d}return e}},
clone:function(b,c){if(b=$(b)){var d=b.cloneNode(c);d._prototypeUID=void 0;if(c)for(var e=Element.select(d,"*"),f=e.length;f--;)e[f]._prototypeUID=void 0;return Element.extend(d)}},purge:function(b){if(b=$(b)){purgeElement(b);b=b.getElementsByTagName("*");for(var c=b.length;c--;)purgeElement(b[c]);return null}}});
(function(){function b(g,i){if(Object.isElement(g)){element=g;g=element.getStyle(i)}if(g===null)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(g))return window.parseFloat(g);if(/\d/.test(g)&&element.runtimeStyle){var j=element.style.left,k=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=g||0;g=element.style.pixelLeft;element.style.left=j;element.runtimeStyle.left=k;return g}if(g.include("%")){k=(k=g.match(/^(\d+)%?$/i))?Number(k[1])/100:null;if(i.include("left")||
i.include("right")||i.include("width"))j=$(element.parentNode).measure("width");else if(i.include("top")||i.include("bottom")||i.include("height"))j=$(element.parentNode).measure("height");return j*k}return 0}function c(g){if(f(g))return $(document.body);if(Element.getStyle(g,"display")!=="inline"&&g.offsetParent)return $(g.offsetParent);if(g===document.body)return $(g);for(;(g=g.parentNode)&&g!==document.body;)if(Element.getStyle(g,"position")!=="static")return g.nodeName==="HTML"?$(document.body):
$(g);return $(document.body)}function d(g){var i=g.getLayout(),j=0,k=0;do{j+=g.offsetTop||0;k+=g.offsetLeft||0;if(g=g.offsetParent){if(g.nodeName.toUpperCase()==="BODY")break;if(Element.getStyle(g,"position")!=="static")break}}while(g);k-=i.get("margin-top");j-=i.get("margin-left");return new Element.Offset(k,j)}function e(g){var i=0,j=0,k=document.body,l=g;do{i+=l.offsetTop||0;j+=l.offsetLeft||0;if(l.offsetParent==k&&Element.getStyle(l,"position")=="absolute")break}while(l=l.offsetParent);l=g;do if(l!=
k){i-=l.scrollTop||0;j-=l.scrollLeft||0}while(l=l.parentNode);return new Element.Offset(j,i)}function f(g){return g!==document.body&&!Element.descendantOf(g,document.body)}var h=Prototype.K;if("currentStyle"in document.documentElement)h=function(g){if(!g.currentStyle.hasLayout)g.style.zoom=1;return g};Element.Layout=Class.create(Hash,{initialize:function($super,i,j){$super();this.element=$(i);Element.Layout.PROPERTIES.each(function(k){this._set(k,null)},this);if(j){this._preComputing=true;this._begin();
Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(g,i){return Hash.prototype.set.call(this,g,i)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,i){var j=$super(i);return j===null?this._compute(i):j},_begin:function(){if(!this._prepared){var g=this.element,i;a:{for(i=g;i&&i.parentNode;){if(i.getStyle("display")==="none"){i=false;break a}i=$(i.parentNode)}i=true}if(!i){g.store("prototype_original_styles",
{position:g.style.position||"",width:g.style.width||"",visibility:g.style.visibility||"",display:g.style.display||""});i=g.getStyle("position");var j=g.getStyle("width");g.setStyle({position:"absolute",visibility:"hidden",display:"block"});var k=g.getStyle("width");i=j&&k===j?b(j):j&&(i==="absolute"||i==="fixed")?b(j):$(g.parentNode).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");
g.setStyle({width:i+"px"})}this._prepared=true}},_end:function(){var g=this.element,i=g.retrieve("prototype_original_styles");g.store("prototype_original_styles",null);g.setStyle(i);this._prepared=false},_compute:function(g){var i=Element.Layout.COMPUTATIONS;if(!(g in i))throw"Property not found.";return this._set(g,i[g].call(this,this.element))},toObject:function(){var g=$A(arguments),i={};(g.length===0?Element.Layout.PROPERTIES:g.join(" ").split(" ")).each(function(j){if(Element.Layout.PROPERTIES.include(j)){var k=
this.get(j);if(k!=null)i[j]=k}},this);return i},toHash:function(){var g=this.toObject.apply(this,arguments);return new Hash(g)},toCSS:function(){var g=$A(arguments),i={};(g.length===0?Element.Layout.PROPERTIES:g.join(" ").split(" ")).each(function(j){if(Element.Layout.PROPERTIES.include(j))if(!Element.Layout.COMPOSITE_PROPERTIES.include(j)){var k=this.get(j);if(k!=null){j=j;if(j.include("border"))j+="-width";j=j.camelize();i[j]=k+"px"}}},this);return i},inspect:function(){return"#<Element.Layout>"}});
Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(){this._preComputing||
this._begin();var g=this.get("border-box-height");if(g<=0)return 0;var i=this.get("border-top"),j=this.get("border-bottom"),k=this.get("padding-top"),l=this.get("padding-bottom");this._preComputing||this._end();return g-i-j-k-l},width:function(){this._preComputing||this._begin();var g=this.get("border-box-width");if(g<=0)return 0;var i=this.get("border-left"),j=this.get("border-right"),k=this.get("padding-left"),l=this.get("padding-right");this._preComputing||this._end();return g-i-j-k-l},"padding-box-height":function(){var g=
this.get("height"),i=this.get("padding-top"),j=this.get("padding-bottom");return g+i+j},"padding-box-width":function(){var g=this.get("width"),i=this.get("padding-left"),j=this.get("padding-right");return g+i+j},"border-box-height":function(g){return g.offsetHeight},"border-box-width":function(g){return g.offsetWidth},"margin-box-height":function(){var g=this.get("border-box-height"),i=this.get("margin-top"),j=this.get("margin-bottom");if(g<=0)return 0;return g+i+j},"margin-box-width":function(){var g=
this.get("border-box-width"),i=this.get("margin-left"),j=this.get("margin-right");if(g<=0)return 0;return g+i+j},top:function(g){return g.positionedOffset().top},bottom:function(g){var i=g.positionedOffset();g=g.getOffsetParent().measure("height");var j=this.get("border-box-height");return g-j-i.top},left:function(g){return g.positionedOffset().left},right:function(g){var i=g.positionedOffset();g=g.getOffsetParent().measure("width");var j=this.get("border-box-width");return g-j-i.left},"padding-top":function(g){return b(g,
"paddingTop")},"padding-bottom":function(g){return b(g,"paddingBottom")},"padding-left":function(g){return b(g,"paddingLeft")},"padding-right":function(g){return b(g,"paddingRight")},"border-top":function(g){return Object.isNumber(g.clientTop)?g.clientTop:b(g,"borderTopWidth")},"border-bottom":function(g){return Object.isNumber(g.clientBottom)?g.clientBottom:b(g,"borderBottomWidth")},"border-left":function(g){return Object.isNumber(g.clientLeft)?g.clientLeft:b(g,"borderLeftWidth")},"border-right":function(g){return Object.isNumber(g.clientRight)?
g.clientRight:b(g,"borderRightWidth")},"margin-top":function(g){return b(g,"marginTop")},"margin-bottom":function(g){return b(g,"marginBottom")},"margin-left":function(g){return b(g,"marginLeft")},"margin-right":function(g){return b(g,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(g){var i=h(g.getOffsetParent());g=g.getBoundingClientRect();return(i.getBoundingClientRect().right-g.right).round()},bottom:function(g){var i=
h(g.getOffsetParent());g=g.getBoundingClientRect();return(i.getBoundingClientRect().bottom-g.bottom).round()}});Element.Offset=Class.create({initialize:function(g,i){this.left=g.round();this.top=i.round();this[0]=this.left;this[1]=this.top},relativeTo:function(g){return new Element.Offset(this.left-g.left,this.top-g.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,
this.top]}});Element.addMethods({getLayout:function(g,i){return new Element.Layout(g,i)},measure:function(g,i){return $(g).getLayout().get(i)},getDimensions:function(g){g=$(g).getLayout();return{width:g.get("width"),height:g.get("height")}},getOffsetParent:c,cumulativeOffset:function(g){var i=0,j=0;do{i+=g.offsetTop||0;j+=g.offsetLeft||0;g=g.offsetParent}while(g);return new Element.Offset(j,i)},positionedOffset:d,cumulativeScrollOffset:function(g){var i=0,j=0;do{i+=g.scrollTop||0;j+=g.scrollLeft||
0;g=g.parentNode}while(g);return new Element.Offset(j,i)},viewportOffset:e,absolutize:function(g){g=$(g);if(Element.getStyle(g,"position")==="absolute")return g;var i=c(g),j=g.viewportOffset();i=i.viewportOffset();j=j.relativeTo(i);i=g.getLayout();g.store("prototype_absolutize_original_styles",{left:g.getStyle("left"),top:g.getStyle("top"),width:g.getStyle("width"),height:g.getStyle("height")});g.setStyle({position:"absolute",top:j.top+"px",left:j.left+"px",width:i.get("width")+"px",height:i.get("height")+
"px"});return g},relativize:function(g){g=$(g);if(Element.getStyle(g,"position")==="relative")return g;var i=g.retrieve("prototype_absolutize_original_styles");i&&g.setStyle(i);return g}});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(g){g=$(g);if(f(g))return new Element.Offset(0,0);g=g.getBoundingClientRect();var i=document.documentElement;return new Element.Offset(g.left-i.clientLeft,g.top-i.clientTop)},positionedOffset:function(g){g=$(g);var i=
g.getOffsetParent();if(f(g))return new Element.Offset(0,0);if(g.offsetParent&&g.offsetParent.nodeName.toUpperCase()==="HTML")return d(g);var j=g.viewportOffset();i=i.nodeName.toUpperCase()==="BODY"?e(i):i.viewportOffset();j=j.relativeTo(i);i=g.getLayout();g=j.top-i.get("margin-top");j=j.left-i.get("margin-left");return new Element.Offset(j,g)}})})();window.$$=function(){var b=$A(arguments).join(", ");return Prototype.Selector.select(b,document)};
Prototype.Selector=function(){function b(d){for(var e=0,f=d.length;e<f;e++)Element.extend(d[e]);return d}var c=Prototype.K;return{select:function(){throw Error('Method "Prototype.Selector.select" must be defined.');},match:function(){throw Error('Method "Prototype.Selector.match" must be defined.');},find:function(d,e,f){f=f||0;var h=Prototype.Selector.match,g=d.length,i=0,j;for(j=0;j<g;j++)if(h(d[j],e)&&f==i++)return Element.extend(d[j])},extendElements:Element.extend===c?c:b,extendElement:Element.extend}}();
Prototype._original_property=window.Sizzle;
(function(){function b(n,m,r,p,s,u){s=n=="previousSibling"&&!u;for(var v=0,y=p.length;v<y;v++){var x=p[v];if(x){if(s&&x.nodeType===1){x.sizcache=r;x.sizset=v}x=x[n];for(var B=false;x;){if(x.sizcache===r){B=p[x.sizset];break}if(x.nodeType===1&&!u){x.sizcache=r;x.sizset=v}if(x.nodeName===m){B=x;break}x=x[n]}p[v]=B}}}function c(n,m,r,p,s,u){s=n=="previousSibling"&&!u;for(var v=0,y=p.length;v<y;v++){var x=p[v];if(x){if(s&&x.nodeType===1){x.sizcache=r;x.sizset=v}x=x[n];for(var B=false;x;){if(x.sizcache===
r){B=p[x.sizset];break}if(x.nodeType===1){if(!u){x.sizcache=r;x.sizset=v}if(typeof m!=="string"){if(x===m){B=true;break}}else if(i.filter(m,[x]).length>0){B=x;break}}x=x[n]}p[v]=B}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,f=Object.prototype.toString,h=false,g=true;[0,0].sort(function(){g=false;return 0});var i=function(n,m,r,p){r=r||[];var s=m=m||document;if(m.nodeType!==1&&m.nodeType!==9)return[];
if(!n||typeof n!=="string")return r;for(var u=[],v,y,x,B,C=true,E=z(m),F=n;(d.exec(""),v=d.exec(F))!==null;){F=v[3];u.push(v[1]);if(v[2]){B=v[3];break}}if(u.length>1&&k.exec(n))if(u.length===2&&j.relative[u[0]])y=A(u[0]+u[1],m);else for(y=j.relative[u[0]]?[m]:i(u.shift(),m);u.length;){n=u.shift();if(j.relative[n])n+=u.shift();y=A(n,y)}else{if(!p&&u.length>1&&m.nodeType===9&&!E&&j.match.ID.test(u[0])&&!j.match.ID.test(u[u.length-1])){v=i.find(u.shift(),m,E);m=v.expr?i.filter(v.expr,v.set)[0]:v.set[0]}if(m){v=
p?{expr:u.pop(),set:o(p)}:i.find(u.pop(),u.length===1&&(u[0]==="~"||u[0]==="+")&&m.parentNode?m.parentNode:m,E);y=v.expr?i.filter(v.expr,v.set):v.set;if(u.length>0)x=o(y);else C=false;for(;u.length;){var D=u.pop();v=D;if(j.relative[D])v=u.pop();else D="";if(v==null)v=m;j.relative[D](x,v,E)}}else x=[]}x||(x=y);if(!x)throw"Syntax error, unrecognized expression: "+(D||n);if(f.call(x)==="[object Array]")if(C)if(m&&m.nodeType===1)for(n=0;x[n]!=null;n++){if(x[n]&&(x[n]===true||x[n].nodeType===1&&w(m,x[n])))r.push(y[n])}else for(n=
0;x[n]!=null;n++)x[n]&&x[n].nodeType===1&&r.push(y[n]);else r.push.apply(r,x);else o(x,r);if(B){i(B,s,r,p);i.uniqueSort(r)}return r};i.uniqueSort=function(n){if(t){h=g;n.sort(t);if(h)for(var m=1;m<n.length;m++)n[m]===n[m-1]&&n.splice(m--,1)}return n};i.matches=function(n,m){return i(n,null,null,m)};i.find=function(n,m,r){var p,s;if(!n)return[];for(var u=0,v=j.order.length;u<v;u++){var y=j.order[u];if(s=j.leftMatch[y].exec(n)){var x=s[1];s.splice(1,1);if(x.substr(x.length-1)!=="\\"){s[1]=(s[1]||"").replace(/\\/g,
"");p=j.find[y](s,m,r);if(p!=null){n=n.replace(j.match[y],"");break}}}}p||(p=m.getElementsByTagName("*"));return{set:p,expr:n}};i.filter=function(n,m,r,p){for(var s=n,u=[],v=m,y,x,B=m&&m[0]&&z(m[0]);n&&m.length;){for(var C in j.filter)if((y=j.match[C].exec(n))!=null){var E=j.filter[C],F,D;x=false;if(v==u)u=[];if(j.preFilter[C])if(y=j.preFilter[C](y,v,r,u,p,B)){if(y===true)continue}else x=F=true;if(y)for(var G=0;(D=v[G])!=null;G++)if(D){F=E(D,y,G,v);var H=p^!!F;if(r&&F!=null)if(H)x=true;else v[G]=
false;else if(H){u.push(D);x=true}}if(F!==undefined){r||(v=u);n=n.replace(j.match[C],"");if(!x)return[];break}}if(n==s)if(x==null)throw"Syntax error, unrecognized expression: "+n;else break;s=n}return v};var j=i.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,
CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(n){return n.getAttribute("href")}},relative:{"+":function(n,m,r){var p=typeof m==="string",s=p&&!/\W/.test(m);p=p&&!s;if(s&&!r)m=m.toUpperCase();r=0;s=n.length;for(var u;r<s;r++)if(u=n[r]){for(;(u=u.previousSibling)&&
u.nodeType!==1;);n[r]=p||u&&u.nodeName===m?u||false:u===m}p&&i.filter(m,n,true)},">":function(n,m,r){var p=typeof m==="string";if(p&&!/\W/.test(m)){m=r?m:m.toUpperCase();r=0;for(var s=n.length;r<s;r++){var u=n[r];if(u){p=u.parentNode;n[r]=p.nodeName===m?p:false}}}else{r=0;for(s=n.length;r<s;r++)if(u=n[r])n[r]=p?u.parentNode:u.parentNode===m;p&&i.filter(m,n,true)}},"":function(n,m,r){var p=e++,s=c;if(!/\W/.test(m)){var u=m=r?m:m.toUpperCase();s=b}s("parentNode",m,p,n,u,r)},"~":function(n,m,r){var p=
e++,s=c;if(typeof m==="string"&&!/\W/.test(m)){var u=m=r?m:m.toUpperCase();s=b}s("previousSibling",m,p,n,u,r)}},find:{ID:function(n,m,r){if(typeof m.getElementById!=="undefined"&&!r)return(n=m.getElementById(n[1]))?[n]:[]},NAME:function(n,m){if(typeof m.getElementsByName!=="undefined"){for(var r=[],p=m.getElementsByName(n[1]),s=0,u=p.length;s<u;s++)p[s].getAttribute("name")===n[1]&&r.push(p[s]);return r.length===0?null:r}},TAG:function(n,m){return m.getElementsByTagName(n[1])}},preFilter:{CLASS:function(n,
m,r,p,s,u){n=" "+n[1].replace(/\\/g,"")+" ";if(u)return n;u=0;for(var v;(v=m[u])!=null;u++)if(v)if(s^(v.className&&(" "+v.className+" ").indexOf(n)>=0))r||p.push(v);else if(r)m[u]=false;return false},ID:function(n){return n[1].replace(/\\/g,"")},TAG:function(n,m){for(var r=0;m[r]===false;r++);return m[r]&&z(m[r])?n[1]:n[1].toUpperCase()},CHILD:function(n){if(n[1]=="nth"){var m=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(n[2]=="even"&&"2n"||n[2]=="odd"&&"2n+1"||!/\D/.test(n[2])&&"0n+"+n[2]||n[2]);n[2]=m[1]+(m[2]||
1)-0;n[3]=m[3]-0}n[0]=e++;return n},ATTR:function(n,m,r,p,s,u){m=n[1].replace(/\\/g,"");if(!u&&j.attrMap[m])n[1]=j.attrMap[m];if(n[2]==="~=")n[4]=" "+n[4]+" ";return n},PSEUDO:function(n,m,r,p,s){if(n[1]==="not")if((d.exec(n[3])||"").length>1||/^\w/.test(n[3]))n[3]=i(n[3],null,null,m);else{n=i.filter(n[3],m,r,true^s);r||p.push.apply(p,n);return false}else if(j.match.POS.test(n[0])||j.match.CHILD.test(n[0]))return true;return n},POS:function(n){n.unshift(true);return n}},filters:{enabled:function(n){return n.disabled===
false&&n.type!=="hidden"},disabled:function(n){return n.disabled===true},checked:function(n){return n.checked===true},selected:function(n){return n.selected===true},parent:function(n){return!!n.firstChild},empty:function(n){return!n.firstChild},has:function(n,m,r){return!!i(r[3],n).length},header:function(n){return/h\d/i.test(n.nodeName)},text:function(n){return"text"===n.type},radio:function(n){return"radio"===n.type},checkbox:function(n){return"checkbox"===n.type},file:function(n){return"file"===
n.type},password:function(n){return"password"===n.type},submit:function(n){return"submit"===n.type},image:function(n){return"image"===n.type},reset:function(n){return"reset"===n.type},button:function(n){return"button"===n.type||n.nodeName.toUpperCase()==="BUTTON"},input:function(n){return/input|select|textarea|button/i.test(n.nodeName)}},setFilters:{first:function(n,m){return m===0},last:function(n,m,r,p){return m===p.length-1},even:function(n,m){return m%2===0},odd:function(n,m){return m%2===1},
lt:function(n,m,r){return m<r[3]-0},gt:function(n,m,r){return m>r[3]-0},nth:function(n,m,r){return r[3]-0==m},eq:function(n,m,r){return r[3]-0==m}},filter:{PSEUDO:function(n,m,r,p){var s=m[1],u=j.filters[s];if(u)return u(n,r,m,p);else if(s==="contains")return(n.textContent||n.innerText||"").indexOf(m[3])>=0;else if(s==="not"){m=m[3];r=0;for(p=m.length;r<p;r++)if(m[r]===n)return false;return true}},CHILD:function(n,m){var r=m[1],p=n;switch(r){case "only":case "first":for(;p=p.previousSibling;)if(p.nodeType===
1)return false;if(r=="first")return true;p=n;case "last":for(;p=p.nextSibling;)if(p.nodeType===1)return false;return true;case "nth":r=m[2];var s=m[3];if(r==1&&s==0)return true;var u=m[0],v=n.parentNode;if(v&&(v.sizcache!==u||!n.nodeIndex)){var y=0;for(p=v.firstChild;p;p=p.nextSibling)if(p.nodeType===1)p.nodeIndex=++y;v.sizcache=u}p=n.nodeIndex-s;return r==0?p==0:p%r==0&&p/r>=0}},ID:function(n,m){return n.nodeType===1&&n.getAttribute("id")===m},TAG:function(n,m){return m==="*"&&n.nodeType===1||n.nodeName===
m},CLASS:function(n,m){return(" "+(n.className||n.getAttribute("class"))+" ").indexOf(m)>-1},ATTR:function(n,m){var r=m[1];r=j.attrHandle[r]?j.attrHandle[r](n):n[r]!=null?n[r]:n.getAttribute(r);var p=r+"",s=m[2],u=m[4];return r==null?s==="!=":s==="="?p===u:s==="*="?p.indexOf(u)>=0:s==="~="?(" "+p+" ").indexOf(u)>=0:!u?p&&r!==false:s==="!="?p!=u:s==="^="?p.indexOf(u)===0:s==="$="?p.substr(p.length-u.length)===u:s==="|="?p===u||p.substr(0,u.length+1)===u+"-":false},POS:function(n,m,r,p){var s=j.setFilters[m[2]];
if(s)return s(n,r,m,p)}}},k=j.match.POS,l;for(l in j.match){j.match[l]=RegExp(j.match[l].source+/(?![^\[]*\])(?![^\(]*\))/.source);j.leftMatch[l]=RegExp(/(^(?:.|\r|\n)*?)/.source+j.match[l].source)}var o=function(n,m){n=Array.prototype.slice.call(n,0);if(m){m.push.apply(m,n);return m}return n};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(q){o=function(n,m){var r=m||[];if(f.call(n)==="[object Array]")Array.prototype.push.apply(r,n);else if(typeof n.length==="number")for(var p=
0,s=n.length;p<s;p++)r.push(n[p]);else for(p=0;n[p];p++)r.push(n[p]);return r}}var t;if(document.documentElement.compareDocumentPosition)t=function(n,m){if(!n.compareDocumentPosition||!m.compareDocumentPosition){if(n==m)h=true;return 0}var r=n.compareDocumentPosition(m)&4?-1:n===m?0:1;if(r===0)h=true;return r};else if("sourceIndex"in document.documentElement)t=function(n,m){if(!n.sourceIndex||!m.sourceIndex){if(n==m)h=true;return 0}var r=n.sourceIndex-m.sourceIndex;if(r===0)h=true;return r};else if(document.createRange)t=
function(n,m){if(!n.ownerDocument||!m.ownerDocument){if(n==m)h=true;return 0}var r=n.ownerDocument.createRange(),p=m.ownerDocument.createRange();r.setStart(n,0);r.setEnd(n,0);p.setStart(m,0);p.setEnd(m,0);r=r.compareBoundaryPoints(Range.START_TO_END,p);if(r===0)h=true;return r};(function(){var n=document.createElement("div"),m="script"+(new Date).getTime();n.innerHTML="<a name='"+m+"'/>";var r=document.documentElement;r.insertBefore(n,r.firstChild);if(document.getElementById(m)){j.find.ID=function(p,
s,u){if(typeof s.getElementById!=="undefined"&&!u)return(s=s.getElementById(p[1]))?s.id===p[1]||typeof s.getAttributeNode!=="undefined"&&s.getAttributeNode("id").nodeValue===p[1]?[s]:undefined:[]};j.filter.ID=function(p,s){var u=typeof p.getAttributeNode!=="undefined"&&p.getAttributeNode("id");return p.nodeType===1&&u&&u.nodeValue===s}}r.removeChild(n);r=n=null})();(function(){var n=document.createElement("div");n.appendChild(document.createComment(""));if(n.getElementsByTagName("*").length>0)j.find.TAG=
function(m,r){var p=r.getElementsByTagName(m[1]);if(m[1]==="*"){for(var s=[],u=0;p[u];u++)p[u].nodeType===1&&s.push(p[u]);p=s}return p};n.innerHTML="<a href='#'></a>";if(n.firstChild&&typeof n.firstChild.getAttribute!=="undefined"&&n.firstChild.getAttribute("href")!=="#")j.attrHandle.href=function(m){return m.getAttribute("href",2)};n=null})();document.querySelectorAll&&function(){var n=i,m=document.createElement("div");m.innerHTML="<p class='TEST'></p>";if(!(m.querySelectorAll&&m.querySelectorAll(".TEST").length===
0)){i=function(p,s,u,v){s=s||document;if(!v&&s.nodeType===9&&!z(s))try{return o(s.querySelectorAll(p),u)}catch(y){}return n(p,s,u,v)};for(var r in n)i[r]=n[r];m=null}}();document.getElementsByClassName&&document.documentElement.getElementsByClassName&&function(){var n=document.createElement("div");n.innerHTML="<div class='test e'></div><div class='test'></div>";if(n.getElementsByClassName("e").length!==0){n.lastChild.className="e";if(n.getElementsByClassName("e").length!==1){j.order.splice(1,0,"CLASS");
j.find.CLASS=function(m,r,p){if(typeof r.getElementsByClassName!=="undefined"&&!p)return r.getElementsByClassName(m[1])};n=null}}}();var w=document.compareDocumentPosition?function(n,m){return n.compareDocumentPosition(m)&16}:function(n,m){return n!==m&&(n.contains?n.contains(m):true)},z=function(n){return n.nodeType===9&&n.documentElement.nodeName!=="HTML"||!!n.ownerDocument&&n.ownerDocument.documentElement.nodeName!=="HTML"},A=function(n,m){for(var r=[],p="",s,u=m.nodeType?[m]:m;s=j.match.PSEUDO.exec(n);){p+=
s[0];n=n.replace(j.match.PSEUDO,"")}n=j.relative[n]?n+"*":n;s=0;for(var v=u.length;s<v;s++)i(n,u[s],r);return i.filter(p,r)};window.Sizzle=i})();(function(b){var c=Prototype.Selector.extendElements;Prototype.Selector.engine=b;Prototype.Selector.select=function(d,e){return c(b(d,e||document))};Prototype.Selector.match=function(d,e){return b.matches(e,[d]).length==1}})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(b){b=$(b);b.reset();return b},serializeElements:function(b,c){if(typeof c!="object")c={hash:!!c};else if(Object.isUndefined(c.hash))c.hash=true;var d,e,f=false,h=c.submit,g=b.inject({},function(i,j){if(!j.disabled&&j.name){d=j.name;e=$(j).getValue();if(e!=null&&j.type!="file"&&(j.type!="submit"||!f&&h!==false&&(!h||d==h)&&(f=true)))if(d in i){Object.isArray(i[d])||(i[d]=[i[d]]);i[d].push(e)}else i[d]=e}return i});return c.hash?g:Object.toQueryString(g)}};
Form.Methods={serialize:function(b,c){return Form.serializeElements(Form.getElements(b),c)},getElements:function(b){b=$(b).getElementsByTagName("*");for(var c,d=[],e=Form.Element.Serializers,f=0;c=b[f];f++)d.push(c);return d.inject([],function(h,g){e[g.tagName.toLowerCase()]&&h.push(Element.extend(g));return h})},getInputs:function(b,c,d){b=$(b);b=b.getElementsByTagName("input");if(!c&&!d)return $A(b).map(Element.extend);for(var e=0,f=[],h=b.length;e<h;e++){var g=b[e];c&&g.type!=c||d&&g.name!=d||
f.push(Element.extend(g))}return f},disable:function(b){b=$(b);Form.getElements(b).invoke("disable");return b},enable:function(b){b=$(b);Form.getElements(b).invoke("enable");return b},findFirstElement:function(b){b=$(b).getElements().findAll(function(d){return"hidden"!=d.type&&!d.disabled});var c=b.findAll(function(d){return d.hasAttribute("tabIndex")&&d.tabIndex>=0}).sortBy(function(d){return d.tabIndex}).first();return c?c:b.find(function(d){return/^(?:input|select|textarea)$/i.test(d.tagName)})},
focusFirstElement:function(b){b=$(b);b.findFirstElement().activate();return b},request:function(b,c){b=$(b);c=Object.clone(c||{});var d=c.parameters,e=b.readAttribute("action")||"";if(e.blank())e=window.location.href;c.parameters=b.serialize(true);if(d){if(Object.isString(d))d=d.toQueryParams();Object.extend(c.parameters,d)}if(b.hasAttribute("method")&&!c.method)c.method=b.method;return new Ajax.Request(e,c)}};
Form.Element={focus:function(b){$(b).focus();return b},select:function(b){$(b).select();return b}};
Form.Element.Methods={serialize:function(b){b=$(b);if(!b.disabled&&b.name){var c=b.getValue();if(c!=undefined){var d={};d[b.name]=c;return Object.toQueryString(d)}}return""},getValue:function(b){b=$(b);var c=b.tagName.toLowerCase();return Form.Element.Serializers[c](b)},setValue:function(b,c){b=$(b);var d=b.tagName.toLowerCase();Form.Element.Serializers[d](b,c);return b},clear:function(b){$(b).value="";return b},present:function(b){return $(b).value!=""},activate:function(b){b=$(b);try{b.focus();
if(b.select&&(b.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(b.type)))b.select()}catch(c){}return b},disable:function(b){b=$(b);b.disabled=true;return b},enable:function(b){b=$(b);b.disabled=false;return b}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers={input:function(b,c){switch(b.type.toLowerCase()){case "checkbox":case "radio":return Form.Element.Serializers.inputSelector(b,c);default:return Form.Element.Serializers.textarea(b,c)}},inputSelector:function(b,c){if(Object.isUndefined(c))return b.checked?b.value:null;else b.checked=!!c},textarea:function(b,c){if(Object.isUndefined(c))return b.value;else b.value=c},select:function(b,c){if(Object.isUndefined(c))return this[b.type=="select-one"?"selectOne":"selectMany"](b);
else for(var d,e,f=!Object.isArray(c),h=0,g=b.length;h<g;h++){d=b.options[h];e=this.optionValue(d);if(f){if(e==c){d.selected=true;break}}else d.selected=c.include(e)}},selectOne:function(b){var c=b.selectedIndex;return c>=0?this.optionValue(b.options[c]):null},selectMany:function(b){var c,d=b.length;if(!d)return null;var e=0;for(c=[];e<d;e++){var f=b.options[e];f.selected&&c.push(this.optionValue(f))}return c},optionValue:function(b){return Element.extend(b).hasAttribute("value")?b.value:b.text}};
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,c,d,e){$super(e,d);this.element=$(c);this.lastValue=this.getValue()},execute:function(){var b=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(b)?this.lastValue!=b:String(this.lastValue)!=String(b)){this.callback(this.element,b);this.lastValue=b}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(b,c){this.element=$(b);this.callback=c;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var b=this.getValue();if(this.lastValue!=b){this.callback(this.element,b);this.lastValue=b}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(b){if(b.type)switch(b.type.toLowerCase()){case "checkbox":case "radio":Event.observe(b,
"click",this.onElementEvent.bind(this));break;default:Event.observe(b,"change",this.onElementEvent.bind(this))}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function b(m){var r=document.documentElement,p=document.body||{scrollLeft:0};return m.pageX||m.clientX+(r.scrollLeft||p.scrollLeft)-(r.clientLeft||0)}function c(m){var r=document.documentElement,p=document.body||{scrollTop:0};return m.pageY||m.clientY+(r.scrollTop||p.scrollTop)-(r.clientTop||0)}function d(m,r,p){var s=Element.retrieve(m,"prototype_event_registry");if(Object.isUndefined(s)){z.push(m);s=Element.retrieve(m,"prototype_event_registry",$H())}var u=s.get(r);if(Object.isUndefined(u)){u=
[];s.set(r,u)}if(u.pluck("handler").include(p))return false;var v;if(r.include(":"))v=function(y){if(Object.isUndefined(y.eventName))return false;if(y.eventName!==r)return false;j.extend(y,m);p.call(m,y)};else if(!l&&(r==="mouseenter"||r==="mouseleave")){if(r==="mouseenter"||r==="mouseleave")v=function(y){j.extend(y,m);for(var x=y.relatedTarget;x&&x!==m;)try{x=x.parentNode}catch(B){x=m}x!==m&&p.call(m,y)}}else v=function(y){j.extend(y,m);p.call(m,y)};v.handler=p;u.push(v);return v}function e(){for(var m=
0,r=z.length;m<r;m++){j.stopObserving(z[m]);z[m]=null}}function f(m,r,p){m=$(m);p=d(m,r,p);if(!p)return m;if(r.include(":"))if(m.addEventListener)m.addEventListener("dataavailable",p,false);else{m.attachEvent("ondataavailable",p);m.attachEvent("onfilterchange",p)}else{r=A(r);m.addEventListener?m.addEventListener(r,p,false):m.attachEvent("on"+r,p)}return m}function h(m,r,p){m=$(m);var s=Element.retrieve(m,"prototype_event_registry");if(!s)return m;if(!r){s.each(function(x){h(m,x.key)});return m}var u=
s.get(r);if(!u)return m;if(!p){u.each(function(x){h(m,r,x.handler)});return m}var v=u.find(function(x){return x.handler===p});if(!v)return m;if(r.include(":"))if(m.removeEventListener)m.removeEventListener("dataavailable",v,false);else{m.detachEvent("ondataavailable",v);m.detachEvent("onfilterchange",v)}else{var y=A(r);m.removeEventListener?m.removeEventListener(y,v,false):m.detachEvent("on"+y,v)}s.set(r,u.without(v));return m}function g(m,r,p,s){m=$(m);if(Object.isUndefined(s))s=true;if(m==document&&
document.createEvent&&!m.dispatchEvent)m=document.documentElement;var u;if(document.createEvent){u=document.createEvent("HTMLEvents");u.initEvent("dataavailable",true,true)}else{u=document.createEventObject();u.eventType=s?"ondataavailable":"onfilterchange"}u.eventName=r;u.memo=p||{};document.createEvent?m.dispatchEvent(u):m.fireEvent(u.eventType,u);return j.extend(u)}function i(m,r,p,s){m=$(m);if(Object.isFunction(p)&&Object.isUndefined(s)){s=p;p=null}return(new j.Handler(m,r,p,s)).start()}var j=
{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},k=document.documentElement,l="onmouseenter"in k&&"onmouseleave"in k,o;if(Prototype.Browser.IE){var q={0:1,1:4,2:2};o=function(m,r){return m.button===q[r]}}else o=Prototype.Browser.WebKit?function(m,r){switch(r){case 0:return m.which==1&&!m.metaKey;case 1:return m.which==1&&m.metaKey;default:return false}}:function(m,
r){return m.which?m.which===r+1:m.button===r};j.Methods={isLeftClick:function(m){return o(m,0)},isMiddleClick:function(m){return o(m,1)},isRightClick:function(m){return o(m,2)},element:function(m){m=j.extend(m);var r=m.target,p=m.type;if((m=m.currentTarget)&&m.tagName)if(p==="load"||p==="error"||p==="click"&&m.tagName.toLowerCase()==="input"&&m.type==="radio")r=m;if(r.nodeType==Node.TEXT_NODE)r=r.parentNode;return Element.extend(r)},findElement:function(m,r){var p=j.element(m);if(!r)return p;for(;p;){if(Object.isElement(p)&&
Prototype.Selector.match(p,r))return Element.extend(p);p=p.parentNode}},pointer:function(m){return{x:b(m),y:c(m)}},pointerX:b,pointerY:c,stop:function(m){j.extend(m);m.preventDefault();m.stopPropagation();m.stopped=true}};var t=Object.keys(j.Methods).inject({},function(m,r){m[r]=j.Methods[r].methodize();return m});if(Prototype.Browser.IE){var w=function(m){switch(m.type){case "mouseover":m=m.fromElement;break;case "mouseout":m=m.toElement;break;default:return null}return Element.extend(m)};Object.extend(t,
{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});j.extend=function(m,r){if(!m)return false;if(m._extendedByPrototype)return m;m._extendedByPrototype=Prototype.emptyFunction;var p=j.pointer(m);Object.extend(m,{target:m.srcElement||r,relatedTarget:w(m),pageX:p.x,pageY:p.y});return Object.extend(m,t)}}else{j.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(j.prototype,
t);j.extend=Prototype.K}var z=[];Prototype.Browser.IE&&window.attachEvent("onunload",e);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,false);var A=Prototype.K,n={mouseenter:"mouseover",mouseleave:"mouseout"};l||(A=function(m){return n[m]||m});j.Handler=Class.create({initialize:function(m,r,p,s){this.element=$(m);this.eventName=r;this.selector=p;this.callback=s;this.handler=this.handleEvent.bind(this)},start:function(){j.observe(this.element,this.eventName,this.handler);
return this},stop:function(){j.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(m){var r=m.findElement(this.selector);r&&this.callback.call(this.element,m,r)}});Object.extend(j,j.Methods);Object.extend(j,{fire:g,observe:f,stopObserving:h,on:i});Element.addMethods({fire:g,observe:f,stopObserving:h,on:i});Object.extend(document,{fire:g.methodize(),observe:f.methodize(),stopObserving:h.methodize(),on:i.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,
j);else window.Event=j})();
(function(){function b(){if(!document.loaded){e&&window.clearTimeout(e);document.loaded=true;document.fire("dom:loaded")}}function c(){if(document.readyState==="complete"){document.stopObserving("readystatechange",c);b()}}function d(){try{document.documentElement.doScroll("left")}catch(f){e=d.defer();return}b()}var e;if(document.addEventListener)document.addEventListener("DOMContentLoaded",b,false);else{document.observe("readystatechange",c);if(window==top)e=d.defer()}Event.observe(window,"load",
b)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(b,c){return Element.insert(b,{before:c})},Top:function(b,c){return Element.insert(b,{top:c})},Bottom:function(b,c){return Element.insert(b,{bottom:c})},After:function(b,c){return Element.insert(b,{after:c})}},$continue=Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||
document.body.scrollTop||0},within:function(b,c,d){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(b,c,d);this.xcomp=c;this.ycomp=d;this.offset=Element.cumulativeOffset(b);return d>=this.offset[1]&&d<this.offset[1]+b.offsetHeight&&c>=this.offset[0]&&c<this.offset[0]+b.offsetWidth},withinIncludingScrolloffsets:function(b,c,d){var e=Element.cumulativeScrollOffset(b);this.xcomp=c+e[0]-this.deltaX;this.ycomp=d+e[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return this.ycomp>=
this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth},overlap:function(b,c){if(!b)return 0;if(b=="vertical")return(this.offset[1]+c.offsetHeight-this.ycomp)/c.offsetHeight;if(b=="horizontal")return(this.offset[0]+c.offsetWidth-this.xcomp)/c.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(b){Position.prepare();return Element.absolutize(b)},relativize:function(b){Position.prepare();
return Element.relativize(b)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,c,d){d=d||{};return Element.clonePosition(c,b,d)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(b){function c(d){return d.blank()?null:"[contains(concat(' ', @class, ' '), ' "+d+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(d,e){e=e.toString().strip();var f=/\s/.test(e)?$w(e).map(c).join(""):c(e);return f?document._getElementsByXPath(".//*"+f,d):[]}:function(d,e){e=e.toString().strip();var f=[],h=/\s/.test(e)?$w(e):null;if(!h&&!e)return f;var g=$(d).getElementsByTagName("*");e=" "+e+" ";for(var i=
0,j,k;j=g[i];i++)if(j.className&&(k=" "+j.className+" ")&&(k.include(e)||h&&h.all(function(l){return!l.toString().blank()&&k.include(" "+l+" ")})))f.push(Element.extend(j));return f};return function(d,e){return $(e||document.body).getElementsByClassName(d)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(b){this.element=$(b)},_each:function(b){this.element.className.split(/\s+/).select(function(c){return c.length>0})._each(b)},set:function(b){this.element.className=b},add:function(b){this.include(b)||this.set($A(this).concat(b).join(" "))},remove:function(b){this.include(b)&&this.set($A(this).without(b).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(b){this.expression=b.strip()},findElements:function(b){return Prototype.Selector.select(this.expression,b)},match:function(b){return Prototype.Selector.match(b,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(b,c){for(var d=Prototype.Selector.match,e=[],f=0,h=b.length;f<h;f++){var g=b[f];d(g,c)&&e.push(Element.extend(g))}return e},
findElement:function(b,c,d){d=d||0;for(var e=0,f,h=0,g=b.length;h<g;h++){f=b[h];if(Prototype.Selector.match(f,c)&&d===e++)return Element.extend(f)}},findChildElements:function(b,c){var d=c.toArray().join(", ");return Prototype.Selector.select(d,b||document)}})})();
(function(b){var c=Object.prototype.toString,d={get:function(e){return d.has(e)?d.list()[e]:null},has:function(e){return RegExp("(?:;\\s*|^)"+encodeURIComponent(e)+"=").test(document.cookie)},list:function(e){for(var f=document.cookie.split("; "),h,g={},i=0,j=f.length;i<j;++i){h=f[i].split("=");if("[object RegExp]"!=c.call(e)||e.test(h[0]))g[decodeURIComponent(h[0])]=decodeURIComponent(h[1])}return g},remove:function(e,f){var h={},g;for(g in f||{})opts2[g]=f[g];h.expires=new Date(0);h.maxAge=-1;return d.set(e,
null,h)},set:function(e,f,h){h=h||{};e=[encodeURIComponent(e)+"="+encodeURIComponent(f)];h.path&&e.push("path="+h.path);h.domain&&e.push("domain="+h.path);f="maxAge"in h?h.maxAge:"max_age"in h?h.max_age:h["max-age"];var g;if("undefined"!=typeof f&&"null"!=typeof f&&!isNaN(g=parseFloat(f)))e.push("max-age="+g);(g="[object Date]"==c.call(h.expires)?h.expires.toUTCString():h.expires)&&e.push("expires="+g);h.secure&&e.push("secure");e=e.join("; ");return document.cookie=e},test:function(){d.remove("70ab3d396b85e670f25b93be05e027e4eb655b71");
d.set("70ab3d396b85e670f25b93be05e027e4eb655b71","\u00c9lodie Jaubert");var e="\u00c9lodie Jaubert"==d.get("70ab3d396b85e670f25b93be05e027e4eb655b71");d.remove("70ab3d396b85e670f25b93be05e027e4eb655b71");return e}};b.Cookie=d})(window);var a;function extend(b,c){for(var d in c)b[d]=c[d]}var b2Settings=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){};b2Settings.prototype.__varz=function(){};b2Settings.USHRT_MAX=65535;
b2Settings.b2_pi=Math.PI;b2Settings.b2_maxManifoldPoints=2;b2Settings.b2_maxPolygonVertices=8;b2Settings.b2_maxProxies=1024;b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies;b2Settings.b2_linearSlop=0.005;b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi;b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop;b2Settings.b2_maxTOIContactsPerIsland=32;b2Settings.b2_velocityThreshold=1;b2Settings.b2_maxLinearCorrection=0.2;b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi;
b2Settings.b2_maxLinearVelocity=200;b2Settings.b2_maxLinearVelocitySquared=b2Settings.b2_maxLinearVelocity*b2Settings.b2_maxLinearVelocity;b2Settings.b2_maxAngularVelocity=250;b2Settings.b2_maxAngularVelocitySquared=b2Settings.b2_maxAngularVelocity*b2Settings.b2_maxAngularVelocity;b2Settings.b2_contactBaumgarte=0.2;b2Settings.b2_timeToSleep=0.5;b2Settings.b2_linearSleepTolerance=0.01;b2Settings.b2_angularSleepTolerance=2/180;b2Settings.b2Assert=function(b){b||(void 0).x++};
var b2Vec2=function(b,c){if(arguments.length==2){this.x=b;this.y=c}};b2Vec2.Make=function(b,c){return new b2Vec2(b,c)};a=b2Vec2.prototype;a.x=0;a.y=0;a.SetZero=function(){this.y=this.x=0};a.Set=function(b,c){this.x=b;this.y=c};a.SetV=function(b){this.x=b.x;this.y=b.y};a.Negative=function(){return new b2Vec2(-this.x,-this.y)};a.Copy=function(){return new b2Vec2(this.x,this.y)};a.Add=function(b){this.x+=b.x;this.y+=b.y};a.Subtract=function(b){this.x-=b.x;this.y-=b.y};
a.Multiply=function(b){this.x*=b;this.y*=b};a.MulM=function(b){var c=this.x;this.x=b.col1.x*c+b.col2.x*this.y;this.y=b.col1.y*c+b.col2.y*this.y};a.MulTM=function(b){var c=b2Math.b2Dot(this,b.col1);this.y=b2Math.b2Dot(this,b.col2);this.x=c};a.CrossVF=function(b){var c=this.x;this.x=b*this.y;this.y=-b*c};a.CrossFV=function(b){var c=this.x;this.x=-b*this.y;this.y=b*c};a.MinV=function(b){this.x=this.x<b.x?this.x:b.x;this.y=this.y<b.y?this.y:b.y};
a.MaxV=function(b){this.x=this.x>b.x?this.x:b.x;this.y=this.y>b.y?this.y:b.y};a.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};a.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.LengthSquared=function(){return this.x*this.x+this.y*this.y};a.Normalize=function(){var b=Math.sqrt(this.x*this.x+this.y*this.y);if(b<Number.MIN_VALUE)return 0;var c=1/b;this.x*=c;this.y*=c;return b};a.IsValid=function(){return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y)};
var b2BufferedPair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BufferedPair.prototype.__constructor=function(){};b2BufferedPair.prototype.__varz=function(){};b2BufferedPair.prototype.proxyId1=0;b2BufferedPair.prototype.proxyId2=0;var b2AABB=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2AABB.prototype;a.__constructor=function(){};a.__varz=function(){this.lowerBound=new b2Vec2;this.upperBound=new b2Vec2};a.lowerBound=new b2Vec2;a.upperBound=new b2Vec2;
a.IsValid=function(){var b=this.upperBound.y-this.lowerBound.y;return this.upperBound.x-this.lowerBound.x>=0&&b>=0&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};var b2Pair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){};b2Pair.prototype.__varz=function(){};b2Pair.b2_nullPair=b2Settings.USHRT_MAX;b2Pair.b2_nullProxy=b2Settings.USHRT_MAX;b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs;
b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1;b2Pair.e_pairBuffered=1;b2Pair.e_pairRemoved=2;b2Pair.e_pairFinal=4;a=b2Pair.prototype;a.userData=null;a.proxyId1=0;a.proxyId2=0;a.next=0;a.status=0;a.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered};a.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered};a.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered};a.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved};
a.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved};a.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved};a.SetFinal=function(){this.status|=b2Pair.e_pairFinal};a.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal};var b2TimeStep=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2TimeStep.prototype;a.__constructor=function(){};a.__varz=function(){};a.dt=null;a.inv_dt=null;a.dtRatio=null;a.maxIterations=0;
a.warmStarting=null;a.positionCorrection=null;var b2Manifold=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Manifold.prototype;a.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b]=new b2ManifoldPoint;this.normal=new b2Vec2};a.__varz=function(){};a.points=null;a.normal=null;a.pointCount=0;
a.Reset=function(){for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b].Reset();this.normal.SetZero();this.pointCount=0};a.Set=function(b){this.pointCount=b.pointCount;for(var c=0;c<b2Settings.b2_maxManifoldPoints;c++)this.points[c].Set(b.points[c]);this.normal.SetV(b.normal)};var b2Point=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Point.prototype;a.__constructor=function(){};a.__varz=function(){this.p=new b2Vec2};a.p=new b2Vec2;a.Support=function(){return this.p};
a.GetFirstVertex=function(){return this.p};var b2Bound=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Bound.prototype;a.__constructor=function(){};a.__varz=function(){};a.value=0;a.proxyId=0;a.stabbingCount=0;a.IsLower=function(){return(this.value&1)==0};a.IsUpper=function(){return(this.value&1)==1};
a.Swap=function(b){var c=this.value,d=this.proxyId,e=this.stabbingCount;this.value=b.value;this.proxyId=b.proxyId;this.stabbingCount=b.stabbingCount;b.value=c;b.proxyId=d;b.stabbingCount=e};var b2Mat22=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Mat22.prototype;a.__constructor=function(b,c,d){if(c!=null&&d!=null){this.col1.SetV(c);this.col2.SetV(d)}else{c=Math.cos(b);b=Math.sin(b);this.col1.x=c;this.col2.x=-b;this.col1.y=b;this.col2.y=c}};
a.__varz=function(){this.col1=new b2Vec2;this.col2=new b2Vec2};a.col1=new b2Vec2;a.col2=new b2Vec2;a.Set=function(b){var c=Math.cos(b);b=Math.sin(b);this.col1.x=c;this.col2.x=-b;this.col1.y=b;this.col2.y=c};a.SetVV=function(b,c){this.col1.SetV(b);this.col2.SetV(c)};a.Copy=function(){return new b2Mat22(0,this.col1,this.col2)};a.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2)};a.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y};
a.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};a.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};a.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};a.Invert=function(b){var c=this.col1.x,d=this.col2.x,e=this.col1.y,f=this.col2.y,h=c*f-d*e;h=1/h;b.col1.x=h*f;b.col2.x=-h*d;b.col1.y=-h*e;b.col2.y=h*c;return b};
a.Solve=function(b,c,d){var e=this.col1.x,f=this.col2.x,h=this.col1.y,g=this.col2.y,i=e*g-f*h;i=1/i;b.x=i*(g*c-f*d);b.y=i*(e*d-h*c);return b};a.Abs=function(){this.col1.Abs();this.col2.Abs()};var b2BoundaryListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundaryListener.prototype.__constructor=function(){};b2BoundaryListener.prototype.__varz=function(){};b2BoundaryListener.prototype.Violation=function(){};
var b2MassData=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2MassData.prototype;a.__constructor=function(){};a.__varz=function(){this.center=new b2Vec2(0,0)};a.mass=0;a.center=new b2Vec2(0,0);a.I=0;var b2JointEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2JointEdge.prototype;a.__constructor=function(){};a.__varz=function(){};a.other=null;a.joint=null;a.prev=null;a.next=null;
var b2Collision=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){};b2Collision.prototype.__varz=function(){};b2Collision.b2_nullFeature=255;b2Collision.b2CollidePolyTempVec=new b2Vec2;
b2Collision.ClipSegmentToLine=function(b,c,d,e){var f,h=0;f=c[0];var g=f.v;f=c[1];var i=f.v,j=b2Math.b2Dot(d,g)-e;f=b2Math.b2Dot(d,i)-e;if(j<=0)b[h++]=c[0];if(f<=0)b[h++]=c[1];if(j*f<0){d=j/(j-f);f=b[h];f=f.v;f.x=g.x+d*(i.x-g.x);f.y=g.y+d*(i.y-g.y);f=b[h];f.id=(j>0?c[0]:c[1]).id;++h}return h};
b2Collision.EdgeSeparation=function(b,c,d,e,f){var h=b.m_vertices;b=b.m_normals;var g=e.m_vertexCount,i=e.m_vertices,j,k;j=c.R;k=b[d];b=j.col1.x*k.x+j.col2.x*k.y;e=j.col1.y*k.x+j.col2.y*k.y;j=f.R;var l=j.col1.x*b+j.col1.y*e;j=j.col2.x*b+j.col2.y*e;for(var o=0,q=Number.MAX_VALUE,t=0;t<g;++t){k=i[t];k=k.x*l+k.y*j;if(k<q){q=k;o=t}}k=h[d];j=c.R;d=c.position.x+(j.col1.x*k.x+j.col2.x*k.y);c=c.position.y+(j.col1.y*k.x+j.col2.y*k.y);k=i[o];j=f.R;h=f.position.x+(j.col1.x*k.x+j.col2.x*k.y);f=f.position.y+(j.col1.y*
k.x+j.col2.y*k.y);h-=d;f-=c;return h*b+f*e};
b2Collision.FindMaxSeparation=function(b,c,d,e,f){var h=c.m_vertexCount,g=c.m_normals,i,j;j=f.R;i=e.m_centroid;var k=f.position.x+(j.col1.x*i.x+j.col2.x*i.y),l=f.position.y+(j.col1.y*i.x+j.col2.y*i.y);j=d.R;i=c.m_centroid;k-=d.position.x+(j.col1.x*i.x+j.col2.x*i.y);l-=d.position.y+(j.col1.y*i.x+j.col2.y*i.y);j=k*d.R.col1.x+l*d.R.col1.y;l=k*d.R.col2.x+l*d.R.col2.y;k=0;for(var o=-Number.MAX_VALUE,q=0;q<h;++q){i=g[q];i=i.x*j+i.y*l;if(i>o){o=i;k=q}}g=b2Collision.EdgeSeparation(c,d,k,e,f);if(g>0)return g;
l=k-1>=0?k-1:h-1;o=b2Collision.EdgeSeparation(c,d,l,e,f);if(o>0)return o;q=k+1<h?k+1:0;var t=b2Collision.EdgeSeparation(c,d,q,e,f);if(t>0)return t;if(o>g&&o>t){j=-1;i=l;l=o}else if(t>g){j=1;i=q;l=t}else{b[0]=k;return g}for(;;){k=j==-1?i-1>=0?i-1:h-1:i+1<h?i+1:0;g=b2Collision.EdgeSeparation(c,d,k,e,f);if(g>0)return g;if(g>l){i=k;l=g}else break}b[0]=i;return l};
b2Collision.FindIncidentEdge=function(b,c,d,e,f,h){var g=c.m_normals,i=f.m_vertexCount;c=f.m_vertices;f=f.m_normals;var j;j=d.R;d=g[e];g=j.col1.x*d.x+j.col2.x*d.y;var k=j.col1.y*d.x+j.col2.y*d.y;j=h.R;d=j.col1.x*g+j.col1.y*k;k=j.col2.x*g+j.col2.y*k;g=d;j=0;for(var l=Number.MAX_VALUE,o=0;o<i;++o){d=f[o];d=g*d.x+k*d.y;if(d<l){l=d;j=o}}f=j;g=f+1<i?f+1:0;i=b[0];d=c[f];j=h.R;i.v.x=h.position.x+(j.col1.x*d.x+j.col2.x*d.y);i.v.y=h.position.y+(j.col1.y*d.x+j.col2.y*d.y);i.id.features.referenceEdge=e;i.id.features.incidentEdge=
f;i.id.features.incidentVertex=0;i=b[1];d=c[g];j=h.R;i.v.x=h.position.x+(j.col1.x*d.x+j.col2.x*d.y);i.v.y=h.position.y+(j.col1.y*d.x+j.col2.y*d.y);i.id.features.referenceEdge=e;i.id.features.incidentEdge=g;i.id.features.incidentVertex=1};
b2Collision.b2CollidePolygons=function(b,c,d,e,f){var h=b.pointCount=0,g=[h],i=b2Collision.FindMaxSeparation(g,c,d,e,f);h=g[0];if(!(i>0)){var j=0;g=[j];var k=b2Collision.FindMaxSeparation(g,e,f,c,d);j=g[0];if(!(k>0)){var l=new b2XForm,o=new b2XForm,q=0;if(k>0.98*i+0.001){i=e;e=c;l.Set(f);o.Set(d);q=j;g=1}else{i=c;l.Set(d);o.Set(f);q=h;g=0}c=[new ClipVertex,new ClipVertex];b2Collision.FindIncidentEdge(c,i,l,q,e,o);h=i.m_vertexCount;o=i.m_vertices;i=o[q];e=i.Copy();i=q+1<h?o[parseInt(q+1)]:o[0];i=i.Copy();
b2Math.SubtractVV(i,e);h=b2Math.b2MulMV(l.R,b2Math.SubtractVV(i,e));h.Normalize();q=b2Math.b2CrossVF(h,1);e=b2Math.b2MulX(l,e);i=b2Math.b2MulX(l,i);l=b2Math.b2Dot(q,e);o=-b2Math.b2Dot(h,e);i=b2Math.b2Dot(h,i);j=[new ClipVertex,new ClipVertex];e=[new ClipVertex,new ClipVertex];k=b2Collision.ClipSegmentToLine(j,c,h.Negative(),o);if(!(k<2)){k=b2Collision.ClipSegmentToLine(e,j,h,i);if(!(k<2)){b.normal=g?q.Negative():q.Copy();for(o=h=0;o<b2Settings.b2_maxManifoldPoints;++o){c=e[o];i=b2Math.b2Dot(q,c.v)-
l;if(i<=0){j=b.points[h];j.separation=i;j.localPoint1=b2Math.b2MulXT(d,c.v);j.localPoint2=b2Math.b2MulXT(f,c.v);j.id.key=c.id._key;j.id.features.flip=g;++h}}b.pointCount=h}}}}};
b2Collision.b2CollideCircles=function(b,c,d,e,f){b.pointCount=0;var h,g;h=d.R;g=c.m_localPosition;var i=d.position.x+(h.col1.x*g.x+h.col2.x*g.y),j=d.position.y+(h.col1.y*g.x+h.col2.y*g.y);h=f.R;g=e.m_localPosition;var k=f.position.x+(h.col1.x*g.x+h.col2.x*g.y);h=f.position.y+(h.col1.y*g.x+h.col2.y*g.y);g=k-i;var l=h-j,o=g*g+l*l;c=c.m_radius;e=e.m_radius;var q=c+e;if(!(o>q*q)){if(o<Number.MIN_VALUE){o=-q;b.normal.Set(0,1)}else{var t=Math.sqrt(o);o=t-q;q=1/t;b.normal.x=q*g;b.normal.y=q*l}b.pointCount=
1;g=b.points[0];g.id.key=0;g.separation=o;i+=c*b.normal.x;j+=c*b.normal.y;k-=e*b.normal.x;h-=e*b.normal.y;b=0.5*(i+k);j=0.5*(j+h);i=b-d.position.x;k=j-d.position.y;g.localPoint1.x=i*d.R.col1.x+k*d.R.col1.y;g.localPoint1.y=i*d.R.col2.x+k*d.R.col2.y;i=b-f.position.x;k=j-f.position.y;g.localPoint2.x=i*f.R.col1.x+k*f.R.col1.y;g.localPoint2.y=i*f.R.col2.x+k*f.R.col2.y}};
b2Collision.b2CollidePolygonAndCircle=function(b,c,d,e,f){b.pointCount=0;var h,g,i,j,k,l;l=f.R;k=e.m_localPosition;j=f.position.x+(l.col1.x*k.x+l.col2.x*k.y);var o=f.position.y+(l.col1.y*k.x+l.col2.y*k.y);g=j-d.position.x;i=o-d.position.y;l=d.R;var q=g*l.col1.x+i*l.col1.y;l=g*l.col2.x+i*l.col2.y;var t=0,w=-Number.MAX_VALUE;e=e.m_radius;var z=c.m_vertexCount;h=c.m_vertices;c=c.m_normals;for(var A=0;A<z;++A){k=h[A];g=q-k.x;i=l-k.y;k=c[A];g=k.x*g+k.y*i;if(g>e)return;if(g>w){w=g;t=A}}if(w<Number.MIN_VALUE){b.pointCount=
1;k=c[t];l=d.R;b.normal.x=l.col1.x*k.x+l.col2.x*k.y;b.normal.y=l.col1.y*k.x+l.col2.y*k.y;h=b.points[0];h.id.features.incidentEdge=t;h.id.features.incidentVertex=b2Collision.b2_nullFeature;h.id.features.referenceEdge=0;h.id.features.flip=0;j-=e*b.normal.x;b=o-e*b.normal.y;g=j-d.position.x;i=b-d.position.y;l=d.R;h.localPoint1.x=g*l.col1.x+i*l.col1.y;h.localPoint1.y=g*l.col2.x+i*l.col2.y;g=j-f.position.x;i=b-f.position.y;l=f.R;h.localPoint2.x=g*l.col1.x+i*l.col1.y;h.localPoint2.y=g*l.col2.x+i*l.col2.y;
h.separation=w-e}else{w=t;z=w+1<z?w+1:0;k=h[w];c=h[z];var n=c.x-k.x;A=c.y-k.y;var m=Math.sqrt(n*n+A*A);n/=m;A/=m;g=q-k.x;i=l-k.y;g=g*n+i*A;h=b.points[0];if(g<=0){i=k.x;k=k.y;h.id.features.incidentEdge=b2Collision.b2_nullFeature;h.id.features.incidentVertex=w}else if(g>=m){i=c.x;k=c.y;h.id.features.incidentEdge=b2Collision.b2_nullFeature;h.id.features.incidentVertex=z}else{i=n*g+k.x;k=A*g+k.y;h.id.features.incidentEdge=t;h.id.features.incidentVertex=0}g=q-i;i=l-k;q=Math.sqrt(g*g+i*i);g/=q;i/=q;if(!(q>
e)){b.pointCount=1;l=d.R;b.normal.x=l.col1.x*g+l.col2.x*i;b.normal.y=l.col1.y*g+l.col2.y*i;j-=e*b.normal.x;b=o-e*b.normal.y;g=j-d.position.x;i=b-d.position.y;l=d.R;h.localPoint1.x=g*l.col1.x+i*l.col1.y;h.localPoint1.y=g*l.col2.x+i*l.col2.y;g=j-f.position.x;i=b-f.position.y;l=f.R;h.localPoint2.x=g*l.col1.x+i*l.col1.y;h.localPoint2.y=g*l.col2.x+i*l.col2.y;h.separation=q-e;h.id.features.referenceEdge=0;h.id.features.flip=0}}};
b2Collision.b2TestOverlap=function(b,c){var d=c.lowerBound,e=b.upperBound,f=d.x-e.x,h=d.y-e.y;d=b.lowerBound;e=c.upperBound;b=d.y-e.y;if(f>0||h>0)return false;if(d.x-e.x>0||b>0)return false;return true};var b2ContactListener=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactListener.prototype;a.__constructor=function(){};a.__varz=function(){};a.Add=function(){};a.Persist=function(){};a.Remove=function(){};a.Result=function(){};
var b2PairCallback=function(){this.__varz();this.__constructor.apply(this,arguments)};b2PairCallback.prototype.__constructor=function(){};b2PairCallback.prototype.__varz=function(){};b2PairCallback.prototype.PairAdded=function(){return null};b2PairCallback.prototype.PairRemoved=function(){};var b2JointDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2JointDef.prototype;
a.__constructor=function(){this.type=b2Joint.e_unknownJoint;this.body2=this.body1=this.userData=null;this.collideConnected=false};a.__varz=function(){};a.type=0;a.userData=null;a.body1=null;a.body2=null;a.collideConnected=null;var b2Proxy=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Proxy.prototype;a.__constructor=function(){};a.__varz=function(){this.lowerBounds=[parseInt(0),parseInt(0)];this.upperBounds=[parseInt(0),parseInt(0)]};a.lowerBounds=[parseInt(0),parseInt(0)];
a.upperBounds=[parseInt(0),parseInt(0)];a.overlapCount=0;a.timeStamp=0;a.userData=null;a.GetNext=function(){return this.lowerBounds[0]};a.SetNext=function(b){this.lowerBounds[0]=b%65535};a.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid};var b2Color=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Color.prototype;
a.__constructor=function(b,c,d){this._r=parseInt(255*b2Math.b2Clamp(b,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(d,0,1))};a.__varz=function(){};a._r=0;a._g=0;a._b=0;a.Set=function(b,c,d){this._r=parseInt(255*b2Math.b2Clamp(b,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(d,0,1))};a.set=function(b){this._r=parseInt(255*b2Math.b2Clamp(b,0,1))};a.set=function(b){this._g=parseInt(255*b2Math.b2Clamp(b,0,1))};
a.set=function(b){this._b=parseInt(255*b2Math.b2Clamp(b,0,1))};a.get=function(){return this._r|this._g<<8|this._b<<16};var b2FilterData=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2FilterData.prototype;a.__constructor=function(){};a.__varz=function(){this.categoryBits=1;this.maskBits=65535};a.categoryBits=1;a.maskBits=65535;a.groupIndex=0;a.Copy=function(){var b=new b2FilterData;b.categoryBits=this.categoryBits;b.maskBits=this.maskBits;b.groupIndex=this.groupIndex;return b};
var b2PairManager=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2PairManager.prototype.__constructor=function(){var b=0;this.m_hashTable=Array(b2Pair.b2_tableCapacity);for(b=0;b<b2Pair.b2_tableCapacity;++b)this.m_hashTable[b]=b2Pair.b2_nullPair;this.m_pairs=Array(b2Settings.b2_maxPairs);for(b=0;b<b2Settings.b2_maxPairs;++b)this.m_pairs[b]=new b2Pair;this.m_pairBuffer=Array(b2Settings.b2_maxPairs);for(b=0;b<b2Settings.b2_maxPairs;++b)this.m_pairBuffer[b]=new b2BufferedPair;for(b=0;b<b2Settings.b2_maxPairs;++b){this.m_pairs[b].proxyId1=b2Pair.b2_nullProxy;this.m_pairs[b].proxyId2=
b2Pair.b2_nullProxy;this.m_pairs[b].userData=null;this.m_pairs[b].status=0;this.m_pairs[b].next=b+1}this.m_pairs[parseInt(b2Settings.b2_maxPairs-1)].next=b2Pair.b2_nullPair;this.m_pairBufferCount=this.m_pairCount=0};b2PairManager.prototype.__varz=function(){};b2PairManager.Hash=function(b,c){b=c<<16&4294901760|b;b=~b+(b<<15&4294934528);b^=b>>12&1048575;b+=b<<2&4294967292;b^=b>>4&268435455;b*=2057;b^=(b>>16)%65535;return b};b2PairManager.Equals=function(b,c,d){return b.proxyId1==c&&b.proxyId2==d};
b2PairManager.EqualsPair=function(b,c){return b.proxyId1==c.proxyId1&&b.proxyId2==c.proxyId2};a=b2PairManager.prototype;a.m_broadPhase=null;a.m_callback=null;a.m_pairs=null;a.m_freePair=0;a.m_pairCount=0;a.m_pairBuffer=null;a.m_pairBufferCount=0;a.m_hashTable=null;
a.AddPair=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;var e=e=this.FindHash(b,c,d);if(e!=null)return e;var f=this.m_freePair;e=this.m_pairs[f];this.m_freePair=e.next;e.proxyId1=b;e.proxyId2=c;e.status=0;e.userData=null;e.next=this.m_hashTable[d];this.m_hashTable[d]=f;++this.m_pairCount;return e};
a.RemovePair=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;for(var e=this.m_hashTable[d],f=null;e!=b2Pair.b2_nullPair;)if(b2PairManager.Equals(this.m_pairs[e],b,c)){b=e;c=this.m_pairs[e];if(f)f.next=c.next;else this.m_hashTable[d]=c.next;c=this.m_pairs[b];d=c.userData;c.next=this.m_freePair;c.proxyId1=b2Pair.b2_nullProxy;c.proxyId2=b2Pair.b2_nullProxy;c.userData=null;c.status=0;this.m_freePair=b;--this.m_pairCount;return d}else{f=this.m_pairs[e];e=f.next}return null};
a.Find=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;return this.FindHash(b,c,d)};a.FindHash=function(b,c,d){var e=this.m_hashTable[d];for(d=this.m_pairs[e];e!=b2Pair.b2_nullPair&&b2PairManager.Equals(d,b,c)==false;){e=d.next;d=this.m_pairs[e]}if(e==b2Pair.b2_nullPair)return null;return d};a.ValidateBuffer=function(){};a.ValidateTable=function(){};a.Initialize=function(b,c){this.m_broadPhase=b;this.m_callback=c};
a.AddBufferedPair=function(b,c){c=this.AddPair(b,c);if(c.IsBuffered()==false){c.SetBuffered();b=this.m_pairBuffer[this.m_pairBufferCount];b.proxyId1=c.proxyId1;b.proxyId2=c.proxyId2;++this.m_pairBufferCount}c.ClearRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()};
a.RemoveBufferedPair=function(b,c){c=this.Find(b,c);if(c!=null){if(c.IsBuffered()==false){c.SetBuffered();b=this.m_pairBuffer[this.m_pairBufferCount];b.proxyId1=c.proxyId1;b.proxyId2=c.proxyId2;++this.m_pairBufferCount}c.SetRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()}};
a.Commit=function(){var b,c=0,d=0,e=this.m_broadPhase.m_proxyPool;for(c=0;c<this.m_pairBufferCount;++c){b=this.m_pairBuffer[c];var f=this.Find(b.proxyId1,b.proxyId2);f.ClearBuffered();b=e[f.proxyId1];var h=e[f.proxyId2];if(f.IsRemoved()){f.IsFinal()==true&&this.m_callback.PairRemoved(b.userData,h.userData,f.userData);b=this.m_pairBuffer[d];b.proxyId1=f.proxyId1;b.proxyId2=f.proxyId2;++d}else if(f.IsFinal()==false){f.userData=this.m_callback.PairAdded(b.userData,h.userData);f.SetFinal()}}for(c=0;c<
d;++c){b=this.m_pairBuffer[c];this.RemovePair(b.proxyId1,b.proxyId2)}this.m_pairBufferCount=0;b2BroadPhase.s_validate&&this.ValidateTable()};var b2ContactSolver=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactSolver.prototype;
a.__constructor=function(b,c,d,e){var f;this.m_step.dt=b.dt;this.m_step.inv_dt=b.inv_dt;this.m_step.maxIterations=b.maxIterations;this.m_allocator=e;var h;for(b=this.m_constraintCount=0;b<d;++b){f=c[b];this.m_constraintCount+=f.m_manifoldCount}for(b=0;b<this.m_constraintCount;b++)this.m_constraints[b]=new b2ContactConstraint;for(b=e=0;b<d;++b){f=c[b];var g=f.m_shape1.m_body,i=f.m_shape2.m_body,j=f.m_manifoldCount,k=f.GetManifolds(),l=f.m_friction;f=f.m_restitution;for(var o=g.m_linearVelocity.x,q=
g.m_linearVelocity.y,t=i.m_linearVelocity.x,w=i.m_linearVelocity.y,z=g.m_angularVelocity,A=i.m_angularVelocity,n=0;n<j;++n){var m=k[n],r=m.normal.x,p=m.normal.y,s=this.m_constraints[e];s.body1=g;s.body2=i;s.manifold=m;s.normal.x=r;s.normal.y=p;s.pointCount=m.pointCount;s.friction=l;s.restitution=f;for(var u=0;u<s.pointCount;++u){var v=m.points[u],y=s.points[u];y.normalImpulse=v.normalImpulse;y.tangentImpulse=v.tangentImpulse;y.separation=v.separation;y.positionImpulse=0;y.localAnchor1.SetV(v.localPoint1);
y.localAnchor2.SetV(v.localPoint2);var x;h=g.m_xf.R;var B=v.localPoint1.x-g.m_sweep.localCenter.x,C=v.localPoint1.y-g.m_sweep.localCenter.y;x=h.col1.x*B+h.col2.x*C;C=h.col1.y*B+h.col2.y*C;B=x;y.r1.Set(B,C);h=i.m_xf.R;var E=v.localPoint2.x-i.m_sweep.localCenter.x;v=v.localPoint2.y-i.m_sweep.localCenter.y;x=h.col1.x*E+h.col2.x*v;v=h.col1.y*E+h.col2.y*v;E=x;y.r2.Set(E,v);h=B*B+C*C;x=E*E+v*v;var F=B*r+C*p,D=E*r+v*p,G=g.m_invMass+i.m_invMass;G+=g.m_invI*(h-F*F)+i.m_invI*(x-D*D);y.normalMass=1/G;G=g.m_mass*
g.m_invMass+i.m_mass*i.m_invMass;G+=g.m_mass*g.m_invI*(h-F*F)+i.m_mass*i.m_invI*(x-D*D);y.equalizedMass=1/G;D=-r;F=B*p+C*D;D=E*p+v*D;G=g.m_invMass+i.m_invMass;G+=g.m_invI*(h-F*F)+i.m_invI*(x-D*D);y.tangentMass=1/G;y.velocityBias=0;if(y.separation>0)y.velocityBias=-60*y.separation;x=t+-A*v-o- -z*C;B=s.normal.x*x+s.normal.y*(w+A*E-q-z*B);if(B<-b2Settings.b2_velocityThreshold)y.velocityBias+=-s.restitution*B}++e}}};a.__varz=function(){this.m_step=new b2TimeStep;this.m_constraints=[]};a.m_step=new b2TimeStep;
a.m_allocator=null;a.m_constraints=[];a.m_constraintCount=0;
a.InitVelocityConstraints=function(b){for(var c=0;c<this.m_constraintCount;++c){var d=this.m_constraints[c],e=d.body1,f=d.body2,h=e.m_invMass,g=e.m_invI,i=f.m_invMass,j=f.m_invI,k=d.normal.x,l=d.normal.y,o=-k,q=0,t=0;if(b.warmStarting){t=d.pointCount;for(q=0;q<t;++q){var w=d.points[q];w.normalImpulse*=b.dtRatio;w.tangentImpulse*=b.dtRatio;var z=w.normalImpulse*k+w.tangentImpulse*l,A=w.normalImpulse*l+w.tangentImpulse*o;e.m_angularVelocity-=g*(w.r1.x*A-w.r1.y*z);e.m_linearVelocity.x-=h*z;e.m_linearVelocity.y-=
h*A;f.m_angularVelocity+=j*(w.r2.x*A-w.r2.y*z);f.m_linearVelocity.x+=i*z;f.m_linearVelocity.y+=i*A}}else{t=d.pointCount;for(q=0;q<t;++q){e=d.points[q];e.normalImpulse=0;e.tangentImpulse=0}}}};
a.SolveVelocityConstraints=function(){for(var b=0,c,d,e,f,h,g,i=0;i<this.m_constraintCount;++i){var j=this.m_constraints[i],k=j.body1,l=j.body2,o=k.m_angularVelocity,q=l.m_angularVelocity,t=k.m_linearVelocity,w=l.m_linearVelocity,z=k.m_invMass,A=k.m_invI,n=l.m_invMass,m=l.m_invI,r=j.normal.x,p=j.normal.y,s=-r,u=j.friction,v=j.pointCount;for(b=0;b<v;++b){c=j.points[b];d=w.x+-q*c.r2.y-t.x- -o*c.r1.y;e=w.y+q*c.r2.x-t.y-o*c.r1.x;f=d*r+e*p;f=-c.normalMass*(f-c.velocityBias);d=d*p+e*s;e=c.tangentMass*-d;
d=b2Math.b2Max(c.normalImpulse+f,0);f=d-c.normalImpulse;h=u*c.normalImpulse;h=b2Math.b2Clamp(c.tangentImpulse+e,-h,h);e=h-c.tangentImpulse;g=f*r+e*p;f=f*p+e*s;t.x-=z*g;t.y-=z*f;o-=A*(c.r1.x*f-c.r1.y*g);w.x+=n*g;w.y+=n*f;q+=m*(c.r2.x*f-c.r2.y*g);c.normalImpulse=d;c.tangentImpulse=h}k.m_angularVelocity=o;l.m_angularVelocity=q}};
a.FinalizeVelocityConstraints=function(){for(var b=0;b<this.m_constraintCount;++b)for(var c=this.m_constraints[b],d=c.manifold,e=0;e<c.pointCount;++e){var f=d.points[e],h=c.points[e];f.normalImpulse=h.normalImpulse;f.tangentImpulse=h.tangentImpulse}};
a.SolvePositionConstraints=function(b){for(var c=0,d,e,f=0;f<this.m_constraintCount;++f)for(var h=this.m_constraints[f],g=h.body1,i=h.body2,j=g.m_sweep.c,k=g.m_sweep.a,l=i.m_sweep.c,o=i.m_sweep.a,q=g.m_mass*g.m_invMass,t=g.m_mass*g.m_invI,w=i.m_mass*i.m_invMass,z=i.m_mass*i.m_invI,A=h.normal.x,n=h.normal.y,m=h.pointCount,r=0;r<m;++r){var p=h.points[r];d=g.m_xf.R;e=g.m_sweep.localCenter;var s=p.localAnchor1.x-e.x,u=p.localAnchor1.y-e.y;y=d.col1.x*s+d.col2.x*u;u=d.col1.y*s+d.col2.y*u;s=y;d=i.m_xf.R;
e=i.m_sweep.localCenter;var v=p.localAnchor2.x-e.x;e=p.localAnchor2.y-e.y;var y=d.col1.x*v+d.col2.x*e;e=d.col1.y*v+d.col2.y*e;v=y;d=(l.x+v-(j.x+s))*A+(l.y+e-(j.y+u))*n+p.separation;c=b2Math.b2Min(c,d);d=b*b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);d=-p.equalizedMass*d;y=p.positionImpulse;p.positionImpulse=b2Math.b2Max(y+d,0);d=p.positionImpulse-y;p=d*A;d*=n;j.x-=q*p;j.y-=q*d;k-=t*(s*d-u*p);g.m_sweep.a=k;g.SynchronizeTransform();l.x+=w*p;l.y+=w*d;o+=z*(v*d-e*p);
i.m_sweep.a=o;i.SynchronizeTransform()}return c>=-1.5*b2Settings.b2_linearSlop};var b2BoundValues=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){};b2BoundValues.prototype.__varz=function(){this.lowerValues=[0,0];this.upperValues=[0,0]};b2BoundValues.prototype.lowerValues=[0,0];b2BoundValues.prototype.upperValues=[0,0];var Features=function(){this.__varz();this.__constructor.apply(this,arguments)};
Features.prototype={referenceEdge:function(){return this._referenceEdge},referenceEdge:function(b){this._referenceEdge=b;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255},incidentEdge:function(){return this._incidentEdge},incidentEdge:function(b){this._incidentEdge=b;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280},incidentVertex:function(b){this._incidentVertex=b;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680},incidentVertex:function(){return this._incidentVertex},
flip:function(b){this._flip=b;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080},flip:function(){return this._flip}};a=Features.prototype;a.__constructor=function(){};a.__varz=function(){};a._referenceEdge=0;a._incidentEdge=0;a._incidentVertex=0;a._flip=0;a._m_id=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype);a=b2MouseJointDef.prototype;
a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Joint.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7;this.timeStep=1/60};a.__varz=function(){this.target=new b2Vec2};a.target=new b2Vec2;a.maxForce=null;a.frequencyHz=null;a.dampingRatio=null;a.timeStep=null;var b2ContactConstraintPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactConstraintPoint.prototype;a.__constructor=function(){};
a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.r1=new b2Vec2;this.r2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.r1=new b2Vec2;a.r2=new b2Vec2;a.normalImpulse=null;a.tangentImpulse=null;a.positionImpulse=null;a.normalMass=null;a.tangentMass=null;a.equalizedMass=null;a.separation=null;a.velocityBias=null;var b2ContactRegister=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactRegister.prototype;a.__constructor=function(){};
a.__varz=function(){};a.createFcn=null;a.destroyFcn=null;a.primary=null;var b2DestructionListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){};b2DestructionListener.prototype.__varz=function(){};b2DestructionListener.prototype.SayGoodbyeJoint=function(){};b2DestructionListener.prototype.SayGoodbyeShape=function(){};
var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype);a=b2PulleyJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_pulleyJoint;this.groundAnchor1.Set(-1,1);this.groundAnchor2.Set(1,1);this.localAnchor1.Set(-1,0);this.localAnchor2.Set(1,0);this.maxLength2=this.length2=this.maxLength1=this.length1=0;this.ratio=1;this.collideConnected=true};a.__varz=function(){this.groundAnchor1=new b2Vec2;this.groundAnchor2=new b2Vec2;this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.groundAnchor1=new b2Vec2;a.groundAnchor2=new b2Vec2;a.localAnchor1=new b2Vec2;
a.localAnchor2=new b2Vec2;a.length1=null;a.maxLength1=null;a.length2=null;a.maxLength2=null;a.ratio=null;
a.Initialize=function(b,c,d,e,f,h,g){this.body1=b;this.body2=c;this.groundAnchor1.SetV(d);this.groundAnchor2.SetV(e);this.localAnchor1=this.body1.GetLocalPoint(f);this.localAnchor2=this.body2.GetLocalPoint(h);b=f.x-d.x;d=f.y-d.y;this.length1=Math.sqrt(b*b+d*d);d=h.x-e.x;e=h.y-e.y;this.length2=Math.sqrt(d*d+e*e);this.ratio=g;g=this.length1+this.ratio*this.length2;this.maxLength1=g-this.ratio*b2PulleyJoint.b2_minPulleyLength;this.maxLength2=(g-b2PulleyJoint.b2_minPulleyLength)/this.ratio};
var b2Jacobian=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Jacobian.prototype;a.__constructor=function(){};a.__varz=function(){this.linear1=new b2Vec2;this.linear2=new b2Vec2};a.linear1=new b2Vec2;a.angular1=null;a.linear2=new b2Vec2;a.angular2=null;a.SetZero=function(){this.linear1.SetZero();this.angular1=0;this.linear2.SetZero();this.angular2=0};a.Set=function(b,c,d,e){this.linear1.SetV(b);this.angular1=c;this.linear2.SetV(d);this.angular2=e};
a.Compute=function(b,c,d,e){return this.linear1.x*b.x+this.linear1.y*b.y+this.angular1*c+(this.linear2.x*d.x+this.linear2.y*d.y)+this.angular2*e};var b2DebugDraw=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0};b2DebugDraw.prototype.__varz=function(){};b2DebugDraw.e_shapeBit=1;b2DebugDraw.e_jointBit=2;b2DebugDraw.e_coreShapeBit=4;b2DebugDraw.e_aabbBit=8;b2DebugDraw.e_obbBit=16;b2DebugDraw.e_pairBit=32;
b2DebugDraw.e_centerOfMassBit=64;a=b2DebugDraw.prototype;a.m_drawFlags=0;a.m_sprite=null;a.m_drawScale=1;a.m_lineThickness=1;a.m_alpha=1;a.m_fillAlpha=1;a.m_xformScale=1;a.SetFlags=function(b){this.m_drawFlags=b};a.GetFlags=function(){return this.m_drawFlags};a.AppendFlags=function(b){this.m_drawFlags|=b};a.ClearFlags=function(b){this.m_drawFlags&=~b};
a.DrawPolygon=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);for(d=1;d<c;d++)this.m_sprite.graphics.lineTo(b[d].x*this.m_drawScale,b[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale)};
a.DrawSolidPolygon=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);this.m_sprite.graphics.beginFill(d.color,this.m_fillAlpha);for(d=1;d<c;d++)this.m_sprite.graphics.lineTo(b[d].x*this.m_drawScale,b[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);this.m_sprite.graphics.endFill()};
a.DrawCircle=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.drawCircle(b.x*this.m_drawScale,b.y*this.m_drawScale,c*this.m_drawScale)};
a.DrawSolidCircle=function(b,c,d,e){this.m_sprite.graphics.lineStyle(this.m_lineThickness,e.color,this.m_alpha);this.m_sprite.graphics.moveTo(0,0);this.m_sprite.graphics.beginFill(e.color,this.m_fillAlpha);this.m_sprite.graphics.drawCircle(b.x*this.m_drawScale,b.y*this.m_drawScale,c*this.m_drawScale);this.m_sprite.graphics.endFill();this.m_sprite.graphics.moveTo(b.x*this.m_drawScale,b.y*this.m_drawScale);this.m_sprite.graphics.lineTo((b.x+d.x*c)*this.m_drawScale,(b.y+d.y*c)*this.m_drawScale)};
a.DrawSegment=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b.x*this.m_drawScale,b.y*this.m_drawScale);this.m_sprite.graphics.lineTo(c.x*this.m_drawScale,c.y*this.m_drawScale)};
a.DrawXForm=function(b){this.m_sprite.graphics.lineStyle(this.m_lineThickness,16711680,this.m_alpha);this.m_sprite.graphics.moveTo(b.position.x*this.m_drawScale,b.position.y*this.m_drawScale);this.m_sprite.graphics.lineTo((b.position.x+this.m_xformScale*b.R.col1.x)*this.m_drawScale,(b.position.y+this.m_xformScale*b.R.col1.y)*this.m_drawScale);this.m_sprite.graphics.lineStyle(this.m_lineThickness,65280,this.m_alpha);this.m_sprite.graphics.moveTo(b.position.x*this.m_drawScale,b.position.y*this.m_drawScale);
this.m_sprite.graphics.lineTo((b.position.x+this.m_xformScale*b.R.col2.x)*this.m_drawScale,(b.position.y+this.m_xformScale*b.R.col2.y)*this.m_drawScale)};var b2ContactEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactEdge.prototype;a.__constructor=function(){};a.__varz=function(){};a.other=null;a.contact=null;a.prev=null;a.next=null;var b2Sweep=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Sweep.prototype;a.__constructor=function(){};
a.__varz=function(){this.localCenter=new b2Vec2;this.c0=new b2Vec2;this.c=new b2Vec2};a.localCenter=new b2Vec2;a.c0=new b2Vec2;a.c=new b2Vec2;a.a0=null;a.a=null;a.t0=null;
a.GetXForm=function(b,c){if(1-this.t0>Number.MIN_VALUE){c=(c-this.t0)/(1-this.t0);b.position.x=(1-c)*this.c0.x+c*this.c.x;b.position.y=(1-c)*this.c0.y+c*this.c.y;b.R.Set((1-c)*this.a0+c*this.a)}else{b.position.SetV(this.c);b.R.Set(this.a)}c=b.R;b.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y;b.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y};
a.Advance=function(b){if(this.t0<b&&1-this.t0>Number.MIN_VALUE){var c=(b-this.t0)/(1-this.t0);this.c0.x=(1-c)*this.c0.x+c*this.c.x;this.c0.y=(1-c)*this.c0.y+c*this.c.y;this.a0=(1-c)*this.a0+c*this.a;this.t0=b}};var b2ContactConstraint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactConstraint.prototype;a.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b]=new b2ContactConstraintPoint};
a.__varz=function(){this.normal=new b2Vec2};a.points=null;a.normal=new b2Vec2;a.manifold=null;a.body1=null;a.body2=null;a.friction=null;a.restitution=null;a.pointCount=0;var b2Distance=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){};b2Distance.prototype.__varz=function(){};b2Distance.g_GJK_Iterations=0;b2Distance.s_p1s=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.s_p2s=[new b2Vec2,new b2Vec2,new b2Vec2];
b2Distance.s_points=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.gPoint=new b2Point;b2Distance.ProcessTwo=function(b,c,d,e,f){var h=f[0];f=f[1];var g=d[0];d=d[1];var i=e[0];e=e[1];var j=-f.x,k=-f.y,l=h.x-f.x,o=h.y-f.y,q=Math.sqrt(l*l+o*o);l/=q;o/=q;j=j*l+k*o;if(j<=0||q<Number.MIN_VALUE){b.SetV(d);c.SetV(e);g.SetV(d);i.SetV(e);h.SetV(f);return 1}j/=q;b.x=d.x+j*(g.x-d.x);b.y=d.y+j*(g.y-d.y);c.x=e.x+j*(i.x-e.x);c.y=e.y+j*(i.y-e.y);return 2};
b2Distance.ProcessThree=function(b,c,d,e,f){var h=f[0],g=f[1],i=f[2];f=d[0];var j=d[1];d=d[2];var k=e[0],l=e[1];e=e[2];var o=h.x,q=h.y,t=g.x,w=g.y,z=i.x,A=i.y,n=t-o,m=w-q,r=z-o,p=A-q,s=z-t,u=A-w,v=-(o*r+q*p),y=z*r+A*p,x=-(t*s+w*u);s=z*s+A*u;if(y<=0&&s<=0){b.SetV(d);c.SetV(e);f.SetV(d);k.SetV(e);h.SetV(i);return 1}m=n*p-m*r;n=m*(o*w-q*t);t=m*(t*A-w*z);if(t<=0&&x>=0&&s>=0&&x+s>0){v=x/(x+s);b.x=j.x+v*(d.x-j.x);b.y=j.y+v*(d.y-j.y);c.x=l.x+v*(e.x-l.x);c.y=l.y+v*(e.y-l.y);f.SetV(d);k.SetV(e);h.SetV(i);
return 2}h=m*(z*q-A*o);if(h<=0&&v>=0&&y>=0&&v+y>0){v/=v+y;b.x=f.x+v*(d.x-f.x);b.y=f.y+v*(d.y-f.y);c.x=k.x+v*(e.x-k.x);c.y=k.y+v*(e.y-k.y);j.SetV(d);l.SetV(e);g.SetV(i);return 2}i=t+h+n;i=1/i;g=t*i;h*=i;i=1-g-h;b.x=g*f.x+h*j.x+i*d.x;b.y=g*f.y+h*j.y+i*d.y;c.x=g*k.x+h*l.x+i*e.x;c.y=g*k.y+h*l.y+i*e.y;return 3};
b2Distance.InPoints=function(b,c,d){for(var e=100*Number.MIN_VALUE,f=0;f<d;++f){var h=c[f],g=Math.abs(b.x-h.x),i=Math.abs(b.y-h.y),j=Math.max(Math.abs(b.x),Math.abs(h.x));h=Math.max(Math.abs(b.y),Math.abs(h.y));if(g<e*(j+1)&&i<e*(h+1))return true}return false};
b2Distance.DistanceGeneric=function(b,c,d,e,f,h){var g,i=b2Distance.s_p1s,j=b2Distance.s_p2s,k=b2Distance.s_points,l=0;b.SetV(d.GetFirstVertex(e));c.SetV(f.GetFirstVertex(h));for(var o=0,q=0;q<20;++q){g=c.x-b.x;var t=c.y-b.y,w=d.Support(e,g,t),z=f.Support(h,-g,-t);o=g*g+t*t;var A=z.x-w.x,n=z.y-w.y;if(o-(g*A+t*n)<=0.01*o){if(l==0){b.SetV(w);c.SetV(z)}b2Distance.g_GJK_Iterations=q;return Math.sqrt(o)}switch(l){case 0:g=i[0];g.SetV(w);g=j[0];g.SetV(z);g=k[0];g.x=A;g.y=n;b.SetV(i[0]);c.SetV(j[0]);++l;
break;case 1:g=i[1];g.SetV(w);g=j[1];g.SetV(z);g=k[1];g.x=A;g.y=n;l=b2Distance.ProcessTwo(b,c,i,j,k);break;case 2:g=i[2];g.SetV(w);g=j[2];g.SetV(z);g=k[2];g.x=A;g.y=n;l=b2Distance.ProcessThree(b,c,i,j,k)}if(l==3){b2Distance.g_GJK_Iterations=q;return 0}w=-Number.MAX_VALUE;for(z=0;z<l;++z){g=k[z];w=b2Math.b2Max(w,g.x*g.x+g.y*g.y)}if(l==3||o<=100*Number.MIN_VALUE*w){b2Distance.g_GJK_Iterations=q;g=c.x-b.x;t=c.y-b.y;o=g*g+t*t;return Math.sqrt(o)}}b2Distance.g_GJK_Iterations=20;return Math.sqrt(o)};
b2Distance.DistanceCC=function(b,c,d,e,f,h){var g,i;g=e.R;i=d.m_localPosition;var j=e.position.x+(g.col1.x*i.x+g.col2.x*i.y);e=e.position.y+(g.col1.y*i.x+g.col2.y*i.y);g=h.R;i=f.m_localPosition;var k=h.position.x+(g.col1.x*i.x+g.col2.x*i.y);h=h.position.y+(g.col1.y*i.x+g.col2.y*i.y);g=k-j;i=h-e;var l=g*g+i*i;d=d.m_radius-b2Settings.b2_toiSlop;f=f.m_radius-b2Settings.b2_toiSlop;var o=d+f;if(l>o*o){l=Math.sqrt(g*g+i*i);g/=l;i/=l;l-=o;b.x=j+d*g;b.y=e+d*i;c.x=k-f*g;c.y=h-f*i;return l}else if(l>Number.MIN_VALUE*
Number.MIN_VALUE){l=Math.sqrt(g*g+i*i);g/=l;i/=l;b.x=j+d*g;b.y=e+d*i;c.x=b.x;c.y=b.y;return 0}b.x=j;b.y=e;c.x=b.x;c.y=b.y;return 0};
b2Distance.DistancePC=function(b,c,d,e,f,h){var g,i,j=b2Distance.gPoint;i=f.m_localPosition;g=h.R;j.p.x=h.position.x+(g.col1.x*i.x+g.col2.x*i.y);j.p.y=h.position.y+(g.col1.y*i.x+g.col2.y*i.y);d=b2Distance.DistanceGeneric(b,c,d,e,j,b2Math.b2XForm_identity);f=f.m_radius-b2Settings.b2_toiSlop;if(d>f){d-=f;e=c.x-b.x;b=c.y-b.y;h=Math.sqrt(e*e+b*b);e/=h;b/=h;c.x-=f*e;c.y-=f*b}else{d=0;c.x=b.x;c.y=b.y}return d};
b2Distance.Distance=function(b,c,d,e,f,h){var g=d.m_type,i=f.m_type;if(g==b2Shape.e_circleShape&&i==b2Shape.e_circleShape)return b2Distance.DistanceCC(b,c,d,e,f,h);if(g==b2Shape.e_polygonShape&&i==b2Shape.e_circleShape)return b2Distance.DistancePC(b,c,d,e,f,h);if(g==b2Shape.e_circleShape&&i==b2Shape.e_polygonShape)return b2Distance.DistancePC(c,b,f,h,d,e);if(g==b2Shape.e_polygonShape&&i==b2Shape.e_polygonShape)return b2Distance.DistanceGeneric(b,c,d,e,f,h);return 0};
var b2Shape=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(b){this.m_userData=b.userData;this.m_friction=b.friction;this.m_restitution=b.restitution;this.m_density=b.density;this.m_body=null;this.m_sweepRadius=0;this.m_next=null;this.m_proxyId=b2Pair.b2_nullProxy;this.m_filter=b.filter.Copy();this.m_isSensor=b.isSensor};b2Shape.prototype.__varz=function(){};b2Shape.e_unknownShape=-1;b2Shape.e_circleShape=0;b2Shape.e_polygonShape=1;
b2Shape.e_shapeTypeCount=2;b2Shape.e_hitCollide=1;b2Shape.e_missCollide=0;b2Shape.e_startsInsideCollide=-1;b2Shape.s_proxyAABB=new b2AABB;b2Shape.s_syncAABB=new b2AABB;b2Shape.s_resetAABB=new b2AABB;b2Shape.Create=function(b){switch(b.type){case b2Shape.e_circleShape:return new b2CircleShape(b);case b2Shape.e_polygonShape:return new b2PolygonShape(b);default:return null}};b2Shape.Destroy=function(){};a=b2Shape.prototype;a.m_type=0;a.m_next=null;a.m_body=null;a.m_sweepRadius=null;a.m_density=null;
a.m_friction=null;a.m_restitution=null;a.m_proxyId=0;a.m_filter=null;a.m_isSensor=null;a.m_userData=null;a.GetType=function(){return this.m_type};a.IsSensor=function(){return this.m_isSensor};a.SetFilterData=function(b){this.m_filter=b.Copy()};a.GetFilterData=function(){return this.m_filter.Copy()};a.GetBody=function(){return this.m_body};a.GetNext=function(){return this.m_next};a.GetUserData=function(){return this.m_userData};a.SetUserData=function(b){this.m_userData=b};a.TestPoint=function(){return false};
a.TestSegment=function(){return b2Shape.e_missCollide};a.ComputeAABB=function(){};a.ComputeSweptAABB=function(){};a.ComputeMass=function(){};a.GetSweepRadius=function(){return this.m_sweepRadius};a.GetFriction=function(){return this.m_friction};a.GetRestitution=function(){return this.m_restitution};a.CreateProxy=function(b,c){var d=b2Shape.s_proxyAABB;this.ComputeAABB(d,c);this.m_proxyId=b.InRange(d)?b.CreateProxy(d,this):b2Pair.b2_nullProxy};
a.DestroyProxy=function(b){if(this.m_proxyId!=b2Pair.b2_nullProxy){b.DestroyProxy(this.m_proxyId);this.m_proxyId=b2Pair.b2_nullProxy}};a.Synchronize=function(b,c,d){if(this.m_proxyId==b2Pair.b2_nullProxy)return false;var e=b2Shape.s_syncAABB;this.ComputeSweptAABB(e,c,d);if(b.InRange(e)){b.MoveProxy(this.m_proxyId,e);return true}else return false};
a.RefilterProxy=function(b,c){if(this.m_proxyId!=b2Pair.b2_nullProxy){b.DestroyProxy(this.m_proxyId);var d=b2Shape.s_resetAABB;this.ComputeAABB(d,c);this.m_proxyId=b.InRange(d)?b.CreateProxy(d,this):b2Pair.b2_nullProxy}};a.UpdateSweepRadius=function(){};var b2XForm=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2XForm.prototype;a.__constructor=function(b,c){if(b){this.position.SetV(b);this.R.SetM(c)}};a.__varz=function(){this.position=new b2Vec2;this.R=new b2Mat22};
a.position=new b2Vec2;a.R=new b2Mat22;a.Initialize=function(b,c){this.position.SetV(b);this.R.SetM(c)};a.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};a.Set=function(b){this.position.SetV(b.position);this.R.SetM(b.R)};var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype);a=b2DistanceJointDef.prototype;
a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Joint.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.length=null;a.frequencyHz=null;a.dampingRatio=null;
a.Initialize=function(b,c,d,e){this.body1=b;this.body2=c;this.localAnchor1.SetV(this.body1.GetLocalPoint(d));this.localAnchor2.SetV(this.body2.GetLocalPoint(e));b=e.x-d.x;d=e.y-d.y;this.length=Math.sqrt(b*b+d*d);this.dampingRatio=this.frequencyHz=0};var b2OBB=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2OBB.prototype;a.__constructor=function(){};a.__varz=function(){this.R=new b2Mat22;this.center=new b2Vec2;this.extents=new b2Vec2};a.R=new b2Mat22;a.center=new b2Vec2;
a.extents=new b2Vec2;var b2BodyDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2BodyDef.prototype;a.__constructor=function(){this.massData.center.SetZero();this.massData.mass=0;this.massData.I=0;this.userData=null;this.position.Set(0,0);this.angularDamping=this.linearDamping=this.angle=0;this.allowSleep=true;this.isBullet=this.fixedRotation=this.isSleeping=false};a.__varz=function(){this.massData=new b2MassData;this.position=new b2Vec2};a.massData=new b2MassData;
a.userData=null;a.position=new b2Vec2;a.angle=null;a.linearDamping=null;a.angularDamping=null;a.allowSleep=null;a.isSleeping=null;a.fixedRotation=null;a.isBullet=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype);a=b2PrismaticJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_prismaticJoint;this.localAxis1.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.localAxis1=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.localAxis1=new b2Vec2;a.referenceAngle=null;a.enableLimit=null;a.lowerTranslation=null;
a.upperTranslation=null;a.enableMotor=null;a.maxMotorForce=null;a.motorSpeed=null;a.Initialize=function(b,c,d,e){this.body1=b;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(d);this.localAnchor2=this.body2.GetLocalPoint(d);this.localAxis1=this.body1.GetLocalVector(e);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2ContactID=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2ContactID.prototype={key:function(){return this._key},key:function(b){this._key=b;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}};a=b2ContactID.prototype;a.__constructor=function(){this.features._m_id=this};a.__varz=function(){this.features=new Features};a.features=new Features;a._key=0;a.Set=function(b){this.key=b._key};
a.Copy=function(){var b=new b2ContactID;b.key=this._key;return b};var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype);a=b2RevoluteJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_revoluteJoint;this.localAnchor1.Set(0,0);this.localAnchor2.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=false};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.referenceAngle=null;a.enableLimit=null;a.lowerAngle=null;a.upperAngle=null;a.enableMotor=null;a.motorSpeed=null;
a.maxMotorTorque=null;a.Initialize=function(b,c,d){this.body1=b;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(d);this.localAnchor2=this.body2.GetLocalPoint(d);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2CircleShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype);a=b2CircleShape.prototype;a._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_type=b2Shape.e_circleShape;this.m_localPosition.SetV(b.localPosition);this.m_radius=b.radius};a.__varz=function(){this.m_localPosition=new b2Vec2};a.m_localPosition=new b2Vec2;a.m_radius=null;a.TestPoint=function(b,c){var d=b.R,e=b.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y);b=b.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);e=c.x-e;b=c.y-b;return e*e+b*b<=this.m_radius*this.m_radius};
a.TestSegment=function(b,c,d,e,f){var h=b.R,g=e.p1.x-(b.position.x+(h.col1.x*this.m_localPosition.x+h.col2.x*this.m_localPosition.y));b=e.p1.y-(b.position.y+(h.col1.y*this.m_localPosition.x+h.col2.y*this.m_localPosition.y));var i=g*g+b*b-this.m_radius*this.m_radius;if(i<0){c[0]=0;return b2Shape.e_startsInsideCollide}h=e.p2.x-e.p1.x;e=e.p2.y-e.p1.y;var j=g*h+b*e,k=h*h+e*e;i=j*j-k*i;if(i<0||k<Number.MIN_VALUE)return b2Shape.e_missCollide;i=-(j+Math.sqrt(i));if(0<=i&&i<=f*k){i/=k;c[0]=i;d.x=g+i*h;d.y=
b+i*e;d.Normalize();return b2Shape.e_hitCollide}return b2Shape.e_missCollide};a.ComputeAABB=function(b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y);c=c.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);b.lowerBound.Set(e-this.m_radius,c-this.m_radius);b.upperBound.Set(e+this.m_radius,c+this.m_radius)};
a.ComputeSweptAABB=function(b,c,d){var e;e=c.R;var f=c.position.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y);c=c.position.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y);e=d.R;var h=d.position.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y);d=d.position.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y);b.lowerBound.Set((f<h?f:h)-this.m_radius,(c<d?c:d)-this.m_radius);b.upperBound.Set((f>h?f:h)+this.m_radius,(c>d?c:d)+
this.m_radius)};a.ComputeMass=function(b){b.mass=this.m_density*b2Settings.b2_pi*this.m_radius*this.m_radius;b.center.SetV(this.m_localPosition);b.I=b.mass*(0.5*this.m_radius*this.m_radius+(this.m_localPosition.x*this.m_localPosition.x+this.m_localPosition.y*this.m_localPosition.y))};a.GetLocalPosition=function(){return this.m_localPosition};a.GetRadius=function(){return this.m_radius};
a.UpdateSweepRadius=function(b){var c=this.m_localPosition.x-b.x;b=this.m_localPosition.y-b.y;c=Math.sqrt(c*c+b*b);this.m_sweepRadius=c+this.m_radius-b2Settings.b2_toiSlop};var b2Joint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(b){this.m_type=b.type;this.m_next=this.m_prev=null;this.m_body1=b.body1;this.m_body2=b.body2;this.m_collideConnected=b.collideConnected;this.m_islandFlag=false;this.m_userData=b.userData};
b2Joint.prototype.__varz=function(){this.m_node1=new b2JointEdge;this.m_node2=new b2JointEdge};b2Joint.e_unknownJoint=0;b2Joint.e_revoluteJoint=1;b2Joint.e_prismaticJoint=2;b2Joint.e_distanceJoint=3;b2Joint.e_pulleyJoint=4;b2Joint.e_mouseJoint=5;b2Joint.e_gearJoint=6;b2Joint.e_inactiveLimit=0;b2Joint.e_atLowerLimit=1;b2Joint.e_atUpperLimit=2;b2Joint.e_equalLimits=3;
b2Joint.Create=function(b){var c=null;switch(b.type){case b2Joint.e_distanceJoint:c=new b2DistanceJoint(b);break;case b2Joint.e_mouseJoint:c=new b2MouseJoint(b);break;case b2Joint.e_prismaticJoint:c=new b2PrismaticJoint(b);break;case b2Joint.e_revoluteJoint:c=new b2RevoluteJoint(b);break;case b2Joint.e_pulleyJoint:c=new b2PulleyJoint(b);break;case b2Joint.e_gearJoint:c=new b2GearJoint(b)}return c};b2Joint.Destroy=function(){};a=b2Joint.prototype;a.m_type=0;a.m_prev=null;a.m_next=null;a.m_node1=new b2JointEdge;
a.m_node2=new b2JointEdge;a.m_body1=null;a.m_body2=null;a.m_inv_dt=null;a.m_islandFlag=null;a.m_collideConnected=null;a.m_userData=null;a.GetType=function(){return this.m_type};a.GetAnchor1=function(){return null};a.GetAnchor2=function(){return null};a.GetReactionForce=function(){return null};a.GetReactionTorque=function(){return 0};a.GetBody1=function(){return this.m_body1};a.GetBody2=function(){return this.m_body2};a.GetNext=function(){return this.m_next};a.GetUserData=function(){return this.m_userData};
a.SetUserData=function(b){this.m_userData=b};a.InitVelocityConstraints=function(){};a.SolveVelocityConstraints=function(){};a.InitPositionConstraints=function(){};a.SolvePositionConstraints=function(){return false};var b2GearJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype);a=b2GearJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);var c=b.joint1.m_type,d=b.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;this.m_ground1=b.joint1.m_body1;this.m_body1=b.joint1.m_body2;if(c==b2Joint.e_revoluteJoint){this.m_revolute1=b.joint1;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);c=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=b.joint1;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);c=this.m_prismatic1.GetJointTranslation()}this.m_ground2=b.joint2.m_body1;this.m_body2=b.joint2.m_body2;if(d==b2Joint.e_revoluteJoint){this.m_revolute2=b.joint2;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);d=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=b.joint2;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);
d=this.m_prismatic2.GetJointTranslation()}this.m_ratio=b.ratio;this.m_constant=c+this.m_ratio*d;this.m_force=0};a.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_J=new b2Jacobian};a.m_ground1=null;a.m_ground2=null;a.m_revolute1=null;a.m_prismatic1=null;a.m_revolute2=null;a.m_prismatic2=null;a.m_groundAnchor1=new b2Vec2;a.m_groundAnchor2=new b2Vec2;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;
a.m_J=new b2Jacobian;a.m_constant=null;a.m_ratio=null;a.m_mass=null;a.m_force=null;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){return new b2Vec2(this.m_force*this.m_J.linear2.x,this.m_force*this.m_J.linear2.y)};
a.GetReactionTorque=function(){var b=this.m_body2.m_xf.R,c=this.m_localAnchor1.x-this.m_body2.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_body2.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d;c=e;return this.m_force*this.m_J.angular2-(c*this.m_force*this.m_J.linear2.y-d*this.m_force*this.m_J.linear2.x)};a.GetRatio=function(){return this.m_ratio};
a.InitVelocityConstraints=function(b){var c=this.m_ground1,d=this.m_ground2,e=this.m_body1,f=this.m_body2,h,g,i,j,k,l=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angular1=-1;l+=e.m_invI}else{j=c.m_xf.R;h=this.m_prismatic1.m_localXAxis1;c=j.col1.x*h.x+j.col2.x*h.y;h=j.col1.y*h.x+j.col2.y*h.y;j=e.m_xf.R;g=this.m_localAnchor1.x-e.m_sweep.localCenter.x;i=this.m_localAnchor1.y-e.m_sweep.localCenter.y;k=j.col1.x*g+j.col2.x*i;i=j.col1.y*g+j.col2.y*i;g=k;j=g*h-i*c;this.m_J.linear1.Set(-c,-h);this.m_J.angular1=
-j;l+=e.m_invMass+e.m_invI*j*j}if(this.m_revolute2){this.m_J.angular2=-this.m_ratio;l+=this.m_ratio*this.m_ratio*f.m_invI}else{j=d.m_xf.R;h=this.m_prismatic2.m_localXAxis1;c=j.col1.x*h.x+j.col2.x*h.y;h=j.col1.y*h.x+j.col2.y*h.y;j=f.m_xf.R;g=this.m_localAnchor2.x-f.m_sweep.localCenter.x;i=this.m_localAnchor2.y-f.m_sweep.localCenter.y;k=j.col1.x*g+j.col2.x*i;i=j.col1.y*g+j.col2.y*i;g=k;j=g*h-i*c;this.m_J.linear2.Set(-this.m_ratio*c,-this.m_ratio*h);this.m_J.angular2=-this.m_ratio*j;l+=this.m_ratio*
this.m_ratio*(f.m_invMass+f.m_invI*j*j)}this.m_mass=1/l;if(b.warmStarting){b=b.dt*this.m_force;e.m_linearVelocity.x+=e.m_invMass*b*this.m_J.linear1.x;e.m_linearVelocity.y+=e.m_invMass*b*this.m_J.linear1.y;e.m_angularVelocity+=e.m_invI*b*this.m_J.angular1;f.m_linearVelocity.x+=f.m_invMass*b*this.m_J.linear2.x;f.m_linearVelocity.y+=f.m_invMass*b*this.m_J.linear2.y;f.m_angularVelocity+=f.m_invI*b*this.m_J.angular2}else this.m_force=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e=this.m_J.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);e=-b.inv_dt*this.m_mass*e;this.m_force+=e;b=b.dt*e;c.m_linearVelocity.x+=c.m_invMass*b*this.m_J.linear1.x;c.m_linearVelocity.y+=c.m_invMass*b*this.m_J.linear1.y;c.m_angularVelocity+=c.m_invI*b*this.m_J.angular1;d.m_linearVelocity.x+=d.m_invMass*b*this.m_J.linear2.x;d.m_linearVelocity.y+=d.m_invMass*b*this.m_J.linear2.y;d.m_angularVelocity+=
d.m_invI*b*this.m_J.angular2};
a.SolvePositionConstraints=function(){var b=this.m_body1,c=this.m_body2,d,e;d=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();e=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();d=-this.m_mass*(this.m_constant-(d+this.m_ratio*e));b.m_sweep.c.x+=b.m_invMass*d*this.m_J.linear1.x;b.m_sweep.c.y+=b.m_invMass*d*this.m_J.linear1.y;b.m_sweep.a+=b.m_invI*d*this.m_J.angular1;c.m_sweep.c.x+=c.m_invMass*d*this.m_J.linear2.x;c.m_sweep.c.y+=
c.m_invMass*d*this.m_J.linear2.y;c.m_sweep.a+=c.m_invI*d*this.m_J.angular2;b.SynchronizeTransform();c.SynchronizeTransform();return 0<b2Settings.b2_linearSlop};var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype);a=b2GearJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};a.__varz=function(){};a.joint1=null;a.joint2=null;a.ratio=null;var b2BroadPhase=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2BroadPhase.prototype.__constructor=function(b,c){var d=0;this.m_pairManager.Initialize(this,c);this.m_worldAABB=b;for(d=this.m_proxyCount=0;d<b2Settings.b2_maxProxies;d++){this.m_queryResults[d]=0;this.m_querySortKeys[d]=0}this.m_bounds=Array(2);for(d=0;d<2;d++){this.m_bounds[d]=Array(2*b2Settings.b2_maxProxies);for(c=0;c<2*b2Settings.b2_maxProxies;c++)this.m_bounds[d][c]=new b2Bound}d=b.upperBound.y-b.lowerBound.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/(b.upperBound.x-b.lowerBound.x);
this.m_quantizationFactor.y=b2Settings.USHRT_MAX/d;for(d=0;d<b2Settings.b2_maxProxies-1;++d){b=new b2Proxy;this.m_proxyPool[d]=b;b.SetNext(d+1);b.timeStamp=0;b.overlapCount=b2BroadPhase.b2_invalid;b.userData=null}b=new b2Proxy;this.m_proxyPool[parseInt(b2Settings.b2_maxProxies-1)]=b;b.SetNext(b2Pair.b2_nullProxy);b.timeStamp=0;b.overlapCount=b2BroadPhase.b2_invalid;b.userData=null;this.m_freeProxy=0;this.m_timeStamp=1;this.m_queryResultCount=0};
b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager;this.m_proxyPool=Array(b2Settings.b2_maxPairs);this.m_bounds=Array(2*b2Settings.b2_maxProxies);this.m_querySortKeys=Array(b2Settings.b2_maxProxies);this.m_queryResults=Array(b2Settings.b2_maxProxies);this.m_quantizationFactor=new b2Vec2};b2BroadPhase.s_validate=false;b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX;b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX;
b2BroadPhase.BinarySearch=function(b,c,d){var e=0;for(c-=1;e<=c;){var f=Math.round((e+c)/2),h=b[f];if(h.value>d)c=f-1;else if(h.value<d)e=f+1;else return parseInt(f)}return parseInt(e)};a=b2BroadPhase.prototype;a.m_pairManager=new b2PairManager;a.m_proxyPool=Array(b2Settings.b2_maxPairs);a.m_freeProxy=0;a.m_bounds=Array(2*b2Settings.b2_maxProxies);a.m_querySortKeys=Array(b2Settings.b2_maxProxies);a.m_queryResults=Array(b2Settings.b2_maxProxies);a.m_queryResultCount=0;a.m_worldAABB=null;
a.m_quantizationFactor=new b2Vec2;a.m_proxyCount=0;a.m_timeStamp=0;
a.ComputeBounds=function(b,c,d){var e=d.lowerBound.x,f=d.lowerBound.y;e=b2Math.b2Min(e,this.m_worldAABB.upperBound.x);f=b2Math.b2Min(f,this.m_worldAABB.upperBound.y);e=b2Math.b2Max(e,this.m_worldAABB.lowerBound.x);f=b2Math.b2Max(f,this.m_worldAABB.lowerBound.y);var h=d.upperBound.x;d=d.upperBound.y;h=b2Math.b2Min(h,this.m_worldAABB.upperBound.x);d=b2Math.b2Min(d,this.m_worldAABB.upperBound.y);h=b2Math.b2Max(h,this.m_worldAABB.lowerBound.x);d=b2Math.b2Max(d,this.m_worldAABB.lowerBound.y);b[0]=parseInt(this.m_quantizationFactor.x*
(e-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1;c[0]=parseInt(this.m_quantizationFactor.x*(h-this.m_worldAABB.lowerBound.x))%65535|1;b[1]=parseInt(this.m_quantizationFactor.y*(f-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1;c[1]=parseInt(this.m_quantizationFactor.y*(d-this.m_worldAABB.lowerBound.y))%65535|1};
a.TestOverlapValidate=function(b,c){for(var d=0;d<2;++d){var e=this.m_bounds[d],f=e[b.lowerBounds[d]],h=e[c.upperBounds[d]];if(f.value>h.value)return false;f=e[b.upperBounds[d]];h=e[c.lowerBounds[d]];if(f.value<h.value)return false}return true};
a.Query=function(b,c,d,e,f,h,g){d=b2BroadPhase.BinarySearch(f,h,d);e=b2BroadPhase.BinarySearch(f,h,e);for(var i=d;i<e;++i){h=f[i];h.IsLower()&&this.IncrementOverlapCount(h.proxyId)}if(d>0){i=d-1;h=f[i];for(var j=h.stabbingCount;j>0;){h=f[i];if(h.IsLower())if(d<=this.m_proxyPool[h.proxyId].upperBounds[g]){this.IncrementOverlapCount(h.proxyId);--j}--i}}b[0]=d;c[0]=e};
a.IncrementOverlapCount=function(b){var c=this.m_proxyPool[b];if(c.timeStamp<this.m_timeStamp){c.timeStamp=this.m_timeStamp;c.overlapCount=1}else{c.overlapCount=2;this.m_queryResults[this.m_queryResultCount]=b;++this.m_queryResultCount}};a.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var b=0;b<b2Settings.b2_maxProxies;++b)this.m_proxyPool[b].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp};
a.AddProxyResult=function(b,c,d,e){e=e(c.userData);if(!(e<0)){for(c=0;c<this.m_queryResultCount&&this.m_querySortKeys[c]<e;)c++;this.m_queryResultCount+=1;if(this.m_queryResultCount>d)this.m_queryResultCount=d;for(;c<this.m_queryResultCount;){d=this.m_querySortKeys[c];var f=this.m_queryResults[c];this.m_querySortKeys[c]=e;this.m_queryResults[c]=b;e=d;b=f;c++}}};
a.InRange=function(b){var c,d,e,f;c=b.lowerBound.x;d=b.lowerBound.y;c-=this.m_worldAABB.upperBound.x;d-=this.m_worldAABB.upperBound.y;e=this.m_worldAABB.lowerBound.x;f=this.m_worldAABB.lowerBound.y;e-=b.upperBound.x;f-=b.upperBound.y;c=b2Math.b2Max(c,e);d=b2Math.b2Max(d,f);return b2Math.b2Max(c,d)<0};a.GetProxy=function(b){var c=this.m_proxyPool[b];if(b==b2Pair.b2_nullProxy||c.IsValid()==false)return null;return c};
a.CreateProxy=function(b,c){var d=0,e,f=this.m_freeProxy;e=this.m_proxyPool[f];this.m_freeProxy=e.GetNext();e.overlapCount=0;e.userData=c;c=2*this.m_proxyCount;e=[];var h=[];this.ComputeBounds(e,h,b);for(b=0;b<2;++b){var g=this.m_bounds[b],i=0,j=0;i=[i];j=[j];this.Query(i,j,e[b],h[b],g,c,b);i=i[0];j=j[0];var k=[],l=0,o=c-j,q;for(l=0;l<o;l++){k[l]=new b2Bound;q=k[l];d=g[parseInt(j+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}o=k.length;var t=j+2;for(l=0;l<o;l++){d=k[l];q=
g[parseInt(t+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}k=[];o=j-i;for(l=0;l<o;l++){k[l]=new b2Bound;q=k[l];d=g[parseInt(i+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}o=k.length;t=i+1;for(l=0;l<o;l++){d=k[l];q=g[parseInt(t+l)];q.value=d.value;q.proxyId=d.proxyId;q.stabbingCount=d.stabbingCount}++j;q=g[i];d=g[j];q.value=e[b];q.proxyId=f;d.value=h[b];d.proxyId=f;k=g[parseInt(i-1)];q.stabbingCount=i==0?0:k.stabbingCount;k=g[parseInt(j-1)];d.stabbingCount=
k.stabbingCount;for(d=i;d<j;++d){k=g[d];k.stabbingCount++}for(d=i;d<c+2;++d){q=g[d];i=this.m_proxyPool[q.proxyId];if(q.IsLower())i.lowerBounds[b]=d;else i.upperBounds[b]=d}}++this.m_proxyCount;for(c=0;c<this.m_queryResultCount;++c)this.m_pairManager.AddBufferedPair(f,this.m_queryResults[c]);this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();return f};
a.DestroyProxy=function(b){for(var c,d,e=this.m_proxyPool[b],f=2*this.m_proxyCount,h=0;h<2;++h){var g=this.m_bounds[h],i=e.lowerBounds[h],j=e.upperBounds[h];c=g[i];var k=c.value;d=g[j];var l=d.value,o=[],q=0,t=j-i-1;for(q=0;q<t;q++){o[q]=new b2Bound;c=o[q];d=g[parseInt(i+1+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}t=o.length;var w=i;for(q=0;q<t;q++){d=o[q];c=g[parseInt(w+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}o=[];t=f-j-1;for(q=0;q<t;q++){o[q]=
new b2Bound;c=o[q];d=g[parseInt(j+1+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}t=o.length;w=j-1;for(q=0;q<t;q++){d=o[q];c=g[parseInt(w+q)];c.value=d.value;c.proxyId=d.proxyId;c.stabbingCount=d.stabbingCount}t=f-2;for(d=i;d<t;++d){c=g[d];o=this.m_proxyPool[c.proxyId];if(c.IsLower())o.lowerBounds[h]=d;else o.upperBounds[h]=d}for(t=j-1;i<t;++i){c=g[i];c.stabbingCount--}this.Query([0],[0],k,l,g,f-2,h)}for(c=0;c<this.m_queryResultCount;++c)this.m_pairManager.RemoveBufferedPair(b,
this.m_queryResults[c]);this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();e.userData=null;e.overlapCount=b2BroadPhase.b2_invalid;e.lowerBounds[0]=b2BroadPhase.b2_invalid;e.lowerBounds[1]=b2BroadPhase.b2_invalid;e.upperBounds[0]=b2BroadPhase.b2_invalid;e.upperBounds[1]=b2BroadPhase.b2_invalid;e.SetNext(this.m_freeProxy);this.m_freeProxy=b;--this.m_proxyCount};
a.MoveProxy=function(b,c){var d,e,f=0,h=0,g;if(!(b==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=b))if(c.IsValid()!=false){var i=2*this.m_proxyCount,j=this.m_proxyPool[b],k=new b2BoundValues;this.ComputeBounds(k.lowerValues,k.upperValues,c);var l=new b2BoundValues;for(f=0;f<2;++f){c=this.m_bounds[f][j.lowerBounds[f]];l.lowerValues[f]=c.value;c=this.m_bounds[f][j.upperBounds[f]];l.upperValues[f]=c.value}for(f=0;f<2;++f){var o=this.m_bounds[f],q=j.lowerBounds[f],t=j.upperBounds[f],w=k.lowerValues[f],
z=k.upperValues[f];c=o[q];var A=w-c.value;c.value=w;c=o[t];var n=z-c.value;c.value=z;if(A<0)for(h=q;h>0&&w<o[parseInt(h-1)].value;){c=o[h];g=o[parseInt(h-1)];d=g.proxyId;e=this.m_proxyPool[g.proxyId];g.stabbingCount++;if(g.IsUpper()==true){this.TestOverlap(k,e)&&this.m_pairManager.AddBufferedPair(b,d);d=e.upperBounds;e=d[f];e++;d[f]=e;c.stabbingCount++}else{d=e.lowerBounds;e=d[f];e++;d[f]=e;c.stabbingCount--}d=j.lowerBounds;e=d[f];e--;d[f]=e;c.Swap(g);--h}if(n>0)for(h=t;h<i-1&&o[parseInt(h+1)].value<=
z;){c=o[h];g=o[parseInt(h+1)];d=g.proxyId;e=this.m_proxyPool[d];g.stabbingCount++;if(g.IsLower()==true){this.TestOverlap(k,e)&&this.m_pairManager.AddBufferedPair(b,d);d=e.lowerBounds;e=d[f];e--;d[f]=e;c.stabbingCount++}else{d=e.upperBounds;e=d[f];e--;d[f]=e;c.stabbingCount--}d=j.upperBounds;e=d[f];e++;d[f]=e;c.Swap(g);h++}if(A>0)for(h=q;h<i-1&&o[parseInt(h+1)].value<=w;){c=o[h];g=o[parseInt(h+1)];d=g.proxyId;e=this.m_proxyPool[d];g.stabbingCount--;if(g.IsUpper()){this.TestOverlap(l,e)&&this.m_pairManager.RemoveBufferedPair(b,
d);d=e.upperBounds;e=d[f];e--;d[f]=e;c.stabbingCount--}else{d=e.lowerBounds;e=d[f];e--;d[f]=e;c.stabbingCount++}d=j.lowerBounds;e=d[f];e++;d[f]=e;c.Swap(g);h++}if(n<0)for(h=t;h>0&&z<o[parseInt(h-1)].value;){c=o[h];g=o[parseInt(h-1)];d=g.proxyId;e=this.m_proxyPool[d];g.stabbingCount--;if(g.IsLower()==true){this.TestOverlap(l,e)&&this.m_pairManager.RemoveBufferedPair(b,d);d=e.lowerBounds;e=d[f];e++;d[f]=e;c.stabbingCount--}else{d=e.upperBounds;e=d[f];e++;d[f]=e;c.stabbingCount++}d=j.upperBounds;e=d[f];
e--;d[f]=e;c.Swap(g);h--}}}};a.Commit=function(){this.m_pairManager.Commit()};a.QueryAABB=function(b,c,d){var e=[],f=[];this.ComputeBounds(e,f,b);b=[0];var h=[0];this.Query(b,h,e[0],f[0],this.m_bounds[0],2*this.m_proxyCount,0);this.Query(b,h,e[1],f[1],this.m_bounds[1],2*this.m_proxyCount,1);for(f=e=0;f<this.m_queryResultCount&&e<d;++f,++e)c[f]=this.m_proxyPool[this.m_queryResults[f]].userData;this.m_queryResultCount=0;this.IncrementTimeStamp();return e};
a.Validate=function(){for(var b=0;b<2;++b)for(var c=this.m_bounds[b],d=2*this.m_proxyCount,e=0,f=0;f<d;++f)if(c[f].IsLower()==true)e++;else e--};
a.QuerySegment=function(b,c,d,e){var f=(b.p2.x-b.p1.x)*this.m_quantizationFactor.x,h=(b.p2.y-b.p1.y)*this.m_quantizationFactor.y,g=f<-Number.MIN_VALUE?-1:f>Number.MIN_VALUE?1:0,i=h<-Number.MIN_VALUE?-1:h>Number.MIN_VALUE?1:0,j=this.m_quantizationFactor.x*(b.p1.x-this.m_worldAABB.lowerBound.x);b=this.m_quantizationFactor.y*(b.p1.y-this.m_worldAABB.lowerBound.y);var k=[],l=[];k[0]=parseInt(j)&b2Settings.USHRT_MAX-1;k[1]=parseInt(b)&b2Settings.USHRT_MAX-1;l[0]=k[0]+1;l[1]=k[1]+1;var o=0,q=0,t=0;q=[0];
t=[0];this.Query(q,t,k[0],l[0],this.m_bounds[0],2*this.m_proxyCount,0);o=g>=0?t[0]-1:q[0];this.Query(q,t,k[1],l[1],this.m_bounds[1],2*this.m_proxyCount,1);q=i>=0?t[0]-1:q[0];if(e!=null){for(k=0;k<this.m_queryResultCount;k++)this.m_querySortKeys[k]=e(this.m_proxyPool[this.m_queryResults[k]].userData);for(k=0;k<this.m_queryResultCount-1;){l=this.m_querySortKeys[k];t=this.m_querySortKeys[k+1];if(l<0?t>=0:l>t&&t>=0){this.m_querySortKeys[k+1]=l;this.m_querySortKeys[k]=t;l=this.m_queryResults[k+1];this.m_queryResults[k+
1]=this.m_queryResults[k];this.m_queryResults[k]=l;k--;if(k==-1)k=1}else k++}for(;this.m_queryResultCount>0&&this.m_querySortKeys[this.m_queryResultCount-1]<0;)this.m_queryResultCount--}k=true;var w,z;if(o<0||o>=this.m_proxyCount*2)k=false;if(q<0||q>=this.m_proxyCount*2)k=false;if(k){if(g!=0){if(g>0){o++;if(o==this.m_proxyCount*2)k=false}else{o--;if(o<0)k=false}w=(this.m_bounds[0][o].value-j)/f}if(i!=0){if(i>0){q++;if(q==this.m_proxyCount*2)k=false}else{q--;if(q<0)k=false}z=(this.m_bounds[1][q].value-
b)/h}}for(;k;)if(i==0||g!=0&&w<z){if(w>1)break;if(g>0?this.m_bounds[0][o].IsLower():this.m_bounds[0][o].IsUpper()){t=this.m_bounds[0][o].proxyId;l=this.m_proxyPool[t];if(i>=0){if(l.lowerBounds[1]<=q-1&&l.upperBounds[1]>=q)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;++this.m_queryResultCount}}else if(l.lowerBounds[1]<=q&&l.upperBounds[1]>=q+1)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;++this.m_queryResultCount}}if(e!=
null&&this.m_queryResultCount==d&&this.m_queryResultCount>0&&w>this.m_querySortKeys[this.m_queryResultCount-1])break;if(g>0){o++;if(o==this.m_proxyCount*2)break}else{o--;if(o<0)break}w=(this.m_bounds[0][o].value-j)/f}else{if(z>1)break;if(i>0?this.m_bounds[1][q].IsLower():this.m_bounds[1][q].IsUpper()){t=this.m_bounds[1][q].proxyId;l=this.m_proxyPool[t];if(g>=0){if(l.lowerBounds[0]<=o-1&&l.upperBounds[0]>=o)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;
++this.m_queryResultCount}}else if(l.lowerBounds[0]<=o&&l.upperBounds[0]>=o+1)if(e!=null)this.AddProxyResult(t,l,d,e);else{this.m_queryResults[this.m_queryResultCount]=t;++this.m_queryResultCount}}if(e!=null&&this.m_queryResultCount==d&&this.m_queryResultCount>0&&z>this.m_querySortKeys[this.m_queryResultCount-1])break;if(i>0){q++;if(q==this.m_proxyCount*2)break}else{q--;if(q<0)break}z=(this.m_bounds[1][q].value-b)/h}for(k=e=0;k<this.m_queryResultCount&&e<d;++k,++e){l=this.m_proxyPool[this.m_queryResults[k]];
c[k]=l.userData}this.m_queryResultCount=0;this.IncrementTimeStamp();return e};a.TestOverlap=function(b,c){for(var d=0;d<2;++d){var e=this.m_bounds[d],f=e[c.upperBounds[d]];if(b.lowerValues[d]>f.value)return false;f=e[c.lowerBounds[d]];if(b.upperValues[d]<f.value)return false}return true};var b2TimeOfImpact=function(){this.__varz();this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){};b2TimeOfImpact.prototype.__varz=function(){};b2TimeOfImpact.s_p1=new b2Vec2;
b2TimeOfImpact.s_p2=new b2Vec2;b2TimeOfImpact.s_xf1=new b2XForm;b2TimeOfImpact.s_xf2=new b2XForm;
b2TimeOfImpact.TimeOfImpact=function(b,c,d,e){var f,h,g=b.m_sweepRadius,i=d.m_sweepRadius,j=c.t0,k=c.c.x-c.c0.x,l=c.c.y-c.c0.y,o=e.c.x-e.c0.x,q=e.c.y-e.c0.y,t=c.a-c.a0,w=e.a-e.a0,z=0,A=b2TimeOfImpact.s_p1,n=b2TimeOfImpact.s_p2,m=0,r=0,p=0;for(f=0;;){p=(1-z)*j+z;h=b2TimeOfImpact.s_xf1;r=b2TimeOfImpact.s_xf2;c.GetXForm(h,p);e.GetXForm(r,p);p=b2Distance.Distance(A,n,b,h,d,r);if(m==0)if(p>2*b2Settings.b2_toiSlop)f=1.5*b2Settings.b2_toiSlop;else{f=0.05*b2Settings.b2_toiSlop;h=p-0.5*b2Settings.b2_toiSlop;
f=f>h?f:h}if(p-f<0.05*b2Settings.b2_toiSlop||m==20)break;h=n.x-A.x;r=n.y-A.y;var s=Math.sqrt(h*h+r*r);h/=s;r/=s;h=h*(k-o)+r*(l-q)+(t<0?-t:t)*g+(w<0?-w:w)*i;if(h==0){z=1;break}p=z+(p-f)/h;if(p<0||1<p){z=1;break}if(p<(1+100*Number.MIN_VALUE)*z)break;z=p;++m}return z};var b2ShapeDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ShapeDef.prototype;a.__constructor=function(){};a.__varz=function(){this.type=b2Shape.e_unknownShape;this.filter=new b2FilterData};a.type=b2Shape.e_unknownShape;
a.userData=null;a.friction=0.2;a.restitution=0;a.density=0;a.isSensor=false;a.filter=new b2FilterData;var b2PolygonDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonDef.prototype,b2ShapeDef.prototype);b2PolygonDef.prototype._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};
b2PolygonDef.prototype.__constructor=function(){this.type=b2Shape.e_polygonShape;for(var b=this.vertexCount=0;b<b2Settings.b2_maxPolygonVertices;b++)this.vertices[b]=new b2Vec2};b2PolygonDef.prototype.__varz=function(){this.vertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonDef.s_mat=new b2Mat22;b2PolygonDef.prototype.vertices=Array(b2Settings.b2_maxPolygonVertices);b2PolygonDef.prototype.vertexCount=0;
b2PolygonDef.prototype.SetAsBox=function(b,c){this.vertexCount=4;this.vertices[0].Set(-b,-c);this.vertices[1].Set(b,-c);this.vertices[2].Set(b,c);this.vertices[3].Set(-b,c)};
b2PolygonDef.prototype.SetAsOrientedBox=function(b,c,d,e){this.vertexCount=4;this.vertices[0].Set(-b,-c);this.vertices[1].Set(b,-c);this.vertices[2].Set(b,c);this.vertices[3].Set(-b,c);if(d){c=d;var f=b2PolygonDef.s_mat;f.Set(e);for(e=0;e<this.vertexCount;++e){d=this.vertices[e];b=c.x+(f.col1.x*d.x+f.col2.x*d.y);d.y=c.y+(f.col1.y*d.x+f.col2.y*d.y);d.x=b}}};var b2Contact=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Contact.prototype.__constructor=function(b,c){this.m_flags=0;if(!b||!c)this.m_shape2=this.m_shape1=null;else{if(b.IsSensor()||c.IsSensor())this.m_flags|=b2Contact.e_nonSolidFlag;this.m_shape1=b;this.m_shape2=c;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_next=this.m_prev=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;
this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null}};b2Contact.prototype.__varz=function(){this.m_node1=new b2ContactEdge;this.m_node2=new b2ContactEdge};b2Contact.e_nonSolidFlag=1;b2Contact.e_slowFlag=2;b2Contact.e_islandFlag=4;b2Contact.e_toiFlag=8;b2Contact.s_registers=null;b2Contact.s_initialized=false;
b2Contact.AddType=function(b,c,d,e){b2Contact.s_registers[d][e].createFcn=b;b2Contact.s_registers[d][e].destroyFcn=c;b2Contact.s_registers[d][e].primary=true;if(d!=e){b2Contact.s_registers[e][d].createFcn=b;b2Contact.s_registers[e][d].destroyFcn=c;b2Contact.s_registers[e][d].primary=false}};
b2Contact.InitializeRegisters=function(){b2Contact.s_registers=Array(b2Shape.e_shapeTypeCount);for(var b=0;b<b2Shape.e_shapeTypeCount;b++){b2Contact.s_registers[b]=Array(b2Shape.e_shapeTypeCount);for(var c=0;c<b2Shape.e_shapeTypeCount;c++)b2Contact.s_registers[b][c]=new b2ContactRegister}b2Contact.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,
b2Shape.e_circleShape);b2Contact.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape)};b2Contact.Create=function(b,c,d){if(b2Contact.s_initialized==false){b2Contact.InitializeRegisters();b2Contact.s_initialized=true}var e=b2Contact.s_registers[b.m_type][c.m_type],f=e.createFcn;if(f!=null)if(e.primary)return f(b,c,d);else{b=f(c,b,d);for(c=0;c<b.m_manifoldCount;++c){d=b.GetManifolds()[c];d.normal=d.normal.Negative()}return b}else return null};
b2Contact.Destroy=function(b,c){if(b.m_manifoldCount>0){b.m_shape1.m_body.WakeUp();b.m_shape2.m_body.WakeUp()}var d=b2Contact.s_registers[b.m_shape1.m_type][b.m_shape2.m_type].destroyFcn;d(b,c)};a=b2Contact.prototype;a.m_flags=0;a.m_prev=null;a.m_next=null;a.m_node1=new b2ContactEdge;a.m_node2=new b2ContactEdge;a.m_shape1=null;a.m_shape2=null;a.m_manifoldCount=0;a.m_friction=null;a.m_restitution=null;a.m_toi=null;a.GetManifolds=function(){return null};a.GetManifoldCount=function(){return this.m_manifoldCount};
a.IsSolid=function(){return(this.m_flags&b2Contact.e_nonSolidFlag)==0};a.GetNext=function(){return this.m_next};a.GetShape1=function(){return this.m_shape1};a.GetShape2=function(){return this.m_shape2};a.Update=function(b){var c=this.m_manifoldCount;this.Evaluate(b);b=this.m_shape1.m_body;var d=this.m_shape2.m_body;if(this.m_manifoldCount==0&&c>0){b.WakeUp();d.WakeUp()}if(b.IsStatic()||b.IsBullet()||d.IsStatic()||d.IsBullet())this.m_flags&=~b2Contact.e_slowFlag;else this.m_flags|=b2Contact.e_slowFlag};
a.Evaluate=function(){};var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype);a=b2DistanceJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_length=b.length;this.m_frequencyHz=b.frequencyHz;this.m_dampingRatio=b.dampingRatio;this.m_inv_dt=this.m_bias=this.m_gamma=this.m_impulse=0};a.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u=new b2Vec2};a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_u=new b2Vec2;a.m_frequencyHz=null;a.m_dampingRatio=null;
a.m_gamma=null;a.m_bias=null;a.m_impulse=null;a.m_mass=null;a.m_length=null;
a.InitVelocityConstraints=function(b){var c,d;this.m_inv_dt=b.inv_dt;var e=this.m_body1,f=this.m_body2;c=e.m_xf.R;var h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,g=this.m_localAnchor1.y-e.m_sweep.localCenter.y;d=c.col1.x*h+c.col2.x*g;g=c.col1.y*h+c.col2.y*g;h=d;c=f.m_xf.R;var i=this.m_localAnchor2.x-f.m_sweep.localCenter.x,j=this.m_localAnchor2.y-f.m_sweep.localCenter.y;d=c.col1.x*i+c.col2.x*j;j=c.col1.y*i+c.col2.y*j;i=d;this.m_u.x=f.m_sweep.c.x+i-e.m_sweep.c.x-h;this.m_u.y=f.m_sweep.c.y+j-e.m_sweep.c.y-
g;d=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);d>b2Settings.b2_linearSlop?this.m_u.Multiply(1/d):this.m_u.SetZero();c=h*this.m_u.y-g*this.m_u.x;var k=i*this.m_u.y-j*this.m_u.x;c=e.m_invMass+e.m_invI*c*c+f.m_invMass+f.m_invI*k*k;this.m_mass=1/c;if(this.m_frequencyHz>0){d-=this.m_length;k=2*Math.PI*this.m_frequencyHz;var l=this.m_mass*k*k;this.m_gamma=1/(b.dt*(2*this.m_mass*this.m_dampingRatio*k+b.dt*l));this.m_bias=d*b.dt*l*this.m_gamma;this.m_mass=1/(c+this.m_gamma)}if(b.warmStarting){this.m_impulse*=
b.dtRatio;b=this.m_impulse*this.m_u.x;c=this.m_impulse*this.m_u.y;e.m_linearVelocity.x-=e.m_invMass*b;e.m_linearVelocity.y-=e.m_invMass*c;e.m_angularVelocity-=e.m_invI*(h*c-g*b);f.m_linearVelocity.x+=f.m_invMass*b;f.m_linearVelocity.y+=f.m_invMass*c;f.m_angularVelocity+=f.m_invI*(i*c-j*b)}else this.m_impulse=0};
a.SolveVelocityConstraints=function(){var b,c=this.m_body1,d=this.m_body2;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f;e=h;b=d.m_xf.R;var g=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=b.col1.x*g+b.col2.x*i;i=b.col1.y*g+b.col2.y*i;g=h;h=-this.m_mass*(this.m_u.x*(d.m_linearVelocity.x+-d.m_angularVelocity*i-(c.m_linearVelocity.x+-c.m_angularVelocity*
f))+this.m_u.y*(d.m_linearVelocity.y+d.m_angularVelocity*g-(c.m_linearVelocity.y+c.m_angularVelocity*e))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;b=h*this.m_u.x;h*=this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*b;c.m_linearVelocity.y-=c.m_invMass*h;c.m_angularVelocity-=c.m_invI*(e*h-f*b);d.m_linearVelocity.x+=d.m_invMass*b;d.m_linearVelocity.y+=d.m_invMass*h;d.m_angularVelocity+=d.m_invI*(g*h-i*b)};
a.SolvePositionConstraints=function(){var b;if(this.m_frequencyHz>0)return true;var c=this.m_body1,d=this.m_body2;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f;e=h;b=d.m_xf.R;var g=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=b.col1.x*g+b.col2.x*i;i=b.col1.y*g+b.col2.y*i;g=h;h=d.m_sweep.c.x+g-c.m_sweep.c.x-e;var j=d.m_sweep.c.y+i-c.m_sweep.c.y-
f;b=Math.sqrt(h*h+j*j);h/=b;j/=b;b-=this.m_length;b=b2Math.b2Clamp(b,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var k=-this.m_mass*b;this.m_u.Set(h,j);h=k*this.m_u.x;j=k*this.m_u.y;c.m_sweep.c.x-=c.m_invMass*h;c.m_sweep.c.y-=c.m_invMass*j;c.m_sweep.a-=c.m_invI*(e*j-f*h);d.m_sweep.c.x+=d.m_invMass*h;d.m_sweep.c.y+=d.m_invMass*j;d.m_sweep.a+=d.m_invI*(g*j-i*h);c.SynchronizeTransform();d.SynchronizeTransform();return b2Math.b2Abs(b)<b2Settings.b2_linearSlop};a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};
a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){var b=new b2Vec2;b.SetV(this.m_u);b.Multiply(this.m_inv_dt*this.m_impulse);return b};a.GetReactionTorque=function(){return 0};var b2Body=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Body.prototype.__constructor=function(b,c){this.m_flags=0;if(b.isBullet)this.m_flags|=b2Body.e_bulletFlag;if(b.fixedRotation)this.m_flags|=b2Body.e_fixedRotationFlag;if(b.allowSleep)this.m_flags|=b2Body.e_allowSleepFlag;if(b.isSleeping)this.m_flags|=b2Body.e_sleepFlag;this.m_world=c;this.m_xf.position.SetV(b.position);this.m_xf.R.Set(b.angle);this.m_sweep.localCenter.SetV(b.massData.center);this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=b.angle;c=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=
c.col1.x*d.x+c.col2.x*d.y;this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_next=this.m_prev=this.m_contactList=this.m_jointList=null;this.m_linearDamping=b.linearDamping;this.m_angularDamping=b.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_linearVelocity.SetZero();this.m_invI=this.m_I=this.m_invMass=this.m_sleepTime=this.m_angularVelocity=0;this.m_mass=b.massData.mass;
if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=b.massData.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;this.m_userData=b.userData;this.m_shapeList=null;this.m_shapeCount=0};b2Body.prototype.__varz=function(){this.m_xf=new b2XForm;this.m_sweep=new b2Sweep;this.m_linearVelocity=new b2Vec2;this.m_force=new b2Vec2};b2Body.e_frozenFlag=2;b2Body.e_islandFlag=4;
b2Body.e_sleepFlag=8;b2Body.e_allowSleepFlag=16;b2Body.e_bulletFlag=32;b2Body.e_fixedRotationFlag=64;b2Body.e_staticType=1;b2Body.e_dynamicType=2;b2Body.e_maxTypes=3;b2Body.s_massData=new b2MassData;b2Body.s_xf1=new b2XForm;a=b2Body.prototype;a.m_flags=0;a.m_type=0;a.m_xf=new b2XForm;a.m_sweep=new b2Sweep;a.m_linearVelocity=new b2Vec2;a.m_angularVelocity=null;a.m_force=new b2Vec2;a.m_torque=null;a.m_world=null;a.m_prev=null;a.m_next=null;a.m_shapeList=null;a.m_shapeCount=0;a.m_jointList=null;
a.m_contactList=null;a.m_mass=null;a.m_invMass=null;a.m_I=null;a.m_invI=null;a.m_linearDamping=null;a.m_angularDamping=null;a.m_sleepTime=null;a.m_userData=null;a.CreateShape=function(b){if(this.m_world.m_lock==true)return null;b=b2Shape.Create(b,this.m_world.m_blockAllocator);b.m_next=this.m_shapeList;this.m_shapeList=b;++this.m_shapeCount;b.m_body=this;b.CreateProxy(this.m_world.m_broadPhase,this.m_xf);b.UpdateSweepRadius(this.m_sweep.localCenter);return b};
a.DestroyShape=function(b){if(this.m_world.m_lock!=true){b.DestroyProxy(this.m_world.m_broadPhase);for(var c=this.m_shapeList;c!=null;){if(c==b)break;c=c.m_next}b.m_body=null;b.m_next=null;--this.m_shapeCount;b2Shape.Destroy(b,this.m_world.m_blockAllocator)}};
a.SetMass=function(b){if(this.m_world.m_lock!=true){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=b.mass;if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=b.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_sweep.localCenter.SetV(b.center);b=this.m_xf.R;var c=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*c.x+b.col2.x*c.y;this.m_sweep.c.y=b.col1.y*c.x+b.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;
this.m_sweep.c0.SetV(this.m_sweep.c);for(b=this.m_shapeList;b;b=b.m_next)b.UpdateSweepRadius(this.m_sweep.localCenter);b=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(b!=this.m_type)for(b=this.m_shapeList;b;b=b.m_next)b.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}};
a.SetMassFromShapes=function(){var b;if(this.m_world.m_lock!=true){var c=this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,d=0,e=b2Body.s_massData;for(b=this.m_shapeList;b;b=b.m_next){b.ComputeMass(e);this.m_mass+=e.mass;c+=e.mass*e.center.x;d+=e.mass*e.center.y;this.m_I+=e.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;c*=this.m_invMass;d*=this.m_invMass}if(this.m_I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(c*c+d*d);this.m_invI=1/this.m_I}else this.m_invI=this.m_I=
0;this.m_sweep.localCenter.Set(c,d);b=this.m_xf.R;c=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*c.x+b.col2.x*c.y;this.m_sweep.c.y=b.col1.y*c.x+b.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);for(b=this.m_shapeList;b;b=b.m_next)b.UpdateSweepRadius(this.m_sweep.localCenter);b=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(b!=this.m_type)for(b=this.m_shapeList;b;b=
b.m_next)b.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}};
a.SetXForm=function(b,c){if(this.m_world.m_lock==true)return true;if(this.IsFrozen())return false;this.m_xf.R.Set(c);this.m_xf.position.SetV(b);b=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*d.x+b.col2.x*d.y;this.m_sweep.c.y=b.col1.y*d.x+b.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=c;b=false;for(c=this.m_shapeList;c;c=c.m_next)if(c.Synchronize(this.m_world.m_broadPhase,
this.m_xf,this.m_xf)==false){b=true;break}if(b==true){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(c=this.m_shapeList;c;c=c.m_next)c.DestroyProxy(this.m_world.m_broadPhase);return false}this.m_world.m_broadPhase.Commit();return true};a.GetXForm=function(){return this.m_xf};a.GetPosition=function(){return this.m_xf.position};a.GetAngle=function(){return this.m_sweep.a};a.GetWorldCenter=function(){return this.m_sweep.c};a.GetLocalCenter=function(){return this.m_sweep.localCenter};
a.SetLinearVelocity=function(b){this.m_linearVelocity.SetV(b)};a.GetLinearVelocity=function(){return this.m_linearVelocity};a.SetAngularVelocity=function(b){this.m_angularVelocity=b};a.GetAngularVelocity=function(){return this.m_angularVelocity};a.ApplyForce=function(b,c){this.IsSleeping()&&this.WakeUp();this.m_force.x+=b.x;this.m_force.y+=b.y;this.m_torque+=(c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x};a.ApplyTorque=function(b){this.IsSleeping()&&this.WakeUp();this.m_torque+=b};
a.ApplyImpulse=function(b,c){this.IsSleeping()&&this.WakeUp();this.m_linearVelocity.x+=this.m_invMass*b.x;this.m_linearVelocity.y+=this.m_invMass*b.y;this.m_angularVelocity+=this.m_invI*((c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x)};a.GetMass=function(){return this.m_mass};a.GetInertia=function(){return this.m_I};a.GetWorldPoint=function(b){var c=this.m_xf.R;b=new b2Vec2(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;return b};
a.GetWorldVector=function(b){return b2Math.b2MulMV(this.m_xf.R,b)};a.GetLocalPoint=function(b){return b2Math.b2MulXT(this.m_xf,b)};a.GetLocalVector=function(b){return b2Math.b2MulTMV(this.m_xf.R,b)};a.GetLinearVelocityFromWorldPoint=function(b){return new b2Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(b.x-this.m_sweep.c.x))};
a.GetLinearVelocityFromLocalPoint=function(b){var c=this.m_xf.R;b=new b2Vec2(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;return new b2Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(b.x-this.m_sweep.c.x))};a.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag};
a.SetBullet=function(b){if(b)this.m_flags|=b2Body.e_bulletFlag;else this.m_flags&=~b2Body.e_bulletFlag};a.IsStatic=function(){return this.m_type==b2Body.e_staticType};a.IsDynamic=function(){return this.m_type==b2Body.e_dynamicType};a.IsFrozen=function(){return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag};a.IsSleeping=function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag};
a.AllowSleeping=function(b){if(b)this.m_flags|=b2Body.e_allowSleepFlag;else{this.m_flags&=~b2Body.e_allowSleepFlag;this.WakeUp()}};a.WakeUp=function(){this.m_flags&=~b2Body.e_sleepFlag;this.m_sleepTime=0};a.PutToSleep=function(){this.m_flags|=b2Body.e_sleepFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0};a.GetShapeList=function(){return this.m_shapeList};a.GetJointList=function(){return this.m_jointList};a.GetNext=function(){return this.m_next};
a.GetUserData=function(){return this.m_userData};a.SetUserData=function(b){this.m_userData=b};a.GetWorld=function(){return this.m_world};
a.SynchronizeShapes=function(){var b=b2Body.s_xf1;b.R.Set(this.m_sweep.a0);var c=b.R,d=this.m_sweep.localCenter;b.position.x=this.m_sweep.c0.x-(c.col1.x*d.x+c.col2.x*d.y);b.position.y=this.m_sweep.c0.y-(c.col1.y*d.x+c.col2.y*d.y);d=true;for(c=this.m_shapeList;c;c=c.m_next){d=c.Synchronize(this.m_world.m_broadPhase,b,this.m_xf);if(d==false)break}if(d==false){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(c=this.m_shapeList;c;c=c.m_next)c.DestroyProxy(this.m_world.m_broadPhase);
return false}return true};a.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var b=this.m_xf.R,c=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(b.col1.x*c.x+b.col2.x*c.y);this.m_xf.position.y=this.m_sweep.c.y-(b.col1.y*c.x+b.col2.y*c.y)};a.IsConnected=function(b){for(var c=this.m_jointList;c;c=c.next)if(c.other==b)return c.joint.m_collideConnected==false;return false};
a.Advance=function(b){this.m_sweep.Advance(b);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};var b2ContactFilter=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){};b2ContactFilter.prototype.__varz=function(){};b2ContactFilter.b2_defaultFilter=new b2ContactFilter;
b2ContactFilter.prototype.ShouldCollide=function(b,c){b=b.GetFilterData();c=c.GetFilterData();if(b.groupIndex==c.groupIndex&&b.groupIndex!=0)return b.groupIndex>0;return(b.maskBits&c.categoryBits)!=0&&(b.categoryBits&c.maskBits)!=0};b2ContactFilter.prototype.RayCollide=function(b,c){if(!b)return true;return this.ShouldCollide(b,c)};var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype);
b2PolygonShape.prototype._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};
b2PolygonShape.prototype.__constructor=function(b){this._super(b);this.m_type=b2Shape.e_polygonShape;this.m_vertexCount=b.vertexCount;var c=0,d=c,e=c;for(c=0;c<this.m_vertexCount;++c)this.m_vertices[c]=b.vertices[c].Copy();for(c=0;c<this.m_vertexCount;++c){d=c;e=c+1<this.m_vertexCount?c+1:0;var f=this.m_vertices[e].x-this.m_vertices[d].x;d=this.m_vertices[e].y-this.m_vertices[d].y;e=Math.sqrt(f*f+d*d);this.m_normals[c]=new b2Vec2(d/e,-f/e)}this.m_centroid=b2PolygonShape.ComputeCentroid(b.vertices,
b.vertexCount);b2PolygonShape.ComputeOBB(this.m_obb,this.m_vertices,this.m_vertexCount);for(c=0;c<this.m_vertexCount;++c){d=c-1>=0?c-1:this.m_vertexCount-1;e=c;b=this.m_normals[d].x;f=this.m_normals[d].y;d=this.m_normals[e].x;e=this.m_normals[e].y;var h=this.m_vertices[c].x-this.m_centroid.x,g=this.m_vertices[c].y-this.m_centroid.y,i=b*h+f*g-b2Settings.b2_toiSlop;h=d*h+e*g-b2Settings.b2_toiSlop;g=1/(b*e-f*d);this.m_coreVertices[c]=new b2Vec2(g*(e*i-f*h)+this.m_centroid.x,g*(b*h-d*i)+this.m_centroid.y)}};
b2PolygonShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2;this.m_obb=new b2OBB;this.m_vertices=Array(b2Settings.b2_maxPolygonVertices);this.m_normals=Array(b2Settings.b2_maxPolygonVertices);this.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonShape.s_computeMat=new b2Mat22;b2PolygonShape.s_sweptAABB1=new b2AABB;b2PolygonShape.s_sweptAABB2=new b2AABB;
b2PolygonShape.ComputeCentroid=function(b,c){for(var d=new b2Vec2,e=0,f=1/3,h=0;h<c;++h){var g=b[h],i=h+1<c?b[parseInt(h+1)]:b[0],j=0.5*((g.x-0)*(i.y-0)-(g.y-0)*(i.x-0));e+=j;d.x+=j*f*(0+g.x+i.x);d.y+=j*f*(0+g.y+i.y)}d.x*=1/e;d.y*=1/e;return d};
b2PolygonShape.ComputeOBB=function(b,c,d){var e=0,f=Array(b2Settings.b2_maxPolygonVertices+1);for(e=0;e<d;++e)f[e]=c[e];f[d]=f[0];c=Number.MAX_VALUE;for(e=1;e<=d;++e){var h=f[parseInt(e-1)],g=f[e].x-h.x,i=f[e].y-h.y,j=Math.sqrt(g*g+i*i);g/=j;i/=j;for(var k=-i,l=g,o=j=Number.MAX_VALUE,q=-Number.MAX_VALUE,t=-Number.MAX_VALUE,w=0;w<d;++w){var z=f[w].x-h.x,A=f[w].y-h.y,n=g*z+i*A;z=k*z+l*A;if(n<j)j=n;if(z<o)o=z;if(n>q)q=n;if(z>t)t=z}w=(q-j)*(t-o);if(w<0.95*c){c=w;b.R.col1.x=g;b.R.col1.y=i;b.R.col2.x=k;
b.R.col2.y=l;g=0.5*(j+q);i=0.5*(o+t);k=b.R;b.center.x=h.x+(k.col1.x*g+k.col2.x*i);b.center.y=h.y+(k.col1.y*g+k.col2.y*i);b.extents.x=0.5*(q-j);b.extents.y=0.5*(t-o)}}};a=b2PolygonShape.prototype;a.s_supportVec=new b2Vec2;a.m_centroid=null;a.m_obb=new b2OBB;a.m_vertices=Array(b2Settings.b2_maxPolygonVertices);a.m_normals=Array(b2Settings.b2_maxPolygonVertices);a.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices);a.m_vertexCount=0;
a.TestPoint=function(b,c){var d;d=b.R;var e=c.x-b.position.x;b=c.y-b.position.y;c=e*d.col1.x+b*d.col1.y;for(var f=e*d.col2.x+b*d.col2.y,h=0;h<this.m_vertexCount;++h){d=this.m_vertices[h];e=c-d.x;b=f-d.y;d=this.m_normals[h];if(d.x*e+d.y*b>0)return false}return true};
a.TestSegment=function(b,c,d,e,f){var h=0,g,i,j,k;g=e.p1.x-b.position.x;i=e.p1.y-b.position.y;j=b.R;var l=g*j.col1.x+i*j.col1.y,o=g*j.col2.x+i*j.col2.y;g=e.p2.x-b.position.x;i=e.p2.y-b.position.y;j=b.R;e=g*j.col1.x+i*j.col1.y-l;j=g*j.col2.x+i*j.col2.y-o;for(var q=-1,t=0;t<this.m_vertexCount;++t){k=this.m_vertices[t];g=k.x-l;i=k.y-o;k=this.m_normals[t];g=k.x*g+k.y*i;i=k.x*e+k.y*j;if(i<0&&g<h*i){h=g/i;q=t}else if(i>0&&g<f*i)f=g/i;if(f<h)return b2Shape.e_missCollide}if(q>=0){c[0]=h;j=b.R;k=this.m_normals[q];
d.x=j.col1.x*k.x+j.col2.x*k.y;d.y=j.col1.y*k.x+j.col2.y*k.y;return b2Shape.e_hitCollide}c[0]=0;return b2Shape.e_startsInsideCollide};
a.ComputeAABB=function(b,c){var d,e,f=b2PolygonShape.s_computeMat;d=c.R;e=this.m_obb.R.col1;f.col1.x=d.col1.x*e.x+d.col2.x*e.y;f.col1.y=d.col1.y*e.x+d.col2.y*e.y;e=this.m_obb.R.col2;f.col2.x=d.col1.x*e.x+d.col2.x*e.y;f.col2.y=d.col1.y*e.x+d.col2.y*e.y;f.Abs();e=this.m_obb.extents;var h=f.col1.x*e.x+f.col2.x*e.y;f=f.col1.y*e.x+f.col2.y*e.y;d=c.R;e=this.m_obb.center;var g=c.position.x+(d.col1.x*e.x+d.col2.x*e.y);c=c.position.y+(d.col1.y*e.x+d.col2.y*e.y);b.lowerBound.Set(g-h,c-f);b.upperBound.Set(g+
h,c+f)};a.ComputeSweptAABB=function(b,c,d){var e=b2PolygonShape.s_sweptAABB1,f=b2PolygonShape.s_sweptAABB2;this.ComputeAABB(e,c);this.ComputeAABB(f,d);b.lowerBound.Set(e.lowerBound.x<f.lowerBound.x?e.lowerBound.x:f.lowerBound.x,e.lowerBound.y<f.lowerBound.y?e.lowerBound.y:f.lowerBound.y);b.upperBound.Set(e.upperBound.x>f.upperBound.x?e.upperBound.x:f.upperBound.x,e.upperBound.y>f.upperBound.y?e.upperBound.y:f.upperBound.y)};
a.ComputeMass=function(b){for(var c=0,d=0,e=0,f=0,h=1/3,g=0;g<this.m_vertexCount;++g){var i=this.m_vertices[g],j=g+1<this.m_vertexCount?this.m_vertices[parseInt(g+1)]:this.m_vertices[0],k=i.x-0,l=i.y-0,o=j.x-0,q=j.y-0,t=k*q-l*o,w=0.5*t;e+=w;c+=w*h*(0+i.x+j.x);d+=w*h*(0+i.y+j.y);f+=t*(h*(0.25*(k*k+o*k+o*o)+(0*k+0*o))+0+(h*(0.25*(l*l+q*l+q*q)+(0*l+0*q))+0))}b.mass=this.m_density*e;c*=1/e;d*=1/e;b.center.Set(c,d);b.I=this.m_density*f};a.GetOBB=function(){return this.m_obb};a.GetCentroid=function(){return this.m_centroid};
a.GetVertexCount=function(){return this.m_vertexCount};a.GetVertices=function(){return this.m_vertices};a.GetCoreVertices=function(){return this.m_coreVertices};a.GetNormals=function(){return this.m_normals};a.GetFirstVertex=function(b){return b2Math.b2MulX(b,this.m_coreVertices[0])};a.Centroid=function(b){return b2Math.b2MulX(b,this.m_centroid)};
a.Support=function(b,c,d){var e;e=b.R;var f=c*e.col1.x+d*e.col1.y;e=c*e.col2.x+d*e.col2.y;c=0;d=this.m_coreVertices[0];for(var h=d.x*f+d.y*e,g=1;g<this.m_vertexCount;++g){d=this.m_coreVertices[g];d=d.x*f+d.y*e;if(d>h){c=g;h=d}}e=b.R;d=this.m_coreVertices[c];this.s_supportVec.x=b.position.x+(e.col1.x*d.x+e.col2.x*d.y);this.s_supportVec.y=b.position.y+(e.col1.y*d.x+e.col2.y*d.y);return this.s_supportVec};
a.UpdateSweepRadius=function(b){for(var c,d=this.m_sweepRadius=0;d<this.m_vertexCount;++d){c=this.m_coreVertices[d];var e=c.x-b.x;c=c.y-b.y;e=Math.sqrt(e*e+c*c);if(e>this.m_sweepRadius)this.m_sweepRadius=e}};var b2ContactResult=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactResult.prototype;a.__constructor=function(){};a.__varz=function(){this.position=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};a.shape1=null;a.shape2=null;a.position=new b2Vec2;
a.normal=new b2Vec2;a.normalImpulse=null;a.tangentImpulse=null;a.id=new b2ContactID;var b2Island=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Island.prototype.__constructor=function(b,c,d,e,f){var h=0;this.m_bodyCapacity=b;this.m_contactCapacity=c;this.m_jointCapacity=d;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=e;this.m_listener=f;this.m_bodies=Array(b);for(h=0;h<b;h++)this.m_bodies[h]=null;this.m_contacts=Array(c);for(h=0;h<c;h++)this.m_contacts[h]=null;this.m_joints=Array(d);for(h=0;h<d;h++)this.m_joints[h]=null;this.m_positionIterationCount=0};b2Island.prototype.__varz=function(){};
b2Island.s_reportCR=new b2ContactResult;a=b2Island.prototype;a.m_allocator=null;a.m_listener=null;a.m_bodies=null;a.m_contacts=null;a.m_joints=null;a.m_bodyCount=0;a.m_jointCount=0;a.m_contactCount=0;a.m_bodyCapacity=0;a.m_contactCapacity=0;a.m_jointCapacity=0;a.m_positionIterationCount=0;a.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};
a.Solve=function(b,c,d,e){var f=0,h;for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];if(!h.IsStatic()){h.m_linearVelocity.x+=b.dt*(c.x+h.m_invMass*h.m_force.x);h.m_linearVelocity.y+=b.dt*(c.y+h.m_invMass*h.m_force.y);h.m_angularVelocity+=b.dt*h.m_invI*h.m_torque;h.m_force.SetZero();h.m_torque=0;h.m_linearVelocity.Multiply(b2Math.b2Clamp(1-b.dt*h.m_linearDamping,0,1));h.m_angularVelocity*=b2Math.b2Clamp(1-b.dt*h.m_angularDamping,0,1);if(h.m_linearVelocity.LengthSquared()>b2Settings.b2_maxLinearVelocitySquared){h.m_linearVelocity.Normalize();
h.m_linearVelocity.x*=b2Settings.b2_maxLinearVelocity;h.m_linearVelocity.y*=b2Settings.b2_maxLinearVelocity}if(h.m_angularVelocity*h.m_angularVelocity>b2Settings.b2_maxAngularVelocitySquared)h.m_angularVelocity=h.m_angularVelocity<0?-b2Settings.b2_maxAngularVelocity:b2Settings.b2_maxAngularVelocity}}c=new b2ContactSolver(b,this.m_contacts,this.m_contactCount,this.m_allocator);c.InitVelocityConstraints(b);for(f=0;f<this.m_jointCount;++f){h=this.m_joints[f];h.InitVelocityConstraints(b)}for(f=0;f<b.maxIterations;++f){c.SolveVelocityConstraints();
for(var g=0;g<this.m_jointCount;++g){h=this.m_joints[g];h.SolveVelocityConstraints(b)}}c.FinalizeVelocityConstraints();for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];if(!h.IsStatic()){h.m_sweep.c0.SetV(h.m_sweep.c);h.m_sweep.a0=h.m_sweep.a;h.m_sweep.c.x+=b.dt*h.m_linearVelocity.x;h.m_sweep.c.y+=b.dt*h.m_linearVelocity.y;h.m_sweep.a+=b.dt*h.m_angularVelocity;h.SynchronizeTransform()}}if(d){for(f=0;f<this.m_jointCount;++f){h=this.m_joints[f];h.InitPositionConstraints()}for(this.m_positionIterationCount=
0;this.m_positionIterationCount<b.maxIterations;++this.m_positionIterationCount){d=c.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);g=true;for(f=0;f<this.m_jointCount;++f){h=this.m_joints[f];h=h.SolvePositionConstraints();g=g&&h}if(d&&g)break}}this.Report(c.m_constraints);if(e){e=Number.MAX_VALUE;c=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance;d=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];
if(h.m_invMass!=0){if((h.m_flags&b2Body.e_allowSleepFlag)==0)e=h.m_sleepTime=0;if((h.m_flags&b2Body.e_allowSleepFlag)==0||h.m_angularVelocity*h.m_angularVelocity>d||b2Math.b2Dot(h.m_linearVelocity,h.m_linearVelocity)>c)e=h.m_sleepTime=0;else{h.m_sleepTime+=b.dt;e=b2Math.b2Min(e,h.m_sleepTime)}}}if(e>=b2Settings.b2_timeToSleep)for(f=0;f<this.m_bodyCount;++f){h=this.m_bodies[f];h.m_flags|=b2Body.e_sleepFlag;h.m_linearVelocity.SetZero();h.m_angularVelocity=0}}};
a.SolveTOI=function(b){var c=0,d=new b2ContactSolver(b,this.m_contacts,this.m_contactCount,this.m_allocator);for(c=0;c<b.maxIterations;++c)d.SolveVelocityConstraints();for(c=0;c<this.m_bodyCount;++c){var e=this.m_bodies[c];if(!e.IsStatic()){e.m_sweep.c0.SetV(e.m_sweep.c);e.m_sweep.a0=e.m_sweep.a;e.m_sweep.c.x+=b.dt*e.m_linearVelocity.x;e.m_sweep.c.y+=b.dt*e.m_linearVelocity.y;e.m_sweep.a+=b.dt*e.m_angularVelocity;e.SynchronizeTransform()}}for(c=0;c<b.maxIterations;++c)if(d.SolvePositionConstraints(0.75))break;
this.Report(d.m_constraints)};
a.Report=function(b){if(this.m_listener!=null)for(var c=0;c<this.m_contactCount;++c){var d=this.m_contacts[c],e=b[c],f=b2Island.s_reportCR;f.shape1=d.m_shape1;f.shape2=d.m_shape2;var h=f.shape1.m_body,g=d.m_manifoldCount;d=d.GetManifolds();for(var i=0;i<g;++i){var j=d[i];f.normal.SetV(j.normal);for(var k=0;k<j.pointCount;++k){var l=j.points[k],o=e.points[k];f.position=h.GetWorldPoint(l.localPoint1);f.normalImpulse=o.normalImpulse;f.tangentImpulse=o.tangentImpulse;f.id.key=l.id.key;this.m_listener.Result(f)}}}};
a.AddBody=function(b){this.m_bodies[this.m_bodyCount++]=b};a.AddContact=function(b){this.m_contacts[this.m_contactCount++]=b};a.AddJoint=function(b){this.m_joints[this.m_jointCount++]=b};var b2ManifoldPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ManifoldPoint.prototype;a.__constructor=function(){};a.__varz=function(){this.localPoint1=new b2Vec2;this.localPoint2=new b2Vec2;this.id=new b2ContactID};a.localPoint1=new b2Vec2;a.localPoint2=new b2Vec2;a.separation=null;
a.normalImpulse=null;a.tangentImpulse=null;a.id=new b2ContactID;a.Reset=function(){this.localPoint1.SetZero();this.localPoint2.SetZero();this.tangentImpulse=this.normalImpulse=this.separation=0;this.id.key=0};a.Set=function(b){this.localPoint1.SetV(b.localPoint1);this.localPoint2.SetV(b.localPoint2);this.separation=b.separation;this.normalImpulse=b.normalImpulse;this.tangentImpulse=b.tangentImpulse;this.id.key=b.id.key};var b2Math=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Math.prototype.__constructor=function(){};b2Math.prototype.__varz=function(){};b2Math.b2Vec2_zero=new b2Vec2(0,0);b2Math.b2Mat22_identity=new b2Mat22(0,new b2Vec2(1,0),new b2Vec2(0,1));b2Math.b2XForm_identity=new b2XForm(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);b2Math.b2IsValid=function(b){return isFinite(b)};b2Math.b2Dot=function(b,c){return b.x*c.x+b.y*c.y};b2Math.b2CrossVV=function(b,c){return b.x*c.y-b.y*c.x};b2Math.b2CrossVF=function(b,c){return new b2Vec2(c*b.y,-c*b.x)};
b2Math.b2CrossFV=function(b,c){return new b2Vec2(-b*c.y,b*c.x)};b2Math.b2MulMV=function(b,c){return new b2Vec2(b.col1.x*c.x+b.col2.x*c.y,b.col1.y*c.x+b.col2.y*c.y)};b2Math.b2MulTMV=function(b,c){return new b2Vec2(b2Math.b2Dot(c,b.col1),b2Math.b2Dot(c,b.col2))};b2Math.b2MulX=function(b,c){c=b2Math.b2MulMV(b.R,c);c.x+=b.position.x;c.y+=b.position.y;return c};b2Math.b2MulXT=function(b,c){c=b2Math.SubtractVV(c,b.position);var d=c.x*b.R.col1.x+c.y*b.R.col1.y;c.y=c.x*b.R.col2.x+c.y*b.R.col2.y;c.x=d;return c};
b2Math.AddVV=function(b,c){return new b2Vec2(b.x+c.x,b.y+c.y)};b2Math.SubtractVV=function(b,c){return new b2Vec2(b.x-c.x,b.y-c.y)};b2Math.b2Distance=function(b,c){var d=b.x-c.x;b=b.y-c.y;return Math.sqrt(d*d+b*b)};b2Math.b2DistanceSquared=function(b,c){var d=b.x-c.x;b=b.y-c.y;return d*d+b*b};b2Math.MulFV=function(b,c){return new b2Vec2(b*c.x,b*c.y)};b2Math.AddMM=function(b,c){return new b2Mat22(0,b2Math.AddVV(b.col1,c.col1),b2Math.AddVV(b.col2,c.col2))};
b2Math.b2MulMM=function(b,c){return new b2Mat22(0,b2Math.b2MulMV(b,c.col1),b2Math.b2MulMV(b,c.col2))};b2Math.b2MulTMM=function(b,c){var d=new b2Vec2(b2Math.b2Dot(b.col1,c.col1),b2Math.b2Dot(b.col2,c.col1));b=new b2Vec2(b2Math.b2Dot(b.col1,c.col2),b2Math.b2Dot(b.col2,c.col2));return new b2Mat22(0,d,b)};b2Math.b2Abs=function(b){return b>0?b:-b};b2Math.b2AbsV=function(b){return new b2Vec2(b2Math.b2Abs(b.x),b2Math.b2Abs(b.y))};b2Math.b2AbsM=function(b){return new b2Mat22(0,b2Math.b2AbsV(b.col1),b2Math.b2AbsV(b.col2))};
b2Math.b2Min=function(b,c){return b<c?b:c};b2Math.b2MinV=function(b,c){return new b2Vec2(b2Math.b2Min(b.x,c.x),b2Math.b2Min(b.y,c.y))};b2Math.b2Max=function(b,c){return b>c?b:c};b2Math.b2MaxV=function(b,c){return new b2Vec2(b2Math.b2Max(b.x,c.x),b2Math.b2Max(b.y,c.y))};b2Math.b2Clamp=function(b,c,d){return b2Math.b2Max(c,b2Math.b2Min(b,d))};b2Math.b2ClampV=function(b,c,d){return b2Math.b2MaxV(c,b2Math.b2MinV(b,d))};b2Math.b2Swap=function(b,c){var d=b[0];b[0]=c[0];c[0]=d};
b2Math.b2Random=function(){return Math.random()*2-1};b2Math.b2RandomRange=function(b,c){return(c-b)*Math.random()+b};b2Math.b2NextPowerOfTwo=function(b){b|=b>>1&2147483647;b|=b>>2&1073741823;b|=b>>4&268435455;b|=b>>8&16777215;b|=b>>16&65535;return b+1};b2Math.b2IsPowerOfTwo=function(b){return b>0&&(b&b-1)==0};var b2CircleDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleDef.prototype,b2ShapeDef.prototype);a=b2CircleDef.prototype;
a._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Shape.e_circleShape;this.radius=1};a.__varz=function(){this.localPosition=new b2Vec2(0,0)};a.localPosition=new b2Vec2(0,0);a.radius=null;var b2ContactPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactPoint.prototype;a.__constructor=function(){};a.__varz=function(){this.position=new b2Vec2;this.velocity=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};
a.shape1=null;a.shape2=null;a.position=new b2Vec2;a.velocity=new b2Vec2;a.normal=new b2Vec2;a.separation=null;a.friction=null;a.restitution=null;a.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype);b2PolygonContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};
b2PolygonContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0};b2PolygonContact.prototype.__varz=function(){this.m0=new b2Manifold;this.m_manifolds=[new b2Manifold]};b2PolygonContact.s_evalCP=new b2ContactPoint;b2PolygonContact.Create=function(b,c){return new b2PolygonContact(b,c)};b2PolygonContact.Destroy=function(){};a=b2PolygonContact.prototype;a.m0=new b2Manifold;a.m_manifolds=[new b2Manifold];a.m_manifold=null;
a.Evaluate=function(b){var c,d,e,f=this.m_shape1.m_body,h=this.m_shape2.m_body,g,i=0;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygons(this.m_manifold,this.m_shape1,f.m_xf,this.m_shape2,h.m_xf);var j=[false,false];g=b2PolygonContact.s_evalCP;g.shape1=this.m_shape1;g.shape2=this.m_shape2;g.friction=this.m_friction;g.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(i=0;i<this.m_manifold.pointCount;++i){var k=this.m_manifold.points[i];k.normalImpulse=0;k.tangentImpulse=0;
var l=false,o=k.id._key;for(c=0;c<this.m0.pointCount;++c)if(j[c]!=true){e=this.m0.points[c];if(e.id._key==o){j[c]=true;k.normalImpulse=e.normalImpulse;k.tangentImpulse=e.tangentImpulse;l=true;if(b!=null){g.position=f.GetWorldPoint(k.localPoint1);c=f.GetLinearVelocityFromLocalPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint2);g.velocity.Set(d.x-c.x,d.y-c.y);g.normal.SetV(this.m_manifold.normal);g.separation=k.separation;g.id.key=o;b.Persist(g)}break}}if(l==false&&b!=null){g.position=
f.GetWorldPoint(k.localPoint1);c=f.GetLinearVelocityFromLocalPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint2);g.velocity.Set(d.x-c.x,d.y-c.y);g.normal.SetV(this.m_manifold.normal);g.separation=k.separation;g.id.key=o;b.Add(g)}}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(b!=null)for(i=0;i<this.m0.pointCount;++i)if(!j[i]){e=this.m0.points[i];g.position=f.GetWorldPoint(e.localPoint1);c=f.GetLinearVelocityFromLocalPoint(e.localPoint1);d=h.GetLinearVelocityFromLocalPoint(e.localPoint2);
g.velocity.Set(d.x-c.x,d.y-c.y);g.normal.SetV(this.m0.normal);g.separation=e.separation;g.id.key=e.id._key;b.Remove(g)}};a.GetManifolds=function(){return this.m_manifolds};var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype);a=b2MouseJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_target.SetV(b.target);var c=this.m_target.x-this.m_body2.m_xf.position.x,d=this.m_target.y-this.m_body2.m_xf.position.y,e=this.m_body2.m_xf.R;this.m_localAnchor.x=c*e.col1.x+d*e.col1.y;this.m_localAnchor.y=c*e.col2.x+d*e.col2.y;this.m_maxForce=b.maxForce;this.m_impulse.SetZero();d=this.m_body2.m_mass;e=2*b2Settings.b2_pi*b.frequencyHz;c=2*d*b.dampingRatio*e;b=b.timeStep*d*e*e;this.m_gamma=1/(c+b);this.m_beta=b/(c+b)};
a.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.m_localAnchor=new b2Vec2;this.m_target=new b2Vec2;this.m_impulse=new b2Vec2;this.m_mass=new b2Mat22;this.m_C=new b2Vec2};a.K=new b2Mat22;a.K1=new b2Mat22;a.K2=new b2Mat22;a.m_localAnchor=new b2Vec2;a.m_target=new b2Vec2;a.m_impulse=new b2Vec2;a.m_mass=new b2Mat22;a.m_C=new b2Vec2;a.m_maxForce=null;a.m_beta=null;a.m_gamma=null;a.GetAnchor1=function(){return this.m_target};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor)};
a.GetReactionForce=function(){return this.m_impulse};a.GetReactionTorque=function(){return 0};a.SetTarget=function(b){this.m_body2.IsSleeping()&&this.m_body2.WakeUp();this.m_target=b};
a.InitVelocityConstraints=function(b){var c=this.m_body2,d;d=c.m_xf.R;var e=this.m_localAnchor.x-c.m_sweep.localCenter.x,f=this.m_localAnchor.y-c.m_sweep.localCenter.y,h=d.col1.x*e+d.col2.x*f;f=d.col1.y*e+d.col2.y*f;e=h;d=c.m_invMass;h=c.m_invI;this.K1.col1.x=d;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=d;this.K2.col1.x=h*f*f;this.K2.col2.x=-h*e*f;this.K2.col1.y=-h*e*f;this.K2.col2.y=h*e*e;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.Invert(this.m_mass);
this.m_C.x=c.m_sweep.c.x+e-this.m_target.x;this.m_C.y=c.m_sweep.c.y+f-this.m_target.y;c.m_angularVelocity*=0.98;var g=b.dt*this.m_impulse.x;b=b.dt*this.m_impulse.y;c.m_linearVelocity.x+=d*g;c.m_linearVelocity.y+=d*b;c.m_angularVelocity+=h*(e*b-f*g)};
a.SolveVelocityConstraints=function(b){var c=this.m_body2,d,e,f;d=c.m_xf.R;var h=this.m_localAnchor.x-c.m_sweep.localCenter.x,g=this.m_localAnchor.y-c.m_sweep.localCenter.y;e=d.col1.x*h+d.col2.x*g;g=d.col1.y*h+d.col2.y*g;h=e;e=c.m_linearVelocity.x+-c.m_angularVelocity*g;var i=c.m_linearVelocity.y+c.m_angularVelocity*h;d=this.m_mass;e=e+this.m_beta*b.inv_dt*this.m_C.x+this.m_gamma*b.dt*this.m_impulse.x;f=i+this.m_beta*b.inv_dt*this.m_C.y+this.m_gamma*b.dt*this.m_impulse.y;i=-b.inv_dt*(d.col1.x*e+d.col2.x*
f);d=-b.inv_dt*(d.col1.y*e+d.col2.y*f);e=this.m_impulse.x;f=this.m_impulse.y;this.m_impulse.x+=i;this.m_impulse.y+=d;i=this.m_impulse.Length();i>this.m_maxForce&&this.m_impulse.Multiply(this.m_maxForce/i);i=this.m_impulse.x-e;d=this.m_impulse.y-f;i=b.dt*i;b=b.dt*d;c.m_linearVelocity.x+=c.m_invMass*i;c.m_linearVelocity.y+=c.m_invMass*b;c.m_angularVelocity+=c.m_invI*(h*b-g*i)};a.SolvePositionConstraints=function(){return true};
var b2CircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype);b2CircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};b2CircleContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0;b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};
b2CircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2CircleContact.s_evalCP=new b2ContactPoint;b2CircleContact.Create=function(b,c){return new b2CircleContact(b,c)};b2CircleContact.Destroy=function(){};a=b2CircleContact.prototype;a.m_manifolds=[new b2Manifold];a.m0=new b2Manifold;a.m_manifold=null;
a.Evaluate=function(b){var c,d,e;c=this.m_shape1.m_body;d=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollideCircles(this.m_manifold,this.m_shape1,c.m_xf,this.m_shape2,d.m_xf);var f=b2CircleContact.s_evalCP;f.shape1=this.m_shape1;f.shape2=this.m_shape2;f.friction=this.m_friction;f.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){this.m_manifoldCount=1;var h=this.m_manifold.points[0];if(this.m0.pointCount==0){h.normalImpulse=0;h.tangentImpulse=0;if(b){f.position=
c.GetWorldPoint(h.localPoint1);c=c.GetLinearVelocityFromLocalPoint(h.localPoint1);d=d.GetLinearVelocityFromLocalPoint(h.localPoint2);f.velocity.Set(d.x-c.x,d.y-c.y);f.normal.SetV(this.m_manifold.normal);f.separation=h.separation;f.id.key=h.id._key;b.Add(f)}}else{e=this.m0.points[0];h.normalImpulse=e.normalImpulse;h.tangentImpulse=e.tangentImpulse;if(b){f.position=c.GetWorldPoint(h.localPoint1);c=c.GetLinearVelocityFromLocalPoint(h.localPoint1);d=d.GetLinearVelocityFromLocalPoint(h.localPoint2);f.velocity.Set(d.x-
c.x,d.y-c.y);f.normal.SetV(this.m_manifold.normal);f.separation=h.separation;f.id.key=h.id._key;b.Persist(f)}}}else{this.m_manifoldCount=0;if(this.m0.pointCount>0&&b){e=this.m0.points[0];f.position=c.GetWorldPoint(e.localPoint1);c=c.GetLinearVelocityFromLocalPoint(e.localPoint1);d=d.GetLinearVelocityFromLocalPoint(e.localPoint2);f.velocity.Set(d.x-c.x,d.y-c.y);f.normal.SetV(this.m0.normal);f.separation=e.separation;f.id.key=e.id._key;b.Remove(f)}}};a.GetManifolds=function(){return this.m_manifolds};
var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype);b2PulleyJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2PulleyJoint.prototype.__constructor=function(b){this._super(b);this.m_ground=this.m_body1.m_world.m_groundBody;this.m_groundAnchor1.x=b.groundAnchor1.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=b.groundAnchor1.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=b.groundAnchor2.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=b.groundAnchor2.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_ratio=b.ratio;this.m_constant=
b.length1+this.m_ratio*b.length2;this.m_maxLength1=b2Math.b2Min(b.maxLength1,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=b2Math.b2Min(b.maxLength2,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_limitForce2=this.m_limitForce1=this.m_force=0};
b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u1=new b2Vec2;this.m_u2=new b2Vec2};b2PulleyJoint.b2_minPulleyLength=2;a=b2PulleyJoint.prototype;a.m_ground=null;a.m_groundAnchor1=new b2Vec2;a.m_groundAnchor2=new b2Vec2;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_u1=new b2Vec2;a.m_u2=new b2Vec2;a.m_constant=null;a.m_ratio=null;a.m_maxLength1=null;
a.m_maxLength2=null;a.m_pulleyMass=null;a.m_limitMass1=null;a.m_limitMass2=null;a.m_force=null;a.m_limitForce1=null;a.m_limitForce2=null;a.m_positionImpulse=null;a.m_limitPositionImpulse1=null;a.m_limitPositionImpulse2=null;a.m_state=0;a.m_limitState1=0;a.m_limitState2=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
a.GetReactionForce=function(){var b=this.m_u2.Copy();b.Multiply(this.m_force);return b};a.GetReactionTorque=function(){return 0};a.GetGroundAnchor1=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor1);return b};a.GetGroundAnchor2=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor2);return b};
a.GetLength1=function(){var b=this.m_body1.GetWorldPoint(this.m_localAnchor1),c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(c*c+b*b)};a.GetLength2=function(){var b=this.m_body2.GetWorldPoint(this.m_localAnchor2),c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(c*c+b*b)};a.GetRatio=function(){return this.m_ratio};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*h;h=e.col1.y*f+e.col2.y*h;f=g;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=g;e=d.m_sweep.c.x+i;g=d.m_sweep.c.y+j;var k=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+
this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+f-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+h-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(e-k,g-l);e=this.m_u1.Length();g=this.m_u2.Length();e>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero();g>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/g):this.m_u2.SetZero();if(this.m_constant-e-this.m_ratio*g>0){this.m_state=b2Joint.e_inactiveLimit;this.m_force=0}else{this.m_state=b2Joint.e_atUpperLimit;
this.m_positionImpulse=0}if(e<this.m_maxLength1){this.m_limitState1=b2Joint.e_inactiveLimit;this.m_limitForce1=0}else{this.m_limitState1=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse1=0}if(g<this.m_maxLength2){this.m_limitState2=b2Joint.e_inactiveLimit;this.m_limitForce2=0}else{this.m_limitState2=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse2=0}e=f*this.m_u1.y-h*this.m_u1.x;g=i*this.m_u2.y-j*this.m_u2.x;this.m_limitMass1=c.m_invMass+c.m_invI*e*e;this.m_limitMass2=d.m_invMass+d.m_invI*g*
g;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(b.warmStarting){e=b.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.x;g=b.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.y;k=b.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.x;b=b.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*e;c.m_linearVelocity.y+=
c.m_invMass*g;c.m_angularVelocity+=c.m_invI*(f*g-h*e);d.m_linearVelocity.x+=d.m_invMass*k;d.m_linearVelocity.y+=d.m_invMass*b;d.m_angularVelocity+=d.m_invI*(i*b-j*k)}else this.m_limitForce2=this.m_limitForce1=this.m_force=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*h;h=e.col1.y*f+e.col2.y*h;f=g;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=g;var k,l;if(this.m_state==b2Joint.e_atUpperLimit){e=c.m_linearVelocity.x+-c.m_angularVelocity*h;g=c.m_linearVelocity.y+
c.m_angularVelocity*f;k=d.m_linearVelocity.x+-d.m_angularVelocity*j;l=d.m_linearVelocity.y+d.m_angularVelocity*i;e=-(this.m_u1.x*e+this.m_u1.y*g)-this.m_ratio*(this.m_u2.x*k+this.m_u2.y*l);l=-b.inv_dt*this.m_pulleyMass*e;e=this.m_force;this.m_force=b2Math.b2Max(0,this.m_force+l);l=this.m_force-e;e=-b.dt*l*this.m_u1.x;g=-b.dt*l*this.m_u1.y;k=-b.dt*this.m_ratio*l*this.m_u2.x;l=-b.dt*this.m_ratio*l*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*e;c.m_linearVelocity.y+=c.m_invMass*g;c.m_angularVelocity+=
c.m_invI*(f*g-h*e);d.m_linearVelocity.x+=d.m_invMass*k;d.m_linearVelocity.y+=d.m_invMass*l;d.m_angularVelocity+=d.m_invI*(i*l-j*k)}if(this.m_limitState1==b2Joint.e_atUpperLimit){e=c.m_linearVelocity.x+-c.m_angularVelocity*h;g=c.m_linearVelocity.y+c.m_angularVelocity*f;e=-(this.m_u1.x*e+this.m_u1.y*g);l=-b.inv_dt*this.m_limitMass1*e;e=this.m_limitForce1;this.m_limitForce1=b2Math.b2Max(0,this.m_limitForce1+l);l=this.m_limitForce1-e;e=-b.dt*l*this.m_u1.x;g=-b.dt*l*this.m_u1.y;c.m_linearVelocity.x+=c.m_invMass*
e;c.m_linearVelocity.y+=c.m_invMass*g;c.m_angularVelocity+=c.m_invI*(f*g-h*e)}if(this.m_limitState2==b2Joint.e_atUpperLimit){k=d.m_linearVelocity.x+-d.m_angularVelocity*j;l=d.m_linearVelocity.y+d.m_angularVelocity*i;e=-(this.m_u2.x*k+this.m_u2.y*l);l=-b.inv_dt*this.m_limitMass2*e;e=this.m_limitForce2;this.m_limitForce2=b2Math.b2Max(0,this.m_limitForce2+l);l=this.m_limitForce2-e;k=-b.dt*l*this.m_u2.x;l=-b.dt*l*this.m_u2.y;d.m_linearVelocity.x+=d.m_invMass*k;d.m_linearVelocity.y+=d.m_invMass*l;d.m_angularVelocity+=
d.m_invI*(i*l-j*k)}};
a.SolvePositionConstraints=function(){var b=this.m_body1,c=this.m_body2,d,e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,h=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,i,j,k,l,o,q,t,w=0;if(this.m_state==b2Joint.e_atUpperLimit){d=b.m_xf.R;i=this.m_localAnchor1.x-b.m_sweep.localCenter.x;j=this.m_localAnchor1.y-b.m_sweep.localCenter.y;o=d.col1.x*i+d.col2.x*j;j=d.col1.y*i+d.col2.y*
j;i=o;d=c.m_xf.R;k=this.m_localAnchor2.x-c.m_sweep.localCenter.x;l=this.m_localAnchor2.y-c.m_sweep.localCenter.y;o=d.col1.x*k+d.col2.x*l;l=d.col1.y*k+d.col2.y*l;k=o;o=b.m_sweep.c.x+i;q=b.m_sweep.c.y+j;t=c.m_sweep.c.x+k;d=c.m_sweep.c.y+l;this.m_u1.Set(o-e,q-f);this.m_u2.Set(t-h,d-g);d=this.m_u1.Length();o=this.m_u2.Length();d>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/d):this.m_u1.SetZero();o>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/o):this.m_u2.SetZero();d=this.m_constant-d-this.m_ratio*o;
w=b2Math.b2Max(w,-d);d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);d=-this.m_pulleyMass*d;o=this.m_positionImpulse;this.m_positionImpulse=b2Math.b2Max(0,this.m_positionImpulse+d);d=this.m_positionImpulse-o;o=-d*this.m_u1.x;q=-d*this.m_u1.y;t=-this.m_ratio*d*this.m_u2.x;d=-this.m_ratio*d*this.m_u2.y;b.m_sweep.c.x+=b.m_invMass*o;b.m_sweep.c.y+=b.m_invMass*q;b.m_sweep.a+=b.m_invI*(i*q-j*o);c.m_sweep.c.x+=c.m_invMass*t;c.m_sweep.c.y+=c.m_invMass*d;c.m_sweep.a+=c.m_invI*
(k*d-l*t);b.SynchronizeTransform();c.SynchronizeTransform()}if(this.m_limitState1==b2Joint.e_atUpperLimit){d=b.m_xf.R;i=this.m_localAnchor1.x-b.m_sweep.localCenter.x;j=this.m_localAnchor1.y-b.m_sweep.localCenter.y;o=d.col1.x*i+d.col2.x*j;j=d.col1.y*i+d.col2.y*j;i=o;o=b.m_sweep.c.x+i;q=b.m_sweep.c.y+j;this.m_u1.Set(o-e,q-f);d=this.m_u1.Length();if(d>b2Settings.b2_linearSlop){this.m_u1.x*=1/d;this.m_u1.y*=1/d}else this.m_u1.SetZero();d=this.m_maxLength1-d;w=b2Math.b2Max(w,-d);d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,
-b2Settings.b2_maxLinearCorrection,0);d=-this.m_limitMass1*d;e=this.m_limitPositionImpulse1;this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+d);d=this.m_limitPositionImpulse1-e;o=-d*this.m_u1.x;q=-d*this.m_u1.y;b.m_sweep.c.x+=b.m_invMass*o;b.m_sweep.c.y+=b.m_invMass*q;b.m_sweep.a+=b.m_invI*(i*q-j*o);b.SynchronizeTransform()}if(this.m_limitState2==b2Joint.e_atUpperLimit){d=c.m_xf.R;k=this.m_localAnchor2.x-c.m_sweep.localCenter.x;l=this.m_localAnchor2.y-c.m_sweep.localCenter.y;
o=d.col1.x*k+d.col2.x*l;l=d.col1.y*k+d.col2.y*l;k=o;t=c.m_sweep.c.x+k;d=c.m_sweep.c.y+l;this.m_u2.Set(t-h,d-g);o=this.m_u2.Length();if(o>b2Settings.b2_linearSlop){this.m_u2.x*=1/o;this.m_u2.y*=1/o}else this.m_u2.SetZero();d=this.m_maxLength2-o;w=b2Math.b2Max(w,-d);d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);d=-this.m_limitMass2*d;e=this.m_limitPositionImpulse2;this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+d);d=this.m_limitPositionImpulse2-
e;t=-d*this.m_u2.x;d=-d*this.m_u2.y;c.m_sweep.c.x+=c.m_invMass*t;c.m_sweep.c.y+=c.m_invMass*d;c.m_sweep.a+=c.m_invI*(k*d-l*t);c.SynchronizeTransform()}return w<b2Settings.b2_linearSlop};var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype);b2RevoluteJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2RevoluteJoint.prototype.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_referenceAngle=b.referenceAngle;this.m_pivotForce.Set(0,0);this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=0;this.m_lowerAngle=b.lowerAngle;this.m_upperAngle=b.upperAngle;this.m_maxMotorTorque=b.maxMotorTorque;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor};
b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.K3=new b2Mat22;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_pivotForce=new b2Vec2;this.m_pivotMass=new b2Mat22};b2RevoluteJoint.tImpulse=new b2Vec2;a=b2RevoluteJoint.prototype;a.K=new b2Mat22;a.K1=new b2Mat22;a.K2=new b2Mat22;a.K3=new b2Mat22;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_pivotForce=new b2Vec2;a.m_motorForce=null;a.m_limitForce=null;
a.m_limitPositionImpulse=null;a.m_pivotMass=new b2Mat22;a.m_motorMass=null;a.m_enableMotor=null;a.m_maxMotorTorque=null;a.m_motorSpeed=null;a.m_enableLimit=null;a.m_referenceAngle=null;a.m_lowerAngle=null;a.m_upperAngle=null;a.m_limitState=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){return this.m_pivotForce};a.GetReactionTorque=function(){return this.m_limitForce};
a.GetJointAngle=function(){return this.m_body2.m_sweep.a-this.m_body1.m_sweep.a-this.m_referenceAngle};a.GetJointSpeed=function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity};a.IsLimitEnabled=function(){return this.m_enableLimit};a.EnableLimit=function(b){this.m_enableLimit=b};a.GetLowerLimit=function(){return this.m_lowerAngle};a.GetUpperLimit=function(){return this.m_upperAngle};a.SetLimits=function(b,c){this.m_lowerAngle=b;this.m_upperAngle=c};a.IsMotorEnabled=function(){return this.m_enableMotor};
a.EnableMotor=function(b){this.m_enableMotor=b};a.SetMotorSpeed=function(b){this.m_motorSpeed=b};a.GetMotorSpeed=function(){return this.m_motorSpeed};a.SetMaxMotorTorque=function(b){this.m_maxMotorTorque=b};a.GetMotorTorque=function(){return this.m_motorForce};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var h=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*h+e.col2.x*g;g=e.col1.y*h+e.col2.y*g;h=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;e=c.m_invMass;f=d.m_invMass;var k=c.m_invI,l=d.m_invI;this.K1.col1.x=e+f;this.K1.col2.x=0;this.K1.col1.y=
0;this.K1.col2.y=e+f;this.K2.col1.x=k*g*g;this.K2.col2.x=-k*h*g;this.K2.col1.y=-k*h*g;this.K2.col2.y=k*h*h;this.K3.col1.x=l*j*j;this.K3.col2.x=-l*i*j;this.K3.col1.y=-l*i*j;this.K3.col2.y=l*i*i;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Invert(this.m_pivotMass);this.m_motorMass=1/(k+l);if(this.m_enableMotor==false)this.m_motorForce=0;if(this.m_enableLimit){var o=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;if(b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop)this.m_limitState=
b2Joint.e_equalLimits;else if(o<=this.m_lowerAngle){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atLowerLimit}else if(o>=this.m_upperAngle){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitForce=0}}else this.m_limitForce=0;if(b.warmStarting){c.m_linearVelocity.x-=b.dt*e*this.m_pivotForce.x;c.m_linearVelocity.y-=b.dt*e*this.m_pivotForce.y;
c.m_angularVelocity-=b.dt*k*(h*this.m_pivotForce.y-g*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce);d.m_linearVelocity.x+=b.dt*f*this.m_pivotForce.x;d.m_linearVelocity.y+=b.dt*f*this.m_pivotForce.y;d.m_angularVelocity+=b.dt*l*(i*this.m_pivotForce.y-j*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce)}else{this.m_pivotForce.SetZero();this.m_limitForce=this.m_motorForce=0}this.m_limitPositionImpulse=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var h=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*h+e.col2.x*g;g=e.col1.y*h+e.col2.y*g;h=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;f=d.m_linearVelocity.x+-d.m_angularVelocity*j-c.m_linearVelocity.x- -c.m_angularVelocity*g;var k=d.m_linearVelocity.y+
d.m_angularVelocity*i-c.m_linearVelocity.y-c.m_angularVelocity*h;e=-b.inv_dt*(this.m_pivotMass.col1.x*f+this.m_pivotMass.col2.x*k);f=-b.inv_dt*(this.m_pivotMass.col1.y*f+this.m_pivotMass.col2.y*k);this.m_pivotForce.x+=e;this.m_pivotForce.y+=f;e=b.dt*e;f=b.dt*f;c.m_linearVelocity.x-=c.m_invMass*e;c.m_linearVelocity.y-=c.m_invMass*f;c.m_angularVelocity-=c.m_invI*(h*f-g*e);d.m_linearVelocity.x+=d.m_invMass*e;d.m_linearVelocity.y+=d.m_invMass*f;d.m_angularVelocity+=d.m_invI*(i*f-j*e);if(this.m_enableMotor&&
this.m_limitState!=b2Joint.e_equalLimits){h=-b.inv_dt*this.m_motorMass*(d.m_angularVelocity-c.m_angularVelocity-this.m_motorSpeed);g=this.m_motorForce;this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+h,-this.m_maxMotorTorque,this.m_maxMotorTorque);h=this.m_motorForce-g;c.m_angularVelocity-=c.m_invI*b.dt*h;d.m_angularVelocity+=d.m_invI*b.dt*h}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){g=-b.inv_dt*this.m_motorMass*(d.m_angularVelocity-c.m_angularVelocity);if(this.m_limitState==
b2Joint.e_equalLimits)this.m_limitForce+=g;else if(this.m_limitState==b2Joint.e_atLowerLimit){h=this.m_limitForce;this.m_limitForce=b2Math.b2Max(this.m_limitForce+g,0);g=this.m_limitForce-h}else if(this.m_limitState==b2Joint.e_atUpperLimit){h=this.m_limitForce;this.m_limitForce=b2Math.b2Min(this.m_limitForce+g,0);g=this.m_limitForce-h}c.m_angularVelocity-=c.m_invI*b.dt*g;d.m_angularVelocity+=d.m_invI*b.dt*g}};
a.SolvePositionConstraints=function(){var b,c=this.m_body1,d=this.m_body2,e=0;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*h;h=e.col1.y*f+e.col2.y*h;f=g;e=d.m_xf.R;b=this.m_localAnchor2.x-d.m_sweep.localCenter.x;var i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=e.col1.x*b+e.col2.x*i;i=e.col1.y*b+e.col2.y*i;b=g;g=d.m_sweep.c.x+b-(c.m_sweep.c.x+f);var j=d.m_sweep.c.y+i-(c.m_sweep.c.y+h);e=Math.sqrt(g*g+j*j);
var k=c.m_invMass,l=d.m_invMass,o=c.m_invI,q=d.m_invI;this.K1.col1.x=k+l;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=k+l;this.K2.col1.x=o*h*h;this.K2.col2.x=-o*f*h;this.K2.col1.y=-o*f*h;this.K2.col2.y=o*f*f;this.K3.col1.x=q*i*i;this.K3.col2.x=-q*b*i;this.K3.col1.y=-q*b*i;this.K3.col2.y=q*b*b;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(b2RevoluteJoint.tImpulse,-g,-j);g=b2RevoluteJoint.tImpulse.x;j=b2RevoluteJoint.tImpulse.y;c.m_sweep.c.x-=c.m_invMass*g;c.m_sweep.c.y-=
c.m_invMass*j;c.m_sweep.a-=c.m_invI*(f*j-h*g);d.m_sweep.c.x+=d.m_invMass*g;d.m_sweep.c.y+=d.m_invMass*j;d.m_sweep.a+=d.m_invI*(b*j-i*g);c.SynchronizeTransform();d.SynchronizeTransform();f=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){b=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;h=0;if(this.m_limitState==b2Joint.e_equalLimits){b=b2Math.b2Clamp(b,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);h=-this.m_motorMass*b;f=b2Math.b2Abs(b)}else if(this.m_limitState==
b2Joint.e_atLowerLimit){b-=this.m_lowerAngle;f=b2Math.b2Max(0,-b);b=b2Math.b2Clamp(b+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0);h=-this.m_motorMass*b;b=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+h,0);h=this.m_limitPositionImpulse-b}else if(this.m_limitState==b2Joint.e_atUpperLimit){b-=this.m_upperAngle;f=b2Math.b2Max(0,b);b=b2Math.b2Clamp(b-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection);h=-this.m_motorMass*
b;b=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+h,0);h=this.m_limitPositionImpulse-b}c.m_sweep.a-=c.m_invI*h;d.m_sweep.a+=d.m_invI*h;c.SynchronizeTransform();d.SynchronizeTransform()}return e<=b2Settings.b2_linearSlop&&f<=b2Settings.b2_angularSlop};var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype);a=b2PrismaticJoint.prototype;
a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_localXAxis1.SetV(b.localAxis1);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=b.referenceAngle;this.m_linearJacobian.SetZero();this.m_torque=this.m_angularMass=this.m_force=this.m_linearMass=0;this.m_motorJacobian.SetZero();this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=this.m_motorMass=0;this.m_lowerTranslation=
b.lowerTranslation;this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor};a.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_localXAxis1=new b2Vec2;this.m_localYAxis1=new b2Vec2;this.m_linearJacobian=new b2Jacobian;this.m_motorJacobian=new b2Jacobian};a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_localXAxis1=new b2Vec2;
a.m_localYAxis1=new b2Vec2;a.m_refAngle=null;a.m_linearJacobian=new b2Jacobian;a.m_linearMass=null;a.m_force=null;a.m_angularMass=null;a.m_torque=null;a.m_motorJacobian=new b2Jacobian;a.m_motorMass=null;a.m_motorForce=null;a.m_limitForce=null;a.m_limitPositionImpulse=null;a.m_lowerTranslation=null;a.m_upperTranslation=null;a.m_maxMotorForce=null;a.m_motorSpeed=null;a.m_enableLimit=null;a.m_enableMotor=null;a.m_limitState=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};
a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
a.GetReactionForce=function(){var b=this.m_body1.m_xf.R;return new b2Vec2(this.m_limitForce*this.m_limitForce*(b.col1.x*this.m_localXAxis1.x+b.col2.x*this.m_localXAxis1.y)+this.m_force*this.m_force*(b.col1.x*this.m_localYAxis1.x+b.col2.x*this.m_localYAxis1.y),this.m_limitForce*this.m_limitForce*(b.col1.y*this.m_localXAxis1.x+b.col2.y*this.m_localXAxis1.y)+this.m_force*this.m_force*(b.col1.y*this.m_localYAxis1.x+b.col2.y*this.m_localYAxis1.y))};a.GetReactionTorque=function(){return this.m_torque};
a.GetJointTranslation=function(){var b=this.m_body1,c=this.m_body2,d=b.GetWorldPoint(this.m_localAnchor1),e=c.GetWorldPoint(this.m_localAnchor2);c=e.x-d.x;d=e.y-d.y;b=b.GetWorldVector(this.m_localXAxis1);return b.x*c+b.y*d};
a.GetJointSpeed=function(){var b=this.m_body1,c=this.m_body2,d;d=b.m_xf.R;var e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=d.col1.x*e+d.col2.x*f;f=d.col1.y*e+d.col2.y*f;e=h;d=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,i=this.m_localAnchor2.y-c.m_sweep.localCenter.y;h=d.col1.x*g+d.col2.x*i;i=d.col1.y*g+d.col2.y*i;g=h;d=c.m_sweep.c.x+g-(b.m_sweep.c.x+e);h=c.m_sweep.c.y+i-(b.m_sweep.c.y+f);var j=b.GetWorldVector(this.m_localXAxis1),
k=b.m_linearVelocity,l=c.m_linearVelocity;b=b.m_angularVelocity;c=c.m_angularVelocity;return d*-b*j.y+h*b*j.x+(j.x*(l.x+-c*i-k.x- -b*f)+j.y*(l.y+c*g-k.y-b*e))};a.IsLimitEnabled=function(){return this.m_enableLimit};a.EnableLimit=function(b){this.m_enableLimit=b};a.GetLowerLimit=function(){return this.m_lowerTranslation};a.GetUpperLimit=function(){return this.m_upperTranslation};a.SetLimits=function(b,c){this.m_lowerTranslation=b;this.m_upperTranslation=c};a.IsMotorEnabled=function(){return this.m_enableMotor};
a.EnableMotor=function(b){this.m_enableMotor=b};a.SetMotorSpeed=function(b){this.m_motorSpeed=b};a.GetMotorSpeed=function(){return this.m_motorSpeed};a.SetMaxMotorForce=function(b){this.m_maxMotorForce=b};a.GetMotorForce=function(){return this.m_motorForce};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var h=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*h+e.col2.x*g;g=e.col1.y*h+e.col2.y*g;h=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;f=c.m_invMass;var k=d.m_invMass,l=c.m_invI,o=d.m_invI;e=c.m_xf.R;var q=e.col1.x*this.m_localYAxis1.x+
e.col2.x*this.m_localYAxis1.y;e=e.col1.y*this.m_localYAxis1.x+e.col2.y*this.m_localYAxis1.y;var t=d.m_sweep.c.x+i-c.m_sweep.c.x,w=d.m_sweep.c.y+j-c.m_sweep.c.y;this.m_linearJacobian.linear1.x=-q;this.m_linearJacobian.linear1.y=-e;this.m_linearJacobian.linear2.x=q;this.m_linearJacobian.linear2.y=e;this.m_linearJacobian.angular1=-(t*e-w*q);this.m_linearJacobian.angular2=i*e-j*q;this.m_linearMass=f+l*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+k+o*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2;
this.m_linearMass=1/this.m_linearMass;this.m_angularMass=l+o;if(this.m_angularMass>Number.MIN_VALUE)this.m_angularMass=1/this.m_angularMass;if(this.m_enableLimit||this.m_enableMotor){e=c.m_xf.R;q=e.col1.x*this.m_localXAxis1.x+e.col2.x*this.m_localXAxis1.y;e=e.col1.y*this.m_localXAxis1.x+e.col2.y*this.m_localXAxis1.y;this.m_motorJacobian.linear1.x=-q;this.m_motorJacobian.linear1.y=-e;this.m_motorJacobian.linear2.x=q;this.m_motorJacobian.linear2.y=e;this.m_motorJacobian.angular1=-(t*e-w*q);this.m_motorJacobian.angular2=
i*e-j*q;this.m_motorMass=f+l*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+k+o*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2;this.m_motorMass=1/this.m_motorMass;if(this.m_enableLimit){h=q*(t-h)+e*(w-g);if(b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop)this.m_limitState=b2Joint.e_equalLimits;else if(h<=this.m_lowerTranslation){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atLowerLimit}else if(h>=
this.m_upperTranslation){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitForce=0}}}if(this.m_enableMotor==false)this.m_motorForce=0;if(this.m_enableLimit==false)this.m_limitForce=0;if(b.warmStarting){h=b.dt*(this.m_force*this.m_linearJacobian.linear1.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.y);g=b.dt*(this.m_force*this.m_linearJacobian.linear2.x+(this.m_motorForce+
this.m_limitForce)*this.m_motorJacobian.linear2.x);i=b.dt*(this.m_force*this.m_linearJacobian.linear2.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear2.y);j=b.dt*(this.m_force*this.m_linearJacobian.angular1-this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular1);t=b.dt*(this.m_force*this.m_linearJacobian.angular2+this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular2);c.m_linearVelocity.x+=f*b.dt*(this.m_force*this.m_linearJacobian.linear1.x+
(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.x);c.m_linearVelocity.y+=f*h;c.m_angularVelocity+=l*j;d.m_linearVelocity.x+=k*g;d.m_linearVelocity.y+=k*i;d.m_angularVelocity+=o*t}else this.m_motorForce=this.m_limitForce=this.m_torque=this.m_force=0;this.m_limitPositionImpulse=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e=c.m_invMass,f=d.m_invMass,h=c.m_invI,g=d.m_invI,i;i=this.m_linearJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);i=-b.inv_dt*this.m_linearMass*i;this.m_force+=i;i=b.dt*i;c.m_linearVelocity.x+=e*i*this.m_linearJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_linearJacobian.linear1.y;c.m_angularVelocity+=h*i*this.m_linearJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_linearJacobian.linear2.x;
d.m_linearVelocity.y+=f*i*this.m_linearJacobian.linear2.y;d.m_angularVelocity+=g*i*this.m_linearJacobian.angular2;i=-b.inv_dt*this.m_angularMass*(d.m_angularVelocity-c.m_angularVelocity);this.m_torque+=i;i=b.dt*i;c.m_angularVelocity-=h*i;d.m_angularVelocity+=g*i;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){i=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity)-this.m_motorSpeed;i=-b.inv_dt*this.m_motorMass*i;var j=this.m_motorForce;
this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+i,-this.m_maxMotorForce,this.m_maxMotorForce);i=this.m_motorForce-j;i=b.dt*i;c.m_linearVelocity.x+=e*i*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=h*i*this.m_motorJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_motorJacobian.linear2.x;d.m_linearVelocity.y+=f*i*this.m_motorJacobian.linear2.y;d.m_angularVelocity+=g*i*this.m_motorJacobian.angular2}if(this.m_enableLimit&&this.m_limitState!=
b2Joint.e_inactiveLimit){i=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);j=-b.inv_dt*this.m_motorMass*i;if(this.m_limitState==b2Joint.e_equalLimits)this.m_limitForce+=j;else if(this.m_limitState==b2Joint.e_atLowerLimit){i=this.m_limitForce;this.m_limitForce=b2Math.b2Max(this.m_limitForce+j,0);j=this.m_limitForce-i}else if(this.m_limitState==b2Joint.e_atUpperLimit){i=this.m_limitForce;this.m_limitForce=b2Math.b2Min(this.m_limitForce+j,0);
j=this.m_limitForce-i}i=b.dt*j;c.m_linearVelocity.x+=e*i*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=h*i*this.m_motorJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_motorJacobian.linear2.x;d.m_linearVelocity.y+=f*i*this.m_motorJacobian.linear2.y;d.m_angularVelocity+=g*i*this.m_motorJacobian.angular2}};
a.SolvePositionConstraints=function(){var b,c,d=this.m_body1,e=this.m_body2,f=d.m_invMass,h=e.m_invMass,g=d.m_invI,i=e.m_invI,j,k;j=d.m_xf.R;var l=this.m_localAnchor1.x-d.m_sweep.localCenter.x,o=this.m_localAnchor1.y-d.m_sweep.localCenter.y;k=j.col1.x*l+j.col2.x*o;o=j.col1.y*l+j.col2.y*o;l=k;j=e.m_xf.R;var q=this.m_localAnchor2.x-e.m_sweep.localCenter.x;b=this.m_localAnchor2.y-e.m_sweep.localCenter.y;k=j.col1.x*q+j.col2.x*b;b=j.col1.y*q+j.col2.y*b;q=k;j=d.m_sweep.c.x+l;o=d.m_sweep.c.y+o;q=e.m_sweep.c.x+
q;b=e.m_sweep.c.y+b;q-=j;b-=o;j=d.m_xf.R;var t=(j.col1.x*this.m_localYAxis1.x+j.col2.x*this.m_localYAxis1.y)*q+(j.col1.y*this.m_localYAxis1.x+j.col2.y*this.m_localYAxis1.y)*b;t=b2Math.b2Clamp(t,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);c=-this.m_linearMass*t;d.m_sweep.c.x+=f*c*this.m_linearJacobian.linear1.x;d.m_sweep.c.y+=f*c*this.m_linearJacobian.linear1.y;d.m_sweep.a+=g*c*this.m_linearJacobian.angular1;e.m_sweep.c.x+=h*c*this.m_linearJacobian.linear2.x;e.m_sweep.c.y+=
h*c*this.m_linearJacobian.linear2.y;e.m_sweep.a+=i*c*this.m_linearJacobian.angular2;t=b2Math.b2Abs(t);c=e.m_sweep.a-d.m_sweep.a-this.m_refAngle;c=b2Math.b2Clamp(c,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var w=-this.m_angularMass*c;d.m_sweep.a-=d.m_invI*w;e.m_sweep.a+=e.m_invI*w;d.SynchronizeTransform();e.SynchronizeTransform();w=b2Math.b2Abs(c);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){j=d.m_xf.R;l=this.m_localAnchor1.x-d.m_sweep.localCenter.x;
o=this.m_localAnchor1.y-d.m_sweep.localCenter.y;k=j.col1.x*l+j.col2.x*o;o=j.col1.y*l+j.col2.y*o;l=k;j=e.m_xf.R;q=this.m_localAnchor2.x-e.m_sweep.localCenter.x;b=this.m_localAnchor2.y-e.m_sweep.localCenter.y;k=j.col1.x*q+j.col2.x*b;b=j.col1.y*q+j.col2.y*b;q=k;j=d.m_sweep.c.x+l;o=d.m_sweep.c.y+o;q=e.m_sweep.c.x+q;b=e.m_sweep.c.y+b;q-=j;b-=o;j=d.m_xf.R;j=(j.col1.x*this.m_localXAxis1.x+j.col2.x*this.m_localXAxis1.y)*q+(j.col1.y*this.m_localXAxis1.x+j.col2.y*this.m_localXAxis1.y)*b;b=0;if(this.m_limitState==
b2Joint.e_equalLimits){b=b2Math.b2Clamp(j,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);b=-this.m_motorMass*b;t=b2Math.b2Max(t,b2Math.b2Abs(c))}else if(this.m_limitState==b2Joint.e_atLowerLimit){b=j-this.m_lowerTranslation;t=b2Math.b2Max(t,-b);b=b2Math.b2Clamp(b+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);b=-this.m_motorMass*b;c=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+b,0);b=this.m_limitPositionImpulse-
c}else if(this.m_limitState==b2Joint.e_atUpperLimit){b=j-this.m_upperTranslation;t=b2Math.b2Max(t,b);b=b2Math.b2Clamp(b-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection);b=-this.m_motorMass*b;c=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+b,0);b=this.m_limitPositionImpulse-c}d.m_sweep.c.x+=f*b*this.m_motorJacobian.linear1.x;d.m_sweep.c.y+=f*b*this.m_motorJacobian.linear1.y;d.m_sweep.a+=g*b*this.m_motorJacobian.angular1;e.m_sweep.c.x+=
h*b*this.m_motorJacobian.linear2.x;e.m_sweep.c.y+=h*b*this.m_motorJacobian.linear2.y;e.m_sweep.a+=i*b*this.m_motorJacobian.angular2;d.SynchronizeTransform();e.SynchronizeTransform()}return t<=b2Settings.b2_linearSlop&&w<=b2Settings.b2_angularSlop};var ClipVertex=function(){this.__varz();this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){};ClipVertex.prototype.__varz=function(){this.v=new b2Vec2;this.id=new b2ContactID};ClipVertex.prototype.v=new b2Vec2;
ClipVertex.prototype.id=new b2ContactID;var b2NullContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype);a=b2NullContact.prototype;a._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){};a.__varz=function(){};a.Evaluate=function(){};a.GetManifolds=function(){return null};
var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype);b2PolyAndCircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};
b2PolyAndCircleContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polygonShape);b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape);this.m_manifold.pointCount=0;b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};b2PolyAndCircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2PolyAndCircleContact.s_evalCP=new b2ContactPoint;
b2PolyAndCircleContact.Create=function(b,c){return new b2PolyAndCircleContact(b,c)};b2PolyAndCircleContact.Destroy=function(){};a=b2PolyAndCircleContact.prototype;a.m_manifolds=[new b2Manifold];a.m0=new b2Manifold;a.m_manifold=null;
a.Evaluate=function(b){var c=0,d,e,f,h=this.m_shape1.m_body,g=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygonAndCircle(this.m_manifold,this.m_shape1,h.m_xf,this.m_shape2,g.m_xf);var i=[false,false],j=b2PolyAndCircleContact.s_evalCP;j.shape1=this.m_shape1;j.shape2=this.m_shape2;j.friction=this.m_friction;j.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(c=0;c<this.m_manifold.pointCount;++c){var k=this.m_manifold.points[c];k.normalImpulse=0;k.tangentImpulse=
0;var l=false,o=k.id._key;for(d=0;d<this.m0.pointCount;++d)if(i[d]!=true){f=this.m0.points[d];if(f.id._key==o){i[d]=true;k.normalImpulse=f.normalImpulse;k.tangentImpulse=f.tangentImpulse;l=true;if(b!=null){j.position=h.GetWorldPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint1);e=g.GetLinearVelocityFromLocalPoint(k.localPoint2);j.velocity.Set(e.x-d.x,e.y-d.y);j.normal.SetV(this.m_manifold.normal);j.separation=k.separation;j.id.key=o;b.Persist(j)}break}}if(l==false&&b!=null){j.position=
h.GetWorldPoint(k.localPoint1);d=h.GetLinearVelocityFromLocalPoint(k.localPoint1);e=g.GetLinearVelocityFromLocalPoint(k.localPoint2);j.velocity.Set(e.x-d.x,e.y-d.y);j.normal.SetV(this.m_manifold.normal);j.separation=k.separation;j.id.key=o;b.Add(j)}}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(b!=null)for(c=0;c<this.m0.pointCount;++c)if(!i[c]){f=this.m0.points[c];j.position=h.GetWorldPoint(f.localPoint1);d=h.GetLinearVelocityFromLocalPoint(f.localPoint1);e=g.GetLinearVelocityFromLocalPoint(f.localPoint2);
j.velocity.Set(e.x-d.x,e.y-d.y);j.normal.SetV(this.m0.normal);j.separation=f.separation;j.id.key=f.id._key;b.Remove(j)}};a.GetManifolds=function(){return this.m_manifolds};var b2ContactManager=function(){b2PairCallback.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2ContactManager.prototype,b2PairCallback.prototype);b2ContactManager.prototype._super=function(){b2PairCallback.prototype.__constructor.apply(this,arguments)};
b2ContactManager.prototype.__constructor=function(){this.m_world=null;this.m_destroyImmediate=false};b2ContactManager.prototype.__varz=function(){this.m_nullContact=new b2NullContact};b2ContactManager.s_evalCP=new b2ContactPoint;a=b2ContactManager.prototype;a.m_world=null;a.m_nullContact=new b2NullContact;a.m_destroyImmediate=null;
a.PairAdded=function(b,c){var d=b.m_body,e=c.m_body;if(d.IsStatic()&&e.IsStatic())return this.m_nullContact;if(b.m_body==c.m_body)return this.m_nullContact;if(e.IsConnected(d))return this.m_nullContact;if(this.m_world.m_contactFilter!=null&&this.m_world.m_contactFilter.ShouldCollide(b,c)==false)return this.m_nullContact;var f=b2Contact.Create(b,c,this.m_world.m_blockAllocator);if(f==null)return this.m_nullContact;b=f.m_shape1;c=f.m_shape2;d=b.m_body;e=c.m_body;f.m_prev=null;f.m_next=this.m_world.m_contactList;
if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=f;this.m_world.m_contactList=f;f.m_node1.contact=f;f.m_node1.other=e;f.m_node1.prev=null;f.m_node1.next=d.m_contactList;if(d.m_contactList!=null)d.m_contactList.prev=f.m_node1;d.m_contactList=f.m_node1;f.m_node2.contact=f;f.m_node2.other=d;f.m_node2.prev=null;f.m_node2.next=e.m_contactList;if(e.m_contactList!=null)e.m_contactList.prev=f.m_node2;e.m_contactList=f.m_node2;++this.m_world.m_contactCount;return f};
a.PairRemoved=function(b,c,d){d!=null&&d!=this.m_nullContact&&this.Destroy(d)};
a.Destroy=function(b){var c=b.m_shape1,d=b.m_shape2,e=b.m_manifoldCount;if(e>0&&this.m_world.m_contactListener){var f=c.m_body,h=d.m_body,g=b.GetManifolds(),i=b2ContactManager.s_evalCP;i.shape1=b.m_shape1;i.shape2=b.m_shape1;i.friction=b.m_friction;i.restitution=b.m_restitution;for(var j=0;j<e;++j){var k=g[j];i.normal.SetV(k.normal);for(var l=0;l<k.pointCount;++l){var o=k.points[l];i.position=f.GetWorldPoint(o.localPoint1);var q=f.GetLinearVelocityFromLocalPoint(o.localPoint1),t=h.GetLinearVelocityFromLocalPoint(o.localPoint2);
i.velocity.Set(t.x-q.x,t.y-q.y);i.separation=o.separation;i.id.key=o.id._key;this.m_world.m_contactListener.Remove(i)}}}if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_world.m_contactList)this.m_world.m_contactList=b.m_next;c=c.m_body;d=d.m_body;if(b.m_node1.prev)b.m_node1.prev.next=b.m_node1.next;if(b.m_node1.next)b.m_node1.next.prev=b.m_node1.prev;if(b.m_node1==c.m_contactList)c.m_contactList=b.m_node1.next;if(b.m_node2.prev)b.m_node2.prev.next=b.m_node2.next;
if(b.m_node2.next)b.m_node2.next.prev=b.m_node2.prev;if(b.m_node2==d.m_contactList)d.m_contactList=b.m_node2.next;b2Contact.Destroy(b,this.m_world.m_blockAllocator);--this.m_world.m_contactCount};a.Collide=function(){for(var b=this.m_world.m_contactList;b;b=b.m_next){var c=b.m_shape2.m_body;b.m_shape1.m_body.IsSleeping()&&c.IsSleeping()||b.Update(this.m_world.m_contactListener)}};var b2World=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2World.prototype.__constructor=function(b,c,d){this.m_boundaryListener=this.m_destructionListener=null;this.m_contactFilter=b2ContactFilter.b2_defaultFilter;this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_contactListener=null;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;b2World.m_positionCorrection=true;b2World.m_warmStarting=true;b2World.m_continuousPhysics=true;this.m_allowSleep=d;this.m_gravity=c;this.m_lock=false;this.m_inv_dt0=0;this.m_contactManager.m_world=
this;this.m_broadPhase=new b2BroadPhase(b,this.m_contactManager);this.m_groundBody=this.CreateBody(new b2BodyDef)};b2World.prototype.__varz=function(){this.m_raycastNormal=new b2Vec2;this.m_contactManager=new b2ContactManager};b2World.m_positionCorrection=null;b2World.m_warmStarting=null;b2World.m_continuousPhysics=null;b2World.s_jointColor=new b2Color(0.5,0.8,0.8);b2World.s_coreColor=new b2Color(0.9,0.6,0.6);b2World.s_xf=new b2XForm;a=b2World.prototype;a.m_raycastUserData=null;
a.m_raycastSegment=null;a.m_raycastNormal=new b2Vec2;a.m_blockAllocator=null;a.m_stackAllocator=null;a.m_lock=null;a.m_broadPhase=null;a.m_contactManager=new b2ContactManager;a.m_bodyList=null;a.m_jointList=null;a.m_contactList=null;a.m_bodyCount=0;a.m_contactCount=0;a.m_jointCount=0;a.m_gravity=null;a.m_allowSleep=null;a.m_groundBody=null;a.m_destructionListener=null;a.m_boundaryListener=null;a.m_contactFilter=null;a.m_contactListener=null;a.m_debugDraw=null;a.m_inv_dt0=null;
a.m_positionIterationCount=0;a.SetDestructionListener=function(b){this.m_destructionListener=b};a.SetBoundaryListener=function(b){this.m_boundaryListener=b};a.SetContactFilter=function(b){this.m_contactFilter=b};a.SetContactListener=function(b){this.m_contactListener=b};a.SetDebugDraw=function(b){this.m_debugDraw=b};a.Validate=function(){this.m_broadPhase.Validate()};a.GetProxyCount=function(){return this.m_broadPhase.m_proxyCount};a.GetPairCount=function(){return this.m_broadPhase.m_pairManager.m_pairCount};
a.CreateBody=function(b){if(this.m_lock==true)return null;b=new b2Body(b,this);b.m_prev=null;if(b.m_next=this.m_bodyList)this.m_bodyList.m_prev=b;this.m_bodyList=b;++this.m_bodyCount;return b};
a.DestroyBody=function(b){if(this.m_lock!=true){for(var c=b.m_jointList;c;){var d=c;c=c.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(d.joint);this.DestroyJoint(d.joint)}for(c=b.m_shapeList;c;){d=c;c=c.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeShape(d);d.DestroyProxy(this.m_broadPhase);b2Shape.Destroy(d,this.m_blockAllocator)}if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_bodyList)this.m_bodyList=b.m_next;
--this.m_bodyCount}};
a.CreateJoint=function(b){var c=b2Joint.Create(b,this.m_blockAllocator);c.m_prev=null;if(c.m_next=this.m_jointList)this.m_jointList.m_prev=c;this.m_jointList=c;++this.m_jointCount;c.m_node1.joint=c;c.m_node1.other=c.m_body2;c.m_node1.prev=null;if(c.m_node1.next=c.m_body1.m_jointList)c.m_body1.m_jointList.prev=c.m_node1;c.m_body1.m_jointList=c.m_node1;c.m_node2.joint=c;c.m_node2.other=c.m_body1;c.m_node2.prev=null;if(c.m_node2.next=c.m_body2.m_jointList)c.m_body2.m_jointList.prev=c.m_node2;c.m_body2.m_jointList=
c.m_node2;if(b.collideConnected==false){b=b.body1.m_shapeCount<b.body2.m_shapeCount?b.body1:b.body2;for(var d=b.m_shapeList;d;d=d.m_next)d.RefilterProxy(this.m_broadPhase,b.m_xf)}return c};
a.DestroyJoint=function(b){var c=b.m_collideConnected;if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_jointList)this.m_jointList=b.m_next;var d=b.m_body1,e=b.m_body2;d.WakeUp();e.WakeUp();if(b.m_node1.prev)b.m_node1.prev.next=b.m_node1.next;if(b.m_node1.next)b.m_node1.next.prev=b.m_node1.prev;if(b.m_node1==d.m_jointList)d.m_jointList=b.m_node1.next;b.m_node1.prev=null;b.m_node1.next=null;if(b.m_node2.prev)b.m_node2.prev.next=b.m_node2.next;if(b.m_node2.next)b.m_node2.next.prev=
b.m_node2.prev;if(b.m_node2==e.m_jointList)e.m_jointList=b.m_node2.next;b.m_node2.prev=null;b.m_node2.next=null;b2Joint.Destroy(b,this.m_blockAllocator);--this.m_jointCount;if(c==false){b=d.m_shapeCount<e.m_shapeCount?d:e;for(c=b.m_shapeList;c;c=c.m_next)c.RefilterProxy(this.m_broadPhase,b.m_xf)}};a.Refilter=function(b){b.RefilterProxy(this.m_broadPhase,b.m_body.m_xf)};a.SetWarmStarting=function(b){b2World.m_warmStarting=b};a.SetPositionCorrection=function(b){b2World.m_positionCorrection=b};
a.SetContinuousPhysics=function(b){b2World.m_continuousPhysics=b};a.GetBodyCount=function(){return this.m_bodyCount};a.GetJointCount=function(){return this.m_jointCount};a.GetContactCount=function(){return this.m_contactCount};a.SetGravity=function(b){this.m_gravity=b};a.GetGroundBody=function(){return this.m_groundBody};
a.Step=function(b,c){this.m_lock=true;var d=new b2TimeStep;d.dt=b;d.maxIterations=c;d.inv_dt=b>0?1/b:0;d.dtRatio=this.m_inv_dt0*b;d.positionCorrection=b2World.m_positionCorrection;d.warmStarting=b2World.m_warmStarting;this.m_contactManager.Collide();d.dt>0&&this.Solve(d);b2World.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d);this.DrawDebugData();this.m_inv_dt0=d.inv_dt;this.m_lock=false};a.Query=function(b,c,d){var e=Array(d);b=this.m_broadPhase.QueryAABB(b,e,d);for(d=0;d<b;++d)c[d]=e[d];return b};
a.Raycast=function(b,c,d,e,f){var h=Array(d);this.m_raycastSegment=b;this.m_raycastUserData=f;f=e?this.m_broadPhase.QuerySegment(b,h,d,this.RaycastSortKey):this.m_broadPhase.QuerySegment(b,h,d,this.RaycastSortKey2);for(b=0;b<f;++b)c[b]=h[b];return f};a.RaycastOne=function(b,c,d,e,f){var h=Array(1);e=this.Raycast(b,h,1,e,f);if(e==0)return null;e>1&&trace(e);h=h[0];e=h.GetBody().GetXForm();h.TestSegment(e,c,d,b,1);return h};a.GetBodyList=function(){return this.m_bodyList};a.GetJointList=function(){return this.m_jointList};
a.Solve=function(b){var c;this.m_positionIterationCount=0;var d=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator,this.m_contactListener);for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~b2Body.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~b2Contact.e_islandFlag;for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=false;e=Array(this.m_bodyCount);for(var f=this.m_bodyList;f;f=f.m_next)if(!(f.m_flags&(b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag)))if(!f.IsStatic()){d.Clear();
var h=0;e[h++]=f;for(f.m_flags|=b2Body.e_islandFlag;h>0;){c=e[--h];d.AddBody(c);c.m_flags&=~b2Body.e_sleepFlag;if(!c.IsStatic()){for(var g,i=c.m_contactList;i;i=i.next)if(!(i.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_nonSolidFlag)))if(i.contact.m_manifoldCount!=0){d.AddContact(i.contact);i.contact.m_flags|=b2Contact.e_islandFlag;g=i.other;if(!(g.m_flags&b2Body.e_islandFlag)){e[h++]=g;g.m_flags|=b2Body.e_islandFlag}}for(c=c.m_jointList;c;c=c.next)if(c.joint.m_islandFlag!=true){d.AddJoint(c.joint);
c.joint.m_islandFlag=true;g=c.other;if(!(g.m_flags&b2Body.e_islandFlag)){e[h++]=g;g.m_flags|=b2Body.e_islandFlag}}}}d.Solve(b,this.m_gravity,b2World.m_positionCorrection,this.m_allowSleep);if(d.m_positionIterationCount>this.m_positionIterationCount)this.m_positionIterationCount=d.m_positionIterationCount;for(h=0;h<d.m_bodyCount;++h){c=d.m_bodies[h];if(c.IsStatic())c.m_flags&=~b2Body.e_islandFlag}}for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag)||c.IsStatic()||
c.SynchronizeShapes()==false&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(c);this.m_broadPhase.Commit()};
a.SolveTOI=function(b){var c,d,e,f=new b2Island(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,0,this.m_stackAllocator,this.m_contactListener),h=Array(this.m_bodyCount);for(c=this.m_bodyList;c;c=c.m_next){c.m_flags&=~b2Body.e_islandFlag;c.m_sweep.t0=0}var g;for(g=this.m_contactList;g;g=g.m_next)g.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(;;){c=null;var i=1;for(g=this.m_contactList;g;g=g.m_next)if(!(g.m_flags&(b2Contact.e_slowFlag|b2Contact.e_nonSolidFlag))){if(g.m_flags&b2Contact.e_toiFlag)d=
g.m_toi;else{d=g.m_shape1;e=g.m_shape2;d=d.m_body;e=e.m_body;if((d.IsStatic()||d.IsSleeping())&&(e.IsStatic()||e.IsSleeping()))continue;var j=d.m_sweep.t0;if(d.m_sweep.t0<e.m_sweep.t0){j=e.m_sweep.t0;d.m_sweep.Advance(j)}else if(e.m_sweep.t0<d.m_sweep.t0){j=d.m_sweep.t0;e.m_sweep.Advance(j)}d=b2TimeOfImpact.TimeOfImpact(g.m_shape1,d.m_sweep,g.m_shape2,e.m_sweep);if(d>0&&d<1){d=(1-d)*j+d;if(d>1)d=1}g.m_toi=d;g.m_flags|=b2Contact.e_toiFlag}if(Number.MIN_VALUE<d&&d<i){c=g;i=d}}if(c==null||1-100*Number.MIN_VALUE<
i)break;d=c.m_shape1;e=c.m_shape2;d=d.m_body;e=e.m_body;d.Advance(i);e.Advance(i);c.Update(this.m_contactListener);c.m_flags&=~b2Contact.e_toiFlag;if(c.m_manifoldCount!=0){c=d;if(c.IsStatic())c=e;f.Clear();g=0;h[g++]=c;for(c.m_flags|=b2Body.e_islandFlag;g>0;){c=h[--g];f.AddBody(c);c.m_flags&=~b2Body.e_sleepFlag;if(!c.IsStatic())for(c=c.m_contactList;c;c=c.next)if(f.m_contactCount!=f.m_contactCapacity)if(!(c.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_slowFlag|b2Contact.e_nonSolidFlag)))if(c.contact.m_manifoldCount!=
0){f.AddContact(c.contact);c.contact.m_flags|=b2Contact.e_islandFlag;d=c.other;if(!(d.m_flags&b2Body.e_islandFlag)){if(d.IsStatic()==false){d.Advance(i);d.WakeUp()}h[g++]=d;d.m_flags|=b2Body.e_islandFlag}}}g=new b2TimeStep;g.dt=(1-i)*b.dt;g.inv_dt=1/g.dt;g.maxIterations=b.maxIterations;f.SolveTOI(g);for(i=i=0;i<f.m_bodyCount;++i){c=f.m_bodies[i];c.m_flags&=~b2Body.e_islandFlag;if(!(c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag)))if(!c.IsStatic()){c.SynchronizeShapes()==false&&this.m_boundaryListener!=
null&&this.m_boundaryListener.Violation(c);for(c=c.m_contactList;c;c=c.next)c.contact.m_flags&=~b2Contact.e_toiFlag}}for(i=0;i<f.m_contactCount;++i){g=f.m_contacts[i];g.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag)}this.m_broadPhase.Commit()}}};
a.DrawJoint=function(b){var c=b.m_body1,d=b.m_body2,e=c.m_xf.position,f=d.m_xf.position,h=b.GetAnchor1(),g=b.GetAnchor2(),i=b2World.s_jointColor;switch(b.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(h,g,i);break;case b2Joint.e_pulleyJoint:c=b.GetGroundAnchor1();b=b.GetGroundAnchor2();this.m_debugDraw.DrawSegment(c,h,i);this.m_debugDraw.DrawSegment(b,g,i);this.m_debugDraw.DrawSegment(c,b,i);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(h,g,i);break;default:c!=this.m_groundBody&&
this.m_debugDraw.DrawSegment(e,h,i);this.m_debugDraw.DrawSegment(h,g,i);d!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,g,i)}};
a.DrawShape=function(b,c,d,e){var f=b2World.s_coreColor;switch(b.m_type){case b2Shape.e_circleShape:var h=b2Math.b2MulX(c,b.m_localPosition);b=b.m_radius;this.m_debugDraw.DrawSolidCircle(h,b,c.R.col1,d);e&&this.m_debugDraw.DrawCircle(h,b-b2Settings.b2_toiSlop,f);break;case b2Shape.e_polygonShape:var g=b.GetVertexCount(),i=b.GetVertices(),j=Array(b2Settings.b2_maxPolygonVertices);for(h=0;h<g;++h)j[h]=b2Math.b2MulX(c,i[h]);this.m_debugDraw.DrawSolidPolygon(j,g,d);if(e){d=b.GetCoreVertices();for(h=0;h<
g;++h)j[h]=b2Math.b2MulX(c,d[h]);this.m_debugDraw.DrawPolygon(j,g,f)}}};
a.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var b=this.m_debugDraw.GetFlags(),c=0,d,e,f=new b2Vec2,h=new b2Vec2,g=new b2Vec2,i=new b2Color(0,0,0),j,k=new b2AABB,l=new b2AABB,o=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];if(b&b2DebugDraw.e_shapeBit){c=(b&b2DebugDraw.e_coreShapeBit)==b2DebugDraw.e_coreShapeBit;for(d=this.m_bodyList;d;d=d.m_next){j=d.m_xf;for(e=d.GetShapeList();e;e=e.m_next)if(d.IsStatic())this.DrawShape(e,j,new b2Color(0.5,0.9,
0.5),c);else d.IsSleeping()?this.DrawShape(e,j,new b2Color(0.5,0.5,0.9),c):this.DrawShape(e,j,new b2Color(0.9,0.9,0.9),c)}}if(b&b2DebugDraw.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(b&b2DebugDraw.e_pairBit){d=this.m_broadPhase;f.Set(1/d.m_quantizationFactor.x,1/d.m_quantizationFactor.y);i.Set(0.9,0.9,0.3);for(c=0;c<b2Pair.b2_tableCapacity;++c)for(e=d.m_pairManager.m_hashTable[c];e!=b2Pair.b2_nullPair;){e=d.m_pairManager.m_pairs[e];j=d.m_proxyPool[e.proxyId1];var q=d.m_proxyPool[e.proxyId2];
k.lowerBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][j.lowerBounds[0]].value;k.lowerBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][j.lowerBounds[1]].value;k.upperBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][j.upperBounds[0]].value;k.upperBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][j.upperBounds[1]].value;l.lowerBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][q.lowerBounds[0]].value;l.lowerBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][q.lowerBounds[1]].value;
l.upperBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][q.upperBounds[0]].value;l.upperBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][q.upperBounds[1]].value;h.x=0.5*(k.lowerBound.x+k.upperBound.x);h.y=0.5*(k.lowerBound.y+k.upperBound.y);g.x=0.5*(l.lowerBound.x+l.upperBound.x);g.y=0.5*(l.lowerBound.y+l.upperBound.y);this.m_debugDraw.DrawSegment(h,g,i);e=e.next}}if(b&b2DebugDraw.e_aabbBit){d=this.m_broadPhase;h=d.m_worldAABB.lowerBound;g=d.m_worldAABB.upperBound;f.Set(1/d.m_quantizationFactor.x,
1/d.m_quantizationFactor.y);i.Set(0.9,0.3,0.9);for(c=0;c<b2Settings.b2_maxProxies;++c){l=d.m_proxyPool[c];if(l.IsValid()!=false){k.lowerBound.x=h.x+f.x*d.m_bounds[0][l.lowerBounds[0]].value;k.lowerBound.y=h.y+f.y*d.m_bounds[1][l.lowerBounds[1]].value;k.upperBound.x=h.x+f.x*d.m_bounds[0][l.upperBounds[0]].value;k.upperBound.y=h.y+f.y*d.m_bounds[1][l.upperBounds[1]].value;o[0].Set(k.lowerBound.x,k.lowerBound.y);o[1].Set(k.upperBound.x,k.lowerBound.y);o[2].Set(k.upperBound.x,k.upperBound.y);o[3].Set(k.lowerBound.x,
k.upperBound.y);this.m_debugDraw.DrawPolygon(o,4,i)}}o[0].Set(h.x,h.y);o[1].Set(g.x,h.y);o[2].Set(g.x,g.y);o[3].Set(h.x,g.y);this.m_debugDraw.DrawPolygon(o,4,new b2Color(0.3,0.9,0.9))}if(b&b2DebugDraw.e_obbBit){i.Set(0.5,0.3,0.5);for(d=this.m_bodyList;d;d=d.m_next){j=d.m_xf;for(e=d.GetShapeList();e;e=e.m_next)if(e.m_type==b2Shape.e_polygonShape){f=e.GetOBB();c=f.extents;o[0].Set(-c.x,-c.y);o[1].Set(c.x,-c.y);o[2].Set(c.x,c.y);o[3].Set(-c.x,c.y);for(c=0;c<4;++c){k=f.R;h=o[c];g=f.center.x+(k.col1.x*
h.x+k.col2.x*h.y);o[c].y=f.center.y+(k.col1.y*h.x+k.col2.y*h.y);o[c].x=g;k=j.R;g=j.position.x+(k.col1.x*h.x+k.col2.x*h.y);o[c].y=j.position.y+(k.col1.y*h.x+k.col2.y*h.y);o[c].x=g}this.m_debugDraw.DrawPolygon(o,4,i)}}}if(b&b2DebugDraw.e_centerOfMassBit)for(d=this.m_bodyList;d;d=d.m_next){j=b2World.s_xf;j.R=d.m_xf.R;j.position=d.GetWorldCenter();this.m_debugDraw.DrawXForm(j)}}};
a.RaycastSortKey=function(b){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,b))return-1;var c=b.GetBody().GetXForm(),d=[0];if(b.TestSegment(c,d,this.m_raycastNormal,this.m_raycastSegment,1)==b2Shape.e_missCollide)return-1;return d[0]};
a.RaycastSortKey2=function(b){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,b))return-1;var c=b.GetBody().GetXForm(),d=[0];if(b.TestSegment(c,d,this.m_raycastNormal,this.m_raycastSegment,1)!=b2Shape.e_hitCollide)return-1;return d[0]};var Rectangle=function(b,c,d,e){this.x=b;this.y=c;this.width=d;this.height=e};Rectangle.prototype.draw=function(b){b.fillRect(this.x,this.y,this.width,this.height);b.addClearRectangle(this)};
CanvasRenderingContext2D.prototype.dashedLine=function(b,c,d,e,f){var h=d-b,g=e-c,i=Math.sqrt(h*h+g*g),j=f*h/i;f=f*g/i;i=j;var k=f,l=true;for(this.moveTo(b,c);Math.abs(h)>Math.abs(i)||Math.abs(g)>Math.abs(k);){l?this.lineTo(b+i,c+k):this.moveTo(b+i,c+k);l=!l;i+=j;k+=f}l?this.lineTo(d,e):this.moveTo(d,e)};CanvasRenderingContext2D.prototype.clearRects=[];CanvasRenderingContext2D.prototype.addClearRectangle=function(b){this.clearRects.push(b)};
CanvasRenderingContext2D.prototype.clearRectangles=function(){var b;for(b=0;b<this.clearRects.length;b++)this.clearRect(this.clearRects[b].x-1,this.clearRects[b].y-1,this.clearRects[b].width+2,this.clearRects[b].height+2);this.clearRects=[]};CanvasRenderingContext2D.prototype.clearShadow=function(){this.shadowColor="rgba(0, 0, 0, 0)"};Array.prototype.shuffle=function(){var b=this.length;if(b<2)return false;do{var c=Math.floor(Math.random()*b),d=this[c];this[c]=this[--b];this[b]=d}while(b);return true};
Date.prototype.getMonthName=function(){return["January","February","March","April","May","June","July","August","September","October","November","December"][this.getMonth()]};Date.prototype.getFormatHours=function(){if(this.getHours()===12)return 12;return this.fullString(this.getHours()%12)};Date.prototype.getFormatMinutes=function(){return this.fullString(this.getMinutes())};Date.prototype.fullString=function(b){b=b.toString();if(b.length===1)return"0"+b;return b};
Date.prototype.getDayTime=function(){if(this.getHours()>11)return"PM";return"AM"};function getAbsolutePosition(b){var c={x:b.offsetLeft,y:b.offsetTop};if(b.offsetParent){b=getAbsolutePosition(b.offsetParent);c.x+=b.x;c.y+=b.y}return c}
function getRelativeCoordinates(b,c){var d,e,f,h;b=b||window.event;var g=b.target||b.srcElement;if(!window.opera&&typeof b.offsetX!=="undefined"){h={x:b.offsetX,y:b.offsetY};for(f=g;f;){f.mouseX=h.x;f.mouseY=h.y;h.x+=f.offsetLeft;h.y+=f.offsetTop;f=f.offsetParent}f=c;for(h={x:0,y:0};f;){if(typeof f.mouseX!=="undefined"){d=f.mouseX-h.x;e=f.mouseY-h.y;break}h.x+=f.offsetLeft;h.y+=f.offsetTop;f=f.offsetParent}for(f=g;f;){f.mouseX=undefined;f.mouseY=undefined;f=f.offsetParent}}else{h=getAbsolutePosition(c);
d=b.pageX-h.x;e=b.pageY-h.y}return{x:d,y:e}}function testShadowOffsetTransform(){var b=document.createElement("canvas");b.width=b.height=8;b=b.getContext("2d");b.shadowColor="rgba(255, 255, 255, 1.0)";b.shadowOffsetX=4;b.translate(1.5,1.5);b.rotate(Math.PI/2);b.fillStyle="#000000";b.fillRect(-2,-2,4,4);return b.getImageData(1,5,1,1).data[0]===255}var Pattern={};Pattern.image={};Pattern.onload=null;Pattern.loaded=0;Pattern.total=0;
Pattern.onLoaded=function(){Pattern.loaded++;Pattern.loaded===Pattern.total&&Pattern.onload&&Pattern.onload()};Pattern.loadPattern=function(b){var c,d=function(){if(Pattern.context.createPattern){Pattern[this.name]=Pattern.context.createPattern(this,"repeat");Pattern.onLoaded()}};Pattern.total=b.length;for(c=0;c<b.length;c++){var e=new Image;e.src=b[c].path;e.name=b[c].name;Pattern.image[b[c].name]=e;e.onload=d}};
Event=Class.create({initialize:function(b){this.type=b;this.mouseY=this.mouseX=this.parameter=null}});
EventEngine=Class.create({initialize:function(){this.listeners=[];this.state={type:"unknown"};this.clickTimeout=this.latestEvent=null;this.clickTime=250;var b=this;document.body.onmousedown=function(c){b.onMouseDown.call(b,c)};document.body.onmouseup=function(c){b.onMouseUp.call(b,c)};document.body.onmousemove=function(c){b.onMouseMove.call(b,c)}},addListener:function(b,c,d){this.listeners.push({type:b,closure:c,thisArgument:d})},removeListener:function(b,c){var d;for(d=0;d<this.listeners.length;d++)this.listeners[d].type===
b&&this.listeners[d].closure===c&&this.listeners.splice(d,1)},dispatchEvent:function(b){var c;this.latestEvent=b;for(c=0;c<this.listeners.length;c++)this.listeners[c].type===b.type&&this.listeners[c].closure.call(this.listeners[c].thisArgument,b)},onMouseDown:function(b){var c=getRelativeCoordinates(b,$("editor")),d=new Event("mouseDown");d.parameter=b;d.mouseX=c.x;d.mouseY=c.y;this.dispatchEvent(d);this.state={type:"down",x:c.x,y:c.y};var e=this;this.clickTimeoutID=setTimeout(function(f,h){e.onClickTimeout(f,
h)},this.clickTime,c,b)},onMouseUp:function(b){if(this.clickTimeoutID){clearTimeout(this.clickTimeoutID);this.clickTimeoutID=null}var c;if(this.state.type==="drag")c="stopDrag";else if(this.state.type==="down")c="click";var d=getRelativeCoordinates(b,$("editor"));c=new Event(c);c.parameter=b;c.mouseX=d.x;c.mouseY=d.y;this.state.type="up";this.dispatchEvent(c)},onMouseMove:function(b){var c=getRelativeCoordinates(b,$("editor")),d=new Event("mouseMove");d.parameter=b;d.mouseX=c.x;d.mouseY=c.y;this.dispatchEvent(d);
if(this.state.type!=="up"){d.type="drag";this.dispatchEvent(d)}this.state.type==="down"&&function(e,f,h,g){e=h-e;f=g-f;return Math.sqrt(e*e+f*f)}(this.state.x,this.state.y,c.x,c.y)>5&&this.onClickTimeout({x:this.state.x,y:this.state.y})},onClickTimeout:function(b,c){if(this.state.type==="down"){this.clickTimeoutID=null;this.state.type="drag";var d=new Event("startDrag");d.parameter=c;d.mouseX=b.x;d.mouseY=b.y;this.dispatchEvent(d)}}});
var DisplayObject=Class.create({initialize:function(){this.parent=this.height=this.width=this.y=this.x=null},hitTest:function(b,c){return b<this.x||c<this.y||b>this.x+this.width||c>this.y+this.height?false:true},parentToLocal:function(b){return{x:b.x-this.x,y:b.y-this.y}}}),Brick=Class.create(DisplayObject,{initialize:function($super){$super();this.targetRotation=this.rotation=this.y=this.x=0;this.rotateID=null;this.isRemoveable=this.isDraggable=this.isVisible=true;this.isPreview=false;this.isInFront=
true;this.isDynamic=false;this.hasShadow=true;this.cell={row:0,col:0}},update:function(){},draw:function(b){if(this.isVisible){this.rotation!==0&&this.applyRotation(b);b.drawShadows&&this.hasShadow&&!this.isPreview&&this.applyShadow(b);if(this.isPreview)b.globalAlpha=0.3;this.drawShape(b);this.isPreview&&this.applyStyle(b);this.isDynamic&&this.applyClearing(b);b.beginPath()}},reset:function(){},drawShape:function(b){b.fillRect(0,0,Brick.SIZE,Brick.SIZE);b.clearShadow();b.strokeRect(0,0,Brick.SIZE,
Brick.SIZE)},applyStyle:function(b){b.fillStyle="#1E1E1E";b.strokeStyle="#F2E049";b.lineJoing="miter";b.lineWidth=1},applyShadow:function(b){var c=new b2Vec2(Math.cos(Math.PI/4)*-Brick.SIZE/4,Math.sin(Math.PI/4)*Brick.SIZE/4);if(shadowOffsetGetsTransformed)c=this.rotateVector(c,-this.rotation);b.shadowOffsetX=c.x;b.shadowOffsetY=c.y;b.shadowBlur=5;b.shadowColor="rgba(0, 0, 0, 0.5)"},applyScale:function(b){b.translate(Brick.SIZE/2,Brick.SIZE/2);b.scale(1.1,1.1);b.translate(-Brick.SIZE/2,-Brick.SIZE/
2)},applyRotation:function(b){b.translate(Brick.SIZE/2,Brick.SIZE/2);b.rotate(this.rotation);b.translate(-Brick.SIZE/2,-Brick.SIZE/2)},applyClearing:function(b){var c;c=this.rotateID?new Rectangle(this.x-Brick.SIZE/2,this.y-Brick.SIZE/2,Brick.SIZE*2,Brick.SIZE*2):new Rectangle(this.x,this.y,Brick.SIZE,Brick.SIZE);b.addClearRectangle(c)},drawGlobal:function(b){var c=Brick.SIZE;Brick.SIZE=Brick.BIG_SIZE;b.save();b.translate(this.x,this.y);this.applyStyle(b);this.draw(b);b.restore();this.rotateID=true;
this.applyClearing(b);this.rotateID=null;Brick.SIZE=c},createBody:function(b){var c=new b2BodyDef;c.position.Set(this.cell.col+0.5,this.cell.row+0.5);this.body=b.CreateBody(c);this.createShapes(this.body);this.body.SetMassFromShapes();this.setRotation(this.rotation)},createShapes:function(b){var c=new b2PolygonDef;c.SetAsBox(0.5,0.5);c.restitution=0;c.friction=0.9;b.CreateShape(c)},removeBody:function(b){b.DestroyBody(this.body)},moveToCell:function(b){this.cell=b;this.body&&this.body.SetXForm(new b2Vec2(b.col+
0.5,b.row+0.5),this.body.GetAngle())},rotate:function(b){if(this.rotateID){clearTimeout(this.rotateID);this.targetRotation+=b}else{this.storedDynamic=this.isDynamic;this.isDynamic=true;this.parent.renderNew=true;this.targetRotation=this.rotation+b}var c=this;this.rotateID=setTimeout(function(){c.rotateTimeout()},30)},rotateTimeout:function(){this.rotation+=(this.targetRotation-this.rotation)/3;if(Math.abs(this.rotation-this.targetRotation)<0.03)this.rotateStop();else{var b=this;this.rotateID=setTimeout(function(){b.rotateTimeout()},
30)}},rotateStop:function(){this.setRotation(this.targetRotation);this.isDynamic=this.storedDynamic;this.parent.renderNew=true;this.rotateID=null},setRotation:function(b){if(this.body){this.body.SetXForm(this.body.GetPosition(),b);this.rotation=this.body.GetAngle()}else this.rotation=b},rotateVector:function(b,c){return new b2Vec2(b.x*Math.cos(c)-b.y*Math.sin(c),b.x*Math.sin(c)+b.y*Math.cos(c))}});Brick.SIZE=28;Brick.BIG_SIZE=32;Brick.TINY_SIZE=12;Brick.prototype.type="Brick";
var Kicker=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(1,0);b.bezierCurveTo(1,Brick.SIZE/2,Brick.SIZE/2,Brick.SIZE-1,Brick.SIZE,Brick.SIZE-1);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=[],d;for(d=0;d<6;d++){c[d]=new b2PolygonDef;c[d].vertexCount=4;c[d].restitution=0;c[d].friction=0.9}var e=Math.PI/2/6,f={x:-Math.cos(e),y:Math.sin(e)},h={x:-1,y:Math.tan(e)};
c[0].vertexCount=3;c[0].vertices[0].Set(-0.5,-0.5);c[0].vertices[1].Set(f.x+0.5,f.y-0.5);c[0].vertices[2].Set(h.x+0.5,h.y-0.5);for(d=1;d<5;d++){var g={x:-Math.cos((d+1)*e),y:Math.sin((d+1)*e)},i;i=d>=3?{x:-Math.tan((6-d-1)*e),y:1}:{x:-1,y:Math.tan((d+1)*e)};c[d].vertices[0].Set(f.x+0.5,f.y-0.5);c[d].vertices[1].Set(g.x+0.5,g.y-0.5);c[d].vertices[2].Set(i.x+0.5,i.y-0.5);c[d].vertices[3].Set(h.x+0.5,h.y-0.5);f=g;h=i}c[5].vertexCount=3;c[5].vertices[0].Set(0.5,0.5);c[5].vertices[1].Set(h.x+0.5,h.y-0.5);
c[5].vertices[2].Set(f.x+0.5,f.y-0.5);for(d=0;d<6;d++)b.CreateShape(c[d])}});Kicker.prototype.type="Kicker";var Ramp=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,-0.5);c.vertices[1].Set(0.5,0.5);c.vertices[2].Set(-0.5,0.5);b.CreateShape(c)}});
Ramp.prototype.type="Ramp";
var Curve=new Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.bezierCurveTo(Brick.SIZE/2,0,Brick.SIZE,Brick.SIZE/2,Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef,d=Math.PI/2/6,e,f;c.vertexCount=8;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,0.5);e=6;for(f=0;e>=0;e--,f++)c.vertices[f].Set(Math.cos(d*e)-0.5,-Math.sin(d*e)+0.5);c.vertices[7].Set(-0.5,0.5);b.CreateShape(c)}});
Curve.prototype.type="Curve";
var Line=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(Brick.SIZE,0);b.lineTo(Brick.SIZE,Brick.SIZE/7);b.lineTo(0,Brick.SIZE/7);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=8;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,-0.499);c.vertices[1].Set(-0.49,-0.5);c.vertices[2].Set(0.49,-0.5);c.vertices[3].Set(0.5,-0.499);c.vertices[4].Set(0.5,-0.376);c.vertices[5].Set(0.49,-0.375);
c.vertices[6].Set(-0.49,-0.375);c.vertices[7].Set(-0.5,-0.376);b.CreateShape(c)}});Line.prototype.type="Line";
var Exit=Class.create(Brick,{initialize:function($super){$super();this.hasShadow=this.isInFront=this.isRemoveable=this.isDraggable=false},drawShape:function(b){var c=Brick.SIZE/5,d=0,e,f;for(e=0;e<5;e++)for(f=0;f<5;f++){d%2===0&&b.fillRect(c*f,c*e,c,c);d++}},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=4;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0.3,0.3);c.vertices[1].Set(-0.3,0.3);c.vertices[2].Set(-0.3,-0.3);c.vertices[3].Set(0.3,-0.3);c.isSensor=true;b.CreateShape(c);var d=
this;b.onCollision=function(e){d.onCollision(e)}},onCollision:function(b){if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance){this.parent.parent.onBallExit();if(this.parent.trackLength&&this.parent.bricks.length>2){this.parent.validTrack=true;$("publishButton").addClassName("activePublish");$("publishButtonWarning").style.visibility="hidden"}}},rotate:function(){}});Exit.prototype.type="Exit";
var Spring=new Class.create(Brick,{drawShape:function(b){b.strokeStyle=b.fillStyle;b.lineWidth=2;b.beginPath();b.moveTo(Brick.SIZE/5,Brick.SIZE*0.22);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.07);b.moveTo(Brick.SIZE/5,Brick.SIZE*0.37);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.22);b.moveTo(Brick.SIZE/5,Brick.SIZE*0.52);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.37);b.stroke();b.fillRect(0,0,Brick.SIZE,Brick.SIZE/8);b.fillRect(0,Brick.SIZE/2,Brick.SIZE,Brick.SIZE/2);b.clearShadow();this.applyStyle(b);b.strokeRect(0,
0,Brick.SIZE,Brick.SIZE)},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=4;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,-0.5);c.vertices[1].Set(0.5,-0.5);c.vertices[2].Set(0.5,0.5);c.vertices[3].Set(-0.5,0.5);b.CreateShape(c);var d=this;this.body.onCollision=function(e){d.onCollision(e)}},onCollision:function(b){var c;if(b.shape1.GetBody().ballInstance)c=b.shape1.GetBody().ballInstance;else if(b.shape2.GetBody().ballInstance)c=b.shape2.GetBody().ballInstance;else return;var d=
this.body.GetPosition();b=this.rotateVector(new b2Vec2(b.position.x-d.x,b.position.y-d.y),-this.body.GetAngle());if(b.x>-0.5&&b.x<0.5&&b.y>-0.6&&b.y<-0.4){b=new b2Vec2(0,-6);c.impulseVector.Add(this.rotateVector(b,this.body.GetAngle()))}}});Spring.prototype.type="Spring";
var Boost=new Class.create(Brick,{initialize:function($super){$super();this.hasShadow=this.isInFront=false},drawShape:function(b){b.beginPath();b.moveTo(Brick.SIZE/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*2/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*4/7,Brick.SIZE/2);b.lineTo(Brick.SIZE*2/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*3/7,Brick.SIZE/2);b.closePath();b.fill();b.beginPath();b.moveTo(Brick.SIZE*3/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*4/7,Brick.SIZE*3/14);
b.lineTo(Brick.SIZE*6/7,Brick.SIZE/2);b.lineTo(Brick.SIZE*4/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*3/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*5/7,Brick.SIZE/2);b.closePath();b.fill()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=4;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.4,-0.4);c.vertices[1].Set(0.4,-0.4);c.vertices[2].Set(0.4,0.4);c.vertices[3].Set(-0.4,0.4);c.isSensor=true;c.filter.maskBits=2;b.CreateShape(c);var d=this;b.whileCollision=function(e){d.whileCollision(e)}},
whileCollision:function(b){b=b.shape1.GetBody().ballInstance?b.shape1.GetBody().ballInstance:b.shape2.GetBody().ballInstance;var c=new b2Vec2(1,0);b.impulseVector.Add(this.rotateVector(c,this.body.GetAngle()))}});Boost.prototype.type="Boost";
var Ball=Class.create(Brick,{initialize:function($super){$super();this.impulseVector=new b2Vec2;this.positionVector=new b2Vec2;this.velocityVector=new b2Vec2;this.rollLength=0;this.lastPosition=new b2Vec2;this.isRemoveable=this.isDraggable=false;this.isDynamic=true;this.hasShadow=false},update:function(){if(this.impulseVector.Length()>0){this.body.ApplyImpulse(this.impulseVector,this.body.GetPosition());this.impulseVector.Set(0,0)}if(this.positionVector.Length()>0){this.body.SetXForm(this.positionVector,
this.body.GetAngle());this.body.SetLinearVelocity(this.velocityVector);this.lastPosition.Set(this.positionVector.x,this.positionVector.y);this.positionVector.Set(0,0)}this.rollLength+=this.minus(this.lastPosition,this.body.GetPosition()).Length();this.lastPosition.Set(this.body.GetPosition().x,this.body.GetPosition().y);if(this.rollLength>9999)this.rollLength=9999;$("lengthDisplay").update(this.getFormatString(this.rollLength));this.parent.trackLength=this.rollLength/10},minus:function(b,c){return new b2Vec2(b.x-
c.x,b.y-c.y)},getFormatString:function(b){for(b=parseInt(b,10).toString();b.length<4;)b="0"+b;return b.toString()},reset:function(){this.rollLength=0;this.lastPosition.Set(this.cell.col+0.5,this.cell.row+0.5);this.body.SetXForm(this.lastPosition,0);this.body.SetLinearVelocity({x:0,y:0});this.body.SetAngularVelocity(0);this.impulseVector.Set(0,0)},drawShape:function(b){var c;if(this.body){c=this.body.GetPosition();b.addClearRectangle(new Rectangle(this.x+(c.x-this.cell.col-1)*Brick.SIZE,this.y+(c.y-
this.cell.row-1)*Brick.SIZE,Brick.SIZE*2,Brick.SIZE*2))}else c={x:this.cell.col+0.5,y:this.cell.row+0.5};b.save();b.translate((c.x-this.cell.col)*Brick.SIZE,(c.y-this.cell.row)*Brick.SIZE);this.body&&b.rotate(this.body.GetAngle());b.fillStyle="#800000";b.beginPath();b.arc(0,0,Ball.radius*Brick.SIZE,0,Math.PI*2,true);b.lineTo(Ball.radius*Brick.SIZE,0);b.fill();b.restore()},createShapes:function(b){var c=new b2CircleDef;c.radius=Ball.radius;c.restitution=0;c.density=2;c.friction=0.9;c.filter.categoryBits=
2;b.CreateShape(c);b.SetMassFromShapes();b.ballInstance=this},rotate:function(){}});Ball.prototype.type="Ball";Ball.radius=0.25;
var Breaker=new Class.create(Brick,{initialize:function($super){$super();this.bodies=null;this.isBroken=false;this.timeoutID=0;this.isDynamic=false;this.hasShadow=true;this.generateShapes()},reset:function(){this.isBroken=this.isDynamic=false;if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=0}this.bodies&&this.removeBodies(this.world);this.body||this.createBody(this.world)},createBody:function($super,c){this.world=c;$super(c);var d=this;this.body.onCollision=function(e){d.onCollision(e)};
this.body.afterCollision=function(e){d.afterCollision(e)}},createBodies:function(b){this.bodies=[];var c;for(c=0;c<this.shapes.length;c++){var d=new b2BodyDef;d.position.Set(this.cell.col+0.5,this.cell.row+0.5);d=b.CreateBody(d);this.createShape(d,c);d.SetMassFromShapes();this.bodies.push(d)}},removeBody:function($super,c){$super(c);this.bodies&&this.removeBodies(c);this.body=null},removeBodies:function(b){var c=b.m_bodyCount,d;for(d=0;d<this.bodies.length;d++)b.DestroyBody(this.bodies[d]);c===b.m_bodyCount&&
console.error("Bodies were not removed");this.bodies=null},drawShape:function(b){if(!this.isBroken){var c,d,e;b.save();this.bodies&&b.clearShadow();b.translate(-this.cell.col*Brick.SIZE,-this.cell.row*Brick.SIZE);for(c=0;c<this.shapes.length;c++){b.save();e=this.bodies?this.bodies[c].GetPosition():{x:this.cell.col+0.5,y:this.cell.row+0.5};b.translate(e.x*Brick.SIZE,e.y*Brick.SIZE);this.bodies&&b.rotate(this.bodies[c].GetAngle());b.beginPath();b.moveTo(this.shapes[c][0].x*Brick.SIZE,this.shapes[c][0].y*
Brick.SIZE);for(d=1;d<this.shapes[c].length;d++)b.lineTo(this.shapes[c][d].x*Brick.SIZE,this.shapes[c][d].y*Brick.SIZE);b.closePath();b.fill();b.stroke();b.restore();d=this.x+(e.x-this.cell.col-0.7)*Brick.SIZE;e=this.y+(e.y-this.cell.row-0.7)*Brick.SIZE;b.addClearRectangle(new Rectangle(d,e,Brick.SIZE*1.4,Brick.SIZE*1.4))}b.restore()}},createShape:function(b,c){var d=new b2PolygonDef,e;d.vertexCount=this.shapes[c].length;d.restitution=0;d.friction=0.9;for(e=0;e<this.shapes[c].length;e++)d.vertices[e]=
this.shapes[c][e];d.density=2;d.filter.maskBits=1;b.CreateShape(d)},onCollision:function(b){if(this.timeoutID&&(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance)){clearTimeout(this.timeoutID);this.timeoutID=0}},afterCollision:function(b){if(!this.isBroken)if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance){if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=0}var c=this;this.timeoutID=setTimeout(function(){c.onTimeout()},200)}},onTimeout:function(){this.isDynamic=
true;this.parent.renderNew=true;this.removeBody(this.world);this.createBodies(this.world);this.applyImpulse();var b=this;this.timeoutID=setTimeout(function(){b.removeBodies(b.world);b.isBroken=true},500)},applyImpulse:function(){var b,c=new b2Vec2(0,-Math.random());c=this.rotateVector(c,-Math.PI/3);for(b=0;b<this.bodies.length;b++){this.bodies[b].ApplyImpulse(c,this.bodies[b].GetPosition());c=this.rotateVector(c,Math.PI/3)}},generateShapes:function(){this.shapes=[];var b=new b2Vec2(Math.random()/
2-0.25,Math.random()/2-0.25),c=[new b2Vec2(-0.5,Math.random()/2-0.25),new b2Vec2(-0.5,-0.5),new b2Vec2(-Math.random()/2,-0.501),new b2Vec2(Math.random()/2,-0.501),new b2Vec2(0.5,-0.5),new b2Vec2(0.501,Math.random()/2-0.25),new b2Vec2(0.5,0.5),new b2Vec2(Math.random()/2,0.501),new b2Vec2(-Math.random()/2,0.501),new b2Vec2(-0.501,0.5)],d=[3,2,3,3,2,3],e=0,f,h;d.shuffle();for(f=0;f<6;f++){var g=[];g.push(b);for(h=0;h<d[f];h++){g.push(c[e%10]);e++}e--;this.shapes.push(g)}},rotate:function(){}});
Breaker.prototype.type="Breaker";
var Beamer=new Class.create(Brick,{initialize:function($super){$super();this.partner=null;this.hasBeamed=false},reset:function(){this.hasBeamed=false},drawShape:function(b){b.beginPath();b.moveTo(0,Brick.SIZE/2);b.lineTo(Brick.SIZE/5,Brick.SIZE/2);b.bezierCurveTo(Brick.SIZE/5,Brick.SIZE*9/10,Brick.SIZE*4/5,Brick.SIZE*9/10,Brick.SIZE*4/5,Brick.SIZE/2);b.lineTo(Brick.SIZE,Brick.SIZE/2);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=
new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,0);c.vertices[1].Set(0.2,0.5);c.vertices[2].Set(-0.5,0.5);b.CreateShape(c);c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0.5,0);c.vertices[1].Set(0.5,0.5);c.vertices[2].Set(-0.2,0.5);b.CreateShape(c);c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0,0);c.vertices[1].Set(0.2,0.2);c.vertices[2].Set(-0.2,0.2);c.isSensor=true;c.filter.maskBits=
2;b.CreateShape(c);var d=this;b.onCollision=function(e){d.onCollision(e)};b.afterCollision=function(e){d.afterCollision(e)};this.divorce()},removeBody:function($super,c){$super(c);if(this.partner){this.partner.divorce();this.partner=null}else if(this.parent.singles[this.pairType]===this)this.parent.singles[this.pairType]=null},divorce:function(){this.partner=null;this.parent.findPartner(this)},onCollision:function(b){if(b.shape1.m_isSensor)b=b.shape2.GetBody().ballInstance;else if(b.shape2.m_isSensor)b=
b.shape1.GetBody().ballInstance;else return;if(this.partner&&!this.hasBeamed){var c=this.rotateVector(new b2Vec2(0,-0.1),this.partner.rotation);b.positionVector.Set(this.partner.cell.col+0.5+c.x,this.partner.cell.row+0.5+c.y);c.Multiply(10);c.Multiply(b.body.GetLinearVelocity().Length());b.velocityVector=c;this.hasBeamed=this.partner.hasBeamed=true}},afterCollision:function(b){if(this.hasBeamed&&this.partner&&(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance))this.hasBeamed=this.partner.hasBeamed=
false}});Beamer.prototype.type="Beamer";Beamer.prototype.pairType="Beamer";
var OneWay=Class.create(Line,{initialize:function($super){$super();this.isActive=false},reset:function(){this.isActive=false},drawShape:function($super,c){$super(c);c.beginPath();c.moveTo(Brick.SIZE/2,Brick.SIZE*7/20);c.lineTo(Brick.SIZE*7/10,Brick.SIZE*13/20);c.lineTo(Brick.SIZE*3/10,Brick.SIZE*13/20);c.closePath();c.fill()},createShapes:function($super,c){$super(c);var d=new b2PolygonDef;d.vertexCount=4;d.restitution=0;d.friction=0.9;d.vertices[0].Set(-1.5,-0.45);d.vertices[1].Set(1.5,-0.45);d.vertices[2].Set(1.5,
0);d.vertices[3].Set(-1.5,0);d.isSensor=true;d.filter.maskBits=2;c.CreateShape(d);var e=this;c.beforeCollision=function(f,h){return e.beforeCollision(f,h)};c.onCollision=function(f){e.onCollision(f)};c.afterCollision=function(f){e.afterCollision(f)}},removeBody:function($super,c){$super(c)},beforeCollision:function(b,c){if(b.GetBody().ballInstance&&this.isActive)return false;else if(c.GetBody().ballInstance&&this.isActive)return false;return true},onCollision:function(b){if(b.shape1.GetBody().ballInstance&&
b.shape2.m_isSensor)this.isActive=true;else if(b.shape2.GetBody().ballInstance&&b.shape1.m_isSensor)this.isActive=true},afterCollision:function(b){if(b.shape1.GetBody().ballInstance&&b.shape2.m_isSensor)this.isActive=false;else if(b.shape2.GetBody().ballInstance&&b.shape1.m_isSensor)this.isActive=false}});OneWay.prototype.type="OneWay";
var Graviton=new Class.create(Brick,{initialize:function($super){$super();this.isActive=false;this.timeoutID=0;this.isDynamic=false;this.hasShadow=true},reset:function(){this.isActive=false;if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=0}},createBody:function($super,c){$super(c);var d=this;this.body.onCollision=function(e){d.onCollision(e)}},drawShape:function($super,c){$super(c);c.beginPath();c.moveTo(Brick.SIZE/2,Brick.SIZE/7);c.lineTo(Brick.SIZE*6/7,Brick.SIZE/2);c.lineTo(Brick.SIZE*
5/7,Brick.SIZE/2);c.lineTo(Brick.SIZE*5/7,Brick.SIZE*6/7);c.lineTo(Brick.SIZE*2/7,Brick.SIZE*6/7);c.lineTo(Brick.SIZE*2/7,Brick.SIZE/2);c.lineTo(Brick.SIZE/7,Brick.SIZE/2);c.closePath();if(this.isActive){c.save();c.fillStyle=c.strokeStyle;c.fill();c.restore()}else c.stroke()},onCollision:function(b){if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance){this.parent.setActiveGraviton(this);this.isActive=true;this.parent.renderNew=true;var c=this;this.timeoutID=setTimeout(function(){var d=
new b2Vec2(0,-9.81);c.body.GetWorld().SetGravity(c.rotateVector(d,c.body.GetAngle()));c.timeoutID=0},50)}}});Graviton.prototype.type="Graviton";
Grid=Class.create(DisplayObject,{initialize:function($super){$super();this.cols=this.rows=0;this.bricks=[];this.renderNew=true;this.renderDynamics=this.renderStatics=false},draw:function(b){this.drawStatics(b);this.drawDynamics(b)},drawStatics:function(b){this.setClipping(b);b.translate(this.x,this.y);this.drawGrid(b);this.renderStatics=true;b.drawShadows=true;this.drawElements(b);this.drawFieldShadow(b);b.drawShadows=false;this.drawElements(b);this.renderStatics=false;this.drawFrame(b);this.releaseClipping(b)},
drawDynamics:function(b){this.setClipping(b);b.translate(this.x,this.y);this.renderDynamics=true;b.drawShadows=true;this.drawElements(b,true);this.renderDynamics=false;this.releaseClipping(b)},setClipping:function(b){b.save();b.translate(0.5,0.5);b.beginPath();b.moveTo(this.x-2,this.y-2);b.lineTo(this.x+this.width,this.y-2);b.lineTo(this.x+this.width,this.y+this.height);b.lineTo(this.x-2,this.y+this.height);b.closePath();b.translate(-0.5,-0.5);b.clip()},releaseClipping:function(b){b.restore();this.renderNew=
false},drawFrame:function(b){b.save();b.translate(-0.5,-0.5);b.strokeStyle="#2D2D2D";b.lineWidth=2;b.strokeRect(0,0,this.width,this.height);b.restore()},drawGrid:function(b){b.strokeStyle="#000000";b.lineWidth=0.5;var c;for(c=1;c<this.rows;c++){b.beginPath();b.dashedLine(0,c*Brick.SIZE,this.cols*Brick.SIZE,c*Brick.SIZE,3);b.closePath();b.stroke()}for(c=1;c<this.cols;c++){b.beginPath();b.dashedLine(c*Brick.SIZE,0,c*Brick.SIZE,this.rows*Brick.SIZE,3);b.closePath();b.stroke()}b.beginPath()},drawFieldShadow:function(b){b.save();
b.beginPath();b.moveTo(0,0);b.lineTo(this.width,0);b.lineTo(this.width,this.height);b.lineTo(this.width+10,this.height);b.lineTo(this.width+10,-10);b.lineTo(0,-10);b.closePath();b.shadowOffsetX=-6;b.shadowOffsetY=6;b.shadowBlur=5;b.shadowColor="rgba(0, 0, 0, 0.4)";b.fill();b.restore()},drawElements:function(b){if(this.bricks.length!==0){this.bricks[0].applyStyle(b);var c;for(c=0;c<this.bricks.length;c++)if(this.bricks[c].isDynamic&&this.renderDynamics||!this.bricks[c].isDynamic&&this.renderStatics){b.save();
b.translate(this.bricks[c].cell.col*Brick.SIZE,this.bricks[c].cell.row*Brick.SIZE);this.bricks[c].draw(b);b.restore()}}},getCell:function(b,c){if(b>0&&c>0&&b<this.width&&c<this.height)return{row:parseInt(c/Brick.SIZE,10),col:parseInt(b/Brick.SIZE,10)};return null},checkCell:function(b){return b&&b.row>=0&&b.row<this.rows&&b.col>=0&&b.col<this.cols},getCellBox:function(b){if(!this.checkCell(b))return null;return new Rectangle(this.x+b.col*Brick.SIZE,this.y+b.row*Brick.SIZE,Brick.SIZE,Brick.SIZE)},
getBrickAt:function(b){var c;if(this.checkCell(b))for(c=0;c<this.bricks.length;c++)if(this.bricks[c].cell.row===b.row&&this.bricks[c].cell.col===b.col)return this.bricks[c];return null},removeBrickAt:function(b){if(!this.checkCell(b))return false;var c;for(c=0;c<this.bricks.length;c++)if(this.bricks[c].cell.row===b.row&&this.bricks[c].cell.col===b.col){this.bricks.splice(c,1);this.renderNew=true;break}return true},dropBrickAt:function(b,c){if(!this.checkCell(c))return false;b.cell=c;return this.insertBrick(b)},
insertBrick:function(b){b.parent=this;if(!this.removeBrickAt(b.cell))return false;b.x=this.x+b.cell.col*Brick.SIZE;b.y=this.y+b.cell.row*Brick.SIZE;b.width=b.height=Brick.SIZE;b.isInFront?this.bricks.push(b):this.bricks.unshift(b);return this.renderNew=true}});
var Toolbox=Class.create(Grid,{initialize:function($super){$super();this.rows=15;this.cols=3;this.width=Brick.SIZE*this.cols;this.height=Brick.SIZE*this.rows;this.brickCounter=0},addBrick:function(b){var c=new b;c.cell={row:this.brickCounter*2+1,col:1};c.parent=this;this.dropBrickAt(c,c.cell);this.brickCounter++;if(c.pairType){b=new b;b.parent=this;b.setRotation(Math.PI);b.cell=c.cell;this.bricks.push(b);c.partner=b}return c},addPreviewBrick:function(b){b=this.addBrick(b);b.isDraggable=false;b.isPreview=
true;if(b.partner){b.partner.isDraggable=false;b.partner.isPreview=true}},onClick:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e&&e.isDraggable&&this.parent.selectElement&&this.parent.selectElement.brick===e){e.rotate(Math.PI/2);this.renderNew=true;e.partner&&e.partner.rotate(Math.PI/2)}this.select(d)},onStartDrag:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e&&e.isDraggable){var f=new (eval(e.type));f.rotation=e.rotation;this.parent.dragBrick(f)}this.select(d)},
select:function(b){var c=this.getBrickAt(b),d=null;d=this.getCellBox(b);if(c&&c.isDraggable)d.brick=c;this.parent.selectElement=d}});
Field=Class.create(Grid,{initialize:function($super){$super();this.rows=15;this.cols=10;this.width=Brick.SIZE*this.cols;this.height=Brick.SIZE*this.rows;this.bricks=[];this.singles={};this.debugMode=false;this.trackLength=0},setup:function(){$("lengthDisplay").update("0000");this.trackLength=0;this.initializeBox2D();this.clearTrack(true)},draw:function($super,c){this.debugMode?this.drawBodies(c):$super(c)},drawBodies:function(b){b.strokeStyle="#FF0000";b.lineWidth=1;b.save();b.translate(this.x,this.y);
var c;for(c=this.world.GetBodyList();c!==null;c=c.GetNext())this.drawBody(b,c);b.restore();b.addClearRectangle(new Rectangle(this.x-Brick.SIZE,this.y-Brick.SIZE,(this.cols+2)*Brick.SIZE,(this.rows+2)*Brick.SIZE))},drawBody:function(b,c){b.save();var d=c.GetPosition(),e;b.translate(Brick.SIZE*d.x,Brick.SIZE*d.y);b.rotate(c.GetAngle());b.beginPath();b.moveTo(0,0);b.lineTo(0,-Brick.SIZE/2);for(d=c.GetShapeList();d!==null;d=d.GetNext())if(d.m_vertices&&d.m_vertices[0]){b.moveTo(d.m_vertices[0].x*Brick.SIZE,
d.m_vertices[0].y*Brick.SIZE);for(e=1;e<d.m_vertexCount;e++)b.lineTo(d.m_vertices[e].x*Brick.SIZE,d.m_vertices[e].y*Brick.SIZE);b.lineTo(d.m_vertices[0].x*Brick.SIZE,d.m_vertices[0].y*Brick.SIZE)}else{b.moveTo(Ball.radius*Brick.SIZE,0);b.arc(0,0,Ball.radius*Brick.SIZE,0,Math.PI*2,true)}b.stroke();b.restore()},initializeBox2D:function(){var b=new b2AABB,c=new b2Vec2(0,9.81);b.lowerBound.Set(-10,-10);b.upperBound.Set(20,25);this.world=new b2World(b,c,true);this.createBorders();this.initContactListener();
this.initContactFilter();this.intervalLength=1/120},startBox2D:function(){this.resetTrack();var b=this;this.world.SetGravity(new b2Vec2(0,9.81));this.intervalID=setInterval(function(){b.calculateBox2D()},this.intervalLength*1E3);$("lengthDisplay").update("0000");this.trackLength=0},stopBox2D:function(){this.intervalID&&clearInterval(this.intervalID);this.intervalID=null},calculateBox2D:function(){var b;for(b=0;b<this.bricks.length;b++)this.bricks[b].update();this.world.Step(0.02,20)},createBorders:function(){var b=
new b2BodyDef,c=[],d;b.position.Set(0,0);b=this.world.CreateBody(b);for(d=0;d<4;d++){c[d]=new b2PolygonDef;c[d].vertexCount=4;c[d].restitution=0;c[d].friction=0.9}c[0].vertices[0].Set(this.cols,0);c[0].vertices[1].Set(0,0);c[0].vertices[2].Set(0,-1);c[0].vertices[3].Set(this.cols,-1);c[1].vertices[0].Set(this.cols,this.rows);c[1].vertices[1].Set(this.cols,0);c[1].vertices[2].Set(this.cols+1,0);c[1].vertices[3].Set(this.cols+1,this.rows);c[2].vertices[0].Set(0,this.rows);c[2].vertices[1].Set(this.cols,
this.rows);c[2].vertices[2].Set(this.cols,this.rows+1);c[2].vertices[3].Set(0,this.rows+1);c[3].vertices[0].Set(0,0);c[3].vertices[1].Set(0,this.rows);c[3].vertices[2].Set(-1,this.rows);c[3].vertices[3].Set(-1,0);for(d=0;d<4;d++)b.CreateShape(c[d]);b.SetMassFromShapes()},initContactListener:function(){var b=new b2ContactListener;b.Add=function(c){if(c.shape1.GetBody().onCollision)c.shape1.GetBody().onCollision(c);else c.shape2.GetBody().onCollision&&c.shape2.GetBody().onCollision(c)};b.Persist=function(c){if(c.shape1.GetBody().whileCollision)c.shape1.GetBody().whileCollision(c);
else c.shape2.GetBody().whileCollision&&c.shape2.GetBody().whileCollision(c)};b.Remove=function(c){if(c.shape1.GetBody().afterCollision)c.shape1.GetBody().afterCollision(c);else c.shape2.GetBody().afterCollision&&c.shape2.GetBody().afterCollision(c)};this.world.SetContactListener(b)},initContactFilter:function(){var b=new b2ContactFilter;b.ShouldCollide=function(c,d){if(c.GetBody().beforeCollision)return c.GetBody().beforeCollision(c,d);else if(d.GetBody().beforeCollision)return d.GetBody().beforeCollision(c,
d);var e=c.GetFilterData(),f=d.GetFilterData();if(e.groupIndex===f.groupIndex&&e.groupIndex!==0)return e.groupIndex>0;return(e.maskBits&f.categoryBits)!==0&&(e.categoryBits&f.maskBits)!==0};this.world.SetContactFilter(b)},findPartner:function(b){if(this.singles[b.pairType]){if(this.singles[b.pairType]!==b){b.partner=this.singles[b.pairType];this.singles[b.pairType].partner=b;this.singles[b.pairType]=null}}else this.singles[b.type]=b},setActiveGraviton:function(b){if(this.activeGraviton)this.activeGraviton.isActive=
false;this.activeGraviton=b},dropBrickAt:function($super,c,d){if($super(c,d)){c.createBody(this.world);this.validTrack=false;$("publishButton").removeClassName("activePublish")}},removeBrickAt:function($super,c){var d=this.getBrickAt(c);if(d)if($super(c)){d.removeBody(this.world);this.validTrack=false;$("publishButton").removeClassName("activePublish");return true}else return false;return true},onClick:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e){e.rotate(Math.PI/2);this.validTrack=
false;$("publishButton").removeClassName("activePublish")}else if(d&&this.parent.selectElement&&this.parent.selectElement.brick){e=new (eval(this.parent.selectElement.brick.type));e.setRotation(this.parent.selectElement.brick.rotation);this.dropBrickAt(e,d)}this.renderNew=true},onStartDrag:function(b,c){var d=this.getBrickAt(this.getCell(b,c));if(d){if(d.isDraggable){d.isVisible=false;this.renderNew=true;var e=new (eval(d.type));e.setRotation(d.rotation);e.origin=d;this.parent.dragBrick(e);this.validTrack=
false;$("publishButton").removeClassName("activePublish")}}else{this.onDrag(b,c);this.parent.startDragBricking()}},onDrag:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(d&&this.parent.selectElement){if(this.parent.selectElement.brick){if(e&&(!e.isRemoveable||e.type===this.parent.selectElement.brick.type&&e.rotation===this.parent.selectElement.brick.rotation))return;e=new (eval(this.parent.selectElement.brick.type));e.setRotation(this.parent.selectElement.brick.rotation);this.dropBrickAt(e,
d)}else e&&e.isRemoveable&&this.removeBrickAt(d);this.renderNew=true}},onStopDrag:function(b,c){var d=this.getCell(c.x-this.x+Brick.SIZE/2,c.y-this.y+Brick.SIZE/2);if(d){var e=this.getBrickAt(d);this.intervalID&&this.resetTrack();if(e&&!e.isRemoveable){if(c.origin)this.renderNew=c.origin.isVisible=true}else{e&&c.origin!==e&&this.removeBrickAt(d);if(c.origin){c.origin.x=this.x+d.col*Brick.SIZE;c.origin.y=this.y+d.row*Brick.SIZE;c.origin.moveToCell(d);this.renderNew=c.origin.isVisible=true}else this.dropBrickAt(c,
d)}}else if(c.origin)if(c.isRemoveable)this.removeBrickAt(c.origin.cell);else this.renderNew=c.origin.isVisible=true;this.validTrack=false;$("publishButton").removeClassName("activePublish")},resetTrack:function(){this.stopBox2D();this.renderNew=true;var b;for(b=0;b<this.bricks.length;b++)this.bricks[b].reset()},setTrack:function(b){var c;this.clearTrack();for(c in b.bricks)if(b.bricks.hasOwnProperty(c)){var d=b.bricks[c],e=new (eval(d.type));e.setRotation(d.rotation*Math.PI/2);this.dropBrickAt(e,
{row:d.row,col:d.col})}if(b.pairs)for(c=0;c<b.pairs.length;c++){d=this.getBrickAt(b.pairs[c].girl);e=this.getBrickAt(b.pairs[c].boy);if(d&&e&&d.pairType===e.type){d.partner=e;e.partner=d}}return true},getTrack:function(){this.resetTrack();var b={bricks:{},pairs:[]},c,d,e=function(g){for(var i=0;g-0.5>0;){g-=Math.PI/2;i++}return i%4};for(c=0;c<this.bricks.length;c++){var f=this.bricks[c];b.bricks[f.cell.row*this.cols+f.cell.col]={type:f.type,rotation:e(f.rotation),row:f.cell.row,col:f.cell.col};if(f.pairType&&
f.partner){var h=false;for(d=0;d<b.pairs.length;d++)if(b.pairs[d].girl===f||b.pairs[d].boy===f){h=true;break}h||b.pairs.push({girl:{row:f.cell.row,col:f.cell.col},boy:{row:f.partner.cell.row,col:f.partner.cell.col}})}}return b},clearTrack:function(b){this.resetTrack();var c;for(c=0;c<this.bricks.length;c++)this.bricks[c].removeBody(this.world);this.bricks=[];this.singles={};if(b){this.dropBrickAt(new Ball,{row:0,col:0});this.dropBrickAt(new Exit,{row:this.rows-1,col:0})}},getTrackImage:function(b){this.resetTrack();
var c=b.getContext("2d"),d=Brick.SIZE,e;Brick.SIZE=Brick.TINY_SIZE;b.width=Brick.SIZE*this.cols+2;b.height=Brick.SIZE*this.rows+2;c.save();c.translate(0.5,0.5);c.lineWidth=0.5;c.beginPath();for(e=1;e<this.rows;e++)c.dashedLine(0,Brick.SIZE*e,Brick.SIZE*this.cols,Brick.SIZE*e,2);for(e=1;e<this.cols;e++)c.dashedLine(Brick.SIZE*e,0,Brick.SIZE*e,Brick.SIZE*this.rows,2);c.stroke();c.beginPath();if(this.bricks.length){this.bricks[0].applyStyle(c);c.lineWidth=0.5;for(e=0;e<this.bricks.length;e++){c.save();
c.translate(this.bricks[e].cell.col*Brick.SIZE,this.bricks[e].cell.row*Brick.SIZE);this.bricks[e].draw(c);c.restore()}}c.strokeStyle="#000000";c.lineWidth=1;c.strokeRect(0,0,Brick.SIZE*this.cols,Brick.SIZE*this.rows);c.restore();Brick.SIZE=d;return b.toDataURL("image/png")}});
var Renderer=Class.create(DisplayObject,{initialize:function($super,c,d,e){$super();this.staticCanvas=c;this.dynamicCanvas=d;this.bufferCanvas=e;this.staticContext=this.staticCanvas.getContext("2d");this.dynamicContext=this.dynamicCanvas.getContext("2d");this.bufferContext=this.bufferCanvas.getContext("2d");this.field=null;this.initField();this.repeat=false;this.timeoutID=null},initField:function(){if(this.field&&this.field.intervalID){clearInterval(this.field.intervalID);this.field.intervalID=null}this.field=
new Field;this.field.parent=this;this.field.x=64;this.field.y=Brick.SIZE;this.field.setup()},destroy:function(){this.stopRender();this.field.stopBox2D();if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=null}},initializeHTMLInterface:function(){},debug:function(){this.field.debugMode=!this.field.debugMode},startRender:function(){var b=this;this.intervalID=setInterval(function(){b.draw()},25)},stopRender:function(){if(this.intervalID){clearInterval(this.intervalID);this.intervalID=null}},
quit:function(){this.stopRender();this.field.stopBox2D();if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=null}},init:function(){this.startRender()},onBallExit:function(){this.field.stopBox2D();var b=this;this.timeoutID=setTimeout(function(){b.timeoutID=null;b.repeat&&b.field.startBox2D()},10)},clearCanvas:function(b){var c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);c.beginPath()},draw:function(){this.drawStatics();this.drawDynamics();this.dynamicContext.drawImage(this.bufferCanvas,
0,0)},drawStatics:function(){if(this.field.renderNew){this.clearCanvas(this.staticCanvas);this.staticContext.save();this.staticContext.translate(0.5,0.5);this.field.drawStatics(this.staticContext);this.staticContext.restore()}},drawDynamics:function(){this.dynamicContext.save();this.dynamicContext.clearRectangles();this.dynamicContext.translate(0.5,0.5);this.field.drawDynamics(this.dynamicContext);this.field.debugMode&&this.field.draw(this.dynamicContext);this.dynamicContext.restore()}}),Editor=Class.create(Renderer,
{initialize:function($super,c,d,e,f){$super(c,d,e);this.imageCanvas=f;this.baseToolbox=new Toolbox;this.baseToolbox.parent=this;this.baseToolbox.x=this.field.x+this.field.width+3*Brick.SIZE;this.baseToolbox.y=this.field.y;this.specialToolbox=new Toolbox;this.specialToolbox.parent=this;this.specialToolbox.x=this.baseToolbox.x+this.baseToolbox.width+Brick.SIZE;this.specialToolbox.y=this.baseToolbox.y;this.setSize();this.eventEngine=new EventEngine;this.addBricksToToolboxes();this.dragElement=this.hoverElement=
this.selectElement=null;this.initializeHTMLInterface()},destroy:function($super){$super();$("runButton").stopObserving();$("clearButton").stopObserving();$("publishButton").stopObserving();this.eventEngine.removeListener("click",this.onClick);this.eventEngine.removeListener("mouseMove",this.onMouseMove);this.eventEngine.removeListener("startDrag",this.onStartDrag);this.eventEngine.removeListener("stopDrag",this.onStopDrag)},quit:function($super){$super();this.removeEventListening()},init:function($super){$super();
this.setSize();this.addEventListening();this.field.renderNew=true;this.field.resetTrack()},setSize:function(){var b=this.field.y+this.field.height+Brick.SIZE;this.width=this.staticCanvas.width=this.dynamicCanvas.width=this.bufferCanvas.width=this.specialToolbox.x+this.specialToolbox.width+3;this.height=this.staticCanvas.height=this.dynamicCanvas.height=this.bufferCanvas.height=b},addEventListening:function(){this.eventEngine.addListener("click",this.onClick,this);this.eventEngine.addListener("mouseMove",
this.onMouseMove,this);this.eventEngine.addListener("startDrag",this.onStartDrag,this);this.eventEngine.addListener("stopDrag",this.onStopDrag,this)},removeEventListening:function(){this.eventEngine.removeListener("click",this.onClick);this.eventEngine.removeListener("mouseMove",this.onMouseMove);this.eventEngine.removeListener("startDrag",this.onStartDrag);this.eventEngine.removeListener("stopDrag",this.onStopDrag)},addBricksToToolboxes:function(){var b=[Brick,Ramp,Kicker,Curve,Line],c;for(c=0;c<
b.length;c++)this.baseToolbox.addBrick(b[c]);var d=this;new Ajax.Request("/unlocks",{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(e){for(c=5;c<e.responseJSON.unlocks.length;c++)d.specialToolbox.addBrick(eval(e.responseJSON.unlocks[c]));e.responseJSON.locks&&d.specialToolbox.addPreviewBrick(eval(e.responseJSON.locks[0]))},onFailure:function(){}})},initializeHTMLInterface:function(){var b=this;$("runButton").observe("click",function(){b.field.startBox2D()});$("clearButton").observe("click",
function(){b.field.clearTrack(true)});$("publishButton").observe("click",function(){if($("publishButton").hasClassName("activePublish")&&b.field.validTrack){b.publishTrack();$("publishButtonWarning").style.visibility="hidden"}else $("publishButtonWarning").style.visibility="visible"})},drawStatics:function(){if(this.field.renderNew||this.baseToolbox.renderNew||this.specialToolbox.renderNew){this.clearCanvas(this.staticCanvas);this.staticContext.save();this.staticContext.translate(0.5,0.5);this.field.drawStatics(this.staticContext);
this.baseToolbox.drawStatics(this.staticContext);this.specialToolbox.drawStatics(this.staticContext);this.staticContext.restore()}},drawDynamics:function(){this.dynamicContext.save();this.dynamicContext.clearRectangles();this.dynamicContext.translate(0.5,0.5);this.field.drawDynamics(this.dynamicContext);this.baseToolbox.drawDynamics(this.dynamicContext);this.specialToolbox.drawDynamics(this.dynamicContext);if(this.hoverElement){this.dynamicContext.save();this.dynamicContext.fillStyle="#333333";this.dynamicContext.globalAlpha=
0.15;this.hoverElement.draw(this.dynamicContext);this.dynamicContext.restore()}if(this.selectElement){this.dynamicContext.save();this.dynamicContext.fillStyle="#800000";this.dynamicContext.globalAlpha=0.3;this.selectElement.draw(this.dynamicContext);this.dynamicContext.restore()}this.field.debugMode&&this.field.draw(this.dynamicContext);if(this.dragElement){this.dynamicContext.drawShadows=true;this.dragElement.drawGlobal(this.dynamicContext);this.dynamicContext.drawShadows=false}this.dynamicContext.restore()},
onClick:function(b){if(this.field.hitTest(b.mouseX,b.mouseY)){this.field.intervalID||this.field.onClick(b.mouseX-this.field.x,b.mouseY-this.field.y);this.field.resetTrack()}else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.baseToolbox.onClick(b.mouseX-this.baseToolbox.x,b.mouseY-this.baseToolbox.y);else this.specialToolbox.hitTest(b.mouseX,b.mouseY)&&this.specialToolbox.onClick(b.mouseX-this.specialToolbox.x,b.mouseY-this.specialToolbox.y)},onMouseMove:function(b){this.hoverElement=null;if(this.field.hitTest(b.mouseX,
b.mouseY))this.hoverElement=this.getCellBox(this.field,b.mouseX,b.mouseY);else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.hoverElement=this.getCellBox(this.baseToolbox,b.mouseX,b.mouseY);else if(this.specialToolbox.hitTest(b.mouseX,b.mouseY))this.hoverElement=this.getCellBox(this.specialToolbox,b.mouseX,b.mouseY)},getCellBox:function(b,c,d){return b.getCellBox(b.getCell(c-b.x,d-b.y))},onStartDrag:function(b){this.field.resetTrack();if(this.field.hitTest(b.mouseX,b.mouseY)){this.field.resetTrack();
this.field.onStartDrag(b.mouseX-this.field.x,b.mouseY-this.field.y)}else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.baseToolbox.onStartDrag(b.mouseX-this.baseToolbox.x,b.mouseY-this.baseToolbox.y);else this.specialToolbox.hitTest(b.mouseX,b.mouseY)&&this.specialToolbox.onStartDrag(b.mouseX-this.specialToolbox.x,b.mouseY-this.specialToolbox.y)},onDrag:function(b){if(this.dragElement&&b.mouseX&&b.mouseY){this.dragElement.x=parseInt(b.mouseX-Brick.SIZE/2,10);this.dragElement.y=parseInt(b.mouseY-
Brick.SIZE/2,10)}},dragBrick:function(b){var c={x:this.eventEngine.latestEvent.mouseX,y:this.eventEngine.latestEvent.mouseY};b.x=c.x-Brick.BIG_SIZE/2;b.y=c.y-Brick.BIG_SIZE/2;this.dragElement=b;this.eventEngine.addListener("drag",this.onDrag,this)},startDragBricking:function(){this.eventEngine.addListener("drag",this.onDragBricking,this)},onDragBricking:function(b){this.field.hitTest(b.mouseX,b.mouseY)&&this.field.onDrag(b.mouseX-this.field.x,b.mouseY-this.field.y)},onStopDrag:function(b){if(this.dragElement){this.field.onStopDrag(b,
this.dragElement);this.dragElement=null}this.eventEngine.removeListener("drag",this.onDragBricking);this.eventEngine.removeListener("drag",this.onDrag)},publishTrack:function(){if(this.field.validTrack){contentLoader.parseResponse({responseJSON:{mode:"load"}});var b={},c=this.field.trackLength;b["track[json]"]=Object.toJSON(this.field.getTrack());b["track[length]"]=c;b["track[imagedata]"]=this.field.getTrackImage(this.imageCanvas);b["track[username]"]=$("userName").value;b["track[trackname]"]=$("trackName").value;
new Ajax.Request("/tracks",{method:"post",parameters:b,requestHeaders:{Accept:"application/json"},onSuccess:function(d){contentLoader.parseResponse(d,true)},onFailure:function(d){contentLoader.parseResponse(d,false)}});this.field.clearTrack(true)}}}),Showroom=Class.create(Renderer,{initialize:function($super,c,d,e){$super(c,d,e);this.setSize();this.trackID=null},destroy:function($super){$super();$("showButton").stopObserving();$("nextButton").stopObserving();$("previousButton").stopObserving();$("repeatButton").stopObserving()},
quit:function($super){$super();$("showroomLikeButton").stopObserving();$("showroomFlagButton").stopObserving()},init:function($super){this.initField();this.setSize();trackStore.loadNext(currentTrack);trackStore.loadPrevious(currentTrack);this.setLikeBlameButtons();$super()},onBallExit:function($super){this.field.stopBox2D();if(auto)if(trackStore.hasNext(currentTrack)){trackStore.loadTrack(trackStore.next(currentTrack),contentLoader.parseResponse,contentLoader,true);return}else contentLoader.loadContent("/tracks/"+
currentTrack+"/next",true);$super()},setSize:function(){var b=this.field.y+this.field.height+3;this.width=this.staticCanvas.width=this.dynamicCanvas.width=this.bufferCanvas.width=this.field.x+this.field.width+3;this.height=this.staticCanvas.height=this.dynamicCanvas.height=this.bufferCanvas.height=b},parseTrack:function(b){this.field.setTrack(b.json);auto&&this.field.startBox2D()},initializeHTMLInterface:function(){var b=this;$("showButton").observe("click",function(){b.field.startBox2D()});$("nextButton").observe("click",
function(){trackStore.hasNext(currentTrack)?trackStore.loadTrack(trackStore.next(currentTrack),contentLoader.parseResponse,contentLoader,true):contentLoader.loadContent("/tracks/"+currentTrack+"/next")});$("previousButton").observe("click",function(){trackStore.hasPrevious(currentTrack)?trackStore.loadTrack(trackStore.previous(currentTrack),contentLoader.parseResponse,contentLoader,true):contentLoader.loadContent("/tracks/"+currentTrack+"/previous")});$("repeatButton").observe("click",function(){$("repeatButton").toggleClassName("active");
b.repeat=$("repeatButton").hasClassName("active")});$("repeatButton").removeClassName("active")},setLikeBlameButtons:function(){var b=this;if(Cookie.likedTracks.indexOf(this.trackID)===-1){$("showroomLikeButton").observe("click",function(){b.like()});$("showroomLikeButton").setStyle({display:"block"})}else{$("showroomLikeButton").stopObserving();$("showroomLikeButton").setStyle({display:"none"})}if(Cookie.flagedTracks.indexOf(this.trackID)===-1){$("showroomFlagButton").observe("click",function(){b.flag()});
$("showroomFlag").setStyle({display:"block"})}else{$("showroomFlagButton").stopObserving();$("showroomFlag").setStyle({display:"none"})}},startRender:function($super){$super();auto&&this.field.startBox2D()},like:function(){if(this.trackID){var b={},c=this;b.likes=1;new Ajax.Request("/tracks/"+this.trackID,{method:"put",parameters:b,requestHeaders:{Accept:"application/json"},onSuccess:function(){Cookie.likedTracks.push(c.trackID);Cookie.set("likes",JSON.stringify(Cookie.likedTracks),{maxAge:31536E3});
$("tableLikes").update(parseInt($("tableLikes").innerHTML,10)+1);$("showroomLikeButton").setStyle({display:"none"})},onFailure:function(){$("showroomLikeButton").setStyle({display:"none"})}})}},flag:function(){if(this.trackID){var b={},c=this;b.flags=1;new Ajax.Request("/tracks/"+this.trackID,{method:"put",parameters:b,requestHeaders:{Accept:"application/json"},onSuccess:function(){Cookie.flagedTracks.push(c.trackID);Cookie.set("flags",JSON.stringify(Cookie.flagedTracks),{maxAge:31536E3});$("showroomFlag").setStyle({display:"none"})},
onFailure:function(){$("showroomFlag").setStyle({display:"none"})}})}}}),Meter=Class.create(DisplayObject,{initialize:function($super,c){$super();this.canvas=c;this.context=c.getContext("2d");this.context.translate(0.5,0.5);this.width=218;this.height=185;this.angle=-Math.PI/4;this.timeINT=this.targetAngle=null},setSize:function(){this.canvas.width=this.width;this.canvas.height=this.height},setRotation:function(b){clearTimeout(this.timeINT);this.targetAngle=b*Math.PI/2-Math.PI/4;var c=this;setTimeout(function(){c.calculateRotation()},
1E3)},calculateRotation:function(){this.angle+=(this.targetAngle-this.angle)/8;if(Math.abs(this.angle-this.targetAngle)<0.01){this.angle=this.targetAngle;this.draw();this.timeINT=null}else{this.draw();var b=this;this.timeINT=setTimeout(function(){b.calculateRotation()},50)}},draw:function(){this.setSize();this.context.fillStyle=Pattern.meterBackground;this.context.fillRect(0,0,this.width,this.height);this.context.save();this.context.translate(109,120);this.context.rotate(this.angle);this.context.translate(-19,
-65);this.context.drawImage(Pattern.image.meterPointer,0,0,22,92);this.context.restore();this.context.fillStyle=Pattern.meterForeground;this.context.fillRect(0,0,this.width,this.height)}}),SidebarController=Class.create({initialize:function(){meter=new Meter(meterCanvas);meter.setRotation(0);var b=this;new Ajax.PeriodicalUpdater("","/tracks/info",{method:"get",frequency:6,decay:1,onSuccess:function(c){b.onInfoUpdate.call(b,c)},onFailure:function(){}});this.targetMeters=null;this.meters=0},onInfoUpdate:function(b){response=
JSON.parse(b.responseText);meter.setRotation(response.percentage);this.setMeters(parseInt(response.total_length/100,10));this.setLatestTrack(response.latest_track)},setMeters:function(b){this.targetMeters=b;var c=this;setTimeout(function(){c.updateMeters()},100)},updateMeters:function(){if(this.targetMeters-this.meters>1){this.meters+=(this.targetMeters-this.meters)/9;var b=this;setTimeout(function(){b.updateMeters()},50)}else this.meters=this.targetMeters;for(var c=parseInt(this.meters,10).toString();c.length<
7;)c="0"+c;$("lengthMeter").update(c)},setLatestTrack:function(b){$("lastTrackHolder").writeAttribute({onclick:"contentLoader.loadContent('/tracks/"+b.id+"', true)"});$("latestTrackReflection").writeAttribute({onclick:"contentLoader.loadContent('/tracks/"+b.id+"', true)"});var c='<div><img width="122" height="182" src="';c+=b.imagedata;c+='" /><div class="background"></div><div><div class="header">LATEST TRACK</div><div id="latestInfo">';c+=b.trackname.toUpperCase()+"<br>";c+=b.username.toUpperCase()+
"<br>";c+=(Math.round(b.length*10)/10).toString()+" METER";c+="</div></div></div>";$("lastTrackHolder").update(c)}}),ContentLoader=Class.create({initialize:function(){this.oldContent=this.oldMode=this.loadingInterval=this.visibleList=this.canvasContent=null;this.setInitialScreen();this.editor=new Editor(staticCanvas,dynamicCanvas,bufferCanvas,imageCanvas);this.editor.x=editorPosition.left;this.editor.y=editorPosition.top;this.showroom=new Showroom(staticCanvas,dynamicCanvas,bufferCanvas);this.showroom.x=
editorPosition.left;this.showroom.y=editorPosition.top;var b=this;Pattern.context=meterCanvas.getContext("2d");Pattern.loadPattern([{name:"meterBackground",path:"../images/sidebar-meter-background.png"},{name:"meterForeground",path:"../images/sidebar-meter-foreground.png"},{name:"meterPointer",path:"../images/sidebar-meter-pointer.png"}]);Pattern.onload=function(){sidebarController=new SidebarController;var c=window.location.href,d=c.substr(c.indexOf("/",7));if(d.substr(0,8)=="/tracks?"){d=d.substr(8);
d=d.split("&");for(var e=0;e<d.length;e++){var f=d[e].split("="),h=f[0];f=f[1];if(h=="page")currentPage=f;else if(h=="search"){currentKeyWord=f;document.getElementById("searchField").value=f}else if(h=="sorting")currentSorting=f}}b.loadContent(c)};this.showroom.initializeHTMLInterface()},loadContent:function(b,c){this.parseResponse({responseJSON:{mode:"load"}});if(b==="/about"||b==="/imprint"||b==="/contact")this.parseResponse({responseJSON:{mode:b.substr(1)}},c);else{var d=this;new Ajax.Request(b,
{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(e){d.parseResponse.call(d,e,c)},onFailure:function(e){d.parseResponse.call(d,e,false)}})}},parseResponse:function(b,c){this.loadingInterval&&clearInterval(this.loadingInterval);if(typeof c==="undefined")c=true;var d=b.responseJSON,e;this.visibleList=[];this.oldContent&&this.oldContent.quit();switch(d.mode){case "build":this.oldContent=this.editor;this.createBuildMode(d);e="/tracks/new";break;case "show":this.oldContent=this.showroom;
this.createShowMode(d);trackStore.addTrack(d.track);e="/tracks/"+d.track.id;setSwitchMode("none");break;case "overview":this.oldContent=null;this.createOverviewMode(d);e="/tracks?page="+currentPage;if(currentKeyWord.length>0)e+="&search="+currentKeyWord;if(currentSorting.length>0)e+="&sorting="+currentSorting;break;case "about":case "imprint":case "contact":this.oldContent=null;this.visibleList=[d.mode+"Page"];e="/"+d.mode;break;case "load":this.oldContent=null;c=false;this.visibleList=["loadingPage"];
this.loadingInterval=setInterval(function(){$("loadingPage").toggleClassName("blink")},500);break;case "failure":this.oldContent=null;this.visibleList=["errorPage"];$("errorMessage").update(d.message.toUpperCase())}this.oldMode=d.mode;setToggleElementsVisibility(this.visibleList);c&&this.pushURL(e,b);$("helpBox").setStyle({display:"none"});$("helpButton").removeClassName("active")},createBuildMode:function(){setBuildTweetButton();setSwitchMode("build");this.editor.init();$("editor").setStyle({height:"560px"});
this.visibleList=["editorControlsTop","editorControlsBottom","editorToolboxTop","editorToolboxBottom","staticCanvas","dynamicCanvas","editorRuler"]},createShowMode:function(b){setTrackTweetButton(b.track.id);setSwitchMode("view");currentTrack=b.track.id;this.showroom.trackID=b.track.id;this.showroom.init();this.showroom.parseTrack(b.track);$("tableTrack").update(b.track.trackname.toUpperCase());$("tableBuilder").update(b.track.username.toUpperCase());$("tableLength").update(parseInt(b.track.length*
10,10)/10+" METER");$("tableDate").update(b.track.date);$("tableTime").update(b.track.time);$("tableLikes").update(b.track.likes);$("editor").setStyle({height:"520px"});this.visibleList=["showroomControlsTop","showroomControlsBottom","showroomDetail","staticCanvas","dynamicCanvas"]},createOverviewMode:function(b){setSwitchMode("view");currentPage=b.current_page;$("overviewPageDisplay").update(""+b.current_page+" / "+b.total_pages);$("overviewPreviousButton").removeClassName("inactive");$("overviewNextButton").removeClassName("inactive");
b.current_page<=1&&$("overviewPreviousButton").addClassName("inactive");b.current_page>=b.total_pages&&$("overviewNextButton").addClassName("inactive");var c="<ul>",d,e=null,f=null;if(b.tracks.length==0)c='<p class="no-track-warning">No track found</p>';for(d=0;d<b.tracks.length;d++){e=d===b.tracks.length-1?null:b.tracks[d+1].id;trackStore.addTrack(b.tracks[d],e,f);f=b.tracks[d].id;e="<li>";e+='<a onclick="trackStore.loadTrack('+b.tracks[d].id+', contentLoader.parseResponse, contentLoader)"><img src="'+
b.tracks[d].imagedata+'"></a>';e+="<ul>";e+='<li class="trackname">'+b.tracks[d].trackname+"</li>";e+='<li class="username">'+b.tracks[d].username+"</li>";e+='<li class="length">'+Math.round(b.tracks[d].length*10)/10+" Meter | LIKES "+b.tracks[d].likes+"</li>";e+="</ul>";e+="</li>";c+=e}c+="</ul>";$("overviewGrid").update(c);this.visibleList=["overviewControls","overviewGrid"]},pushURL:function(b,c){history&&history.pushState&&history.pushState(c,"",b)},onPopState:function(b){this.parseResponse(b.state,
false)},setInitialScreen:function(){if(Cookie.get("isFirstVisit")){$("firstVisitContainer").setStyle({visibility:"hidden"});$("firstVisitText").setStyle({visibility:"hidden"});$("firstVisitCloseButton").setStyle({visibility:"hidden"})}else{$("firstVisitContainer").setStyle({visibility:"visible"});$("firstVisitText").setStyle({visibility:"visible"});$("firstVisitCloseButton").setStyle({visibility:"visible"});$("firstVisitCloseButton").observe("click",function(){$("firstVisitContainer").setStyle({visibility:"hidden"});
$("firstVisitText").setStyle({visibility:"hidden"});$("firstVisitCloseButton").setStyle({visibility:"hidden"})})}Cookie.set("isFirstVisit",true,{maxAge:5184E3});Cookie.likedTracks=JSON.parse(Cookie.get("likes"))||[];Cookie.flagedTracks=JSON.parse(Cookie.get("flags"))||[]}}),TrackStore=Class.create({initialize:function(){this.tracks={}},addTrack:function(b,c,d){if(this.tracks[b.id]){if(c)this.tracks[b.id].next=c;if(d)this.tracks[b.id].previous=d}else this.tracks[b.id]={track:b,next:c,previous:d}},
getTrack:function(b){if(!this.tracks[b])return null;return this.tracks[b].track},loadTrack:function(b,c,d,e){if(this.tracks[b])if(c){c.call(d,{responseJSON:{mode:"show",track:this.tracks[b].track}},e);return}var f=this;new Ajax.Request("/tracks/"+b,{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(h){f.addTrack.call(f,h.responseJSON.track);c&&c.call(d,h,e)},onFailure:function(){}})},loadNext:function(b){if(!(this.tracks[b]&&this.tracks[b].next&&this.tracks[this.tracks[b].next])){var c=
this;new Ajax.Request("/tracks/"+b+"/next",{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(d){c.tracks[b].next=d.responseJSON.track.id;c.addTrack.call(c,d.responseJSON.track,null,b)},onFailure:function(){c.tracks[b].next=b}})}},loadPrevious:function(b){if(!(this.tracks[b]&&this.tracks[b].previous&&this.tracks[this.tracks[b].previous])){var c=this;new Ajax.Request("/tracks/"+b+"/previous",{method:"get",requestHeaders:{Accept:"application/json"},onSuccess:function(d){c.tracks[b].previous=
d.responseJSON.track.id;c.addTrack.call(c,d.responseJSON.track,b,null)},onFailure:function(){c.tracks[b].previous=b}})}},hasNext:function(b){return this.tracks[b].next!==null},next:function(b){if(this.hasNext(b))return this.tracks[b].next;return null},hasPrevious:function(b){return this.tracks[b].previous!==null},previous:function(b){if(this.hasPrevious(b))return this.tracks[b].previous;return null}});