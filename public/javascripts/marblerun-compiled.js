var Prototype={Version:"1.7_rc2",Browser:function(){var b=navigator.userAgent,c=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!c,Opera:c,WebKit:b.indexOf("AppleWebKit/")>-1,Gecko:b.indexOf("Gecko")>-1&&b.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(b)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var b=window.Element||window.HTMLElement;return!(!b||!b.prototype)}(),SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!==
"undefined")return!0;var b=document.createElement("div"),c=document.createElement("form"),d=!1;b.__proto__&&b.__proto__!==c.__proto__&&(d=!0);return d}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(b){return b}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=!1;
var Abstract={},Try={these:function(){for(var b,c=0,d=arguments.length;c<d;c++){var e=arguments[c];try{b=e();break}catch(f){}}return b}},Class=function(){function b(){}var c=function(){for(var b in{toString:1})if(b==="toString")return!1;return!0}();return{create:function(){function c(){this.initialize.apply(this,arguments)}var e=null,f=$A(arguments);Object.isFunction(f[0])&&(e=f.shift());Object.extend(c,Class.Methods);c.superclass=e;c.subclasses=[];if(e)b.prototype=e.prototype,c.prototype=new b,e.subclasses.push(c);
e=0;for(var g=f.length;e<g;e++)c.addMethods(f[e]);if(!c.prototype.initialize)c.prototype.initialize=Prototype.emptyFunction;return c.prototype.constructor=c},Methods:{addMethods:function(b){var e=this.superclass&&this.superclass.prototype,f=Object.keys(b);c&&(b.toString!=Object.prototype.toString&&f.push("toString"),b.valueOf!=Object.prototype.valueOf&&f.push("valueOf"));for(var g=0,h=f.length;g<h;g++){var i=f[g],j=b[i];if(e&&Object.isFunction(j)&&j.argumentNames()[0]=="$super"){var k=j;j=function(b){return function(){return e[b].apply(this,
arguments)}}(i).wrap(k);j.valueOf=k.valueOf.bind(k);j.toString=k.toString.bind(k)}this.prototype[i]=j}return this}}}}();
(function(){function b(b){switch(b){case null:return k;case void 0:return l}switch(typeof b){case "boolean":return m;case "number":return n;case "string":return o}return p}function c(b,c){for(var d in c)b[d]=c[d];return b}function d(b){return e("",{"":b},[])}function e(c,d,f){d=d[c];var h=typeof d;b(d)===p&&typeof d.toJSON==="function"&&(d=d.toJSON(c));c=j.call(d);switch(c){case r:case q:case u:d=d.valueOf()}switch(d){case null:return"null";case !0:return"true";case !1:return"false"}switch(typeof d){case "string":return d.inspect(!0);
case "number":return isFinite(d)?String(d):"null";case "object":h=0;for(var g=f.length;h<g;h++)if(f[h]===d)throw new TypeError;f.push(d);var i=[];if(c===z){h=0;for(g=d.length;h<g;h++){var k=e(h,d,f);i.push(typeof k==="undefined"?"null":k)}i="["+i.join(",")+"]"}else{var l=Object.keys(d);h=0;for(g=l.length;h<g;h++)c=l[h],k=e(c,d,f),typeof k!=="undefined"&&i.push(c.inspect(!0)+":"+k);i="{"+i.join(",")+"}"}f.pop();return i}}function f(b){return JSON.stringify(b)}function g(c){if(b(c)!==p)throw new TypeError;
var d=[],e;for(e in c)c.hasOwnProperty(e)&&d.push(e);return d}function h(b){return j.call(b)===z}function i(b){return typeof b==="undefined"}var j=Object.prototype.toString,k="Null",l="Undefined",m="Boolean",n="Number",o="String",p="Object",q="[object Boolean]",r="[object Number]",u="[object String]",z="[object Array]",y=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";if(typeof Array.isArray=="function"&&Array.isArray([])&&
!Array.isArray({}))h=Array.isArray;c(Object,{extend:c,inspect:function(b){try{if(i(b))return"undefined";if(b===null)return"null";return b.inspect?b.inspect():String(b)}catch(c){if(c instanceof RangeError)return"...";throw c;}},toJSON:y?f:d,toQueryString:function(b){return $H(b).toQueryString()},toHTML:function(b){return b&&b.toHTML?b.toHTML():String.interpret(b)},keys:Object.keys||g,values:function(b){var c=[],d;for(d in b)c.push(b[d]);return c},clone:function(b){return c({},b)},isElement:function(b){return!!(b&&
b.nodeType==1)},isArray:h,isHash:function(b){return b instanceof Hash},isFunction:function(b){return typeof b==="function"},isString:function(b){return j.call(b)===u},isNumber:function(b){return j.call(b)===r},isUndefined:i})})();
Object.extend(Function.prototype,function(){function b(b,c){for(var d=b.length,h=c.length;h--;)b[d+h]=c[h];return b}function c(c,f){c=d.call(c,0);return b(c,f)}var d=Array.prototype.slice;return{argumentNames:function(){var b=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return b.length==1&&!b[0]?[]:b},bind:function(b){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var f=this,g=d.call(arguments,
1);return function(){var d=c(g,arguments);return f.apply(b,d)}},bindAsEventListener:function(c){var f=this,g=d.call(arguments,1);return function(d){d=b([d||window.event],g);return f.apply(c,d)}},curry:function(){if(!arguments.length)return this;var b=this,f=d.call(arguments,0);return function(){var d=c(f,arguments);return b.apply(this,d)}},delay:function(b){var c=this,g=d.call(arguments,1);b*=1E3;return window.setTimeout(function(){return c.apply(c,g)},b)},defer:function(){return this.delay.apply(this,
b([0.01],arguments))},wrap:function(c){var d=this;return function(){var g=b([d.bind(this)],arguments);return c.apply(this,g)}},methodize:function(){if(this._methodized)return this._methodized;var c=this;return this._methodized=function(){var d=b([this],arguments);return c.apply(null,d)}}}}());
(function(b){function c(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function d(){return this.toISOString()}if(!b.toISOString)b.toISOString=c;if(!b.toJSON)b.toJSON=d})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(b){return String(b).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(b,c){this.callback=b;this.frequency=c;this.currentlyExecuting=!1;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer)clearInterval(this.timer),this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(b){throw this.currentlyExecuting=
!1,b;}}});Object.extend(String,{interpret:function(b){return b==null?"":String(b)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function b(b){if(Object.isFunction(b))return b;var c=new Template(b);return function(b){return c.evaluate(b)}}function c(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function d(b){var c=this.strip().match(/([^?#]*)(#.*)?$/);if(!c)return{};return c[1].split(b||"&").inject({},function(b,c){if((c=c.split("="))[0]){var d=decodeURIComponent(c.shift()),e=c.length>1?c.join("="):c[0];e!=void 0&&(e=decodeURIComponent(e));d in b?(Object.isArray(b[d])||(b[d]=
[b[d]]),b[d].push(e)):b[d]=e}return b})}function e(b){var c=this.unfilterJSON(),d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;d.test(c)&&(c=c.replace(d,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));try{if(!b||c.isJSON())return eval("("+c+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function f(){var b=this.unfilterJSON();return JSON.parse(b)}var g=window.JSON&&typeof JSON.parse===
"function"&&JSON.parse('{"test": true}').test;return{gsub:function(c,d){var e="",f=this,g;d=b(d);Object.isString(c)&&(c=RegExp.escape(c));if(!c.length&&!c.source)return d=d(""),d+f.split("").join(d)+d;for(;f.length>0;)(g=f.match(c))?(e+=f.slice(0,g.index),e+=String.interpret(d(g)),f=f.slice(g.index+g[0].length)):(e+=f,f="");return e},sub:function(c,d,e){d=b(d);e=Object.isUndefined(e)?1:e;return this.gsub(c,function(b){if(--e<0)return b[0];return d(b)})},scan:function(b,c){this.gsub(b,c);return String(this)},
truncate:function(b,c){b=b||30;c=Object.isUndefined(c)?"...":c;return this.length>b?this.slice(0,b-c.length)+c:String(this)},strip:String.prototype.trim||c,stripTags:function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripScripts:function(){return this.replace(RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var b=RegExp(Prototype.ScriptFragment,"im");return(this.match(RegExp(Prototype.ScriptFragment,"img"))||[]).map(function(c){return(c.match(b)||
["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(b){return eval(b)})},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},toQueryParams:d,parseQuery:d,toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(b){return b<
1?"":Array(b+1).join(this)},camelize:function(){return this.replace(/-+(.)?/g,function(b,c){return c?c.toUpperCase():""})},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/_/g,"-")},inspect:function(b){var c=this.replace(/[\x00-\x1f\\]/g,function(b){if(b in
String.specialChar)return String.specialChar[b];return"\\u00"+b.charCodeAt().toPaddedString(2,16)});if(b)return'"'+c.replace(/"/g,'\\"')+'"';return"'"+c.replace(/'/g,"\\'")+"'"},unfilterJSON:function(b){return this.replace(b||Prototype.JSONFilter,"$1")},isJSON:function(){var b=this;if(b.blank())return!1;b=b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");b=b.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");b=b.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(b)},
evalJSON:g?f:e,include:function(b){return this.indexOf(b)>-1},startsWith:function(b){return this.lastIndexOf(b,0)===0},endsWith:function(b){var c=this.length-b.length;return c>=0&&this.indexOf(b,c)===c},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(b,c){return(new Template(this,c)).evaluate(b)}}}());
var Template=Class.create({initialize:function(b,c){this.template=b.toString();this.pattern=c||Template.Pattern},evaluate:function(b){b&&Object.isFunction(b.toTemplateReplacements)&&(b=b.toTemplateReplacements());return this.template.gsub(this.pattern,function(c){if(b==null)return c[1]+"";var d=c[1]||"";if(d=="\\")return c[2];var e=b,f=c[3],g=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;c=g.exec(f);if(c==null)return d;for(;c!=null;){var h=c[1].startsWith("[")?c[2].replace(/\\\\]/g,"]"):c[1];e=e[h];if(null==
e||""==c[3])break;f=f.substring("["==c[3]?c[1].length:c[0].length);c=g.exec(f)}return d+String.interpret(e)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function b(b,c){b=b||Prototype.K;var d=!0;this.each(function(e,f){d=d&&!!b.call(c,e,f);if(!d)throw $break;});return d}function c(b,c){b=b||Prototype.K;var d=!1;this.each(function(e,f){if(d=!!b.call(c,e,f))throw $break;});return d}function d(b,c){b=b||Prototype.K;var d=[];this.each(function(e,f){d.push(b.call(c,e,f))});return d}function e(b,c){var d;this.each(function(e,f){if(b.call(c,e,f))throw d=e,$break;});return d}function f(b,c){var d=[];this.each(function(e,
f){b.call(c,e,f)&&d.push(e)});return d}function g(b){if(Object.isFunction(this.indexOf)&&this.indexOf(b)!=-1)return!0;var c=!1;this.each(function(d){if(d==b)throw c=!0,$break;});return c}function h(){return this.map()}return{each:function(b,c){var d=0;try{this._each(function(e){b.call(c,e,d++)})}catch(e){if(e!=$break)throw e;}return this},eachSlice:function(b,c,d){var e=-b,f=[],h=this.toArray();if(b<1)return h;for(;(e+=b)<h.length;)f.push(h.slice(e,e+b));return f.collect(c,d)},all:b,every:b,any:c,
some:c,collect:d,map:d,detect:e,findAll:f,select:f,filter:f,grep:function(b,c,d){c=c||Prototype.K;var e=[];Object.isString(b)&&(b=RegExp(RegExp.escape(b)));this.each(function(f,h){b.match(f)&&e.push(c.call(d,f,h))});return e},include:g,member:g,inGroupsOf:function(b,c){c=Object.isUndefined(c)?null:c;return this.eachSlice(b,function(d){for(;d.length<b;)d.push(c);return d})},inject:function(b,c,d){this.each(function(e,f){b=c.call(d,b,e,f)});return b},invoke:function(b){var c=$A(arguments).slice(1);
return this.map(function(d){return d[b].apply(d,c)})},max:function(b,c){b=b||Prototype.K;var d;this.each(function(e,f){e=b.call(c,e,f);if(d==null||e>=d)d=e});return d},min:function(b,c){b=b||Prototype.K;var d;this.each(function(e,f){e=b.call(c,e,f);if(d==null||e<d)d=e});return d},partition:function(b,c){b=b||Prototype.K;var d=[],e=[];this.each(function(f,h){(b.call(c,f,h)?d:e).push(f)});return[d,e]},pluck:function(b){var c=[];this.each(function(d){c.push(d[b])});return c},reject:function(b,c){var d=
[];this.each(function(e,f){b.call(c,e,f)||d.push(e)});return d},sortBy:function(b,c){return this.map(function(d,e){return{value:d,criteria:b.call(c,d,e)}}).sort(function(b,c){var d=b.criteria,e=c.criteria;return d<e?-1:d>e?1:0}).pluck("value")},toArray:h,entries:h,zip:function(){var b=Prototype.K,c=$A(arguments);Object.isFunction(c.last())&&(b=c.pop());var d=[this].concat(c).map($A);return this.map(function(c,e){return b(d.pluck(e))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+
this.toArray().inspect()+">"},find:e}}();function $A(b){if(!b)return[];if("toArray"in Object(b))return b.toArray();for(var c=b.length||0,d=Array(c);c--;)d[c]=b[c];return d}function $w(b){if(!Object.isString(b))return[];return(b=b.strip())?b.split(/\s+/):[]}Array.from=$A;
(function(){function b(b){for(var c=0,d=this.length;c<d;c++)b(this[c])}function c(){return h.call(this,0)}function d(b,c){c||(c=0);var d=this.length;for(c<0&&(c=d+c);c<d;c++)if(this[c]===b)return c;return-1}function e(b,c){c=isNaN(c)?this.length:(c<0?this.length+c:c)+1;var d=this.slice(0,c).reverse().indexOf(b);return d<0?d:c-d-1}function f(){for(var b=h.call(this,0),c,d=0,e=arguments.length;d<e;d++)if(c=arguments[d],Object.isArray(c)&&!("callee"in c))for(var f=0,g=c.length;f<g;f++)b.push(c[f]);else b.push(c);
return b}var g=Array.prototype,h=g.slice,i=g.forEach;i||(i=b);Object.extend(g,Enumerable);if(!g._reverse)g._reverse=g.reverse;Object.extend(g,{_each:i,clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(b){return b!=null})},flatten:function(){return this.inject([],function(b,c){if(Object.isArray(c))return b.concat(c.flatten());b.push(c);return b})},without:function(){var b=h.call(arguments,
0);return this.select(function(c){return!b.include(c)})},reverse:function(b){return(b===!1?this.toArray():this)._reverse()},uniq:function(b){return this.inject([],function(c,d,e){(0==e||(b?c.last()!=d:!c.include(d)))&&c.push(d);return c})},intersect:function(b){return this.uniq().findAll(function(c){return b.detect(function(b){return c===b})})},clone:c,toArray:c,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"}});if(function(){return[].concat(arguments)[0][0]!==
1}(1,2))g.concat=f;if(!g.indexOf)g.indexOf=d;if(!g.lastIndexOf)g.lastIndexOf=e})();function $H(b){return new Hash(b)}
var Hash=Class.create(Enumerable,function(){function b(){return Object.clone(this._object)}function c(b,c){if(Object.isUndefined(c))return b;return b+"="+encodeURIComponent(String.interpret(c))}return{initialize:function(b){this._object=Object.isHash(b)?b.toObject():Object.clone(b)},_each:function(b){for(var c in this._object){var f=this._object[c],g=[c,f];g.key=c;g.value=f;b(g)}},set:function(b,c){return this._object[b]=c},get:function(b){if(this._object[b]!==Object.prototype[b])return this._object[b]},
unset:function(b){var c=this._object[b];delete this._object[b];return c},toObject:b,toTemplateReplacements:b,keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(b){var c=this.detect(function(c){return c.value===b});return c&&c.key},merge:function(b){return this.clone().update(b)},update:function(b){return(new Hash(b)).inject(this,function(b,c){b.set(c.key,c.value);return b})},toQueryString:function(){return this.inject([],function(b,e){var f=encodeURIComponent(e.key),
g=e.value;if(g&&typeof g=="object"){if(Object.isArray(g))return b.concat(g.map(c.curry(f)))}else b.push(c(f,g));return b}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(b){return b.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:b,clone:function(){return new Hash(this)}}}());Hash.from=$H;
Object.extend(Number.prototype,function(){return{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(b,c){$R(0,this,!0).each(b,c);return this},toPaddedString:function(b,c){var d=this.toString(c||10);return"0".times(b-d.length)+d},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}}}());function $R(b,c,d){return new ObjectRange(b,c,d)}
var ObjectRange=Class.create(Enumerable,function(){return{initialize:function(b,c,d){this.start=b;this.end=c;this.exclusive=d},_each:function(b){for(var c=this.start;this.include(c);)b(c),c=c.succ()},include:function(b){if(b<this.start)return!1;if(this.exclusive)return b<this.end;return b<=this.end}}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||
!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(b){this.responders._each(b)},register:function(b){this.include(b)||this.responders.push(b)},unregister:function(b){this.responders=this.responders.without(b)},dispatch:function(b,c,d,e){this.each(function(f){if(Object.isFunction(f[b]))try{f[b].apply(f,[c,d,e])}catch(g){}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(b){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0};Object.extend(this.options,b||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function($super,c,d){$super(d);this.transport=Ajax.getTransport();this.request(c)},request:function(b){this.url=b;this.method=this.options.method;b=Object.clone(this.options.parameters);if(!["get","post"].include(this.method))b._method=this.method,this.method="post";this.parameters=b;if(b=Object.toQueryString(b))this.method=="get"?this.url+=(this.url.include("?")?"&":"?")+b:/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(b+="&_=");
try{var c=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(c);Ajax.Responders.dispatch("onCreate",this,c);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||b:null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)this.onStateChange()}catch(d){this.dispatchException(d)}},
onStateChange:function(){var b=this.transport.readyState;b>1&&!(b==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var b={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"&&(b["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||
[0,2005])[1]<2005))b.Connection="close";if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(Object.isFunction(c.push))for(var d=0,e=c.length;d<e;d+=2)b[c[d]]=c[d+1];else $H(c).each(function(c){b[c.key]=c.value})}for(var f in b)this.transport.setRequestHeader(f,b[f])},success:function(){var b=this.getStatus();return!b||b>=200&&b<300},getStatus:function(){try{return this.transport.status||0}catch(b){return 0}},respondToReadyState:function(b){b=Ajax.Request.Events[b];
var c=new Ajax.Response(this);if(b=="Complete"){try{this._complete=!0,(this.options["on"+c.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(c,c.headerJSON)}catch(d){this.dispatchException(d)}var e=c.getHeader("Content-type");(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&e&&e.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+b]||Prototype.emptyFunction)(c,c.headerJSON),
Ajax.Responders.dispatch("on"+b,this,c,c.headerJSON)}catch(f){this.dispatchException(f)}if(b=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var b=this.url.match(/^\s*https?:\/\/[^\/]*/);return!b||b[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(b){try{return this.transport.getResponseHeader(b)||null}catch(c){return null}},evalResponse:function(){try{return eval((this.transport.responseText||
"").unfilterJSON())}catch(b){this.dispatchException(b)}},dispatchException:function(b){(this.options.onException||Prototype.emptyFunction)(this,b);Ajax.Responders.dispatch("onException",this,b)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(b){this.request=b;b=this.transport=b.transport;var c=this.readyState=b.readyState;if(c>2&&!Prototype.Browser.IE||c==4)this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(b.responseText),this.headerJSON=this._getHeaderJSON();if(c==4)b=b.responseXML,this.responseXML=Object.isUndefined(b)?null:b,this.responseJSON=this._getResponseJSON()},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||
""}catch(b){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(b){return null}},getResponseHeader:function(b){return this.transport.getResponseHeader(b)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var b=this.getHeader("X-JSON");if(!b)return null;b=decodeURIComponent(escape(b));try{return b.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(c){this.request.dispatchException(c)}},
_getResponseJSON:function(){var b=this.request.options;if(!b.evalJSON||b.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(b.sanitizeJSON||!this.request.isSameOrigin())}catch(c){this.request.dispatchException(c)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,c,d,e){this.container={success:c.success||c,failure:c.failure||(c.success?null:c)};e=Object.clone(e);var f=e.onComplete;e.onComplete=function(c,d){this.updateContent(c.responseText);Object.isFunction(f)&&f(c,d)}.bind(this);$super(d,e)},updateContent:function(b){var c=this.container[this.success()?"success":"failure"],d=this.options;d.evalScripts||(b=b.stripScripts());if(c=$(c))if(d.insertion)if(Object.isString(d.insertion)){var e=
{};e[d.insertion]=b;c.insert(e)}else d.insertion(c,b);else c.update(b)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,c,d,e){$super(e);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=c;this.url=d;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(b){if(this.options.decay)this.decay=b.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=b.responseText;this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(b){if(arguments.length>1){for(var c=0,d=[],e=arguments.length;c<e;c++)d.push($(arguments[c]));return d}Object.isString(b)&&(b=document.getElementById(b));return Element.extend(b)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(b,c){for(var d=[],e=document.evaluate(b,$(c)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),f=0,g=e.snapshotLength;f<g;f++)d.push(Element.extend(e.snapshotItem(f)));return d};if(!Node)var Node={};
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(b){var c=function(){try{var b=document.createElement('<input name="x">');return b.tagName.toLowerCase()==="input"&&b.name==="x"}catch(c){return!1}}(),d=b.Element;b.Element=function(b,d){d=d||{};b=b.toLowerCase();var g=Element.cache;if(c&&d.name)return b="<"+b+' name="'+d.name+'">',delete d.name,Element.writeAttribute(document.createElement(b),d);g[b]||(g[b]=Element.extend(document.createElement(b)));return Element.writeAttribute(g[b].cloneNode(!1),d)};Object.extend(b.Element,d||{});if(d)b.Element.prototype=
d.prototype})(this);Element.idCounter=1;Element.cache={};function purgeElement(b){var c=b._prototypeUID;if(c)Element.stopObserving(b),b._prototypeUID=void 0,delete Element.Storage[c]}
Element.Methods={visible:function(b){return $(b).style.display!="none"},toggle:function(b){b=$(b);Element[Element.visible(b)?"hide":"show"](b);return b},hide:function(b){b=$(b);b.style.display="none";return b},show:function(b){b=$(b);b.style.display="";return b},remove:function(b){b=$(b);b.parentNode.removeChild(b);return b},update:function(){var b=function(){var b=document.createElement("select"),c=!0;b.innerHTML='<option value="test">test</option>';b.options&&b.options[0]&&(c=b.options[0].nodeName.toUpperCase()!==
"OPTION");return c}(),c=function(){try{var b=document.createElement("table");if(b&&b.tBodies)return b.innerHTML="<tbody><tr><td>test</td></tr></tbody>",typeof b.tBodies[0]=="undefined"}catch(c){return!0}}(),d=function(){var b=document.createElement("script"),c=!1;try{b.appendChild(document.createTextNode("")),c=!b.firstChild||b.firstChild&&b.firstChild.nodeType!==3}catch(d){c=!0}return c}();return function(e,f){e=$(e);for(var g=e.getElementsByTagName("*"),h=g.length;h--;)purgeElement(g[h]);f&&f.toElement&&
(f=f.toElement());if(Object.isElement(f))return e.update().insert(f);f=Object.toHTML(f);g=e.tagName.toUpperCase();if(g==="SCRIPT"&&d)return e.text=f,e;if(b||c)if(g in Element._insertionTranslations.tags){for(;e.firstChild;)e.removeChild(e.firstChild);Element._getContentFromAnonymousElement(g,f.stripScripts()).each(function(b){e.appendChild(b)})}else e.innerHTML=f.stripScripts();else e.innerHTML=f.stripScripts();f.evalScripts.bind(f).defer();return e}}(),replace:function(b,c){b=$(b);if(c&&c.toElement)c=
c.toElement();else if(!Object.isElement(c)){c=Object.toHTML(c);var d=b.ownerDocument.createRange();d.selectNode(b);c.evalScripts.bind(c).defer();c=d.createContextualFragment(c.stripScripts())}b.parentNode.replaceChild(c,b);return b},insert:function(b,c){b=$(b);if(Object.isString(c)||Object.isNumber(c)||Object.isElement(c)||c&&(c.toElement||c.toHTML))c={bottom:c};var d,e,f,g;for(g in c)d=c[g],g=g.toLowerCase(),e=Element._insertionTranslations[g],d&&d.toElement&&(d=d.toElement()),Object.isElement(d)?
e(b,d):(d=Object.toHTML(d),f=(g=="before"||g=="after"?b.parentNode:b).tagName.toUpperCase(),f=Element._getContentFromAnonymousElement(f,d.stripScripts()),(g=="top"||g=="after")&&f.reverse(),f.each(e.curry(b)),d.evalScripts.bind(d).defer());return b},wrap:function(b,c,d){b=$(b);Object.isElement(c)?$(c).writeAttribute(d||{}):c=Object.isString(c)?new Element(c,d):new Element("div",c);b.parentNode&&b.parentNode.replaceChild(c,b);c.appendChild(b);return c},inspect:function(b){b=$(b);var c="<"+b.tagName.toLowerCase();
$H({id:"id",className:"class"}).each(function(d){var e=d.first();d=d.last();(e=(b[e]||"").toString())&&(c+=" "+d+"="+e.inspect(!0))});return c+">"},recursivelyCollect:function(b,c,d){b=$(b);d=d||-1;for(var e=[];b=b[c];)if(b.nodeType==1&&e.push(Element.extend(b)),e.length==d)break;return e},ancestors:function(b){return Element.recursivelyCollect(b,"parentNode")},descendants:function(b){return Element.select(b,"*")},firstDescendant:function(b){for(b=$(b).firstChild;b&&b.nodeType!=1;)b=b.nextSibling;
return $(b)},immediateDescendants:function(b){var c=[];for(b=$(b).firstChild;b;)b.nodeType===1&&c.push(Element.extend(b)),b=b.nextSibling;return c},previousSiblings:function(b){return Element.recursivelyCollect(b,"previousSibling")},nextSiblings:function(b){return Element.recursivelyCollect(b,"nextSibling")},siblings:function(b){b=$(b);return Element.previousSiblings(b).reverse().concat(Element.nextSiblings(b))},match:function(b,c){b=$(b);if(Object.isString(c))return Prototype.Selector.match(b,c);
return c.match(b)},up:function(b,c,d){b=$(b);if(arguments.length==1)return $(b.parentNode);var e=Element.ancestors(b);return Object.isNumber(c)?e[c]:Prototype.Selector.find(e,c,d)},down:function(b,c,d){b=$(b);if(arguments.length==1)return Element.firstDescendant(b);return Object.isNumber(c)?Element.descendants(b)[c]:Element.select(b,c)[d||0]},previous:function(b,c,d){b=$(b);Object.isNumber(c)&&(d=c,c=!1);Object.isNumber(d)||(d=0);return c?Prototype.Selector.find(b.previousSiblings(),c,d):b.recursivelyCollect("previousSibling",
d+1)[d]},next:function(b,c,d){b=$(b);Object.isNumber(c)&&(d=c,c=!1);Object.isNumber(d)||(d=0);return c?Prototype.Selector.find(b.nextSiblings(),c,d):(Object.isNumber(d),b.recursivelyCollect("nextSibling",d+1)[d])},select:function(b){b=$(b);var c=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(c,b)},adjacent:function(b){b=$(b);var c=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(c,b.parentNode).without(b)},identify:function(b){b=
$(b);var c=Element.readAttribute(b,"id");if(c)return c;do c="anonymous_element_"+Element.idCounter++;while($(c));Element.writeAttribute(b,"id",c);return c},readAttribute:function(b,c){b=$(b);if(Prototype.Browser.IE){var d=Element._attributeTranslations.read;if(d.values[c])return d.values[c](b,c);d.names[c]&&(c=d.names[c]);if(c.include(":"))return!b.attributes||!b.attributes[c]?null:b.attributes[c].value}return b.getAttribute(c)},writeAttribute:function(b,c,d){b=$(b);var e={},f=Element._attributeTranslations.write;
typeof c=="object"?e=c:e[c]=Object.isUndefined(d)?!0:d;for(var g in e)c=f.names[g]||g,d=e[g],f.values[g]&&(c=f.values[g](b,d)),d===!1||d===null?b.removeAttribute(c):d===!0?b.setAttribute(c,c):b.setAttribute(c,d);return b},getHeight:function(b){return Element.getDimensions(b).height},getWidth:function(b){return Element.getDimensions(b).width},classNames:function(b){return new Element.ClassNames(b)},hasClassName:function(b,c){if(b=$(b)){var d=b.className;return d.length>0&&(d==c||RegExp("(^|\\s)"+c+
"(\\s|$)").test(d))}},addClassName:function(b,c){if(b=$(b))return Element.hasClassName(b,c)||(b.className+=(b.className?" ":"")+c),b},removeClassName:function(b,c){if(b=$(b))return b.className=b.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ").strip(),b},toggleClassName:function(b,c){if(b=$(b))return Element[Element.hasClassName(b,c)?"removeClassName":"addClassName"](b,c)},cleanWhitespace:function(b){b=$(b);for(var c=b.firstChild;c;){var d=c.nextSibling;c.nodeType==3&&!/\S/.test(c.nodeValue)&&
b.removeChild(c);c=d}return b},empty:function(b){return $(b).innerHTML.blank()},descendantOf:function(b,c){b=$(b);c=$(c);if(b.compareDocumentPosition)return(b.compareDocumentPosition(c)&8)===8;if(c.contains)return c.contains(b)&&c!==b;for(;b=b.parentNode;)if(b==c)return!0;return!1},scrollTo:function(b){b=$(b);var c=Element.cumulativeOffset(b);window.scrollTo(c[0],c[1]);return b},getStyle:function(b,c){b=$(b);c=c=="float"?"cssFloat":c.camelize();var d=b.style[c];if(!d||d=="auto")d=(d=document.defaultView.getComputedStyle(b,
null))?d[c]:null;if(c=="opacity")return d?parseFloat(d):1;return d=="auto"?null:d},getOpacity:function(b){return $(b).getStyle("opacity")},setStyle:function(b,c){b=$(b);var d=b.style;if(Object.isString(c))return b.style.cssText+=";"+c,c.include("opacity")?b.setOpacity(c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b;for(var e in c)e=="opacity"?b.setOpacity(c[e]):d[e=="float"||e=="cssFloat"?Object.isUndefined(d.styleFloat)?"cssFloat":"styleFloat":e]=c[e];return b},setOpacity:function(b,c){b=$(b);b.style.opacity=
c==1||c===""?"":c<1.0E-5?0:c;return b},makePositioned:function(b){b=$(b);var c=Element.getStyle(b,"position");if(c=="static"||!c)if(b._madePositioned=!0,b.style.position="relative",Prototype.Browser.Opera)b.style.top=0,b.style.left=0;return b},undoPositioned:function(b){b=$(b);if(b._madePositioned)b._madePositioned=void 0,b.style.position=b.style.top=b.style.left=b.style.bottom=b.style.right="";return b},makeClipping:function(b){b=$(b);if(b._overflow)return b;b._overflow=Element.getStyle(b,"overflow")||
"auto";if(b._overflow!=="hidden")b.style.overflow="hidden";return b},undoClipping:function(b){b=$(b);if(!b._overflow)return b;b.style.overflow=b._overflow=="auto"?"":b._overflow;b._overflow=null;return b},cumulativeOffset:function(b){var c=0,d=0;if(b.parentNode){do c+=b.offsetTop||0,d+=b.offsetLeft||0,b=b.offsetParent;while(b)}return Element._returnOffset(d,c)},positionedOffset:function(b){var c=0,d=0;do if(c+=b.offsetTop||0,d+=b.offsetLeft||0,b=b.offsetParent){if(b.tagName.toUpperCase()=="BODY")break;
if(Element.getStyle(b,"position")!=="static")break}while(b);return Element._returnOffset(d,c)},absolutize:function(b){b=$(b);if(Element.getStyle(b,"position")=="absolute")return b;var c=Element.positionedOffset(b),d=c[1];c=c[0];var e=b.clientWidth,f=b.clientHeight;b._originalLeft=c-parseFloat(b.style.left||0);b._originalTop=d-parseFloat(b.style.top||0);b._originalWidth=b.style.width;b._originalHeight=b.style.height;b.style.position="absolute";b.style.top=d+"px";b.style.left=c+"px";b.style.width=e+
"px";b.style.height=f+"px";return b},relativize:function(b){b=$(b);if(Element.getStyle(b,"position")=="relative")return b;b.style.position="relative";var c=parseFloat(b.style.top||0)-(b._originalTop||0),d=parseFloat(b.style.left||0)-(b._originalLeft||0);b.style.top=c+"px";b.style.left=d+"px";b.style.height=b._originalHeight;b.style.width=b._originalWidth;return b},cumulativeScrollOffset:function(b){var c=0,d=0;do c+=b.scrollTop||0,d+=b.scrollLeft||0,b=b.parentNode;while(b);return Element._returnOffset(d,
c)},getOffsetParent:function(b){if(b.offsetParent)return $(b.offsetParent);if(b==document.body)return $(b);for(;(b=b.parentNode)&&b!=document.body;)if(Element.getStyle(b,"position")!="static")return $(b);return $(document.body)},viewportOffset:function(b){var c=0,d=0,e=b;do if(c+=e.offsetTop||0,d+=e.offsetLeft||0,e.offsetParent==document.body&&Element.getStyle(e,"position")=="absolute")break;while(e=e.offsetParent);e=b;do if(!Prototype.Browser.Opera||e.tagName&&e.tagName.toUpperCase()=="BODY")c-=
e.scrollTop||0,d-=e.scrollLeft||0;while(e=e.parentNode);return Element._returnOffset(d,c)},clonePosition:function(b,c,d){d=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},d||{});c=$(c);var e=Element.viewportOffset(c),f=[0,0],g=null;b=$(b);Element.getStyle(b,"position")=="absolute"&&(g=Element.getOffsetParent(b),f=Element.viewportOffset(g));g==document.body&&(f[0]-=document.body.offsetLeft,f[1]-=document.body.offsetTop);if(d.setLeft)b.style.left=e[0]-f[0]+d.offsetLeft+
"px";if(d.setTop)b.style.top=e[1]-f[1]+d.offsetTop+"px";if(d.setWidth)b.style.width=c.offsetWidth+"px";if(d.setHeight)b.style.height=c.offsetHeight+"px";return b}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera)Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(b,c,d){switch(d){case "left":case "top":case "right":case "bottom":if(b(c,"position")==="static")return null;case "height":case "width":if(!Element.visible(c))return null;var e=parseInt(b(c,d),10);if(e!==c["offset"+d.capitalize()])return e+"px";return(d==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(e,
function(d,e){var h=b(c,e);return h===null?d:d-parseInt(h,10)})+"px";default:return b(c,d)}}),Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(b,c,d){if(d==="title")return c.title;return b(c,d)});else if(Prototype.Browser.IE)Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(b,c){c=$(c);if(!c.parentNode)return $(document.body);var d=c.getStyle("position");if(d!=="static")return b(c);c.setStyle({position:"relative"});var e=b(c);c.setStyle({position:d});
return e}),$w("positionedOffset viewportOffset").each(function(b){Element.Methods[b]=Element.Methods[b].wrap(function(b,d){d=$(d);if(!d.parentNode)return Element._returnOffset(0,0);var e=d.getStyle("position");if(e!=="static")return b(d);var f=d.getOffsetParent();f&&f.getStyle("position")==="fixed"&&f.setStyle({zoom:1});d.setStyle({position:"relative"});f=b(d);d.setStyle({position:e});return f})}),Element.Methods.getStyle=function(b,c){b=$(b);c=c=="float"||c=="cssFloat"?"styleFloat":c.camelize();
var d=b.style[c];!d&&b.currentStyle&&(d=b.currentStyle[c]);if(c=="opacity"){if((d=(b.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))&&d[1])return parseFloat(d[1])/100;return 1}if(d=="auto"){if((c=="width"||c=="height")&&b.getStyle("display")!="none")return b["offset"+c.capitalize()]+"px";return null}return d},Element.Methods.setOpacity=function(b,c){b=$(b);var d=b.currentStyle;if(d&&!d.hasLayout||!d&&b.style.zoom=="normal")b.style.zoom=1;d=b.getStyle("filter");var e=b.style;if(c==1||c==="")return(d=
d.replace(/alpha\([^\)]*\)/gi,""))?e.filter=d:e.removeAttribute("filter"),b;else c<1.0E-5&&(c=0);e.filter=d.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+c*100+")";return b},Element._attributeTranslations=function(){var b="className",c="for",d=document.createElement("div");d.setAttribute(b,"x");d.className!=="x"&&(d.setAttribute("class","x"),d.className==="x"&&(b="class"));d=null;d=document.createElement("label");d.setAttribute(c,"x");d.htmlFor!=="x"&&(d.setAttribute("htmlFor","x"),d.htmlFor===
"x"&&(c="htmlFor"));d=null;return{read:{names:{"class":b,className:b,"for":c,htmlFor:c},values:{_getAttr:function(b,c){return b.getAttribute(c)},_getAttr2:function(b,c){return b.getAttribute(c,2)},_getAttrNode:function(b,c){var d=b.getAttributeNode(c);return d?d.value:""},_getEv:function(){var b=document.createElement("div"),c;b.onclick=Prototype.emptyFunction;b=b.getAttribute("onclick");String(b).indexOf("{")>-1?c=function(b,c){c=b.getAttribute(c);if(!c)return null;c=c.toString();c=c.split("{")[1];
c=c.split("}")[0];return c.strip()}:b===""&&(c=function(b,c){c=b.getAttribute(c);if(!c)return null;return c.strip()});b=null;return c}(),_flag:function(b,c){return $(b).hasAttribute(c)?c:null},style:function(b){return b.style.cssText.toLowerCase()},title:function(b){return b.title}}}}}(),Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(b,c){b.checked=!!c},style:function(b,
c){b.style.cssText=c?c:""}}},Element._attributeTranslations.has={},$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(b){Element._attributeTranslations.write.names[b.toLowerCase()]=b;Element._attributeTranslations.has[b.toLowerCase()]=b}),function(b){Object.extend(b,{href:b._getAttr2,src:b._getAttr2,type:b._getAttr,action:b._getAttrNode,disabled:b._flag,checked:b._flag,readonly:b._flag,multiple:b._flag,onload:b._getEv,onunload:b._getEv,
onclick:b._getEv,ondblclick:b._getEv,onmousedown:b._getEv,onmouseup:b._getEv,onmouseover:b._getEv,onmousemove:b._getEv,onmouseout:b._getEv,onfocus:b._getEv,onblur:b._getEv,onkeypress:b._getEv,onkeydown:b._getEv,onkeyup:b._getEv,onsubmit:b._getEv,onreset:b._getEv,onselect:b._getEv,onchange:b._getEv})}(Element._attributeTranslations.read.values),Prototype.BrowserFeatures.ElementExtensions&&function(){Element.Methods.down=function(b,c,d){b=$(b);if(arguments.length==1)return b.firstDescendant();var e;
if(Object.isNumber(c)){e=b.getElementsByTagName("*");for(var f=[],g=0,h;h=e[g];g++)h.tagName!=="!"&&f.push(h);e=f[c]}else e=Element.select(b,c)[d||0];return e}}();else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=function(b,c){b=$(b);b.style.opacity=c==1?0.999999:c===""?"":c<1.0E-5?0:c;return b};else if(Prototype.Browser.WebKit)Element.Methods.setOpacity=function(b,c){b=$(b);b.style.opacity=c==1||c===""?"":c<1.0E-5?0:c;if(c==1)if(b.tagName.toUpperCase()==
"IMG"&&b.width)b.width++,b.width--;else try{var d=document.createTextNode(" ");b.appendChild(d);b.removeChild(d)}catch(e){}return b},Element.Methods.cumulativeOffset=function(b){var c=0,d=0;do{c+=b.offsetTop||0;d+=b.offsetLeft||0;if(b.offsetParent==document.body&&Element.getStyle(b,"position")=="absolute")break;b=b.offsetParent}while(b);return Element._returnOffset(d,c)};
if("outerHTML"in document.documentElement)Element.Methods.replace=function(b,c){b=$(b);c&&c.toElement&&(c=c.toElement());if(Object.isElement(c))return b.parentNode.replaceChild(c,b),b;c=Object.toHTML(c);var d=b.parentNode,e=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[e]){var f=b.next();e=Element._getContentFromAnonymousElement(e,c.stripScripts());d.removeChild(b);f?e.each(function(b){d.insertBefore(b,f)}):e.each(function(b){d.appendChild(b)})}else b.outerHTML=c.stripScripts();c.evalScripts.bind(c).defer();
return b};Element._returnOffset=function(b,c){var d=[b,c];d.left=b;d.top=c;return d};Element._getContentFromAnonymousElement=function(b,c){var d=new Element("div"),e=Element._insertionTranslations.tags[b];if(e){d.innerHTML=e[0]+c+e[1];for(e=e[2];e--;)d=d.firstChild}else d.innerHTML=c;return $A(d.childNodes)};
Element._insertionTranslations={before:function(b,c){b.parentNode.insertBefore(c,b)},top:function(b,c){b.insertBefore(c,b.firstChild)},bottom:function(b,c){b.appendChild(c)},after:function(b,c){b.parentNode.insertBefore(c,b.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var b=Element._insertionTranslations.tags;Object.extend(b,{THEAD:b.TBODY,TFOOT:b.TBODY,TH:b.TD})})();Element.Methods.Simulated={hasAttribute:function(b,c){c=Element._attributeTranslations.has[c]||c;var d=$(b).getAttributeNode(c);return!(!d||!d.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(b){if(!Prototype.BrowserFeatures.ElementExtensions&&b.__proto__)window.HTMLElement={},window.HTMLElement.prototype=b.__proto__,Prototype.BrowserFeatures.ElementExtensions=!0})(document.createElement("div"));
Element.extend=function(){function b(b,c){for(var d in c){var e=c[d];Object.isFunction(e)&&!(d in b)&&(b[d]=e.methodize())}}var c=function(b){if(typeof window.Element!="undefined"){var c=window.Element.prototype;if(c){var d="_"+(Math.random()+"").slice(2);b=document.createElement(b);c[d]="x";b=b[d]!=="x";delete c[d];return b}}return!1}("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(c)return function(c){if(c&&typeof c._extendedByPrototype=="undefined"){var d=c.tagName;d&&/^(?:object|applet|embed)$/i.test(d)&&
(b(c,Element.Methods),b(c,Element.Methods.Simulated),b(c,Element.Methods.ByTag[d.toUpperCase()]))}return c};return Prototype.K}var d={},e=Element.Methods.ByTag;c=Object.extend(function(c){if(!c||typeof c._extendedByPrototype!="undefined"||c.nodeType!=1||c==window)return c;var g=Object.clone(d),h=c.tagName.toUpperCase();e[h]&&Object.extend(g,e[h]);b(c,g);c._extendedByPrototype=Prototype.emptyFunction;return c},{refresh:function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(d,Element.Methods),
Object.extend(d,Element.Methods.Simulated))}});c.refresh();return c}();Element.hasAttribute=document.documentElement.hasAttribute?function(b,c){return b.hasAttribute(c)}:Element.Methods.Simulated.hasAttribute;
Element.addMethods=function(b){function c(c){c=c.toUpperCase();Element.Methods.ByTag[c]||(Element.Methods.ByTag[c]={});Object.extend(Element.Methods.ByTag[c],b)}function d(b,c,d){d=d||!1;for(var e in b){var f=b[e];if(Object.isFunction(f)&&(!d||!(e in c)))c[e]=f.methodize()}}function e(b){var c,d={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",
INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};d[b]&&(c="HTML"+d[b]+"Element");if(window[c])return window[c];c="HTML"+b+"Element";if(window[c])return window[c];c="HTML"+b.capitalize()+"Element";if(window[c])return window[c];b=document.createElement(b);return b.__proto__||b.constructor.prototype}var f=Prototype.BrowserFeatures,
g=Element.Methods.ByTag;b||(Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)}));if(arguments.length==2){var h=b;b=arguments[1]}h?Object.isArray(h)?h.each(c):c(h):Object.extend(Element.Methods,b||{});h=window.HTMLElement?HTMLElement.prototype:Element.prototype;f.ElementExtensions&&
(d(Element.Methods,h),d(Element.Methods.Simulated,h,!0));if(f.SpecificElementExtensions)for(var i in Element.Methods.ByTag)f=e(i),Object.isUndefined(f)||d(g[i],f.prototype);Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(b){function c(){if(e.WebKit&&!f.evaluate)return document;if(e.Opera&&window.parseFloat(window.opera.version())<9.5)return document.body;return document.documentElement}function d(d){g||(g=c());h[d]="client"+d;b["get"+d]=function(){return g[h[d]]};return b["get"+d]()}var e=Prototype.Browser,f=document,g,h={};b.getWidth=d.curry("Width");b.getHeight=d.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(b){if(b=$(b)){if(b===window)b=0;else{if(typeof b._prototypeUID==="undefined")b._prototypeUID=Element.Storage.UID++;b=b._prototypeUID}Element.Storage[b]||(Element.Storage[b]=$H());return Element.Storage[b]}},store:function(b,c,d){if(b=$(b))return arguments.length===2?Element.getStorage(b).update(c):Element.getStorage(b).set(c,d),b},retrieve:function(b,c,d){if(b=$(b)){b=Element.getStorage(b);var e=b.get(c);Object.isUndefined(e)&&(b.set(c,d),e=d);return e}},clone:function(b,
c){if(b=$(b)){var d=b.cloneNode(c);d._prototypeUID=void 0;if(c)for(var e=Element.select(d,"*"),f=e.length;f--;)e[f]._prototypeUID=void 0;return Element.extend(d)}},purge:function(b){if(b=$(b)){purgeElement(b);b=b.getElementsByTagName("*");for(var c=b.length;c--;)purgeElement(b[c]);return null}}});
(function(){function b(b,c){Object.isElement(b)&&(element=b,b=element.getStyle(c));if(b===null)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(b))return window.parseFloat(b);if(/\d/.test(b)&&element.runtimeStyle){var d=element.style.left,e=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=b||0;b=element.style.pixelLeft;element.style.left=d;element.runtimeStyle.left=e;return b}if(b.include("%")){e=(e=b.match(/^(\d+)%?$/i))?Number(e[1])/100:null;if(c.include("left")||
c.include("right")||c.include("width"))d=$(element.parentNode).measure("width");else if(c.include("top")||c.include("bottom")||c.include("height"))d=$(element.parentNode).measure("height");return d*e}return 0}function c(b){if(f(b))return $(document.body);if(Element.getStyle(b,"display")!=="inline"&&b.offsetParent)return $(b.offsetParent);if(b===document.body)return $(b);for(;(b=b.parentNode)&&b!==document.body;)if(Element.getStyle(b,"position")!=="static")return b.nodeName==="HTML"?$(document.body):
$(b);return $(document.body)}function d(b){var c=b.getLayout(),d=0,e=0;do if(d+=b.offsetTop||0,e+=b.offsetLeft||0,b=b.offsetParent){if(b.nodeName.toUpperCase()==="BODY")break;if(Element.getStyle(b,"position")!=="static")break}while(b);e-=c.get("margin-top");d-=c.get("margin-left");return new Element.Offset(e,d)}function e(b){var c=0,d=0,e=document.body,f=b;do if(c+=f.offsetTop||0,d+=f.offsetLeft||0,f.offsetParent==e&&Element.getStyle(f,"position")=="absolute")break;while(f=f.offsetParent);f=b;do f!=
e&&(c-=f.scrollTop||0,d-=f.scrollLeft||0);while(f=f.parentNode);return new Element.Offset(d,c)}function f(b){return b!==document.body&&!Element.descendantOf(b,document.body)}var g=Prototype.K;"currentStyle"in document.documentElement&&(g=function(b){if(!b.currentStyle.hasLayout)b.style.zoom=1;return b});Element.Layout=Class.create(Hash,{initialize:function($super,b,c){$super();this.element=$(b);Element.Layout.PROPERTIES.each(function(b){this._set(b,null)},this);if(c)this._preComputing=!0,this._begin(),
Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1},_set:function(b,c){return Hash.prototype.set.call(this,b,c)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,b){var c=$super(b);return c===null?this._compute(b):c},_begin:function(){if(!this._prepared){var c=this.element,d;a:{for(d=c;d&&d.parentNode;){if(d.getStyle("display")==="none"){d=!1;break a}d=$(d.parentNode)}d=!0}if(!d){c.store("prototype_original_styles",{position:c.style.position||
"",width:c.style.width||"",visibility:c.style.visibility||"",display:c.style.display||""});d=c.getStyle("position");var e=c.getStyle("width");c.setStyle({position:"absolute",visibility:"hidden",display:"block"});var f=c.getStyle("width");d=e&&f===e?b(e):e&&(d==="absolute"||d==="fixed")?b(e):$(c.parentNode).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");c.setStyle({width:d+
"px"})}this._prepared=!0}},_end:function(){var b=this.element,c=b.retrieve("prototype_original_styles");b.store("prototype_original_styles",null);b.setStyle(c);this._prepared=!1},_compute:function(b){var c=Element.Layout.COMPUTATIONS;if(!(b in c))throw"Property not found.";return this._set(b,c[b].call(this,this.element))},toObject:function(){var b=$A(arguments),c={};(b.length===0?Element.Layout.PROPERTIES:b.join(" ").split(" ")).each(function(b){if(Element.Layout.PROPERTIES.include(b)){var d=this.get(b);
d!=null&&(c[b]=d)}},this);return c},toHash:function(){var b=this.toObject.apply(this,arguments);return new Hash(b)},toCSS:function(){var b=$A(arguments),c={};(b.length===0?Element.Layout.PROPERTIES:b.join(" ").split(" ")).each(function(b){if(Element.Layout.PROPERTIES.include(b)&&!Element.Layout.COMPOSITE_PROPERTIES.include(b)){var d=this.get(b);d!=null&&(b.include("border")&&(b+="-width"),b=b.camelize(),c[b]=d+"px")}},this);return c},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,
{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(){this._preComputing||this._begin();
var b=this.get("border-box-height");if(b<=0)return 0;var c=this.get("border-top"),d=this.get("border-bottom"),e=this.get("padding-top"),f=this.get("padding-bottom");this._preComputing||this._end();return b-c-d-e-f},width:function(){this._preComputing||this._begin();var b=this.get("border-box-width");if(b<=0)return 0;var c=this.get("border-left"),d=this.get("border-right"),e=this.get("padding-left"),f=this.get("padding-right");this._preComputing||this._end();return b-c-d-e-f},"padding-box-height":function(){var b=
this.get("height"),c=this.get("padding-top"),d=this.get("padding-bottom");return b+c+d},"padding-box-width":function(){var b=this.get("width"),c=this.get("padding-left"),d=this.get("padding-right");return b+c+d},"border-box-height":function(b){return b.offsetHeight},"border-box-width":function(b){return b.offsetWidth},"margin-box-height":function(){var b=this.get("border-box-height"),c=this.get("margin-top"),d=this.get("margin-bottom");if(b<=0)return 0;return b+c+d},"margin-box-width":function(){var b=
this.get("border-box-width"),c=this.get("margin-left"),d=this.get("margin-right");if(b<=0)return 0;return b+c+d},top:function(b){return b.positionedOffset().top},bottom:function(b){var c=b.positionedOffset();b=b.getOffsetParent().measure("height");var d=this.get("border-box-height");return b-d-c.top},left:function(b){return b.positionedOffset().left},right:function(b){var c=b.positionedOffset();b=b.getOffsetParent().measure("width");var d=this.get("border-box-width");return b-d-c.left},"padding-top":function(c){return b(c,
"paddingTop")},"padding-bottom":function(c){return b(c,"paddingBottom")},"padding-left":function(c){return b(c,"paddingLeft")},"padding-right":function(c){return b(c,"paddingRight")},"border-top":function(c){return Object.isNumber(c.clientTop)?c.clientTop:b(c,"borderTopWidth")},"border-bottom":function(c){return Object.isNumber(c.clientBottom)?c.clientBottom:b(c,"borderBottomWidth")},"border-left":function(c){return Object.isNumber(c.clientLeft)?c.clientLeft:b(c,"borderLeftWidth")},"border-right":function(c){return Object.isNumber(c.clientRight)?
c.clientRight:b(c,"borderRightWidth")},"margin-top":function(c){return b(c,"marginTop")},"margin-bottom":function(c){return b(c,"marginBottom")},"margin-left":function(c){return b(c,"marginLeft")},"margin-right":function(c){return b(c,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(b){var c=g(b.getOffsetParent());b=b.getBoundingClientRect();return(c.getBoundingClientRect().right-b.right).round()},bottom:function(b){var c=
g(b.getOffsetParent());b=b.getBoundingClientRect();return(c.getBoundingClientRect().bottom-b.bottom).round()}});Element.Offset=Class.create({initialize:function(b,c){this.left=b.round();this.top=c.round();this[0]=this.left;this[1]=this.top},relativeTo:function(b){return new Element.Offset(this.left-b.left,this.top-b.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,
this.top]}});Element.addMethods({getLayout:function(b,c){return new Element.Layout(b,c)},measure:function(b,c){return $(b).getLayout().get(c)},getDimensions:function(b){b=$(b).getLayout();return{width:b.get("width"),height:b.get("height")}},getOffsetParent:c,cumulativeOffset:function(b){var c=0,d=0;do c+=b.offsetTop||0,d+=b.offsetLeft||0,b=b.offsetParent;while(b);return new Element.Offset(d,c)},positionedOffset:d,cumulativeScrollOffset:function(b){var c=0,d=0;do c+=b.scrollTop||0,d+=b.scrollLeft||
0,b=b.parentNode;while(b);return new Element.Offset(d,c)},viewportOffset:e,absolutize:function(b){b=$(b);if(Element.getStyle(b,"position")==="absolute")return b;var d=c(b),e=b.viewportOffset();d=d.viewportOffset();e=e.relativeTo(d);d=b.getLayout();b.store("prototype_absolutize_original_styles",{left:b.getStyle("left"),top:b.getStyle("top"),width:b.getStyle("width"),height:b.getStyle("height")});b.setStyle({position:"absolute",top:e.top+"px",left:e.left+"px",width:d.get("width")+"px",height:d.get("height")+
"px"});return b},relativize:function(b){b=$(b);if(Element.getStyle(b,"position")==="relative")return b;var c=b.retrieve("prototype_absolutize_original_styles");c&&b.setStyle(c);return b}});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(b){b=$(b);if(f(b))return new Element.Offset(0,0);b=b.getBoundingClientRect();var c=document.documentElement;return new Element.Offset(b.left-c.clientLeft,b.top-c.clientTop)},positionedOffset:function(b){b=$(b);var c=
b.getOffsetParent();if(f(b))return new Element.Offset(0,0);if(b.offsetParent&&b.offsetParent.nodeName.toUpperCase()==="HTML")return d(b);var g=b.viewportOffset();c=c.nodeName.toUpperCase()==="BODY"?e(c):c.viewportOffset();g=g.relativeTo(c);c=b.getLayout();b=g.top-c.get("margin-top");g=g.left-c.get("margin-left");return new Element.Offset(g,b)}})})();window.$$=function(){var b=$A(arguments).join(", ");return Prototype.Selector.select(b,document)};
Prototype.Selector=function(){function b(b){for(var c=0,f=b.length;c<f;c++)Element.extend(b[c]);return b}var c=Prototype.K;return{select:function(){throw Error('Method "Prototype.Selector.select" must be defined.');},match:function(){throw Error('Method "Prototype.Selector.match" must be defined.');},find:function(b,c,f){f=f||0;var g=Prototype.Selector.match,h=b.length,i=0,j;for(j=0;j<h;j++)if(g(b[j],c)&&f==i++)return Element.extend(b[j])},extendElements:Element.extend===c?c:b,extendElement:Element.extend}}();
Prototype._original_property=window.Sizzle;
(function(){function b(b,c,d,e,f,g){f=b=="previousSibling"&&!g;for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){if(f&&j.nodeType===1)j.sizcache=d,j.sizset=h;j=j[b];for(var k=!1;j;){if(j.sizcache===d){k=e[j.sizset];break}if(j.nodeType===1&&!g)j.sizcache=d,j.sizset=h;if(j.nodeName===c){k=j;break}j=j[b]}e[h]=k}}}function c(b,c,d,e,f,g){f=b=="previousSibling"&&!g;for(var h=0,j=e.length;h<j;h++){var k=e[h];if(k){if(f&&k.nodeType===1)k.sizcache=d,k.sizset=h;k=k[b];for(var l=!1;k;){if(k.sizcache===d){l=
e[k.sizset];break}if(k.nodeType===1){if(!g)k.sizcache=d,k.sizset=h;if(typeof c!=="string"){if(k===c){l=!0;break}}else if(i.filter(c,[k]).length>0){l=k;break}}k=k[b]}e[h]=l}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,f=Object.prototype.toString,g=!1,h=!0;[0,0].sort(function(){h=!1;return 0});var i=function(b,c,e,g){e=e||[];var h=c=c||document;if(c.nodeType!==1&&c.nodeType!==9)return[];if(!b||typeof b!==
"string")return e;for(var l=[],n,o,w,A,E=!0,D=q(c),F=b;(d.exec(""),n=d.exec(F))!==null;)if(F=n[3],l.push(n[1]),n[2]){A=n[3];break}if(l.length>1&&k.exec(b))if(l.length===2&&j.relative[l[0]])o=r(l[0]+l[1],c);else for(o=j.relative[l[0]]?[c]:i(l.shift(),c);l.length;)b=l.shift(),j.relative[b]&&(b+=l.shift()),o=r(b,o);else if(!g&&l.length>1&&c.nodeType===9&&!D&&j.match.ID.test(l[0])&&!j.match.ID.test(l[l.length-1])&&(n=i.find(l.shift(),c,D),c=n.expr?i.filter(n.expr,n.set)[0]:n.set[0]),c){n=g?{expr:l.pop(),
set:m(g)}:i.find(l.pop(),l.length===1&&(l[0]==="~"||l[0]==="+")&&c.parentNode?c.parentNode:c,D);o=n.expr?i.filter(n.expr,n.set):n.set;for(l.length>0?w=m(o):E=!1;l.length;){var B=l.pop();n=B;j.relative[B]?n=l.pop():B="";n==null&&(n=c);j.relative[B](w,n,D)}}else w=[];w||(w=o);if(!w)throw"Syntax error, unrecognized expression: "+(B||b);if(f.call(w)==="[object Array]")if(E)if(c&&c.nodeType===1)for(b=0;w[b]!=null;b++)w[b]&&(w[b]===!0||w[b].nodeType===1&&p(c,w[b]))&&e.push(o[b]);else for(b=0;w[b]!=null;b++)w[b]&&
w[b].nodeType===1&&e.push(o[b]);else e.push.apply(e,w);else m(w,e);A&&(i(A,h,e,g),i.uniqueSort(e));return e};i.uniqueSort=function(b){if(o&&(g=h,b.sort(o),g))for(var c=1;c<b.length;c++)b[c]===b[c-1]&&b.splice(c--,1);return b};i.matches=function(b,c){return i(b,null,null,c)};i.find=function(b,c,d){var e,f;if(!b)return[];for(var g=0,h=j.order.length;g<h;g++){var i=j.order[g];if(f=j.leftMatch[i].exec(b)){var k=f[1];f.splice(1,1);if(k.substr(k.length-1)!=="\\"&&(f[1]=(f[1]||"").replace(/\\/g,""),e=j.find[i](f,
c,d),e!=null)){b=b.replace(j.match[i],"");break}}}e||(e=c.getElementsByTagName("*"));return{set:e,expr:b}};i.filter=function(b,c,d,e){for(var f=b,g=[],h=c,i,k,l=c&&c[0]&&q(c[0]);b&&c.length;){for(var m in j.filter)if((i=j.match[m].exec(b))!=null){var n=j.filter[m],o,p;k=!1;h==g&&(g=[]);if(j.preFilter[m])if(i=j.preFilter[m](i,h,d,g,e,l)){if(i===!0)continue}else k=o=!0;if(i)for(var r=0;(p=h[r])!=null;r++)if(p){o=n(p,i,r,h);var H=e^!!o;d&&o!=null?H?k=!0:h[r]=!1:H&&(g.push(p),k=!0)}if(o!==void 0){d||
(h=g);b=b.replace(j.match[m],"");if(!k)return[];break}}if(b==f)if(k==null)throw"Syntax error, unrecognized expression: "+b;else break;f=b}return h};var j=i.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(b){return b.getAttribute("href")}},relative:{"+":function(b,c,d){var e=typeof c==="string",f=e&&!/\W/.test(c);e=e&&!f;f&&!d&&(c=c.toUpperCase());d=0;f=b.length;for(var g;d<f;d++)if(g=b[d]){for(;(g=g.previousSibling)&&g.nodeType!==1;);b[d]=e||g&&g.nodeName===c?g||
!1:g===c}e&&i.filter(c,b,!0)},">":function(b,c,d){var e=typeof c==="string";if(e&&!/\W/.test(c)){c=d?c:c.toUpperCase();d=0;for(var f=b.length;d<f;d++){var g=b[d];if(g)e=g.parentNode,b[d]=e.nodeName===c?e:!1}}else{d=0;for(f=b.length;d<f;d++)(g=b[d])&&(b[d]=e?g.parentNode:g.parentNode===c);e&&i.filter(c,b,!0)}},"":function(d,f,g){var h=e++,i=c;if(!/\W/.test(f)){var j=f=g?f:f.toUpperCase();i=b}i("parentNode",f,h,d,j,g)},"~":function(d,f,g){var h=e++,i=c;if(typeof f==="string"&&!/\W/.test(f)){var j=f=
g?f:f.toUpperCase();i=b}i("previousSibling",f,h,d,j,g)}},find:{ID:function(b,c,d){if(typeof c.getElementById!=="undefined"&&!d)return(b=c.getElementById(b[1]))?[b]:[]},NAME:function(b,c){if(typeof c.getElementsByName!=="undefined"){for(var d=[],e=c.getElementsByName(b[1]),f=0,g=e.length;f<g;f++)e[f].getAttribute("name")===b[1]&&d.push(e[f]);return d.length===0?null:d}},TAG:function(b,c){return c.getElementsByTagName(b[1])}},preFilter:{CLASS:function(b,c,d,e,f,g){b=" "+b[1].replace(/\\/g,"")+" ";if(g)return b;
g=0;for(var h;(h=c[g])!=null;g++)h&&(f^(h.className&&(" "+h.className+" ").indexOf(b)>=0)?d||e.push(h):d&&(c[g]=!1));return!1},ID:function(b){return b[1].replace(/\\/g,"")},TAG:function(b,c){for(var d=0;c[d]===!1;d++);return c[d]&&q(c[d])?b[1]:b[1].toUpperCase()},CHILD:function(b){if(b[1]=="nth"){var c=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(b[2]=="even"&&"2n"||b[2]=="odd"&&"2n+1"||!/\D/.test(b[2])&&"0n+"+b[2]||b[2]);b[2]=c[1]+(c[2]||1)-0;b[3]=c[3]-0}b[0]=e++;return b},ATTR:function(b,c,d,e,f,g){c=b[1].replace(/\\/g,
"");!g&&j.attrMap[c]&&(b[1]=j.attrMap[c]);b[2]==="~="&&(b[4]=" "+b[4]+" ");return b},PSEUDO:function(b,c,e,f,g){if(b[1]==="not")if((d.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=i(b[3],null,null,c);else return b=i.filter(b[3],c,e,1^g),e||f.push.apply(f,b),!1;else if(j.match.POS.test(b[0])||j.match.CHILD.test(b[0]))return!0;return b},POS:function(b){b.unshift(!0);return b}},filters:{enabled:function(b){return b.disabled===!1&&b.type!=="hidden"},disabled:function(b){return b.disabled===!0},checked:function(b){return b.checked===
!0},selected:function(b){return b.selected===!0},parent:function(b){return!!b.firstChild},empty:function(b){return!b.firstChild},has:function(b,c,d){return!!i(d[3],b).length},header:function(b){return/h\d/i.test(b.nodeName)},text:function(b){return"text"===b.type},radio:function(b){return"radio"===b.type},checkbox:function(b){return"checkbox"===b.type},file:function(b){return"file"===b.type},password:function(b){return"password"===b.type},submit:function(b){return"submit"===b.type},image:function(b){return"image"===
b.type},reset:function(b){return"reset"===b.type},button:function(b){return"button"===b.type||b.nodeName.toUpperCase()==="BUTTON"},input:function(b){return/input|select|textarea|button/i.test(b.nodeName)}},setFilters:{first:function(b,c){return c===0},last:function(b,c,d,e){return c===e.length-1},even:function(b,c){return c%2===0},odd:function(b,c){return c%2===1},lt:function(b,c,d){return c<d[3]-0},gt:function(b,c,d){return c>d[3]-0},nth:function(b,c,d){return d[3]-0==c},eq:function(b,c,d){return d[3]-
0==c}},filter:{PSEUDO:function(b,c,d,e){var f=c[1],g=j.filters[f];if(g)return g(b,d,c,e);else if(f==="contains")return(b.textContent||b.innerText||"").indexOf(c[3])>=0;else if(f==="not"){c=c[3];d=0;for(e=c.length;d<e;d++)if(c[d]===b)return!1;return!0}},CHILD:function(b,c){var d=c[1],e=b;switch(d){case "only":case "first":for(;e=e.previousSibling;)if(e.nodeType===1)return!1;if(d=="first")return!0;e=b;case "last":for(;e=e.nextSibling;)if(e.nodeType===1)return!1;return!0;case "nth":d=c[2];var f=c[3];
if(d==1&&f==0)return!0;var g=c[0],h=b.parentNode;if(h&&(h.sizcache!==g||!b.nodeIndex)){var i=0;for(e=h.firstChild;e;e=e.nextSibling)if(e.nodeType===1)e.nodeIndex=++i;h.sizcache=g}e=b.nodeIndex-f;return d==0?e==0:e%d==0&&e/d>=0}},ID:function(b,c){return b.nodeType===1&&b.getAttribute("id")===c},TAG:function(b,c){return c==="*"&&b.nodeType===1||b.nodeName===c},CLASS:function(b,c){return(" "+(b.className||b.getAttribute("class"))+" ").indexOf(c)>-1},ATTR:function(b,c){var d=c[1];d=j.attrHandle[d]?j.attrHandle[d](b):
b[d]!=null?b[d]:b.getAttribute(d);var e=d+"",f=c[2],g=c[4];return d==null?f==="!=":f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:!g?e&&d!==!1:f==="!="?e!=g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1},POS:function(b,c,d,e){var f=j.setFilters[c[2]];if(f)return f(b,d,c,e)}}},k=j.match.POS,l;for(l in j.match)j.match[l]=RegExp(j.match[l].source+/(?![^\[]*\])(?![^\(]*\))/.source),j.leftMatch[l]=RegExp(/(^(?:.|\r|\n)*?)/.source+
j.match[l].source);var m=function(b,c){b=Array.prototype.slice.call(b,0);if(c)return c.push.apply(c,b),c;return b};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(n){m=function(b,c){var d=c||[];if(f.call(b)==="[object Array]")Array.prototype.push.apply(d,b);else if(typeof b.length==="number")for(var e=0,g=b.length;e<g;e++)d.push(b[e]);else for(e=0;b[e];e++)d.push(b[e]);return d}}var o;document.documentElement.compareDocumentPosition?o=function(b,c){if(!b.compareDocumentPosition||
!c.compareDocumentPosition)return b==c&&(g=!0),0;var d=b.compareDocumentPosition(c)&4?-1:b===c?0:1;d===0&&(g=!0);return d}:"sourceIndex"in document.documentElement?o=function(b,c){if(!b.sourceIndex||!c.sourceIndex)return b==c&&(g=!0),0;var d=b.sourceIndex-c.sourceIndex;d===0&&(g=!0);return d}:document.createRange&&(o=function(b,c){if(!b.ownerDocument||!c.ownerDocument)return b==c&&(g=!0),0;var d=b.ownerDocument.createRange(),e=c.ownerDocument.createRange();d.setStart(b,0);d.setEnd(b,0);e.setStart(c,
0);e.setEnd(c,0);d=d.compareBoundaryPoints(Range.START_TO_END,e);d===0&&(g=!0);return d});(function(){var b=document.createElement("div"),c="script"+(new Date).getTime();b.innerHTML="<a name='"+c+"'/>";var d=document.documentElement;d.insertBefore(b,d.firstChild);if(document.getElementById(c))j.find.ID=function(b,c,d){if(typeof c.getElementById!=="undefined"&&!d)return(c=c.getElementById(b[1]))?c.id===b[1]||typeof c.getAttributeNode!=="undefined"&&c.getAttributeNode("id").nodeValue===b[1]?[c]:void 0:
[]},j.filter.ID=function(b,c){var d=typeof b.getAttributeNode!=="undefined"&&b.getAttributeNode("id");return b.nodeType===1&&d&&d.nodeValue===c};d.removeChild(b);d=b=null})();(function(){var b=document.createElement("div");b.appendChild(document.createComment(""));if(b.getElementsByTagName("*").length>0)j.find.TAG=function(b,c){var d=c.getElementsByTagName(b[1]);if(b[1]==="*"){for(var e=[],f=0;d[f];f++)d[f].nodeType===1&&e.push(d[f]);d=e}return d};b.innerHTML="<a href='#'></a>";if(b.firstChild&&typeof b.firstChild.getAttribute!==
"undefined"&&b.firstChild.getAttribute("href")!=="#")j.attrHandle.href=function(b){return b.getAttribute("href",2)};b=null})();document.querySelectorAll&&function(){var b=i,c=document.createElement("div");c.innerHTML="<p class='TEST'></p>";if(!(c.querySelectorAll&&c.querySelectorAll(".TEST").length===0)){i=function(c,d,e,f){d=d||document;if(!f&&d.nodeType===9&&!q(d))try{return m(d.querySelectorAll(c),e)}catch(g){}return b(c,d,e,f)};for(var d in b)i[d]=b[d];c=null}}();document.getElementsByClassName&&
document.documentElement.getElementsByClassName&&function(){var b=document.createElement("div");b.innerHTML="<div class='test e'></div><div class='test'></div>";if(b.getElementsByClassName("e").length!==0&&(b.lastChild.className="e",b.getElementsByClassName("e").length!==1))j.order.splice(1,0,"CLASS"),j.find.CLASS=function(b,c,d){if(typeof c.getElementsByClassName!=="undefined"&&!d)return c.getElementsByClassName(b[1])},b=null}();var p=document.compareDocumentPosition?function(b,c){return b.compareDocumentPosition(c)&
16}:function(b,c){return b!==c&&(b.contains?b.contains(c):!0)},q=function(b){return b.nodeType===9&&b.documentElement.nodeName!=="HTML"||!!b.ownerDocument&&b.ownerDocument.documentElement.nodeName!=="HTML"},r=function(b,c){for(var d=[],e="",f,g=c.nodeType?[c]:c;f=j.match.PSEUDO.exec(b);)e+=f[0],b=b.replace(j.match.PSEUDO,"");b=j.relative[b]?b+"*":b;f=0;for(var h=g.length;f<h;f++)i(b,g[f],d);return i.filter(e,d)};window.Sizzle=i})();
(function(b){var c=Prototype.Selector.extendElements;Prototype.Selector.engine=b;Prototype.Selector.select=function(d,e){return c(b(d,e||document))};Prototype.Selector.match=function(c,e){return b.matches(e,[c]).length==1}})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(b){b=$(b);b.reset();return b},serializeElements:function(b,c){if(typeof c!="object")c={hash:!!c};else if(Object.isUndefined(c.hash))c.hash=!0;var d,e,f=!1,g=c.submit,h=b.inject({},function(b,c){if(!c.disabled&&c.name&&(d=c.name,e=$(c).getValue(),e!=null&&c.type!="file"&&(c.type!="submit"||!f&&g!==!1&&(!g||d==g)&&(f=!0))))d in b?(Object.isArray(b[d])||(b[d]=[b[d]]),b[d].push(e)):b[d]=e;return b});return c.hash?h:Object.toQueryString(h)}};
Form.Methods={serialize:function(b,c){return Form.serializeElements(Form.getElements(b),c)},getElements:function(b){b=$(b).getElementsByTagName("*");for(var c,d=[],e=Form.Element.Serializers,f=0;c=b[f];f++)d.push(c);return d.inject([],function(b,c){e[c.tagName.toLowerCase()]&&b.push(Element.extend(c));return b})},getInputs:function(b,c,d){b=$(b);b=b.getElementsByTagName("input");if(!c&&!d)return $A(b).map(Element.extend);for(var e=0,f=[],g=b.length;e<g;e++){var h=b[e];c&&h.type!=c||d&&h.name!=d||
f.push(Element.extend(h))}return f},disable:function(b){b=$(b);Form.getElements(b).invoke("disable");return b},enable:function(b){b=$(b);Form.getElements(b).invoke("enable");return b},findFirstElement:function(b){b=$(b).getElements().findAll(function(b){return"hidden"!=b.type&&!b.disabled});var c=b.findAll(function(b){return b.hasAttribute("tabIndex")&&b.tabIndex>=0}).sortBy(function(b){return b.tabIndex}).first();return c?c:b.find(function(b){return/^(?:input|select|textarea)$/i.test(b.tagName)})},
focusFirstElement:function(b){b=$(b);b.findFirstElement().activate();return b},request:function(b,c){b=$(b);c=Object.clone(c||{});var d=c.parameters,e=b.readAttribute("action")||"";if(e.blank())e=window.location.href;c.parameters=b.serialize(!0);d&&(Object.isString(d)&&(d=d.toQueryParams()),Object.extend(c.parameters,d));if(b.hasAttribute("method")&&!c.method)c.method=b.method;return new Ajax.Request(e,c)}};Form.Element={focus:function(b){$(b).focus();return b},select:function(b){$(b).select();return b}};
Form.Element.Methods={serialize:function(b){b=$(b);if(!b.disabled&&b.name){var c=b.getValue();if(c!=void 0){var d={};d[b.name]=c;return Object.toQueryString(d)}}return""},getValue:function(b){b=$(b);var c=b.tagName.toLowerCase();return Form.Element.Serializers[c](b)},setValue:function(b,c){b=$(b);var d=b.tagName.toLowerCase();Form.Element.Serializers[d](b,c);return b},clear:function(b){$(b).value="";return b},present:function(b){return $(b).value!=""},activate:function(b){b=$(b);try{b.focus(),b.select&&
(b.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(b.type))&&b.select()}catch(c){}return b},disable:function(b){b=$(b);b.disabled=!0;return b},enable:function(b){b=$(b);b.disabled=!1;return b}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers={input:function(b,c){switch(b.type.toLowerCase()){case "checkbox":case "radio":return Form.Element.Serializers.inputSelector(b,c);default:return Form.Element.Serializers.textarea(b,c)}},inputSelector:function(b,c){if(Object.isUndefined(c))return b.checked?b.value:null;else b.checked=!!c},textarea:function(b,c){if(Object.isUndefined(c))return b.value;else b.value=c},select:function(b,c){if(Object.isUndefined(c))return this[b.type=="select-one"?"selectOne":"selectMany"](b);
else for(var d,e,f=!Object.isArray(c),g=0,h=b.length;g<h;g++)if(d=b.options[g],e=this.optionValue(d),f){if(e==c){d.selected=!0;break}}else d.selected=c.include(e)},selectOne:function(b){var c=b.selectedIndex;return c>=0?this.optionValue(b.options[c]):null},selectMany:function(b){var c,d=b.length;if(!d)return null;var e=0;for(c=[];e<d;e++){var f=b.options[e];f.selected&&c.push(this.optionValue(f))}return c},optionValue:function(b){return Element.extend(b).hasAttribute("value")?b.value:b.text}};
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,c,d,e){$super(e,d);this.element=$(c);this.lastValue=this.getValue()},execute:function(){var b=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(b)?this.lastValue!=b:String(this.lastValue)!=String(b))this.callback(this.element,b),this.lastValue=b}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(b,c){this.element=$(b);this.callback=c;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var b=this.getValue();if(this.lastValue!=b)this.callback(this.element,b),this.lastValue=b},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(b){if(b.type)switch(b.type.toLowerCase()){case "checkbox":case "radio":Event.observe(b,
"click",this.onElementEvent.bind(this));break;default:Event.observe(b,"change",this.onElementEvent.bind(this))}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function b(b){var c=document.documentElement,d=document.body||{scrollLeft:0};return b.pageX||b.clientX+(c.scrollLeft||d.scrollLeft)-(c.clientLeft||0)}function c(b){var c=document.documentElement,d=document.body||{scrollTop:0};return b.pageY||b.clientY+(c.scrollTop||d.scrollTop)-(c.clientTop||0)}function d(b,c,d){var e=Element.retrieve(b,"prototype_event_registry");Object.isUndefined(e)&&(q.push(b),e=Element.retrieve(b,"prototype_event_registry",$H()));var f=e.get(c);Object.isUndefined(f)&&
(f=[],e.set(c,f));if(f.pluck("handler").include(d))return!1;var g;if(c.include(":"))g=function(e){if(Object.isUndefined(e.eventName))return!1;if(e.eventName!==c)return!1;j.extend(e,b);d.call(b,e)};else if(!l&&(c==="mouseenter"||c==="mouseleave")){if(c==="mouseenter"||c==="mouseleave")g=function(c){j.extend(c,b);for(var e=c.relatedTarget;e&&e!==b;)try{e=e.parentNode}catch(f){e=b}e!==b&&d.call(b,c)}}else g=function(c){j.extend(c,b);d.call(b,c)};g.handler=d;f.push(g);return g}function e(){for(var b=
0,c=q.length;b<c;b++)j.stopObserving(q[b]),q[b]=null}function f(b,c,e){b=$(b);e=d(b,c,e);if(!e)return b;c.include(":")?b.addEventListener?b.addEventListener("dataavailable",e,!1):(b.attachEvent("ondataavailable",e),b.attachEvent("onfilterchange",e)):(c=r(c),b.addEventListener?b.addEventListener(c,e,!1):b.attachEvent("on"+c,e));return b}function g(b,c,d){b=$(b);var e=Element.retrieve(b,"prototype_event_registry");if(!e)return b;if(!c)return e.each(function(c){g(b,c.key)}),b;var f=e.get(c);if(!f)return b;
if(!d)return f.each(function(d){g(b,c,d.handler)}),b;var h=f.find(function(b){return b.handler===d});if(!h)return b;if(c.include(":"))b.removeEventListener?b.removeEventListener("dataavailable",h,!1):(b.detachEvent("ondataavailable",h),b.detachEvent("onfilterchange",h));else{var i=r(c);b.removeEventListener?b.removeEventListener(i,h,!1):b.detachEvent("on"+i,h)}e.set(c,f.without(h));return b}function h(b,c,d,e){b=$(b);Object.isUndefined(e)&&(e=!0);if(b==document&&document.createEvent&&!b.dispatchEvent)b=
document.documentElement;var f;document.createEvent?(f=document.createEvent("HTMLEvents"),f.initEvent("dataavailable",!0,!0)):(f=document.createEventObject(),f.eventType=e?"ondataavailable":"onfilterchange");f.eventName=c;f.memo=d||{};document.createEvent?b.dispatchEvent(f):b.fireEvent(f.eventType,f);return j.extend(f)}function i(b,c,d,e){b=$(b);Object.isFunction(d)&&Object.isUndefined(e)&&(e=d,d=null);return(new j.Handler(b,c,d,e)).start()}var j={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,
KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},k=document.documentElement,l="onmouseenter"in k&&"onmouseleave"in k,m;if(Prototype.Browser.IE){var n={0:1,1:4,2:2};m=function(b,c){return b.button===n[c]}}else m=Prototype.Browser.WebKit?function(b,c){switch(c){case 0:return b.which==1&&!b.metaKey;case 1:return b.which==1&&b.metaKey;default:return!1}}:function(b,c){return b.which?b.which===c+1:b.button===c};j.Methods=
{isLeftClick:function(b){return m(b,0)},isMiddleClick:function(b){return m(b,1)},isRightClick:function(b){return m(b,2)},element:function(b){b=j.extend(b);var c=b.target,d=b.type;if((b=b.currentTarget)&&b.tagName&&(d==="load"||d==="error"||d==="click"&&b.tagName.toLowerCase()==="input"&&b.type==="radio"))c=b;if(c.nodeType==Node.TEXT_NODE)c=c.parentNode;return Element.extend(c)},findElement:function(b,c){var d=j.element(b);if(!c)return d;for(;d;){if(Object.isElement(d)&&Prototype.Selector.match(d,
c))return Element.extend(d);d=d.parentNode}},pointer:function(d){return{x:b(d),y:c(d)}},pointerX:b,pointerY:c,stop:function(b){j.extend(b);b.preventDefault();b.stopPropagation();b.stopped=!0}};var o=Object.keys(j.Methods).inject({},function(b,c){b[c]=j.Methods[c].methodize();return b});if(Prototype.Browser.IE){var p=function(b){switch(b.type){case "mouseover":b=b.fromElement;break;case "mouseout":b=b.toElement;break;default:return null}return Element.extend(b)};Object.extend(o,{stopPropagation:function(){this.cancelBubble=
!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}});j.extend=function(b,c){if(!b)return!1;if(b._extendedByPrototype)return b;b._extendedByPrototype=Prototype.emptyFunction;var d=j.pointer(b);Object.extend(b,{target:b.srcElement||c,relatedTarget:p(b),pageX:d.x,pageY:d.y});return Object.extend(b,o)}}else j.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(j.prototype,o),j.extend=Prototype.K;var q=[];Prototype.Browser.IE&&
window.attachEvent("onunload",e);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,!1);var r=Prototype.K,u={mouseenter:"mouseover",mouseleave:"mouseout"};l||(r=function(b){return u[b]||b});j.Handler=Class.create({initialize:function(b,c,d,e){this.element=$(b);this.eventName=c;this.selector=d;this.callback=e;this.handler=this.handleEvent.bind(this)},start:function(){j.observe(this.element,this.eventName,this.handler);return this},stop:function(){j.stopObserving(this.element,
this.eventName,this.handler);return this},handleEvent:function(b){var c=b.findElement(this.selector);c&&this.callback.call(this.element,b,c)}});Object.extend(j,j.Methods);Object.extend(j,{fire:h,observe:f,stopObserving:g,on:i});Element.addMethods({fire:h,observe:f,stopObserving:g,on:i});Object.extend(document,{fire:h.methodize(),observe:f.methodize(),stopObserving:g.methodize(),on:i.methodize(),loaded:!1});window.Event?Object.extend(window.Event,j):window.Event=j})();
(function(){function b(){if(!document.loaded)e&&window.clearTimeout(e),document.loaded=!0,document.fire("dom:loaded")}function c(){document.readyState==="complete"&&(document.stopObserving("readystatechange",c),b())}function d(){try{document.documentElement.doScroll("left")}catch(c){e=d.defer();return}b()}var e;document.addEventListener?document.addEventListener("DOMContentLoaded",b,!1):(document.observe("readystatechange",c),window==top&&(e=d.defer()));Event.observe(window,"load",b)})();Element.addMethods();
Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(b,c){return Element.insert(b,{before:c})},Top:function(b,c){return Element.insert(b,{top:c})},Bottom:function(b,c){return Element.insert(b,{bottom:c})},After:function(b,c){return Element.insert(b,{after:c})}},$continue=Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||
document.body.scrollTop||0},within:function(b,c,d){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(b,c,d);this.xcomp=c;this.ycomp=d;this.offset=Element.cumulativeOffset(b);return d>=this.offset[1]&&d<this.offset[1]+b.offsetHeight&&c>=this.offset[0]&&c<this.offset[0]+b.offsetWidth},withinIncludingScrolloffsets:function(b,c,d){var e=Element.cumulativeScrollOffset(b);this.xcomp=c+e[0]-this.deltaX;this.ycomp=d+e[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return this.ycomp>=
this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth},overlap:function(b,c){if(!b)return 0;if(b=="vertical")return(this.offset[1]+c.offsetHeight-this.ycomp)/c.offsetHeight;if(b=="horizontal")return(this.offset[0]+c.offsetWidth-this.xcomp)/c.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(b){Position.prepare();return Element.absolutize(b)},relativize:function(b){Position.prepare();
return Element.relativize(b)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,c,d){d=d||{};return Element.clonePosition(c,b,d)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(b){function c(b){return b.blank()?null:"[contains(concat(' ', @class, ' '), ' "+b+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(b,e){e=e.toString().strip();var f=/\s/.test(e)?$w(e).map(c).join(""):c(e);return f?document._getElementsByXPath(".//*"+f,b):[]}:function(b,c){c=c.toString().strip();var f=[],g=/\s/.test(c)?$w(c):null;if(!g&&!c)return f;var h=$(b).getElementsByTagName("*");c=" "+c+" ";for(var i=
0,j,k;j=h[i];i++)j.className&&(k=" "+j.className+" ")&&(k.include(c)||g&&g.all(function(b){return!b.toString().blank()&&k.include(" "+b+" ")}))&&f.push(Element.extend(j));return f};return function(b,c){return $(c||document.body).getElementsByClassName(b)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(b){this.element=$(b)},_each:function(b){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(b)},set:function(b){this.element.className=b},add:function(b){this.include(b)||this.set($A(this).concat(b).join(" "))},remove:function(b){this.include(b)&&this.set($A(this).without(b).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(b){this.expression=b.strip()},findElements:function(b){return Prototype.Selector.select(this.expression,b)},match:function(b){return Prototype.Selector.match(b,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(b,c){for(var d=Prototype.Selector.match,e=[],f=0,g=b.length;f<g;f++){var h=b[f];d(h,c)&&e.push(Element.extend(h))}return e},
findElement:function(b,c,d){d=d||0;for(var e=0,f,g=0,h=b.length;g<h;g++)if(f=b[g],Prototype.Selector.match(f,c)&&d===e++)return Element.extend(f)},findChildElements:function(b,c){var d=c.toArray().join(", ");return Prototype.Selector.select(d,b||document)}})})();
(function(b){var c=Object.prototype.toString,d={get:function(b){return d.has(b)?d.list()[b]:null},has:function(b){return RegExp("(?:;\\s*|^)"+encodeURIComponent(b)+"=").test(document.cookie)},list:function(b){for(var d=document.cookie.split("; "),g,h={},i=0,j=d.length;i<j;++i)if(g=d[i].split("="),"[object RegExp]"!=c.call(b)||b.test(g[0]))h[decodeURIComponent(g[0])]=decodeURIComponent(g[1]);return h},remove:function(b,c){var g={},h;for(h in c||{})opts2[h]=c[h];g.expires=new Date(0);g.maxAge=-1;return d.set(b,
null,g)},set:function(b,d,g){g=g||{};b=[encodeURIComponent(b)+"="+encodeURIComponent(d)];g.path&&b.push("path="+g.path);g.domain&&b.push("domain="+g.path);d="maxAge"in g?g.maxAge:"max_age"in g?g.max_age:g["max-age"];var h;"undefined"!=typeof d&&"null"!=typeof d&&!isNaN(h=parseFloat(d))&&b.push("max-age="+h);(h="[object Date]"==c.call(g.expires)?g.expires.toUTCString():g.expires)&&b.push("expires="+h);g.secure&&b.push("secure");b=b.join("; ");return document.cookie=b},test:function(){d.remove("70ab3d396b85e670f25b93be05e027e4eb655b71");
d.set("70ab3d396b85e670f25b93be05e027e4eb655b71","\u00c9lodie Jaubert");var b="\u00c9lodie Jaubert"==d.get("70ab3d396b85e670f25b93be05e027e4eb655b71");d.remove("70ab3d396b85e670f25b93be05e027e4eb655b71");return b}};b.Cookie=d})(window);var a;function extend(b,c){for(var d in c)b[d]=c[d]}var b2Settings=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){};b2Settings.prototype.__varz=function(){};b2Settings.USHRT_MAX=65535;
b2Settings.b2_pi=Math.PI;b2Settings.b2_maxManifoldPoints=2;b2Settings.b2_maxPolygonVertices=8;b2Settings.b2_maxProxies=1024;b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies;b2Settings.b2_linearSlop=0.005;b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi;b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop;b2Settings.b2_maxTOIContactsPerIsland=32;b2Settings.b2_velocityThreshold=1;b2Settings.b2_maxLinearCorrection=0.2;b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi;
b2Settings.b2_maxLinearVelocity=200;b2Settings.b2_maxLinearVelocitySquared=b2Settings.b2_maxLinearVelocity*b2Settings.b2_maxLinearVelocity;b2Settings.b2_maxAngularVelocity=250;b2Settings.b2_maxAngularVelocitySquared=b2Settings.b2_maxAngularVelocity*b2Settings.b2_maxAngularVelocity;b2Settings.b2_contactBaumgarte=0.2;b2Settings.b2_timeToSleep=0.5;b2Settings.b2_linearSleepTolerance=0.01;b2Settings.b2_angularSleepTolerance=2/180;b2Settings.b2Assert=function(b){b||(void 0).x++};
var b2Vec2=function(b,c){if(arguments.length==2)this.x=b,this.y=c};b2Vec2.Make=function(b,c){return new b2Vec2(b,c)};a=b2Vec2.prototype;a.x=0;a.y=0;a.SetZero=function(){this.y=this.x=0};a.Set=function(b,c){this.x=b;this.y=c};a.SetV=function(b){this.x=b.x;this.y=b.y};a.Negative=function(){return new b2Vec2(-this.x,-this.y)};a.Copy=function(){return new b2Vec2(this.x,this.y)};a.Add=function(b){this.x+=b.x;this.y+=b.y};a.Subtract=function(b){this.x-=b.x;this.y-=b.y};
a.Multiply=function(b){this.x*=b;this.y*=b};a.MulM=function(b){var c=this.x;this.x=b.col1.x*c+b.col2.x*this.y;this.y=b.col1.y*c+b.col2.y*this.y};a.MulTM=function(b){var c=b2Math.b2Dot(this,b.col1);this.y=b2Math.b2Dot(this,b.col2);this.x=c};a.CrossVF=function(b){var c=this.x;this.x=b*this.y;this.y=-b*c};a.CrossFV=function(b){var c=this.x;this.x=-b*this.y;this.y=b*c};a.MinV=function(b){this.x=this.x<b.x?this.x:b.x;this.y=this.y<b.y?this.y:b.y};
a.MaxV=function(b){this.x=this.x>b.x?this.x:b.x;this.y=this.y>b.y?this.y:b.y};a.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};a.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.LengthSquared=function(){return this.x*this.x+this.y*this.y};a.Normalize=function(){var b=Math.sqrt(this.x*this.x+this.y*this.y);if(b<Number.MIN_VALUE)return 0;var c=1/b;this.x*=c;this.y*=c;return b};a.IsValid=function(){return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y)};
var b2BufferedPair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BufferedPair.prototype.__constructor=function(){};b2BufferedPair.prototype.__varz=function(){};b2BufferedPair.prototype.proxyId1=0;b2BufferedPair.prototype.proxyId2=0;var b2AABB=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2AABB.prototype;a.__constructor=function(){};a.__varz=function(){this.lowerBound=new b2Vec2;this.upperBound=new b2Vec2};a.lowerBound=new b2Vec2;a.upperBound=new b2Vec2;
a.IsValid=function(){var b=this.upperBound.y-this.lowerBound.y;return this.upperBound.x-this.lowerBound.x>=0&&b>=0&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};var b2Pair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){};b2Pair.prototype.__varz=function(){};b2Pair.b2_nullPair=b2Settings.USHRT_MAX;b2Pair.b2_nullProxy=b2Settings.USHRT_MAX;b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs;
b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1;b2Pair.e_pairBuffered=1;b2Pair.e_pairRemoved=2;b2Pair.e_pairFinal=4;a=b2Pair.prototype;a.userData=null;a.proxyId1=0;a.proxyId2=0;a.next=0;a.status=0;a.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered};a.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered};a.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered};a.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved};
a.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved};a.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved};a.SetFinal=function(){this.status|=b2Pair.e_pairFinal};a.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal};var b2TimeStep=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2TimeStep.prototype;a.__constructor=function(){};a.__varz=function(){};a.dt=null;a.inv_dt=null;a.dtRatio=null;a.maxIterations=0;
a.warmStarting=null;a.positionCorrection=null;var b2Manifold=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Manifold.prototype;a.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b]=new b2ManifoldPoint;this.normal=new b2Vec2};a.__varz=function(){};a.points=null;a.normal=null;a.pointCount=0;
a.Reset=function(){for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b].Reset();this.normal.SetZero();this.pointCount=0};a.Set=function(b){this.pointCount=b.pointCount;for(var c=0;c<b2Settings.b2_maxManifoldPoints;c++)this.points[c].Set(b.points[c]);this.normal.SetV(b.normal)};var b2Point=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Point.prototype;a.__constructor=function(){};a.__varz=function(){this.p=new b2Vec2};a.p=new b2Vec2;a.Support=function(){return this.p};
a.GetFirstVertex=function(){return this.p};var b2Bound=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Bound.prototype;a.__constructor=function(){};a.__varz=function(){};a.value=0;a.proxyId=0;a.stabbingCount=0;a.IsLower=function(){return(this.value&1)==0};a.IsUpper=function(){return(this.value&1)==1};
a.Swap=function(b){var c=this.value,d=this.proxyId,e=this.stabbingCount;this.value=b.value;this.proxyId=b.proxyId;this.stabbingCount=b.stabbingCount;b.value=c;b.proxyId=d;b.stabbingCount=e};var b2Mat22=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Mat22.prototype;a.__constructor=function(b,c,d){c!=null&&d!=null?(this.col1.SetV(c),this.col2.SetV(d)):(c=Math.cos(b),b=Math.sin(b),this.col1.x=c,this.col2.x=-b,this.col1.y=b,this.col2.y=c)};
a.__varz=function(){this.col1=new b2Vec2;this.col2=new b2Vec2};a.col1=new b2Vec2;a.col2=new b2Vec2;a.Set=function(b){var c=Math.cos(b);b=Math.sin(b);this.col1.x=c;this.col2.x=-b;this.col1.y=b;this.col2.y=c};a.SetVV=function(b,c){this.col1.SetV(b);this.col2.SetV(c)};a.Copy=function(){return new b2Mat22(0,this.col1,this.col2)};a.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2)};a.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y};
a.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};a.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};a.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};a.Invert=function(b){var c=this.col1.x,d=this.col2.x,e=this.col1.y,f=this.col2.y,g;g=1/(c*f-d*e);b.col1.x=g*f;b.col2.x=-g*d;b.col1.y=-g*e;b.col2.y=g*c;return b};
a.Solve=function(b,c,d){var e=this.col1.x,f=this.col2.x,g=this.col1.y,h=this.col2.y,i;i=1/(e*h-f*g);b.x=i*(h*c-f*d);b.y=i*(e*d-g*c);return b};a.Abs=function(){this.col1.Abs();this.col2.Abs()};var b2BoundaryListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundaryListener.prototype.__constructor=function(){};b2BoundaryListener.prototype.__varz=function(){};b2BoundaryListener.prototype.Violation=function(){};
var b2MassData=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2MassData.prototype;a.__constructor=function(){};a.__varz=function(){this.center=new b2Vec2(0,0)};a.mass=0;a.center=new b2Vec2(0,0);a.I=0;var b2JointEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2JointEdge.prototype;a.__constructor=function(){};a.__varz=function(){};a.other=null;a.joint=null;a.prev=null;a.next=null;
var b2Collision=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){};b2Collision.prototype.__varz=function(){};b2Collision.b2_nullFeature=255;b2Collision.b2CollidePolyTempVec=new b2Vec2;
b2Collision.ClipSegmentToLine=function(b,c,d,e){var f,g=0;f=c[0];var h=f.v;f=c[1];var i=f.v,j=b2Math.b2Dot(d,h)-e;f=b2Math.b2Dot(d,i)-e;j<=0&&(b[g++]=c[0]);f<=0&&(b[g++]=c[1]);if(j*f<0)d=j/(j-f),f=b[g],f=f.v,f.x=h.x+d*(i.x-h.x),f.y=h.y+d*(i.y-h.y),f=b[g],f.id=(j>0?c[0]:c[1]).id,++g;return g};
b2Collision.EdgeSeparation=function(b,c,d,e,f){var g=b.m_vertices;b=b.m_normals;var h=e.m_vertexCount,i=e.m_vertices,j,k;j=c.R;k=b[d];b=j.col1.x*k.x+j.col2.x*k.y;e=j.col1.y*k.x+j.col2.y*k.y;j=f.R;var l=j.col1.x*b+j.col1.y*e;j=j.col2.x*b+j.col2.y*e;for(var m=0,n=Number.MAX_VALUE,o=0;o<h;++o)k=i[o],k=k.x*l+k.y*j,k<n&&(n=k,m=o);k=g[d];j=c.R;d=c.position.x+(j.col1.x*k.x+j.col2.x*k.y);c=c.position.y+(j.col1.y*k.x+j.col2.y*k.y);k=i[m];j=f.R;g=f.position.x+(j.col1.x*k.x+j.col2.x*k.y);f=f.position.y+(j.col1.y*
k.x+j.col2.y*k.y);g-=d;f-=c;return g*b+f*e};
b2Collision.FindMaxSeparation=function(b,c,d,e,f){var g=c.m_vertexCount,h=c.m_normals,i,j;j=f.R;i=e.m_centroid;var k=f.position.x+(j.col1.x*i.x+j.col2.x*i.y),l=f.position.y+(j.col1.y*i.x+j.col2.y*i.y);j=d.R;i=c.m_centroid;k-=d.position.x+(j.col1.x*i.x+j.col2.x*i.y);l-=d.position.y+(j.col1.y*i.x+j.col2.y*i.y);j=k*d.R.col1.x+l*d.R.col1.y;l=k*d.R.col2.x+l*d.R.col2.y;k=0;for(var m=-Number.MAX_VALUE,n=0;n<g;++n)i=h[n],i=i.x*j+i.y*l,i>m&&(m=i,k=n);h=b2Collision.EdgeSeparation(c,d,k,e,f);if(h>0)return h;
l=k-1>=0?k-1:g-1;m=b2Collision.EdgeSeparation(c,d,l,e,f);if(m>0)return m;n=k+1<g?k+1:0;var o=b2Collision.EdgeSeparation(c,d,n,e,f);if(o>0)return o;if(m>h&&m>o)j=-1,i=l,l=m;else if(o>h)j=1,i=n,l=o;else return b[0]=k,h;for(;;){k=j==-1?i-1>=0?i-1:g-1:i+1<g?i+1:0;h=b2Collision.EdgeSeparation(c,d,k,e,f);if(h>0)return h;if(h>l)i=k,l=h;else break}b[0]=i;return l};
b2Collision.FindIncidentEdge=function(b,c,d,e,f,g){var h=c.m_normals,i=f.m_vertexCount;c=f.m_vertices;f=f.m_normals;var j;j=d.R;d=h[e];h=j.col1.x*d.x+j.col2.x*d.y;var k=j.col1.y*d.x+j.col2.y*d.y;j=g.R;d=j.col1.x*h+j.col1.y*k;k=j.col2.x*h+j.col2.y*k;h=d;j=0;for(var l=Number.MAX_VALUE,m=0;m<i;++m)d=f[m],d=h*d.x+k*d.y,d<l&&(l=d,j=m);f=j;h=f+1<i?f+1:0;i=b[0];d=c[f];j=g.R;i.v.x=g.position.x+(j.col1.x*d.x+j.col2.x*d.y);i.v.y=g.position.y+(j.col1.y*d.x+j.col2.y*d.y);i.id.features.referenceEdge=e;i.id.features.incidentEdge=
f;i.id.features.incidentVertex=0;i=b[1];d=c[h];j=g.R;i.v.x=g.position.x+(j.col1.x*d.x+j.col2.x*d.y);i.v.y=g.position.y+(j.col1.y*d.x+j.col2.y*d.y);i.id.features.referenceEdge=e;i.id.features.incidentEdge=h;i.id.features.incidentVertex=1};
b2Collision.b2CollidePolygons=function(b,c,d,e,f){var g=b.pointCount=0,h=[g],i=b2Collision.FindMaxSeparation(h,c,d,e,f);g=h[0];if(!(i>0)){var j;h=[0];var k=b2Collision.FindMaxSeparation(h,e,f,c,d);j=h[0];if(!(k>0)){var l=new b2XForm,m=new b2XForm,n=0;k>0.98*i+0.001?(i=e,e=c,l.Set(f),m.Set(d),n=j,h=1):(i=c,l.Set(d),m.Set(f),n=g,h=0);c=[new ClipVertex,new ClipVertex];b2Collision.FindIncidentEdge(c,i,l,n,e,m);g=i.m_vertexCount;m=i.m_vertices;i=m[n];e=i.Copy();i=n+1<g?m[parseInt(n+1)]:m[0];i=i.Copy();
b2Math.SubtractVV(i,e);g=b2Math.b2MulMV(l.R,b2Math.SubtractVV(i,e));g.Normalize();n=b2Math.b2CrossVF(g,1);e=b2Math.b2MulX(l,e);i=b2Math.b2MulX(l,i);l=b2Math.b2Dot(n,e);m=-b2Math.b2Dot(g,e);i=b2Math.b2Dot(g,i);j=[new ClipVertex,new ClipVertex];e=[new ClipVertex,new ClipVertex];k=b2Collision.ClipSegmentToLine(j,c,g.Negative(),m);if(!(k<2)&&(k=b2Collision.ClipSegmentToLine(e,j,g,i),!(k<2))){b.normal=h?n.Negative():n.Copy();for(m=g=0;m<b2Settings.b2_maxManifoldPoints;++m)if(c=e[m],i=b2Math.b2Dot(n,c.v)-
l,i<=0)j=b.points[g],j.separation=i,j.localPoint1=b2Math.b2MulXT(d,c.v),j.localPoint2=b2Math.b2MulXT(f,c.v),j.id.key=c.id._key,j.id.features.flip=h,++g;b.pointCount=g}}}};
b2Collision.b2CollideCircles=function(b,c,d,e,f){b.pointCount=0;var g,h;g=d.R;h=c.m_localPosition;var i=d.position.x+(g.col1.x*h.x+g.col2.x*h.y),j=d.position.y+(g.col1.y*h.x+g.col2.y*h.y);g=f.R;h=e.m_localPosition;var k=f.position.x+(g.col1.x*h.x+g.col2.x*h.y);g=f.position.y+(g.col1.y*h.x+g.col2.y*h.y);h=k-i;var l=g-j,m=h*h+l*l;c=c.m_radius;e=e.m_radius;var n=c+e;if(!(m>n*n)){if(m<Number.MIN_VALUE)m=-n,b.normal.Set(0,1);else{var o=Math.sqrt(m);m=o-n;n=1/o;b.normal.x=n*h;b.normal.y=n*l}b.pointCount=
1;h=b.points[0];h.id.key=0;h.separation=m;i+=c*b.normal.x;j+=c*b.normal.y;k-=e*b.normal.x;g-=e*b.normal.y;b=0.5*(i+k);j=0.5*(j+g);i=b-d.position.x;k=j-d.position.y;h.localPoint1.x=i*d.R.col1.x+k*d.R.col1.y;h.localPoint1.y=i*d.R.col2.x+k*d.R.col2.y;i=b-f.position.x;k=j-f.position.y;h.localPoint2.x=i*f.R.col1.x+k*f.R.col1.y;h.localPoint2.y=i*f.R.col2.x+k*f.R.col2.y}};
b2Collision.b2CollidePolygonAndCircle=function(b,c,d,e,f){b.pointCount=0;var g,h,i,j,k,l;l=f.R;k=e.m_localPosition;j=f.position.x+(l.col1.x*k.x+l.col2.x*k.y);var m=f.position.y+(l.col1.y*k.x+l.col2.y*k.y);h=j-d.position.x;i=m-d.position.y;l=d.R;var n=h*l.col1.x+i*l.col1.y;l=h*l.col2.x+i*l.col2.y;var o=0,p=-Number.MAX_VALUE;e=e.m_radius;var q=c.m_vertexCount;g=c.m_vertices;c=c.m_normals;for(var r=0;r<q;++r){k=g[r];h=n-k.x;i=l-k.y;k=c[r];h=k.x*h+k.y*i;if(h>e)return;h>p&&(p=h,o=r)}if(p<Number.MIN_VALUE)b.pointCount=
1,k=c[o],l=d.R,b.normal.x=l.col1.x*k.x+l.col2.x*k.y,b.normal.y=l.col1.y*k.x+l.col2.y*k.y,g=b.points[0],g.id.features.incidentEdge=o,g.id.features.incidentVertex=b2Collision.b2_nullFeature,g.id.features.referenceEdge=0,g.id.features.flip=0,j-=e*b.normal.x,b=m-e*b.normal.y,h=j-d.position.x,i=b-d.position.y,l=d.R,g.localPoint1.x=h*l.col1.x+i*l.col1.y,g.localPoint1.y=h*l.col2.x+i*l.col2.y,h=j-f.position.x,i=b-f.position.y,l=f.R,g.localPoint2.x=h*l.col1.x+i*l.col1.y,g.localPoint2.y=h*l.col2.x+i*l.col2.y,
g.separation=p-e;else{p=o;q=p+1<q?p+1:0;k=g[p];c=g[q];var u=c.x-k.x;r=c.y-k.y;var z=Math.sqrt(u*u+r*r);u/=z;r/=z;h=n-k.x;i=l-k.y;h=h*u+i*r;g=b.points[0];h<=0?(i=k.x,k=k.y,g.id.features.incidentEdge=b2Collision.b2_nullFeature,g.id.features.incidentVertex=p):h>=z?(i=c.x,k=c.y,g.id.features.incidentEdge=b2Collision.b2_nullFeature,g.id.features.incidentVertex=q):(i=u*h+k.x,k=r*h+k.y,g.id.features.incidentEdge=o,g.id.features.incidentVertex=0);h=n-i;i=l-k;n=Math.sqrt(h*h+i*i);h/=n;i/=n;if(!(n>e))b.pointCount=
1,l=d.R,b.normal.x=l.col1.x*h+l.col2.x*i,b.normal.y=l.col1.y*h+l.col2.y*i,j-=e*b.normal.x,b=m-e*b.normal.y,h=j-d.position.x,i=b-d.position.y,l=d.R,g.localPoint1.x=h*l.col1.x+i*l.col1.y,g.localPoint1.y=h*l.col2.x+i*l.col2.y,h=j-f.position.x,i=b-f.position.y,l=f.R,g.localPoint2.x=h*l.col1.x+i*l.col1.y,g.localPoint2.y=h*l.col2.x+i*l.col2.y,g.separation=n-e,g.id.features.referenceEdge=0,g.id.features.flip=0}};
b2Collision.b2TestOverlap=function(b,c){var d=c.lowerBound,e=b.upperBound,f=d.x-e.x,g=d.y-e.y;d=b.lowerBound;e=c.upperBound;b=d.y-e.y;if(f>0||g>0)return!1;if(d.x-e.x>0||b>0)return!1;return!0};var b2ContactListener=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactListener.prototype;a.__constructor=function(){};a.__varz=function(){};a.Add=function(){};a.Persist=function(){};a.Remove=function(){};a.Result=function(){};
var b2PairCallback=function(){this.__varz();this.__constructor.apply(this,arguments)};b2PairCallback.prototype.__constructor=function(){};b2PairCallback.prototype.__varz=function(){};b2PairCallback.prototype.PairAdded=function(){return null};b2PairCallback.prototype.PairRemoved=function(){};var b2JointDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2JointDef.prototype;
a.__constructor=function(){this.type=b2Joint.e_unknownJoint;this.body2=this.body1=this.userData=null;this.collideConnected=!1};a.__varz=function(){};a.type=0;a.userData=null;a.body1=null;a.body2=null;a.collideConnected=null;var b2Proxy=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Proxy.prototype;a.__constructor=function(){};a.__varz=function(){this.lowerBounds=[parseInt(0),parseInt(0)];this.upperBounds=[parseInt(0),parseInt(0)]};a.lowerBounds=[parseInt(0),parseInt(0)];
a.upperBounds=[parseInt(0),parseInt(0)];a.overlapCount=0;a.timeStamp=0;a.userData=null;a.GetNext=function(){return this.lowerBounds[0]};a.SetNext=function(b){this.lowerBounds[0]=b%65535};a.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid};var b2Color=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Color.prototype;
a.__constructor=function(b,c,d){this._r=parseInt(255*b2Math.b2Clamp(b,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(d,0,1))};a.__varz=function(){};a._r=0;a._g=0;a._b=0;a.Set=function(b,c,d){this._r=parseInt(255*b2Math.b2Clamp(b,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(d,0,1))};a.set=function(b){this._r=parseInt(255*b2Math.b2Clamp(b,0,1))};a.set=function(b){this._g=parseInt(255*b2Math.b2Clamp(b,0,1))};
a.set=function(b){this._b=parseInt(255*b2Math.b2Clamp(b,0,1))};a.get=function(){return this._r|this._g<<8|this._b<<16};var b2FilterData=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2FilterData.prototype;a.__constructor=function(){};a.__varz=function(){this.categoryBits=1;this.maskBits=65535};a.categoryBits=1;a.maskBits=65535;a.groupIndex=0;a.Copy=function(){var b=new b2FilterData;b.categoryBits=this.categoryBits;b.maskBits=this.maskBits;b.groupIndex=this.groupIndex;return b};
var b2PairManager=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2PairManager.prototype.__constructor=function(){var b=0;this.m_hashTable=Array(b2Pair.b2_tableCapacity);for(b=0;b<b2Pair.b2_tableCapacity;++b)this.m_hashTable[b]=b2Pair.b2_nullPair;this.m_pairs=Array(b2Settings.b2_maxPairs);for(b=0;b<b2Settings.b2_maxPairs;++b)this.m_pairs[b]=new b2Pair;this.m_pairBuffer=Array(b2Settings.b2_maxPairs);for(b=0;b<b2Settings.b2_maxPairs;++b)this.m_pairBuffer[b]=new b2BufferedPair;for(b=0;b<b2Settings.b2_maxPairs;++b)this.m_pairs[b].proxyId1=b2Pair.b2_nullProxy,this.m_pairs[b].proxyId2=
b2Pair.b2_nullProxy,this.m_pairs[b].userData=null,this.m_pairs[b].status=0,this.m_pairs[b].next=b+1;this.m_pairs[parseInt(b2Settings.b2_maxPairs-1)].next=b2Pair.b2_nullPair;this.m_pairBufferCount=this.m_pairCount=0};b2PairManager.prototype.__varz=function(){};b2PairManager.Hash=function(b,c){b|=c<<16&4294901760;b=~b+(b<<15&4294934528);b^=b>>12&1048575;b+=b<<2&4294967292;b^=b>>4&268435455;b*=2057;b^=(b>>16)%65535;return b};b2PairManager.Equals=function(b,c,d){return b.proxyId1==c&&b.proxyId2==d};
b2PairManager.EqualsPair=function(b,c){return b.proxyId1==c.proxyId1&&b.proxyId2==c.proxyId2};a=b2PairManager.prototype;a.m_broadPhase=null;a.m_callback=null;a.m_pairs=null;a.m_freePair=0;a.m_pairCount=0;a.m_pairBuffer=null;a.m_pairBufferCount=0;a.m_hashTable=null;
a.AddPair=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;var e=e=this.FindHash(b,c,d);if(e!=null)return e;var f=this.m_freePair;e=this.m_pairs[f];this.m_freePair=e.next;e.proxyId1=b;e.proxyId2=c;e.status=0;e.userData=null;e.next=this.m_hashTable[d];this.m_hashTable[d]=f;++this.m_pairCount;return e};
a.RemovePair=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;for(var e=this.m_hashTable[d],f=null;e!=b2Pair.b2_nullPair;)if(b2PairManager.Equals(this.m_pairs[e],b,c))return b=e,c=this.m_pairs[e],f?f.next=c.next:this.m_hashTable[d]=c.next,c=this.m_pairs[b],d=c.userData,c.next=this.m_freePair,c.proxyId1=b2Pair.b2_nullProxy,c.proxyId2=b2Pair.b2_nullProxy,c.userData=null,c.status=0,this.m_freePair=b,--this.m_pairCount,d;else f=this.m_pairs[e],e=f.next;return null};
a.Find=function(b,c){if(b>c){var d=b;b=c;c=d}d=b2PairManager.Hash(b,c)&b2Pair.b2_tableMask;return this.FindHash(b,c,d)};a.FindHash=function(b,c,d){var e=this.m_hashTable[d];for(d=this.m_pairs[e];e!=b2Pair.b2_nullPair&&b2PairManager.Equals(d,b,c)==!1;)e=d.next,d=this.m_pairs[e];if(e==b2Pair.b2_nullPair)return null;return d};a.ValidateBuffer=function(){};a.ValidateTable=function(){};a.Initialize=function(b,c){this.m_broadPhase=b;this.m_callback=c};
a.AddBufferedPair=function(b,c){c=this.AddPair(b,c);if(c.IsBuffered()==!1)c.SetBuffered(),b=this.m_pairBuffer[this.m_pairBufferCount],b.proxyId1=c.proxyId1,b.proxyId2=c.proxyId2,++this.m_pairBufferCount;c.ClearRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()};
a.RemoveBufferedPair=function(b,c){c=this.Find(b,c);if(c!=null){if(c.IsBuffered()==!1)c.SetBuffered(),b=this.m_pairBuffer[this.m_pairBufferCount],b.proxyId1=c.proxyId1,b.proxyId2=c.proxyId2,++this.m_pairBufferCount;c.SetRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()}};
a.Commit=function(){var b,c=0,d=0,e=this.m_broadPhase.m_proxyPool;for(c=0;c<this.m_pairBufferCount;++c){b=this.m_pairBuffer[c];var f=this.Find(b.proxyId1,b.proxyId2);f.ClearBuffered();b=e[f.proxyId1];var g=e[f.proxyId2];if(f.IsRemoved())f.IsFinal()==!0&&this.m_callback.PairRemoved(b.userData,g.userData,f.userData),b=this.m_pairBuffer[d],b.proxyId1=f.proxyId1,b.proxyId2=f.proxyId2,++d;else if(f.IsFinal()==!1)f.userData=this.m_callback.PairAdded(b.userData,g.userData),f.SetFinal()}for(c=0;c<d;++c)b=
this.m_pairBuffer[c],this.RemovePair(b.proxyId1,b.proxyId2);this.m_pairBufferCount=0;b2BroadPhase.s_validate&&this.ValidateTable()};var b2ContactSolver=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactSolver.prototype;
a.__constructor=function(b,c,d,e){var f;this.m_step.dt=b.dt;this.m_step.inv_dt=b.inv_dt;this.m_step.maxIterations=b.maxIterations;this.m_allocator=e;var g;for(b=this.m_constraintCount=0;b<d;++b)f=c[b],this.m_constraintCount+=f.m_manifoldCount;for(b=0;b<this.m_constraintCount;b++)this.m_constraints[b]=new b2ContactConstraint;for(b=e=0;b<d;++b){f=c[b];var h=f.m_shape1.m_body,i=f.m_shape2.m_body,j=f.m_manifoldCount,k=f.GetManifolds(),l=f.m_friction;f=f.m_restitution;for(var m=h.m_linearVelocity.x,n=
h.m_linearVelocity.y,o=i.m_linearVelocity.x,p=i.m_linearVelocity.y,q=h.m_angularVelocity,r=i.m_angularVelocity,u=0;u<j;++u){var z=k[u],y=z.normal.x,s=z.normal.y,v=this.m_constraints[e];v.body1=h;v.body2=i;v.manifold=z;v.normal.x=y;v.normal.y=s;v.pointCount=z.pointCount;v.friction=l;v.restitution=f;for(var C=0;C<v.pointCount;++C){var t=z.points[C],x=v.points[C];x.normalImpulse=t.normalImpulse;x.tangentImpulse=t.tangentImpulse;x.separation=t.separation;x.positionImpulse=0;x.localAnchor1.SetV(t.localPoint1);
x.localAnchor2.SetV(t.localPoint2);var w;g=h.m_xf.R;var A=t.localPoint1.x-h.m_sweep.localCenter.x,E=t.localPoint1.y-h.m_sweep.localCenter.y;w=g.col1.x*A+g.col2.x*E;E=g.col1.y*A+g.col2.y*E;A=w;x.r1.Set(A,E);g=i.m_xf.R;var D=t.localPoint2.x-i.m_sweep.localCenter.x;t=t.localPoint2.y-i.m_sweep.localCenter.y;w=g.col1.x*D+g.col2.x*t;t=g.col1.y*D+g.col2.y*t;D=w;x.r2.Set(D,t);g=A*A+E*E;w=D*D+t*t;var F=A*y+E*s,B=D*y+t*s,G=h.m_invMass+i.m_invMass;G+=h.m_invI*(g-F*F)+i.m_invI*(w-B*B);x.normalMass=1/G;G=h.m_mass*
h.m_invMass+i.m_mass*i.m_invMass;G+=h.m_mass*h.m_invI*(g-F*F)+i.m_mass*i.m_invI*(w-B*B);x.equalizedMass=1/G;B=-y;F=A*s+E*B;B=D*s+t*B;G=h.m_invMass+i.m_invMass;G+=h.m_invI*(g-F*F)+i.m_invI*(w-B*B);x.tangentMass=1/G;x.velocityBias=0;if(x.separation>0)x.velocityBias=-60*x.separation;w=o+-r*t-m- -q*E;A=v.normal.x*w+v.normal.y*(p+r*D-n-q*A);A<-b2Settings.b2_velocityThreshold&&(x.velocityBias+=-v.restitution*A)}++e}}};a.__varz=function(){this.m_step=new b2TimeStep;this.m_constraints=[]};a.m_step=new b2TimeStep;
a.m_allocator=null;a.m_constraints=[];a.m_constraintCount=0;
a.InitVelocityConstraints=function(b){for(var c=0;c<this.m_constraintCount;++c){var d=this.m_constraints[c],e=d.body1,f=d.body2,g=e.m_invMass,h=e.m_invI,i=f.m_invMass,j=f.m_invI,k=d.normal.x,l=d.normal.y,m=-k,n=0,o=0;if(b.warmStarting){o=d.pointCount;for(n=0;n<o;++n){var p=d.points[n];p.normalImpulse*=b.dtRatio;p.tangentImpulse*=b.dtRatio;var q=p.normalImpulse*k+p.tangentImpulse*l,r=p.normalImpulse*l+p.tangentImpulse*m;e.m_angularVelocity-=h*(p.r1.x*r-p.r1.y*q);e.m_linearVelocity.x-=g*q;e.m_linearVelocity.y-=
g*r;f.m_angularVelocity+=j*(p.r2.x*r-p.r2.y*q);f.m_linearVelocity.x+=i*q;f.m_linearVelocity.y+=i*r}}else{o=d.pointCount;for(n=0;n<o;++n)e=d.points[n],e.normalImpulse=0,e.tangentImpulse=0}}};
a.SolveVelocityConstraints=function(){for(var b=0,c,d,e,f,g,h,i=0;i<this.m_constraintCount;++i){var j=this.m_constraints[i],k=j.body1,l=j.body2,m=k.m_angularVelocity,n=l.m_angularVelocity,o=k.m_linearVelocity,p=l.m_linearVelocity,q=k.m_invMass,r=k.m_invI,u=l.m_invMass,z=l.m_invI,y=j.normal.x,s=j.normal.y,v=-y,C=j.friction,t=j.pointCount;for(b=0;b<t;++b)c=j.points[b],d=p.x+-n*c.r2.y-o.x- -m*c.r1.y,e=p.y+n*c.r2.x-o.y-m*c.r1.x,f=d*y+e*s,f=-c.normalMass*(f-c.velocityBias),d=d*s+e*v,e=c.tangentMass*-d,
d=b2Math.b2Max(c.normalImpulse+f,0),f=d-c.normalImpulse,g=C*c.normalImpulse,g=b2Math.b2Clamp(c.tangentImpulse+e,-g,g),e=g-c.tangentImpulse,h=f*y+e*s,f=f*s+e*v,o.x-=q*h,o.y-=q*f,m-=r*(c.r1.x*f-c.r1.y*h),p.x+=u*h,p.y+=u*f,n+=z*(c.r2.x*f-c.r2.y*h),c.normalImpulse=d,c.tangentImpulse=g;k.m_angularVelocity=m;l.m_angularVelocity=n}};
a.FinalizeVelocityConstraints=function(){for(var b=0;b<this.m_constraintCount;++b)for(var c=this.m_constraints[b],d=c.manifold,e=0;e<c.pointCount;++e){var f=d.points[e],g=c.points[e];f.normalImpulse=g.normalImpulse;f.tangentImpulse=g.tangentImpulse}};
a.SolvePositionConstraints=function(b){for(var c=0,d,e,f=0;f<this.m_constraintCount;++f)for(var g=this.m_constraints[f],h=g.body1,i=g.body2,j=h.m_sweep.c,k=h.m_sweep.a,l=i.m_sweep.c,m=i.m_sweep.a,n=h.m_mass*h.m_invMass,o=h.m_mass*h.m_invI,p=i.m_mass*i.m_invMass,q=i.m_mass*i.m_invI,r=g.normal.x,u=g.normal.y,z=g.pointCount,y=0;y<z;++y){var s=g.points[y];d=h.m_xf.R;e=h.m_sweep.localCenter;var v=s.localAnchor1.x-e.x,C=s.localAnchor1.y-e.y;x=d.col1.x*v+d.col2.x*C;C=d.col1.y*v+d.col2.y*C;v=x;d=i.m_xf.R;
e=i.m_sweep.localCenter;var t=s.localAnchor2.x-e.x;e=s.localAnchor2.y-e.y;var x=d.col1.x*t+d.col2.x*e;e=d.col1.y*t+d.col2.y*e;t=x;d=(l.x+t-(j.x+v))*r+(l.y+e-(j.y+C))*u+s.separation;c=b2Math.b2Min(c,d);d=b*b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);d*=-s.equalizedMass;x=s.positionImpulse;s.positionImpulse=b2Math.b2Max(x+d,0);d=s.positionImpulse-x;s=d*r;d*=u;j.x-=n*s;j.y-=n*d;k-=o*(v*d-C*s);h.m_sweep.a=k;h.SynchronizeTransform();l.x+=p*s;l.y+=p*d;m+=q*(t*d-e*s);
i.m_sweep.a=m;i.SynchronizeTransform()}return c>=-1.5*b2Settings.b2_linearSlop};var b2BoundValues=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){};b2BoundValues.prototype.__varz=function(){this.lowerValues=[0,0];this.upperValues=[0,0]};b2BoundValues.prototype.lowerValues=[0,0];b2BoundValues.prototype.upperValues=[0,0];var Features=function(){this.__varz();this.__constructor.apply(this,arguments)};
Features.prototype={referenceEdge:function(){return this._referenceEdge},referenceEdge:function(b){this._referenceEdge=b;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255},incidentEdge:function(){return this._incidentEdge},incidentEdge:function(b){this._incidentEdge=b;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280},incidentVertex:function(b){this._incidentVertex=b;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680},incidentVertex:function(){return this._incidentVertex},
flip:function(b){this._flip=b;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080},flip:function(){return this._flip}};a=Features.prototype;a.__constructor=function(){};a.__varz=function(){};a._referenceEdge=0;a._incidentEdge=0;a._incidentVertex=0;a._flip=0;a._m_id=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype);a=b2MouseJointDef.prototype;
a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Joint.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7;this.timeStep=1/60};a.__varz=function(){this.target=new b2Vec2};a.target=new b2Vec2;a.maxForce=null;a.frequencyHz=null;a.dampingRatio=null;a.timeStep=null;var b2ContactConstraintPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactConstraintPoint.prototype;a.__constructor=function(){};
a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.r1=new b2Vec2;this.r2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.r1=new b2Vec2;a.r2=new b2Vec2;a.normalImpulse=null;a.tangentImpulse=null;a.positionImpulse=null;a.normalMass=null;a.tangentMass=null;a.equalizedMass=null;a.separation=null;a.velocityBias=null;var b2ContactRegister=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactRegister.prototype;a.__constructor=function(){};
a.__varz=function(){};a.createFcn=null;a.destroyFcn=null;a.primary=null;var b2DestructionListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){};b2DestructionListener.prototype.__varz=function(){};b2DestructionListener.prototype.SayGoodbyeJoint=function(){};b2DestructionListener.prototype.SayGoodbyeShape=function(){};
var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype);a=b2PulleyJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_pulleyJoint;this.groundAnchor1.Set(-1,1);this.groundAnchor2.Set(1,1);this.localAnchor1.Set(-1,0);this.localAnchor2.Set(1,0);this.maxLength2=this.length2=this.maxLength1=this.length1=0;this.ratio=1;this.collideConnected=!0};a.__varz=function(){this.groundAnchor1=new b2Vec2;this.groundAnchor2=new b2Vec2;this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.groundAnchor1=new b2Vec2;a.groundAnchor2=new b2Vec2;a.localAnchor1=new b2Vec2;
a.localAnchor2=new b2Vec2;a.length1=null;a.maxLength1=null;a.length2=null;a.maxLength2=null;a.ratio=null;
a.Initialize=function(b,c,d,e,f,g,h){this.body1=b;this.body2=c;this.groundAnchor1.SetV(d);this.groundAnchor2.SetV(e);this.localAnchor1=this.body1.GetLocalPoint(f);this.localAnchor2=this.body2.GetLocalPoint(g);b=f.x-d.x;d=f.y-d.y;this.length1=Math.sqrt(b*b+d*d);d=g.x-e.x;e=g.y-e.y;this.length2=Math.sqrt(d*d+e*e);this.ratio=h;h=this.length1+this.ratio*this.length2;this.maxLength1=h-this.ratio*b2PulleyJoint.b2_minPulleyLength;this.maxLength2=(h-b2PulleyJoint.b2_minPulleyLength)/this.ratio};
var b2Jacobian=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Jacobian.prototype;a.__constructor=function(){};a.__varz=function(){this.linear1=new b2Vec2;this.linear2=new b2Vec2};a.linear1=new b2Vec2;a.angular1=null;a.linear2=new b2Vec2;a.angular2=null;a.SetZero=function(){this.linear1.SetZero();this.angular1=0;this.linear2.SetZero();this.angular2=0};a.Set=function(b,c,d,e){this.linear1.SetV(b);this.angular1=c;this.linear2.SetV(d);this.angular2=e};
a.Compute=function(b,c,d,e){return this.linear1.x*b.x+this.linear1.y*b.y+this.angular1*c+(this.linear2.x*d.x+this.linear2.y*d.y)+this.angular2*e};var b2DebugDraw=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0};b2DebugDraw.prototype.__varz=function(){};b2DebugDraw.e_shapeBit=1;b2DebugDraw.e_jointBit=2;b2DebugDraw.e_coreShapeBit=4;b2DebugDraw.e_aabbBit=8;b2DebugDraw.e_obbBit=16;b2DebugDraw.e_pairBit=32;
b2DebugDraw.e_centerOfMassBit=64;a=b2DebugDraw.prototype;a.m_drawFlags=0;a.m_sprite=null;a.m_drawScale=1;a.m_lineThickness=1;a.m_alpha=1;a.m_fillAlpha=1;a.m_xformScale=1;a.SetFlags=function(b){this.m_drawFlags=b};a.GetFlags=function(){return this.m_drawFlags};a.AppendFlags=function(b){this.m_drawFlags|=b};a.ClearFlags=function(b){this.m_drawFlags&=~b};
a.DrawPolygon=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);for(d=1;d<c;d++)this.m_sprite.graphics.lineTo(b[d].x*this.m_drawScale,b[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale)};
a.DrawSolidPolygon=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);this.m_sprite.graphics.beginFill(d.color,this.m_fillAlpha);for(d=1;d<c;d++)this.m_sprite.graphics.lineTo(b[d].x*this.m_drawScale,b[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(b[0].x*this.m_drawScale,b[0].y*this.m_drawScale);this.m_sprite.graphics.endFill()};
a.DrawCircle=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.drawCircle(b.x*this.m_drawScale,b.y*this.m_drawScale,c*this.m_drawScale)};
a.DrawSolidCircle=function(b,c,d,e){this.m_sprite.graphics.lineStyle(this.m_lineThickness,e.color,this.m_alpha);this.m_sprite.graphics.moveTo(0,0);this.m_sprite.graphics.beginFill(e.color,this.m_fillAlpha);this.m_sprite.graphics.drawCircle(b.x*this.m_drawScale,b.y*this.m_drawScale,c*this.m_drawScale);this.m_sprite.graphics.endFill();this.m_sprite.graphics.moveTo(b.x*this.m_drawScale,b.y*this.m_drawScale);this.m_sprite.graphics.lineTo((b.x+d.x*c)*this.m_drawScale,(b.y+d.y*c)*this.m_drawScale)};
a.DrawSegment=function(b,c,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(b.x*this.m_drawScale,b.y*this.m_drawScale);this.m_sprite.graphics.lineTo(c.x*this.m_drawScale,c.y*this.m_drawScale)};
a.DrawXForm=function(b){this.m_sprite.graphics.lineStyle(this.m_lineThickness,16711680,this.m_alpha);this.m_sprite.graphics.moveTo(b.position.x*this.m_drawScale,b.position.y*this.m_drawScale);this.m_sprite.graphics.lineTo((b.position.x+this.m_xformScale*b.R.col1.x)*this.m_drawScale,(b.position.y+this.m_xformScale*b.R.col1.y)*this.m_drawScale);this.m_sprite.graphics.lineStyle(this.m_lineThickness,65280,this.m_alpha);this.m_sprite.graphics.moveTo(b.position.x*this.m_drawScale,b.position.y*this.m_drawScale);
this.m_sprite.graphics.lineTo((b.position.x+this.m_xformScale*b.R.col2.x)*this.m_drawScale,(b.position.y+this.m_xformScale*b.R.col2.y)*this.m_drawScale)};var b2ContactEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactEdge.prototype;a.__constructor=function(){};a.__varz=function(){};a.other=null;a.contact=null;a.prev=null;a.next=null;var b2Sweep=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2Sweep.prototype;a.__constructor=function(){};
a.__varz=function(){this.localCenter=new b2Vec2;this.c0=new b2Vec2;this.c=new b2Vec2};a.localCenter=new b2Vec2;a.c0=new b2Vec2;a.c=new b2Vec2;a.a0=null;a.a=null;a.t0=null;
a.GetXForm=function(b,c){1-this.t0>Number.MIN_VALUE?(c=(c-this.t0)/(1-this.t0),b.position.x=(1-c)*this.c0.x+c*this.c.x,b.position.y=(1-c)*this.c0.y+c*this.c.y,b.R.Set((1-c)*this.a0+c*this.a)):(b.position.SetV(this.c),b.R.Set(this.a));c=b.R;b.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y;b.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y};
a.Advance=function(b){if(this.t0<b&&1-this.t0>Number.MIN_VALUE){var c=(b-this.t0)/(1-this.t0);this.c0.x=(1-c)*this.c0.x+c*this.c.x;this.c0.y=(1-c)*this.c0.y+c*this.c.y;this.a0=(1-c)*this.a0+c*this.a;this.t0=b}};var b2ContactConstraint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactConstraint.prototype;a.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.points[b]=new b2ContactConstraintPoint};
a.__varz=function(){this.normal=new b2Vec2};a.points=null;a.normal=new b2Vec2;a.manifold=null;a.body1=null;a.body2=null;a.friction=null;a.restitution=null;a.pointCount=0;var b2Distance=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){};b2Distance.prototype.__varz=function(){};b2Distance.g_GJK_Iterations=0;b2Distance.s_p1s=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.s_p2s=[new b2Vec2,new b2Vec2,new b2Vec2];
b2Distance.s_points=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.gPoint=new b2Point;b2Distance.ProcessTwo=function(b,c,d,e,f){var g=f[0];f=f[1];var h=d[0];d=d[1];var i=e[0];e=e[1];var j=-f.x,k=-f.y,l=g.x-f.x,m=g.y-f.y,n=Math.sqrt(l*l+m*m);l/=n;m/=n;j=j*l+k*m;if(j<=0||n<Number.MIN_VALUE)return b.SetV(d),c.SetV(e),h.SetV(d),i.SetV(e),g.SetV(f),1;j/=n;b.x=d.x+j*(h.x-d.x);b.y=d.y+j*(h.y-d.y);c.x=e.x+j*(i.x-e.x);c.y=e.y+j*(i.y-e.y);return 2};
b2Distance.ProcessThree=function(b,c,d,e,f){var g=f[0],h=f[1],i=f[2];f=d[0];var j=d[1];d=d[2];var k=e[0],l=e[1];e=e[2];var m=g.x,n=g.y,o=h.x,p=h.y,q=i.x,r=i.y,u=o-m,z=p-n,y=q-m,s=r-n,v=q-o,C=r-p,t=-(m*y+n*s),x=q*y+r*s,w=-(o*v+p*C);v=q*v+r*C;if(x<=0&&v<=0)return b.SetV(d),c.SetV(e),f.SetV(d),k.SetV(e),g.SetV(i),1;z=u*s-z*y;u=z*(m*p-n*o);o=z*(o*r-p*q);if(o<=0&&w>=0&&v>=0&&w+v>0)return t=w/(w+v),b.x=j.x+t*(d.x-j.x),b.y=j.y+t*(d.y-j.y),c.x=l.x+t*(e.x-l.x),c.y=l.y+t*(e.y-l.y),f.SetV(d),k.SetV(e),g.SetV(i),
2;g=z*(q*n-r*m);if(g<=0&&t>=0&&x>=0&&t+x>0)return t/=t+x,b.x=f.x+t*(d.x-f.x),b.y=f.y+t*(d.y-f.y),c.x=k.x+t*(e.x-k.x),c.y=k.y+t*(e.y-k.y),j.SetV(d),l.SetV(e),h.SetV(i),2;i=1/(o+g+u);h=o*i;g*=i;i=1-h-g;b.x=h*f.x+g*j.x+i*d.x;b.y=h*f.y+g*j.y+i*d.y;c.x=h*k.x+g*l.x+i*e.x;c.y=h*k.y+g*l.y+i*e.y;return 3};
b2Distance.InPoints=function(b,c,d){for(var e=100*Number.MIN_VALUE,f=0;f<d;++f){var g=c[f],h=Math.abs(b.x-g.x),i=Math.abs(b.y-g.y),j=Math.max(Math.abs(b.x),Math.abs(g.x));g=Math.max(Math.abs(b.y),Math.abs(g.y));if(h<e*(j+1)&&i<e*(g+1))return!0}return!1};
b2Distance.DistanceGeneric=function(b,c,d,e,f,g){var h,i=b2Distance.s_p1s,j=b2Distance.s_p2s,k=b2Distance.s_points,l=0;b.SetV(d.GetFirstVertex(e));c.SetV(f.GetFirstVertex(g));for(var m=0,n=0;n<20;++n){h=c.x-b.x;var o=c.y-b.y,p=d.Support(e,h,o),q=f.Support(g,-h,-o);m=h*h+o*o;var r=q.x-p.x,u=q.y-p.y;if(m-(h*r+o*u)<=0.01*m)return l==0&&(b.SetV(p),c.SetV(q)),b2Distance.g_GJK_Iterations=n,Math.sqrt(m);switch(l){case 0:h=i[0];h.SetV(p);h=j[0];h.SetV(q);h=k[0];h.x=r;h.y=u;b.SetV(i[0]);c.SetV(j[0]);++l;break;
case 1:h=i[1];h.SetV(p);h=j[1];h.SetV(q);h=k[1];h.x=r;h.y=u;l=b2Distance.ProcessTwo(b,c,i,j,k);break;case 2:h=i[2],h.SetV(p),h=j[2],h.SetV(q),h=k[2],h.x=r,h.y=u,l=b2Distance.ProcessThree(b,c,i,j,k)}if(l==3)return b2Distance.g_GJK_Iterations=n,0;p=-Number.MAX_VALUE;for(q=0;q<l;++q)h=k[q],p=b2Math.b2Max(p,h.x*h.x+h.y*h.y);if(l==3||m<=100*Number.MIN_VALUE*p)return b2Distance.g_GJK_Iterations=n,h=c.x-b.x,o=c.y-b.y,m=h*h+o*o,Math.sqrt(m)}b2Distance.g_GJK_Iterations=20;return Math.sqrt(m)};
b2Distance.DistanceCC=function(b,c,d,e,f,g){var h,i;h=e.R;i=d.m_localPosition;var j=e.position.x+(h.col1.x*i.x+h.col2.x*i.y);e=e.position.y+(h.col1.y*i.x+h.col2.y*i.y);h=g.R;i=f.m_localPosition;var k=g.position.x+(h.col1.x*i.x+h.col2.x*i.y);g=g.position.y+(h.col1.y*i.x+h.col2.y*i.y);h=k-j;i=g-e;var l=h*h+i*i;d=d.m_radius-b2Settings.b2_toiSlop;f=f.m_radius-b2Settings.b2_toiSlop;var m=d+f;if(l>m*m)return l=Math.sqrt(h*h+i*i),h/=l,i/=l,l-=m,b.x=j+d*h,b.y=e+d*i,c.x=k-f*h,c.y=g-f*i,l;else if(l>Number.MIN_VALUE*
Number.MIN_VALUE)return l=Math.sqrt(h*h+i*i),h/=l,i/=l,b.x=j+d*h,b.y=e+d*i,c.x=b.x,c.y=b.y,0;b.x=j;b.y=e;c.x=b.x;c.y=b.y;return 0};
b2Distance.DistancePC=function(b,c,d,e,f,g){var h,i,j=b2Distance.gPoint;i=f.m_localPosition;h=g.R;j.p.x=g.position.x+(h.col1.x*i.x+h.col2.x*i.y);j.p.y=g.position.y+(h.col1.y*i.x+h.col2.y*i.y);d=b2Distance.DistanceGeneric(b,c,d,e,j,b2Math.b2XForm_identity);f=f.m_radius-b2Settings.b2_toiSlop;d>f?(d-=f,e=c.x-b.x,b=c.y-b.y,g=Math.sqrt(e*e+b*b),e/=g,b/=g,c.x-=f*e,c.y-=f*b):(d=0,c.x=b.x,c.y=b.y);return d};
b2Distance.Distance=function(b,c,d,e,f,g){var h=d.m_type,i=f.m_type;if(h==b2Shape.e_circleShape&&i==b2Shape.e_circleShape)return b2Distance.DistanceCC(b,c,d,e,f,g);if(h==b2Shape.e_polygonShape&&i==b2Shape.e_circleShape)return b2Distance.DistancePC(b,c,d,e,f,g);if(h==b2Shape.e_circleShape&&i==b2Shape.e_polygonShape)return b2Distance.DistancePC(c,b,f,g,d,e);if(h==b2Shape.e_polygonShape&&i==b2Shape.e_polygonShape)return b2Distance.DistanceGeneric(b,c,d,e,f,g);return 0};
var b2Shape=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(b){this.m_userData=b.userData;this.m_friction=b.friction;this.m_restitution=b.restitution;this.m_density=b.density;this.m_body=null;this.m_sweepRadius=0;this.m_next=null;this.m_proxyId=b2Pair.b2_nullProxy;this.m_filter=b.filter.Copy();this.m_isSensor=b.isSensor};b2Shape.prototype.__varz=function(){};b2Shape.e_unknownShape=-1;b2Shape.e_circleShape=0;b2Shape.e_polygonShape=1;
b2Shape.e_shapeTypeCount=2;b2Shape.e_hitCollide=1;b2Shape.e_missCollide=0;b2Shape.e_startsInsideCollide=-1;b2Shape.s_proxyAABB=new b2AABB;b2Shape.s_syncAABB=new b2AABB;b2Shape.s_resetAABB=new b2AABB;b2Shape.Create=function(b){switch(b.type){case b2Shape.e_circleShape:return new b2CircleShape(b);case b2Shape.e_polygonShape:return new b2PolygonShape(b);default:return null}};b2Shape.Destroy=function(){};a=b2Shape.prototype;a.m_type=0;a.m_next=null;a.m_body=null;a.m_sweepRadius=null;a.m_density=null;
a.m_friction=null;a.m_restitution=null;a.m_proxyId=0;a.m_filter=null;a.m_isSensor=null;a.m_userData=null;a.GetType=function(){return this.m_type};a.IsSensor=function(){return this.m_isSensor};a.SetFilterData=function(b){this.m_filter=b.Copy()};a.GetFilterData=function(){return this.m_filter.Copy()};a.GetBody=function(){return this.m_body};a.GetNext=function(){return this.m_next};a.GetUserData=function(){return this.m_userData};a.SetUserData=function(b){this.m_userData=b};a.TestPoint=function(){return!1};
a.TestSegment=function(){return b2Shape.e_missCollide};a.ComputeAABB=function(){};a.ComputeSweptAABB=function(){};a.ComputeMass=function(){};a.GetSweepRadius=function(){return this.m_sweepRadius};a.GetFriction=function(){return this.m_friction};a.GetRestitution=function(){return this.m_restitution};a.CreateProxy=function(b,c){var d=b2Shape.s_proxyAABB;this.ComputeAABB(d,c);this.m_proxyId=b.InRange(d)?b.CreateProxy(d,this):b2Pair.b2_nullProxy};
a.DestroyProxy=function(b){if(this.m_proxyId!=b2Pair.b2_nullProxy)b.DestroyProxy(this.m_proxyId),this.m_proxyId=b2Pair.b2_nullProxy};a.Synchronize=function(b,c,d){if(this.m_proxyId==b2Pair.b2_nullProxy)return!1;var e=b2Shape.s_syncAABB;this.ComputeSweptAABB(e,c,d);return b.InRange(e)?(b.MoveProxy(this.m_proxyId,e),!0):!1};
a.RefilterProxy=function(b,c){if(this.m_proxyId!=b2Pair.b2_nullProxy){b.DestroyProxy(this.m_proxyId);var d=b2Shape.s_resetAABB;this.ComputeAABB(d,c);this.m_proxyId=b.InRange(d)?b.CreateProxy(d,this):b2Pair.b2_nullProxy}};a.UpdateSweepRadius=function(){};var b2XForm=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2XForm.prototype;a.__constructor=function(b,c){b&&(this.position.SetV(b),this.R.SetM(c))};a.__varz=function(){this.position=new b2Vec2;this.R=new b2Mat22};
a.position=new b2Vec2;a.R=new b2Mat22;a.Initialize=function(b,c){this.position.SetV(b);this.R.SetM(c)};a.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};a.Set=function(b){this.position.SetV(b.position);this.R.SetM(b.R)};var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype);a=b2DistanceJointDef.prototype;
a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Joint.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.length=null;a.frequencyHz=null;a.dampingRatio=null;
a.Initialize=function(b,c,d,e){this.body1=b;this.body2=c;this.localAnchor1.SetV(this.body1.GetLocalPoint(d));this.localAnchor2.SetV(this.body2.GetLocalPoint(e));b=e.x-d.x;d=e.y-d.y;this.length=Math.sqrt(b*b+d*d);this.dampingRatio=this.frequencyHz=0};var b2OBB=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2OBB.prototype;a.__constructor=function(){};a.__varz=function(){this.R=new b2Mat22;this.center=new b2Vec2;this.extents=new b2Vec2};a.R=new b2Mat22;a.center=new b2Vec2;
a.extents=new b2Vec2;var b2BodyDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2BodyDef.prototype;a.__constructor=function(){this.massData.center.SetZero();this.massData.mass=0;this.massData.I=0;this.userData=null;this.position.Set(0,0);this.angularDamping=this.linearDamping=this.angle=0;this.allowSleep=!0;this.isBullet=this.fixedRotation=this.isSleeping=!1};a.__varz=function(){this.massData=new b2MassData;this.position=new b2Vec2};a.massData=new b2MassData;a.userData=null;
a.position=new b2Vec2;a.angle=null;a.linearDamping=null;a.angularDamping=null;a.allowSleep=null;a.isSleeping=null;a.fixedRotation=null;a.isBullet=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype);a=b2PrismaticJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_prismaticJoint;this.localAxis1.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.localAxis1=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.localAxis1=new b2Vec2;a.referenceAngle=null;a.enableLimit=null;a.lowerTranslation=null;a.upperTranslation=null;
a.enableMotor=null;a.maxMotorForce=null;a.motorSpeed=null;a.Initialize=function(b,c,d,e){this.body1=b;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(d);this.localAnchor2=this.body2.GetLocalPoint(d);this.localAxis1=this.body1.GetLocalVector(e);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2ContactID=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2ContactID.prototype={key:function(){return this._key},key:function(b){this._key=b;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}};a=b2ContactID.prototype;a.__constructor=function(){this.features._m_id=this};a.__varz=function(){this.features=new Features};a.features=new Features;a._key=0;a.Set=function(b){this.key=b._key};
a.Copy=function(){var b=new b2ContactID;b.key=this._key;return b};var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype);a=b2RevoluteJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_revoluteJoint;this.localAnchor1.Set(0,0);this.localAnchor2.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};a.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};a.localAnchor1=new b2Vec2;a.localAnchor2=new b2Vec2;a.referenceAngle=null;a.enableLimit=null;a.lowerAngle=null;a.upperAngle=null;a.enableMotor=null;a.motorSpeed=null;
a.maxMotorTorque=null;a.Initialize=function(b,c,d){this.body1=b;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(d);this.localAnchor2=this.body2.GetLocalPoint(d);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2CircleShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype);a=b2CircleShape.prototype;a._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_type=b2Shape.e_circleShape;this.m_localPosition.SetV(b.localPosition);this.m_radius=b.radius};a.__varz=function(){this.m_localPosition=new b2Vec2};a.m_localPosition=new b2Vec2;a.m_radius=null;a.TestPoint=function(b,c){var d=b.R,e=b.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y);b=b.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);e=c.x-e;b=c.y-b;return e*e+b*b<=this.m_radius*this.m_radius};
a.TestSegment=function(b,c,d,e,f){var g=b.R,h=e.p1.x-(b.position.x+(g.col1.x*this.m_localPosition.x+g.col2.x*this.m_localPosition.y));b=e.p1.y-(b.position.y+(g.col1.y*this.m_localPosition.x+g.col2.y*this.m_localPosition.y));var i=h*h+b*b-this.m_radius*this.m_radius;if(i<0)return c[0]=0,b2Shape.e_startsInsideCollide;g=e.p2.x-e.p1.x;e=e.p2.y-e.p1.y;var j=h*g+b*e,k=g*g+e*e;i=j*j-k*i;if(i<0||k<Number.MIN_VALUE)return b2Shape.e_missCollide;i=-(j+Math.sqrt(i));if(0<=i&&i<=f*k)return i/=k,c[0]=i,d.x=h+i*
g,d.y=b+i*e,d.Normalize(),b2Shape.e_hitCollide;return b2Shape.e_missCollide};a.ComputeAABB=function(b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y);c=c.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);b.lowerBound.Set(e-this.m_radius,c-this.m_radius);b.upperBound.Set(e+this.m_radius,c+this.m_radius)};
a.ComputeSweptAABB=function(b,c,d){var e;e=c.R;var f=c.position.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y);c=c.position.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y);e=d.R;var g=d.position.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y);d=d.position.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y);b.lowerBound.Set((f<g?f:g)-this.m_radius,(c<d?c:d)-this.m_radius);b.upperBound.Set((f>g?f:g)+this.m_radius,(c>d?c:d)+
this.m_radius)};a.ComputeMass=function(b){b.mass=this.m_density*b2Settings.b2_pi*this.m_radius*this.m_radius;b.center.SetV(this.m_localPosition);b.I=b.mass*(0.5*this.m_radius*this.m_radius+(this.m_localPosition.x*this.m_localPosition.x+this.m_localPosition.y*this.m_localPosition.y))};a.GetLocalPosition=function(){return this.m_localPosition};a.GetRadius=function(){return this.m_radius};
a.UpdateSweepRadius=function(b){var c=this.m_localPosition.x-b.x;b=this.m_localPosition.y-b.y;c=Math.sqrt(c*c+b*b);this.m_sweepRadius=c+this.m_radius-b2Settings.b2_toiSlop};var b2Joint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(b){this.m_type=b.type;this.m_next=this.m_prev=null;this.m_body1=b.body1;this.m_body2=b.body2;this.m_collideConnected=b.collideConnected;this.m_islandFlag=!1;this.m_userData=b.userData};
b2Joint.prototype.__varz=function(){this.m_node1=new b2JointEdge;this.m_node2=new b2JointEdge};b2Joint.e_unknownJoint=0;b2Joint.e_revoluteJoint=1;b2Joint.e_prismaticJoint=2;b2Joint.e_distanceJoint=3;b2Joint.e_pulleyJoint=4;b2Joint.e_mouseJoint=5;b2Joint.e_gearJoint=6;b2Joint.e_inactiveLimit=0;b2Joint.e_atLowerLimit=1;b2Joint.e_atUpperLimit=2;b2Joint.e_equalLimits=3;
b2Joint.Create=function(b){var c=null;switch(b.type){case b2Joint.e_distanceJoint:c=new b2DistanceJoint(b);break;case b2Joint.e_mouseJoint:c=new b2MouseJoint(b);break;case b2Joint.e_prismaticJoint:c=new b2PrismaticJoint(b);break;case b2Joint.e_revoluteJoint:c=new b2RevoluteJoint(b);break;case b2Joint.e_pulleyJoint:c=new b2PulleyJoint(b);break;case b2Joint.e_gearJoint:c=new b2GearJoint(b)}return c};b2Joint.Destroy=function(){};a=b2Joint.prototype;a.m_type=0;a.m_prev=null;a.m_next=null;a.m_node1=new b2JointEdge;
a.m_node2=new b2JointEdge;a.m_body1=null;a.m_body2=null;a.m_inv_dt=null;a.m_islandFlag=null;a.m_collideConnected=null;a.m_userData=null;a.GetType=function(){return this.m_type};a.GetAnchor1=function(){return null};a.GetAnchor2=function(){return null};a.GetReactionForce=function(){return null};a.GetReactionTorque=function(){return 0};a.GetBody1=function(){return this.m_body1};a.GetBody2=function(){return this.m_body2};a.GetNext=function(){return this.m_next};a.GetUserData=function(){return this.m_userData};
a.SetUserData=function(b){this.m_userData=b};a.InitVelocityConstraints=function(){};a.SolveVelocityConstraints=function(){};a.InitPositionConstraints=function(){};a.SolvePositionConstraints=function(){return!1};var b2GearJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype);a=b2GearJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);var c=b.joint1.m_type,d=b.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;this.m_ground1=b.joint1.m_body1;this.m_body1=b.joint1.m_body2;c==b2Joint.e_revoluteJoint?(this.m_revolute1=b.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),c=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=b.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),c=this.m_prismatic1.GetJointTranslation());this.m_ground2=b.joint2.m_body1;this.m_body2=b.joint2.m_body2;d==b2Joint.e_revoluteJoint?(this.m_revolute2=b.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),d=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=b.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),
d=this.m_prismatic2.GetJointTranslation());this.m_ratio=b.ratio;this.m_constant=c+this.m_ratio*d;this.m_force=0};a.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_J=new b2Jacobian};a.m_ground1=null;a.m_ground2=null;a.m_revolute1=null;a.m_prismatic1=null;a.m_revolute2=null;a.m_prismatic2=null;a.m_groundAnchor1=new b2Vec2;a.m_groundAnchor2=new b2Vec2;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;
a.m_J=new b2Jacobian;a.m_constant=null;a.m_ratio=null;a.m_mass=null;a.m_force=null;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){return new b2Vec2(this.m_force*this.m_J.linear2.x,this.m_force*this.m_J.linear2.y)};
a.GetReactionTorque=function(){var b=this.m_body2.m_xf.R,c=this.m_localAnchor1.x-this.m_body2.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_body2.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d;return this.m_force*this.m_J.angular2-(e*this.m_force*this.m_J.linear2.y-d*this.m_force*this.m_J.linear2.x)};a.GetRatio=function(){return this.m_ratio};
a.InitVelocityConstraints=function(b){var c=this.m_ground1,d=this.m_ground2,e=this.m_body1,f=this.m_body2,g,h,i,j,k,l=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angular1=-1,l+=e.m_invI):(j=c.m_xf.R,g=this.m_prismatic1.m_localXAxis1,c=j.col1.x*g.x+j.col2.x*g.y,g=j.col1.y*g.x+j.col2.y*g.y,j=e.m_xf.R,h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,k=j.col1.x*h+j.col2.x*i,i=j.col1.y*h+j.col2.y*i,j=k*g-i*c,this.m_J.linear1.Set(-c,-g),this.m_J.angular1=
-j,l+=e.m_invMass+e.m_invI*j*j);this.m_revolute2?(this.m_J.angular2=-this.m_ratio,l+=this.m_ratio*this.m_ratio*f.m_invI):(j=d.m_xf.R,g=this.m_prismatic2.m_localXAxis1,c=j.col1.x*g.x+j.col2.x*g.y,g=j.col1.y*g.x+j.col2.y*g.y,j=f.m_xf.R,h=this.m_localAnchor2.x-f.m_sweep.localCenter.x,i=this.m_localAnchor2.y-f.m_sweep.localCenter.y,k=j.col1.x*h+j.col2.x*i,i=j.col1.y*h+j.col2.y*i,j=k*g-i*c,this.m_J.linear2.Set(-this.m_ratio*c,-this.m_ratio*g),this.m_J.angular2=-this.m_ratio*j,l+=this.m_ratio*this.m_ratio*
(f.m_invMass+f.m_invI*j*j));this.m_mass=1/l;b.warmStarting?(b=b.dt*this.m_force,e.m_linearVelocity.x+=e.m_invMass*b*this.m_J.linear1.x,e.m_linearVelocity.y+=e.m_invMass*b*this.m_J.linear1.y,e.m_angularVelocity+=e.m_invI*b*this.m_J.angular1,f.m_linearVelocity.x+=f.m_invMass*b*this.m_J.linear2.x,f.m_linearVelocity.y+=f.m_invMass*b*this.m_J.linear2.y,f.m_angularVelocity+=f.m_invI*b*this.m_J.angular2):this.m_force=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e=this.m_J.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);e*=-b.inv_dt*this.m_mass;this.m_force+=e;b=b.dt*e;c.m_linearVelocity.x+=c.m_invMass*b*this.m_J.linear1.x;c.m_linearVelocity.y+=c.m_invMass*b*this.m_J.linear1.y;c.m_angularVelocity+=c.m_invI*b*this.m_J.angular1;d.m_linearVelocity.x+=d.m_invMass*b*this.m_J.linear2.x;d.m_linearVelocity.y+=d.m_invMass*b*this.m_J.linear2.y;d.m_angularVelocity+=
d.m_invI*b*this.m_J.angular2};
a.SolvePositionConstraints=function(){var b=this.m_body1,c=this.m_body2,d,e;d=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();e=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();d=-this.m_mass*(this.m_constant-(d+this.m_ratio*e));b.m_sweep.c.x+=b.m_invMass*d*this.m_J.linear1.x;b.m_sweep.c.y+=b.m_invMass*d*this.m_J.linear1.y;b.m_sweep.a+=b.m_invI*d*this.m_J.angular1;c.m_sweep.c.x+=c.m_invMass*d*this.m_J.linear2.x;c.m_sweep.c.y+=
c.m_invMass*d*this.m_J.linear2.y;c.m_sweep.a+=c.m_invI*d*this.m_J.angular2;b.SynchronizeTransform();c.SynchronizeTransform();return 0<b2Settings.b2_linearSlop};var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype);a=b2GearJointDef.prototype;a._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(){this.type=b2Joint.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};a.__varz=function(){};a.joint1=null;a.joint2=null;a.ratio=null;var b2BroadPhase=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2BroadPhase.prototype.__constructor=function(b,c){var d=0;this.m_pairManager.Initialize(this,c);this.m_worldAABB=b;for(d=this.m_proxyCount=0;d<b2Settings.b2_maxProxies;d++)this.m_queryResults[d]=0,this.m_querySortKeys[d]=0;this.m_bounds=Array(2);for(d=0;d<2;d++){this.m_bounds[d]=Array(2*b2Settings.b2_maxProxies);for(c=0;c<2*b2Settings.b2_maxProxies;c++)this.m_bounds[d][c]=new b2Bound}d=b.upperBound.y-b.lowerBound.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/(b.upperBound.x-b.lowerBound.x);
this.m_quantizationFactor.y=b2Settings.USHRT_MAX/d;for(d=0;d<b2Settings.b2_maxProxies-1;++d)b=new b2Proxy,this.m_proxyPool[d]=b,b.SetNext(d+1),b.timeStamp=0,b.overlapCount=b2BroadPhase.b2_invalid,b.userData=null;b=new b2Proxy;this.m_proxyPool[parseInt(b2Settings.b2_maxProxies-1)]=b;b.SetNext(b2Pair.b2_nullProxy);b.timeStamp=0;b.overlapCount=b2BroadPhase.b2_invalid;b.userData=null;this.m_freeProxy=0;this.m_timeStamp=1;this.m_queryResultCount=0};
b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager;this.m_proxyPool=Array(b2Settings.b2_maxPairs);this.m_bounds=Array(2*b2Settings.b2_maxProxies);this.m_querySortKeys=Array(b2Settings.b2_maxProxies);this.m_queryResults=Array(b2Settings.b2_maxProxies);this.m_quantizationFactor=new b2Vec2};b2BroadPhase.s_validate=!1;b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX;b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX;
b2BroadPhase.BinarySearch=function(b,c,d){var e=0;for(c-=1;e<=c;){var f=Math.round((e+c)/2),g=b[f];if(g.value>d)c=f-1;else if(g.value<d)e=f+1;else return parseInt(f)}return parseInt(e)};a=b2BroadPhase.prototype;a.m_pairManager=new b2PairManager;a.m_proxyPool=Array(b2Settings.b2_maxPairs);a.m_freeProxy=0;a.m_bounds=Array(2*b2Settings.b2_maxProxies);a.m_querySortKeys=Array(b2Settings.b2_maxProxies);a.m_queryResults=Array(b2Settings.b2_maxProxies);a.m_queryResultCount=0;a.m_worldAABB=null;
a.m_quantizationFactor=new b2Vec2;a.m_proxyCount=0;a.m_timeStamp=0;
a.ComputeBounds=function(b,c,d){var e=d.lowerBound.x,f=d.lowerBound.y;e=b2Math.b2Min(e,this.m_worldAABB.upperBound.x);f=b2Math.b2Min(f,this.m_worldAABB.upperBound.y);e=b2Math.b2Max(e,this.m_worldAABB.lowerBound.x);f=b2Math.b2Max(f,this.m_worldAABB.lowerBound.y);var g=d.upperBound.x;d=d.upperBound.y;g=b2Math.b2Min(g,this.m_worldAABB.upperBound.x);d=b2Math.b2Min(d,this.m_worldAABB.upperBound.y);g=b2Math.b2Max(g,this.m_worldAABB.lowerBound.x);d=b2Math.b2Max(d,this.m_worldAABB.lowerBound.y);b[0]=parseInt(this.m_quantizationFactor.x*
(e-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1;c[0]=parseInt(this.m_quantizationFactor.x*(g-this.m_worldAABB.lowerBound.x))%65535|1;b[1]=parseInt(this.m_quantizationFactor.y*(f-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1;c[1]=parseInt(this.m_quantizationFactor.y*(d-this.m_worldAABB.lowerBound.y))%65535|1};
a.TestOverlapValidate=function(b,c){for(var d=0;d<2;++d){var e=this.m_bounds[d],f=e[b.lowerBounds[d]],g=e[c.upperBounds[d]];if(f.value>g.value)return!1;f=e[b.upperBounds[d]];g=e[c.lowerBounds[d]];if(f.value<g.value)return!1}return!0};
a.Query=function(b,c,d,e,f,g,h){d=b2BroadPhase.BinarySearch(f,g,d);e=b2BroadPhase.BinarySearch(f,g,e);for(var i=d;i<e;++i)g=f[i],g.IsLower()&&this.IncrementOverlapCount(g.proxyId);if(d>0){i=d-1;g=f[i];for(var j=g.stabbingCount;j>0;)g=f[i],g.IsLower()&&d<=this.m_proxyPool[g.proxyId].upperBounds[h]&&(this.IncrementOverlapCount(g.proxyId),--j),--i}b[0]=d;c[0]=e};
a.IncrementOverlapCount=function(b){var c=this.m_proxyPool[b];c.timeStamp<this.m_timeStamp?(c.timeStamp=this.m_timeStamp,c.overlapCount=1):(c.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=b,++this.m_queryResultCount)};a.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var b=0;b<b2Settings.b2_maxProxies;++b)this.m_proxyPool[b].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp};
a.AddProxyResult=function(b,c,d,e){e=e(c.userData);if(!(e<0)){for(c=0;c<this.m_queryResultCount&&this.m_querySortKeys[c]<e;)c++;this.m_queryResultCount+=1;if(this.m_queryResultCount>d)this.m_queryResultCount=d;for(;c<this.m_queryResultCount;){d=this.m_querySortKeys[c];var f=this.m_queryResults[c];this.m_querySortKeys[c]=e;this.m_queryResults[c]=b;e=d;b=f;c++}}};
a.InRange=function(b){var c,d,e,f;c=b.lowerBound.x;d=b.lowerBound.y;c-=this.m_worldAABB.upperBound.x;d-=this.m_worldAABB.upperBound.y;e=this.m_worldAABB.lowerBound.x;f=this.m_worldAABB.lowerBound.y;e-=b.upperBound.x;f-=b.upperBound.y;c=b2Math.b2Max(c,e);d=b2Math.b2Max(d,f);return b2Math.b2Max(c,d)<0};a.GetProxy=function(b){var c=this.m_proxyPool[b];if(b==b2Pair.b2_nullProxy||c.IsValid()==!1)return null;return c};
a.CreateProxy=function(b,c){var d=0,e,f=this.m_freeProxy;e=this.m_proxyPool[f];this.m_freeProxy=e.GetNext();e.overlapCount=0;e.userData=c;c=2*this.m_proxyCount;e=[];var g=[];this.ComputeBounds(e,g,b);for(b=0;b<2;++b){var h=this.m_bounds[b],i=0,j=0;i=[i];j=[j];this.Query(i,j,e[b],g[b],h,c,b);i=i[0];j=j[0];var k=[],l=0,m=c-j,n;for(l=0;l<m;l++)k[l]=new b2Bound,n=k[l],d=h[parseInt(j+l)],n.value=d.value,n.proxyId=d.proxyId,n.stabbingCount=d.stabbingCount;m=k.length;var o=j+2;for(l=0;l<m;l++)d=k[l],n=h[parseInt(o+
l)],n.value=d.value,n.proxyId=d.proxyId,n.stabbingCount=d.stabbingCount;k=[];m=j-i;for(l=0;l<m;l++)k[l]=new b2Bound,n=k[l],d=h[parseInt(i+l)],n.value=d.value,n.proxyId=d.proxyId,n.stabbingCount=d.stabbingCount;m=k.length;o=i+1;for(l=0;l<m;l++)d=k[l],n=h[parseInt(o+l)],n.value=d.value,n.proxyId=d.proxyId,n.stabbingCount=d.stabbingCount;++j;n=h[i];d=h[j];n.value=e[b];n.proxyId=f;d.value=g[b];d.proxyId=f;k=h[parseInt(i-1)];n.stabbingCount=i==0?0:k.stabbingCount;k=h[parseInt(j-1)];d.stabbingCount=k.stabbingCount;
for(d=i;d<j;++d)k=h[d],k.stabbingCount++;for(d=i;d<c+2;++d)n=h[d],i=this.m_proxyPool[n.proxyId],n.IsLower()?i.lowerBounds[b]=d:i.upperBounds[b]=d}++this.m_proxyCount;for(c=0;c<this.m_queryResultCount;++c)this.m_pairManager.AddBufferedPair(f,this.m_queryResults[c]);this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();return f};
a.DestroyProxy=function(b){for(var c,d,e=this.m_proxyPool[b],f=2*this.m_proxyCount,g=0;g<2;++g){var h=this.m_bounds[g],i=e.lowerBounds[g],j=e.upperBounds[g];c=h[i];var k=c.value;d=h[j];var l=d.value,m=[],n=0,o=j-i-1;for(n=0;n<o;n++)m[n]=new b2Bound,c=m[n],d=h[parseInt(i+1+n)],c.value=d.value,c.proxyId=d.proxyId,c.stabbingCount=d.stabbingCount;o=m.length;var p=i;for(n=0;n<o;n++)d=m[n],c=h[parseInt(p+n)],c.value=d.value,c.proxyId=d.proxyId,c.stabbingCount=d.stabbingCount;m=[];o=f-j-1;for(n=0;n<o;n++)m[n]=
new b2Bound,c=m[n],d=h[parseInt(j+1+n)],c.value=d.value,c.proxyId=d.proxyId,c.stabbingCount=d.stabbingCount;o=m.length;p=j-1;for(n=0;n<o;n++)d=m[n],c=h[parseInt(p+n)],c.value=d.value,c.proxyId=d.proxyId,c.stabbingCount=d.stabbingCount;o=f-2;for(d=i;d<o;++d)c=h[d],m=this.m_proxyPool[c.proxyId],c.IsLower()?m.lowerBounds[g]=d:m.upperBounds[g]=d;for(o=j-1;i<o;++i)c=h[i],c.stabbingCount--;this.Query([0],[0],k,l,h,f-2,g)}for(c=0;c<this.m_queryResultCount;++c)this.m_pairManager.RemoveBufferedPair(b,this.m_queryResults[c]);
this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();e.userData=null;e.overlapCount=b2BroadPhase.b2_invalid;e.lowerBounds[0]=b2BroadPhase.b2_invalid;e.lowerBounds[1]=b2BroadPhase.b2_invalid;e.upperBounds[0]=b2BroadPhase.b2_invalid;e.upperBounds[1]=b2BroadPhase.b2_invalid;e.SetNext(this.m_freeProxy);this.m_freeProxy=b;--this.m_proxyCount};
a.MoveProxy=function(b,c){var d,e,f=0,g=0,h;if(!(b==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=b)&&c.IsValid()!=!1){var i=2*this.m_proxyCount,j=this.m_proxyPool[b],k=new b2BoundValues;this.ComputeBounds(k.lowerValues,k.upperValues,c);var l=new b2BoundValues;for(f=0;f<2;++f)c=this.m_bounds[f][j.lowerBounds[f]],l.lowerValues[f]=c.value,c=this.m_bounds[f][j.upperBounds[f]],l.upperValues[f]=c.value;for(f=0;f<2;++f){var m=this.m_bounds[f],n=j.lowerBounds[f],o=j.upperBounds[f],p=k.lowerValues[f],q=
k.upperValues[f];c=m[n];var r=p-c.value;c.value=p;c=m[o];var u=q-c.value;c.value=q;if(r<0)for(g=n;g>0&&p<m[parseInt(g-1)].value;)c=m[g],h=m[parseInt(g-1)],d=h.proxyId,e=this.m_proxyPool[h.proxyId],h.stabbingCount++,h.IsUpper()==!0?(this.TestOverlap(k,e)&&this.m_pairManager.AddBufferedPair(b,d),d=e.upperBounds,e=d[f],e++,d[f]=e,c.stabbingCount++):(d=e.lowerBounds,e=d[f],e++,d[f]=e,c.stabbingCount--),d=j.lowerBounds,e=d[f],e--,d[f]=e,c.Swap(h),--g;if(u>0)for(g=o;g<i-1&&m[parseInt(g+1)].value<=q;)c=
m[g],h=m[parseInt(g+1)],d=h.proxyId,e=this.m_proxyPool[d],h.stabbingCount++,h.IsLower()==!0?(this.TestOverlap(k,e)&&this.m_pairManager.AddBufferedPair(b,d),d=e.lowerBounds,e=d[f],e--,d[f]=e,c.stabbingCount++):(d=e.upperBounds,e=d[f],e--,d[f]=e,c.stabbingCount--),d=j.upperBounds,e=d[f],e++,d[f]=e,c.Swap(h),g++;if(r>0)for(g=n;g<i-1&&m[parseInt(g+1)].value<=p;)c=m[g],h=m[parseInt(g+1)],d=h.proxyId,e=this.m_proxyPool[d],h.stabbingCount--,h.IsUpper()?(this.TestOverlap(l,e)&&this.m_pairManager.RemoveBufferedPair(b,
d),d=e.upperBounds,e=d[f],e--,d[f]=e,c.stabbingCount--):(d=e.lowerBounds,e=d[f],e--,d[f]=e,c.stabbingCount++),d=j.lowerBounds,e=d[f],e++,d[f]=e,c.Swap(h),g++;if(u<0)for(g=o;g>0&&q<m[parseInt(g-1)].value;)c=m[g],h=m[parseInt(g-1)],d=h.proxyId,e=this.m_proxyPool[d],h.stabbingCount--,h.IsLower()==!0?(this.TestOverlap(l,e)&&this.m_pairManager.RemoveBufferedPair(b,d),d=e.lowerBounds,e=d[f],e++,d[f]=e,c.stabbingCount--):(d=e.upperBounds,e=d[f],e++,d[f]=e,c.stabbingCount++),d=j.upperBounds,e=d[f],e--,d[f]=
e,c.Swap(h),g--}}};a.Commit=function(){this.m_pairManager.Commit()};a.QueryAABB=function(b,c,d){var e=[],f=[];this.ComputeBounds(e,f,b);b=[0];var g=[0];this.Query(b,g,e[0],f[0],this.m_bounds[0],2*this.m_proxyCount,0);this.Query(b,g,e[1],f[1],this.m_bounds[1],2*this.m_proxyCount,1);for(f=e=0;f<this.m_queryResultCount&&e<d;++f,++e)c[f]=this.m_proxyPool[this.m_queryResults[f]].userData;this.m_queryResultCount=0;this.IncrementTimeStamp();return e};
a.Validate=function(){for(var b=0;b<2;++b)for(var c=this.m_bounds[b],d=2*this.m_proxyCount,e=0,f=0;f<d;++f)c[f].IsLower()==!0?e++:e--};
a.QuerySegment=function(b,c,d,e){var f=(b.p2.x-b.p1.x)*this.m_quantizationFactor.x,g=(b.p2.y-b.p1.y)*this.m_quantizationFactor.y,h=f<-Number.MIN_VALUE?-1:f>Number.MIN_VALUE?1:0,i=g<-Number.MIN_VALUE?-1:g>Number.MIN_VALUE?1:0,j=this.m_quantizationFactor.x*(b.p1.x-this.m_worldAABB.lowerBound.x);b=this.m_quantizationFactor.y*(b.p1.y-this.m_worldAABB.lowerBound.y);var k=[],l=[];k[0]=parseInt(j)&b2Settings.USHRT_MAX-1;k[1]=parseInt(b)&b2Settings.USHRT_MAX-1;l[0]=k[0]+1;l[1]=k[1]+1;var m=0,n=0,o=0;n=[0];
o=[0];this.Query(n,o,k[0],l[0],this.m_bounds[0],2*this.m_proxyCount,0);m=h>=0?o[0]-1:n[0];this.Query(n,o,k[1],l[1],this.m_bounds[1],2*this.m_proxyCount,1);n=i>=0?o[0]-1:n[0];if(e!=null){for(k=0;k<this.m_queryResultCount;k++)this.m_querySortKeys[k]=e(this.m_proxyPool[this.m_queryResults[k]].userData);for(k=0;k<this.m_queryResultCount-1;)l=this.m_querySortKeys[k],o=this.m_querySortKeys[k+1],(l<0?o>=0:l>o&&o>=0)?(this.m_querySortKeys[k+1]=l,this.m_querySortKeys[k]=o,l=this.m_queryResults[k+1],this.m_queryResults[k+
1]=this.m_queryResults[k],this.m_queryResults[k]=l,k--,k==-1&&(k=1)):k++;for(;this.m_queryResultCount>0&&this.m_querySortKeys[this.m_queryResultCount-1]<0;)this.m_queryResultCount--}k=!0;var p,q;if(m<0||m>=this.m_proxyCount*2)k=!1;if(n<0||n>=this.m_proxyCount*2)k=!1;k&&(h!=0&&(h>0?(m++,m==this.m_proxyCount*2&&(k=!1)):(m--,m<0&&(k=!1)),p=(this.m_bounds[0][m].value-j)/f),i!=0&&(i>0?(n++,n==this.m_proxyCount*2&&(k=!1)):(n--,n<0&&(k=!1)),q=(this.m_bounds[1][n].value-b)/g));for(;k;)if(i==0||h!=0&&p<q){if(p>
1)break;if(h>0?this.m_bounds[0][m].IsLower():this.m_bounds[0][m].IsUpper())o=this.m_bounds[0][m].proxyId,l=this.m_proxyPool[o],i>=0?l.lowerBounds[1]<=n-1&&l.upperBounds[1]>=n&&(e!=null?this.AddProxyResult(o,l,d,e):(this.m_queryResults[this.m_queryResultCount]=o,++this.m_queryResultCount)):l.lowerBounds[1]<=n&&l.upperBounds[1]>=n+1&&(e!=null?this.AddProxyResult(o,l,d,e):(this.m_queryResults[this.m_queryResultCount]=o,++this.m_queryResultCount));if(e!=null&&this.m_queryResultCount==d&&this.m_queryResultCount>
0&&p>this.m_querySortKeys[this.m_queryResultCount-1])break;if(h>0){if(m++,m==this.m_proxyCount*2)break}else if(m--,m<0)break;p=(this.m_bounds[0][m].value-j)/f}else{if(q>1)break;if(i>0?this.m_bounds[1][n].IsLower():this.m_bounds[1][n].IsUpper())o=this.m_bounds[1][n].proxyId,l=this.m_proxyPool[o],h>=0?l.lowerBounds[0]<=m-1&&l.upperBounds[0]>=m&&(e!=null?this.AddProxyResult(o,l,d,e):(this.m_queryResults[this.m_queryResultCount]=o,++this.m_queryResultCount)):l.lowerBounds[0]<=m&&l.upperBounds[0]>=m+1&&
(e!=null?this.AddProxyResult(o,l,d,e):(this.m_queryResults[this.m_queryResultCount]=o,++this.m_queryResultCount));if(e!=null&&this.m_queryResultCount==d&&this.m_queryResultCount>0&&q>this.m_querySortKeys[this.m_queryResultCount-1])break;if(i>0){if(n++,n==this.m_proxyCount*2)break}else if(n--,n<0)break;q=(this.m_bounds[1][n].value-b)/g}for(k=e=0;k<this.m_queryResultCount&&e<d;++k,++e)l=this.m_proxyPool[this.m_queryResults[k]],c[k]=l.userData;this.m_queryResultCount=0;this.IncrementTimeStamp();return e};
a.TestOverlap=function(b,c){for(var d=0;d<2;++d){var e=this.m_bounds[d],f=e[c.upperBounds[d]];if(b.lowerValues[d]>f.value)return!1;f=e[c.lowerBounds[d]];if(b.upperValues[d]<f.value)return!1}return!0};var b2TimeOfImpact=function(){this.__varz();this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){};b2TimeOfImpact.prototype.__varz=function(){};b2TimeOfImpact.s_p1=new b2Vec2;b2TimeOfImpact.s_p2=new b2Vec2;b2TimeOfImpact.s_xf1=new b2XForm;b2TimeOfImpact.s_xf2=new b2XForm;
b2TimeOfImpact.TimeOfImpact=function(b,c,d,e){var f,g,h=b.m_sweepRadius,i=d.m_sweepRadius,j=c.t0,k=c.c.x-c.c0.x,l=c.c.y-c.c0.y,m=e.c.x-e.c0.x,n=e.c.y-e.c0.y,o=c.a-c.a0,p=e.a-e.a0,q=0,r=b2TimeOfImpact.s_p1,u=b2TimeOfImpact.s_p2,z=0,y=0,s=0;for(f=0;;){s=(1-q)*j+q;g=b2TimeOfImpact.s_xf1;y=b2TimeOfImpact.s_xf2;c.GetXForm(g,s);e.GetXForm(y,s);s=b2Distance.Distance(r,u,b,g,d,y);z==0&&(s>2*b2Settings.b2_toiSlop?f=1.5*b2Settings.b2_toiSlop:(f=0.05*b2Settings.b2_toiSlop,g=s-0.5*b2Settings.b2_toiSlop,f=f>g?
f:g));if(s-f<0.05*b2Settings.b2_toiSlop||z==20)break;g=u.x-r.x;y=u.y-r.y;var v=Math.sqrt(g*g+y*y);g/=v;y/=v;g=g*(k-m)+y*(l-n)+(o<0?-o:o)*h+(p<0?-p:p)*i;if(g==0){q=1;break}s=q+(s-f)/g;if(s<0||1<s){q=1;break}if(s<(1+100*Number.MIN_VALUE)*q)break;q=s;++z}return q};var b2ShapeDef=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ShapeDef.prototype;a.__constructor=function(){};a.__varz=function(){this.type=b2Shape.e_unknownShape;this.filter=new b2FilterData};a.type=b2Shape.e_unknownShape;
a.userData=null;a.friction=0.2;a.restitution=0;a.density=0;a.isSensor=!1;a.filter=new b2FilterData;var b2PolygonDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonDef.prototype,b2ShapeDef.prototype);b2PolygonDef.prototype._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};
b2PolygonDef.prototype.__constructor=function(){this.type=b2Shape.e_polygonShape;for(var b=this.vertexCount=0;b<b2Settings.b2_maxPolygonVertices;b++)this.vertices[b]=new b2Vec2};b2PolygonDef.prototype.__varz=function(){this.vertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonDef.s_mat=new b2Mat22;b2PolygonDef.prototype.vertices=Array(b2Settings.b2_maxPolygonVertices);b2PolygonDef.prototype.vertexCount=0;
b2PolygonDef.prototype.SetAsBox=function(b,c){this.vertexCount=4;this.vertices[0].Set(-b,-c);this.vertices[1].Set(b,-c);this.vertices[2].Set(b,c);this.vertices[3].Set(-b,c)};
b2PolygonDef.prototype.SetAsOrientedBox=function(b,c,d,e){this.vertexCount=4;this.vertices[0].Set(-b,-c);this.vertices[1].Set(b,-c);this.vertices[2].Set(b,c);this.vertices[3].Set(-b,c);if(d){c=d;var f=b2PolygonDef.s_mat;f.Set(e);for(e=0;e<this.vertexCount;++e)d=this.vertices[e],b=c.x+(f.col1.x*d.x+f.col2.x*d.y),d.y=c.y+(f.col1.y*d.x+f.col2.y*d.y),d.x=b}};var b2Contact=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Contact.prototype.__constructor=function(b,c){this.m_flags=0;if(!b||!c)this.m_shape2=this.m_shape1=null;else{if(b.IsSensor()||c.IsSensor())this.m_flags|=b2Contact.e_nonSolidFlag;this.m_shape1=b;this.m_shape2=c;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_next=this.m_prev=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;
this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null}};b2Contact.prototype.__varz=function(){this.m_node1=new b2ContactEdge;this.m_node2=new b2ContactEdge};b2Contact.e_nonSolidFlag=1;b2Contact.e_slowFlag=2;b2Contact.e_islandFlag=4;b2Contact.e_toiFlag=8;b2Contact.s_registers=null;b2Contact.s_initialized=!1;
b2Contact.AddType=function(b,c,d,e){b2Contact.s_registers[d][e].createFcn=b;b2Contact.s_registers[d][e].destroyFcn=c;b2Contact.s_registers[d][e].primary=!0;if(d!=e)b2Contact.s_registers[e][d].createFcn=b,b2Contact.s_registers[e][d].destroyFcn=c,b2Contact.s_registers[e][d].primary=!1};
b2Contact.InitializeRegisters=function(){b2Contact.s_registers=Array(b2Shape.e_shapeTypeCount);for(var b=0;b<b2Shape.e_shapeTypeCount;b++){b2Contact.s_registers[b]=Array(b2Shape.e_shapeTypeCount);for(var c=0;c<b2Shape.e_shapeTypeCount;c++)b2Contact.s_registers[b][c]=new b2ContactRegister}b2Contact.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,
b2Shape.e_circleShape);b2Contact.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape)};b2Contact.Create=function(b,c,d){if(b2Contact.s_initialized==!1)b2Contact.InitializeRegisters(),b2Contact.s_initialized=!0;var e=b2Contact.s_registers[b.m_type][c.m_type],f=e.createFcn;if(f!=null)if(e.primary)return f(b,c,d);else{b=f(c,b,d);for(c=0;c<b.m_manifoldCount;++c)d=b.GetManifolds()[c],d.normal=d.normal.Negative();return b}else return null};
b2Contact.Destroy=function(b,c){b.m_manifoldCount>0&&(b.m_shape1.m_body.WakeUp(),b.m_shape2.m_body.WakeUp());var d=b2Contact.s_registers[b.m_shape1.m_type][b.m_shape2.m_type].destroyFcn;d(b,c)};a=b2Contact.prototype;a.m_flags=0;a.m_prev=null;a.m_next=null;a.m_node1=new b2ContactEdge;a.m_node2=new b2ContactEdge;a.m_shape1=null;a.m_shape2=null;a.m_manifoldCount=0;a.m_friction=null;a.m_restitution=null;a.m_toi=null;a.GetManifolds=function(){return null};a.GetManifoldCount=function(){return this.m_manifoldCount};
a.IsSolid=function(){return(this.m_flags&b2Contact.e_nonSolidFlag)==0};a.GetNext=function(){return this.m_next};a.GetShape1=function(){return this.m_shape1};a.GetShape2=function(){return this.m_shape2};a.Update=function(b){var c=this.m_manifoldCount;this.Evaluate(b);b=this.m_shape1.m_body;var d=this.m_shape2.m_body;this.m_manifoldCount==0&&c>0&&(b.WakeUp(),d.WakeUp());b.IsStatic()||b.IsBullet()||d.IsStatic()||d.IsBullet()?this.m_flags&=~b2Contact.e_slowFlag:this.m_flags|=b2Contact.e_slowFlag};
a.Evaluate=function(){};var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype);a=b2DistanceJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_length=b.length;this.m_frequencyHz=b.frequencyHz;this.m_dampingRatio=b.dampingRatio;this.m_inv_dt=this.m_bias=this.m_gamma=this.m_impulse=0};a.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u=new b2Vec2};a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_u=new b2Vec2;a.m_frequencyHz=null;a.m_dampingRatio=null;
a.m_gamma=null;a.m_bias=null;a.m_impulse=null;a.m_mass=null;a.m_length=null;
a.InitVelocityConstraints=function(b){var c,d;this.m_inv_dt=b.inv_dt;var e=this.m_body1,f=this.m_body2;c=e.m_xf.R;var g=this.m_localAnchor1.x-e.m_sweep.localCenter.x,h=this.m_localAnchor1.y-e.m_sweep.localCenter.y;d=c.col1.x*g+c.col2.x*h;h=c.col1.y*g+c.col2.y*h;g=d;c=f.m_xf.R;var i=this.m_localAnchor2.x-f.m_sweep.localCenter.x,j=this.m_localAnchor2.y-f.m_sweep.localCenter.y;d=c.col1.x*i+c.col2.x*j;j=c.col1.y*i+c.col2.y*j;i=d;this.m_u.x=f.m_sweep.c.x+i-e.m_sweep.c.x-g;this.m_u.y=f.m_sweep.c.y+j-e.m_sweep.c.y-
h;d=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);d>b2Settings.b2_linearSlop?this.m_u.Multiply(1/d):this.m_u.SetZero();c=g*this.m_u.y-h*this.m_u.x;var k=i*this.m_u.y-j*this.m_u.x;c=e.m_invMass+e.m_invI*c*c+f.m_invMass+f.m_invI*k*k;this.m_mass=1/c;if(this.m_frequencyHz>0){d-=this.m_length;k=2*Math.PI*this.m_frequencyHz;var l=this.m_mass*k*k;this.m_gamma=1/(b.dt*(2*this.m_mass*this.m_dampingRatio*k+b.dt*l));this.m_bias=d*b.dt*l*this.m_gamma;this.m_mass=1/(c+this.m_gamma)}b.warmStarting?(this.m_impulse*=
b.dtRatio,b=this.m_impulse*this.m_u.x,c=this.m_impulse*this.m_u.y,e.m_linearVelocity.x-=e.m_invMass*b,e.m_linearVelocity.y-=e.m_invMass*c,e.m_angularVelocity-=e.m_invI*(g*c-h*b),f.m_linearVelocity.x+=f.m_invMass*b,f.m_linearVelocity.y+=f.m_invMass*c,f.m_angularVelocity+=f.m_invI*(i*c-j*b)):this.m_impulse=0};
a.SolveVelocityConstraints=function(){var b,c=this.m_body1,d=this.m_body2;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f;e=g;b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i;i=b.col1.y*h+b.col2.y*i;h=g;g=-this.m_mass*(this.m_u.x*(d.m_linearVelocity.x+-d.m_angularVelocity*i-(c.m_linearVelocity.x+-c.m_angularVelocity*
f))+this.m_u.y*(d.m_linearVelocity.y+d.m_angularVelocity*h-(c.m_linearVelocity.y+c.m_angularVelocity*e))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=g;b=g*this.m_u.x;g*=this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*b;c.m_linearVelocity.y-=c.m_invMass*g;c.m_angularVelocity-=c.m_invI*(e*g-f*b);d.m_linearVelocity.x+=d.m_invMass*b;d.m_linearVelocity.y+=d.m_invMass*g;d.m_angularVelocity+=d.m_invI*(h*g-i*b)};
a.SolvePositionConstraints=function(){var b;if(this.m_frequencyHz>0)return!0;var c=this.m_body1,d=this.m_body2;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f;e=g;b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i;i=b.col1.y*h+b.col2.y*i;h=g;g=d.m_sweep.c.x+h-c.m_sweep.c.x-e;var j=d.m_sweep.c.y+i-c.m_sweep.c.y-
f;b=Math.sqrt(g*g+j*j);g/=b;j/=b;b-=this.m_length;b=b2Math.b2Clamp(b,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var k=-this.m_mass*b;this.m_u.Set(g,j);g=k*this.m_u.x;j=k*this.m_u.y;c.m_sweep.c.x-=c.m_invMass*g;c.m_sweep.c.y-=c.m_invMass*j;c.m_sweep.a-=c.m_invI*(e*j-f*g);d.m_sweep.c.x+=d.m_invMass*g;d.m_sweep.c.y+=d.m_invMass*j;d.m_sweep.a+=d.m_invI*(h*j-i*g);c.SynchronizeTransform();d.SynchronizeTransform();return b2Math.b2Abs(b)<b2Settings.b2_linearSlop};a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};
a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){var b=new b2Vec2;b.SetV(this.m_u);b.Multiply(this.m_inv_dt*this.m_impulse);return b};a.GetReactionTorque=function(){return 0};var b2Body=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Body.prototype.__constructor=function(b,c){this.m_flags=0;b.isBullet&&(this.m_flags|=b2Body.e_bulletFlag);b.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag);b.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag);b.isSleeping&&(this.m_flags|=b2Body.e_sleepFlag);this.m_world=c;this.m_xf.position.SetV(b.position);this.m_xf.R.Set(b.angle);this.m_sweep.localCenter.SetV(b.massData.center);this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=b.angle;c=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=
c.col1.x*d.x+c.col2.x*d.y;this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_next=this.m_prev=this.m_contactList=this.m_jointList=null;this.m_linearDamping=b.linearDamping;this.m_angularDamping=b.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_linearVelocity.SetZero();this.m_invI=this.m_I=this.m_invMass=this.m_sleepTime=this.m_angularVelocity=0;this.m_mass=b.massData.mass;
if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=b.massData.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;this.m_userData=b.userData;this.m_shapeList=null;this.m_shapeCount=0};b2Body.prototype.__varz=function(){this.m_xf=new b2XForm;this.m_sweep=new b2Sweep;this.m_linearVelocity=new b2Vec2;this.m_force=new b2Vec2};b2Body.e_frozenFlag=2;b2Body.e_islandFlag=4;
b2Body.e_sleepFlag=8;b2Body.e_allowSleepFlag=16;b2Body.e_bulletFlag=32;b2Body.e_fixedRotationFlag=64;b2Body.e_staticType=1;b2Body.e_dynamicType=2;b2Body.e_maxTypes=3;b2Body.s_massData=new b2MassData;b2Body.s_xf1=new b2XForm;a=b2Body.prototype;a.m_flags=0;a.m_type=0;a.m_xf=new b2XForm;a.m_sweep=new b2Sweep;a.m_linearVelocity=new b2Vec2;a.m_angularVelocity=null;a.m_force=new b2Vec2;a.m_torque=null;a.m_world=null;a.m_prev=null;a.m_next=null;a.m_shapeList=null;a.m_shapeCount=0;a.m_jointList=null;
a.m_contactList=null;a.m_mass=null;a.m_invMass=null;a.m_I=null;a.m_invI=null;a.m_linearDamping=null;a.m_angularDamping=null;a.m_sleepTime=null;a.m_userData=null;a.CreateShape=function(b){if(this.m_world.m_lock==!0)return null;b=b2Shape.Create(b,this.m_world.m_blockAllocator);b.m_next=this.m_shapeList;this.m_shapeList=b;++this.m_shapeCount;b.m_body=this;b.CreateProxy(this.m_world.m_broadPhase,this.m_xf);b.UpdateSweepRadius(this.m_sweep.localCenter);return b};
a.DestroyShape=function(b){if(this.m_world.m_lock!=!0){b.DestroyProxy(this.m_world.m_broadPhase);for(var c=this.m_shapeList;c!=null;){if(c==b)break;c=c.m_next}b.m_body=null;b.m_next=null;--this.m_shapeCount;b2Shape.Destroy(b,this.m_world.m_blockAllocator)}};
a.SetMass=function(b){if(this.m_world.m_lock!=!0){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=b.mass;if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=b.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_sweep.localCenter.SetV(b.center);b=this.m_xf.R;var c=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*c.x+b.col2.x*c.y;this.m_sweep.c.y=b.col1.y*c.x+b.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);
for(b=this.m_shapeList;b;b=b.m_next)b.UpdateSweepRadius(this.m_sweep.localCenter);b=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(b!=this.m_type)for(b=this.m_shapeList;b;b=b.m_next)b.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}};
a.SetMassFromShapes=function(){var b;if(this.m_world.m_lock!=!0){var c=this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,d=0,e=b2Body.s_massData;for(b=this.m_shapeList;b;b=b.m_next)b.ComputeMass(e),this.m_mass+=e.mass,c+=e.mass*e.center.x,d+=e.mass*e.center.y,this.m_I+=e.I;if(this.m_mass>0)this.m_invMass=1/this.m_mass,c*=this.m_invMass,d*=this.m_invMass;this.m_I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(c*c+d*d),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;this.m_sweep.localCenter.Set(c,
d);b=this.m_xf.R;c=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*c.x+b.col2.x*c.y;this.m_sweep.c.y=b.col1.y*c.x+b.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);for(b=this.m_shapeList;b;b=b.m_next)b.UpdateSweepRadius(this.m_sweep.localCenter);b=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(b!=this.m_type)for(b=this.m_shapeList;b;b=b.m_next)b.RefilterProxy(this.m_world.m_broadPhase,
this.m_xf)}};
a.SetXForm=function(b,c){if(this.m_world.m_lock==!0)return!0;if(this.IsFrozen())return!1;this.m_xf.R.Set(c);this.m_xf.position.SetV(b);b=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*d.x+b.col2.x*d.y;this.m_sweep.c.y=b.col1.y*d.x+b.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=c;b=!1;for(c=this.m_shapeList;c;c=c.m_next)if(c.Synchronize(this.m_world.m_broadPhase,this.m_xf,
this.m_xf)==!1){b=!0;break}if(b==!0){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(c=this.m_shapeList;c;c=c.m_next)c.DestroyProxy(this.m_world.m_broadPhase);return!1}this.m_world.m_broadPhase.Commit();return!0};a.GetXForm=function(){return this.m_xf};a.GetPosition=function(){return this.m_xf.position};a.GetAngle=function(){return this.m_sweep.a};a.GetWorldCenter=function(){return this.m_sweep.c};a.GetLocalCenter=function(){return this.m_sweep.localCenter};
a.SetLinearVelocity=function(b){this.m_linearVelocity.SetV(b)};a.GetLinearVelocity=function(){return this.m_linearVelocity};a.SetAngularVelocity=function(b){this.m_angularVelocity=b};a.GetAngularVelocity=function(){return this.m_angularVelocity};a.ApplyForce=function(b,c){this.IsSleeping()&&this.WakeUp();this.m_force.x+=b.x;this.m_force.y+=b.y;this.m_torque+=(c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x};a.ApplyTorque=function(b){this.IsSleeping()&&this.WakeUp();this.m_torque+=b};
a.ApplyImpulse=function(b,c){this.IsSleeping()&&this.WakeUp();this.m_linearVelocity.x+=this.m_invMass*b.x;this.m_linearVelocity.y+=this.m_invMass*b.y;this.m_angularVelocity+=this.m_invI*((c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x)};a.GetMass=function(){return this.m_mass};a.GetInertia=function(){return this.m_I};a.GetWorldPoint=function(b){var c=this.m_xf.R;b=new b2Vec2(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;return b};
a.GetWorldVector=function(b){return b2Math.b2MulMV(this.m_xf.R,b)};a.GetLocalPoint=function(b){return b2Math.b2MulXT(this.m_xf,b)};a.GetLocalVector=function(b){return b2Math.b2MulTMV(this.m_xf.R,b)};a.GetLinearVelocityFromWorldPoint=function(b){return new b2Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(b.x-this.m_sweep.c.x))};
a.GetLinearVelocityFromLocalPoint=function(b){var c=this.m_xf.R;b=new b2Vec2(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;return new b2Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(b.x-this.m_sweep.c.x))};a.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag};
a.SetBullet=function(b){b?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag};a.IsStatic=function(){return this.m_type==b2Body.e_staticType};a.IsDynamic=function(){return this.m_type==b2Body.e_dynamicType};a.IsFrozen=function(){return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag};a.IsSleeping=function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag};
a.AllowSleeping=function(b){b?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.WakeUp())};a.WakeUp=function(){this.m_flags&=~b2Body.e_sleepFlag;this.m_sleepTime=0};a.PutToSleep=function(){this.m_flags|=b2Body.e_sleepFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0};a.GetShapeList=function(){return this.m_shapeList};a.GetJointList=function(){return this.m_jointList};a.GetNext=function(){return this.m_next};
a.GetUserData=function(){return this.m_userData};a.SetUserData=function(b){this.m_userData=b};a.GetWorld=function(){return this.m_world};
a.SynchronizeShapes=function(){var b=b2Body.s_xf1;b.R.Set(this.m_sweep.a0);var c=b.R,d=this.m_sweep.localCenter;b.position.x=this.m_sweep.c0.x-(c.col1.x*d.x+c.col2.x*d.y);b.position.y=this.m_sweep.c0.y-(c.col1.y*d.x+c.col2.y*d.y);d=!0;for(c=this.m_shapeList;c;c=c.m_next)if(d=c.Synchronize(this.m_world.m_broadPhase,b,this.m_xf),d==!1)break;if(d==!1){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(c=this.m_shapeList;c;c=c.m_next)c.DestroyProxy(this.m_world.m_broadPhase);
return!1}return!0};a.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var b=this.m_xf.R,c=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(b.col1.x*c.x+b.col2.x*c.y);this.m_xf.position.y=this.m_sweep.c.y-(b.col1.y*c.x+b.col2.y*c.y)};a.IsConnected=function(b){for(var c=this.m_jointList;c;c=c.next)if(c.other==b)return c.joint.m_collideConnected==!1;return!1};
a.Advance=function(b){this.m_sweep.Advance(b);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};var b2ContactFilter=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){};b2ContactFilter.prototype.__varz=function(){};b2ContactFilter.b2_defaultFilter=new b2ContactFilter;
b2ContactFilter.prototype.ShouldCollide=function(b,c){b=b.GetFilterData();c=c.GetFilterData();if(b.groupIndex==c.groupIndex&&b.groupIndex!=0)return b.groupIndex>0;return(b.maskBits&c.categoryBits)!=0&&(b.categoryBits&c.maskBits)!=0};b2ContactFilter.prototype.RayCollide=function(b,c){if(!b)return!0;return this.ShouldCollide(b,c)};var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype);
b2PolygonShape.prototype._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};
b2PolygonShape.prototype.__constructor=function(b){this._super(b);this.m_type=b2Shape.e_polygonShape;this.m_vertexCount=b.vertexCount;var c=0,d=c,e=c;for(c=0;c<this.m_vertexCount;++c)this.m_vertices[c]=b.vertices[c].Copy();for(c=0;c<this.m_vertexCount;++c){d=c;e=c+1<this.m_vertexCount?c+1:0;var f=this.m_vertices[e].x-this.m_vertices[d].x;d=this.m_vertices[e].y-this.m_vertices[d].y;e=Math.sqrt(f*f+d*d);this.m_normals[c]=new b2Vec2(d/e,-f/e)}this.m_centroid=b2PolygonShape.ComputeCentroid(b.vertices,
b.vertexCount);b2PolygonShape.ComputeOBB(this.m_obb,this.m_vertices,this.m_vertexCount);for(c=0;c<this.m_vertexCount;++c){d=c-1>=0?c-1:this.m_vertexCount-1;e=c;b=this.m_normals[d].x;f=this.m_normals[d].y;d=this.m_normals[e].x;e=this.m_normals[e].y;var g=this.m_vertices[c].x-this.m_centroid.x,h=this.m_vertices[c].y-this.m_centroid.y,i=b*g+f*h-b2Settings.b2_toiSlop;g=d*g+e*h-b2Settings.b2_toiSlop;h=1/(b*e-f*d);this.m_coreVertices[c]=new b2Vec2(h*(e*i-f*g)+this.m_centroid.x,h*(b*g-d*i)+this.m_centroid.y)}};
b2PolygonShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2;this.m_obb=new b2OBB;this.m_vertices=Array(b2Settings.b2_maxPolygonVertices);this.m_normals=Array(b2Settings.b2_maxPolygonVertices);this.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonShape.s_computeMat=new b2Mat22;b2PolygonShape.s_sweptAABB1=new b2AABB;b2PolygonShape.s_sweptAABB2=new b2AABB;
b2PolygonShape.ComputeCentroid=function(b,c){for(var d=new b2Vec2,e=0,f=1/3,g=0;g<c;++g){var h=b[g],i=g+1<c?b[parseInt(g+1)]:b[0],j=0.5*((h.x-0)*(i.y-0)-(h.y-0)*(i.x-0));e+=j;d.x+=j*f*(0+h.x+i.x);d.y+=j*f*(0+h.y+i.y)}d.x*=1/e;d.y*=1/e;return d};
b2PolygonShape.ComputeOBB=function(b,c,d){var e=0,f=Array(b2Settings.b2_maxPolygonVertices+1);for(e=0;e<d;++e)f[e]=c[e];f[d]=f[0];c=Number.MAX_VALUE;for(e=1;e<=d;++e){var g=f[parseInt(e-1)],h=f[e].x-g.x,i=f[e].y-g.y,j=Math.sqrt(h*h+i*i);h/=j;i/=j;for(var k=-i,l=h,m=j=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=-Number.MAX_VALUE,p=0;p<d;++p){var q=f[p].x-g.x,r=f[p].y-g.y,u=h*q+i*r;q=k*q+l*r;u<j&&(j=u);q<m&&(m=q);u>n&&(n=u);q>o&&(o=q)}p=(n-j)*(o-m);if(p<0.95*c)c=p,b.R.col1.x=h,b.R.col1.y=i,b.R.col2.x=k,
b.R.col2.y=l,h=0.5*(j+n),i=0.5*(m+o),k=b.R,b.center.x=g.x+(k.col1.x*h+k.col2.x*i),b.center.y=g.y+(k.col1.y*h+k.col2.y*i),b.extents.x=0.5*(n-j),b.extents.y=0.5*(o-m)}};a=b2PolygonShape.prototype;a.s_supportVec=new b2Vec2;a.m_centroid=null;a.m_obb=new b2OBB;a.m_vertices=Array(b2Settings.b2_maxPolygonVertices);a.m_normals=Array(b2Settings.b2_maxPolygonVertices);a.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices);a.m_vertexCount=0;
a.TestPoint=function(b,c){var d;d=b.R;var e=c.x-b.position.x;b=c.y-b.position.y;c=e*d.col1.x+b*d.col1.y;for(var f=e*d.col2.x+b*d.col2.y,g=0;g<this.m_vertexCount;++g)if(d=this.m_vertices[g],e=c-d.x,b=f-d.y,d=this.m_normals[g],d.x*e+d.y*b>0)return!1;return!0};
a.TestSegment=function(b,c,d,e,f){var g=0,h,i,j,k;h=e.p1.x-b.position.x;i=e.p1.y-b.position.y;j=b.R;var l=h*j.col1.x+i*j.col1.y,m=h*j.col2.x+i*j.col2.y;h=e.p2.x-b.position.x;i=e.p2.y-b.position.y;j=b.R;e=h*j.col1.x+i*j.col1.y-l;j=h*j.col2.x+i*j.col2.y-m;for(var n=-1,o=0;o<this.m_vertexCount;++o)if(k=this.m_vertices[o],h=k.x-l,i=k.y-m,k=this.m_normals[o],h=k.x*h+k.y*i,i=k.x*e+k.y*j,i<0&&h<g*i?(g=h/i,n=o):i>0&&h<f*i&&(f=h/i),f<g)return b2Shape.e_missCollide;if(n>=0)return c[0]=g,j=b.R,k=this.m_normals[n],
d.x=j.col1.x*k.x+j.col2.x*k.y,d.y=j.col1.y*k.x+j.col2.y*k.y,b2Shape.e_hitCollide;c[0]=0;return b2Shape.e_startsInsideCollide};
a.ComputeAABB=function(b,c){var d,e,f=b2PolygonShape.s_computeMat;d=c.R;e=this.m_obb.R.col1;f.col1.x=d.col1.x*e.x+d.col2.x*e.y;f.col1.y=d.col1.y*e.x+d.col2.y*e.y;e=this.m_obb.R.col2;f.col2.x=d.col1.x*e.x+d.col2.x*e.y;f.col2.y=d.col1.y*e.x+d.col2.y*e.y;f.Abs();e=this.m_obb.extents;var g=f.col1.x*e.x+f.col2.x*e.y;f=f.col1.y*e.x+f.col2.y*e.y;d=c.R;e=this.m_obb.center;var h=c.position.x+(d.col1.x*e.x+d.col2.x*e.y);c=c.position.y+(d.col1.y*e.x+d.col2.y*e.y);b.lowerBound.Set(h-g,c-f);b.upperBound.Set(h+
g,c+f)};a.ComputeSweptAABB=function(b,c,d){var e=b2PolygonShape.s_sweptAABB1,f=b2PolygonShape.s_sweptAABB2;this.ComputeAABB(e,c);this.ComputeAABB(f,d);b.lowerBound.Set(e.lowerBound.x<f.lowerBound.x?e.lowerBound.x:f.lowerBound.x,e.lowerBound.y<f.lowerBound.y?e.lowerBound.y:f.lowerBound.y);b.upperBound.Set(e.upperBound.x>f.upperBound.x?e.upperBound.x:f.upperBound.x,e.upperBound.y>f.upperBound.y?e.upperBound.y:f.upperBound.y)};
a.ComputeMass=function(b){for(var c=0,d=0,e=0,f=0,g=1/3,h=0;h<this.m_vertexCount;++h){var i=this.m_vertices[h],j=h+1<this.m_vertexCount?this.m_vertices[parseInt(h+1)]:this.m_vertices[0],k=i.x-0,l=i.y-0,m=j.x-0,n=j.y-0,o=k*n-l*m,p=0.5*o;e+=p;c+=p*g*(0+i.x+j.x);d+=p*g*(0+i.y+j.y);f+=o*(g*(0.25*(k*k+m*k+m*m)+(0*k+0*m))+0+(g*(0.25*(l*l+n*l+n*n)+(0*l+0*n))+0))}b.mass=this.m_density*e;c*=1/e;d*=1/e;b.center.Set(c,d);b.I=this.m_density*f};a.GetOBB=function(){return this.m_obb};a.GetCentroid=function(){return this.m_centroid};
a.GetVertexCount=function(){return this.m_vertexCount};a.GetVertices=function(){return this.m_vertices};a.GetCoreVertices=function(){return this.m_coreVertices};a.GetNormals=function(){return this.m_normals};a.GetFirstVertex=function(b){return b2Math.b2MulX(b,this.m_coreVertices[0])};a.Centroid=function(b){return b2Math.b2MulX(b,this.m_centroid)};
a.Support=function(b,c,d){var e;e=b.R;var f=c*e.col1.x+d*e.col1.y;e=c*e.col2.x+d*e.col2.y;c=0;d=this.m_coreVertices[0];for(var g=d.x*f+d.y*e,h=1;h<this.m_vertexCount;++h)d=this.m_coreVertices[h],d=d.x*f+d.y*e,d>g&&(c=h,g=d);e=b.R;d=this.m_coreVertices[c];this.s_supportVec.x=b.position.x+(e.col1.x*d.x+e.col2.x*d.y);this.s_supportVec.y=b.position.y+(e.col1.y*d.x+e.col2.y*d.y);return this.s_supportVec};
a.UpdateSweepRadius=function(b){for(var c,d=this.m_sweepRadius=0;d<this.m_vertexCount;++d){c=this.m_coreVertices[d];var e=c.x-b.x;c=c.y-b.y;e=Math.sqrt(e*e+c*c);if(e>this.m_sweepRadius)this.m_sweepRadius=e}};var b2ContactResult=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactResult.prototype;a.__constructor=function(){};a.__varz=function(){this.position=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};a.shape1=null;a.shape2=null;a.position=new b2Vec2;
a.normal=new b2Vec2;a.normalImpulse=null;a.tangentImpulse=null;a.id=new b2ContactID;var b2Island=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Island.prototype.__constructor=function(b,c,d,e,f){var g=0;this.m_bodyCapacity=b;this.m_contactCapacity=c;this.m_jointCapacity=d;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=e;this.m_listener=f;this.m_bodies=Array(b);for(g=0;g<b;g++)this.m_bodies[g]=null;this.m_contacts=Array(c);for(g=0;g<c;g++)this.m_contacts[g]=null;this.m_joints=Array(d);for(g=0;g<d;g++)this.m_joints[g]=null;this.m_positionIterationCount=0};b2Island.prototype.__varz=function(){};
b2Island.s_reportCR=new b2ContactResult;a=b2Island.prototype;a.m_allocator=null;a.m_listener=null;a.m_bodies=null;a.m_contacts=null;a.m_joints=null;a.m_bodyCount=0;a.m_jointCount=0;a.m_contactCount=0;a.m_bodyCapacity=0;a.m_contactCapacity=0;a.m_jointCapacity=0;a.m_positionIterationCount=0;a.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};
a.Solve=function(b,c,d,e){var f=0,g;for(f=0;f<this.m_bodyCount;++f)if(g=this.m_bodies[f],!g.IsStatic()&&(g.m_linearVelocity.x+=b.dt*(c.x+g.m_invMass*g.m_force.x),g.m_linearVelocity.y+=b.dt*(c.y+g.m_invMass*g.m_force.y),g.m_angularVelocity+=b.dt*g.m_invI*g.m_torque,g.m_force.SetZero(),g.m_torque=0,g.m_linearVelocity.Multiply(b2Math.b2Clamp(1-b.dt*g.m_linearDamping,0,1)),g.m_angularVelocity*=b2Math.b2Clamp(1-b.dt*g.m_angularDamping,0,1),g.m_linearVelocity.LengthSquared()>b2Settings.b2_maxLinearVelocitySquared&&
(g.m_linearVelocity.Normalize(),g.m_linearVelocity.x*=b2Settings.b2_maxLinearVelocity,g.m_linearVelocity.y*=b2Settings.b2_maxLinearVelocity),g.m_angularVelocity*g.m_angularVelocity>b2Settings.b2_maxAngularVelocitySquared))g.m_angularVelocity=g.m_angularVelocity<0?-b2Settings.b2_maxAngularVelocity:b2Settings.b2_maxAngularVelocity;c=new b2ContactSolver(b,this.m_contacts,this.m_contactCount,this.m_allocator);c.InitVelocityConstraints(b);for(f=0;f<this.m_jointCount;++f)g=this.m_joints[f],g.InitVelocityConstraints(b);
for(f=0;f<b.maxIterations;++f){c.SolveVelocityConstraints();for(var h=0;h<this.m_jointCount;++h)g=this.m_joints[h],g.SolveVelocityConstraints(b)}c.FinalizeVelocityConstraints();for(f=0;f<this.m_bodyCount;++f)if(g=this.m_bodies[f],!g.IsStatic())g.m_sweep.c0.SetV(g.m_sweep.c),g.m_sweep.a0=g.m_sweep.a,g.m_sweep.c.x+=b.dt*g.m_linearVelocity.x,g.m_sweep.c.y+=b.dt*g.m_linearVelocity.y,g.m_sweep.a+=b.dt*g.m_angularVelocity,g.SynchronizeTransform();if(d){for(f=0;f<this.m_jointCount;++f)g=this.m_joints[f],
g.InitPositionConstraints();for(this.m_positionIterationCount=0;this.m_positionIterationCount<b.maxIterations;++this.m_positionIterationCount){d=c.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);h=!0;for(f=0;f<this.m_jointCount;++f)g=this.m_joints[f],g=g.SolvePositionConstraints(),h=h&&g;if(d&&h)break}}this.Report(c.m_constraints);if(e){e=Number.MAX_VALUE;c=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance;d=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;
for(f=0;f<this.m_bodyCount;++f)if(g=this.m_bodies[f],g.m_invMass!=0){if((g.m_flags&b2Body.e_allowSleepFlag)==0)e=g.m_sleepTime=0;(g.m_flags&b2Body.e_allowSleepFlag)==0||g.m_angularVelocity*g.m_angularVelocity>d||b2Math.b2Dot(g.m_linearVelocity,g.m_linearVelocity)>c?e=g.m_sleepTime=0:(g.m_sleepTime+=b.dt,e=b2Math.b2Min(e,g.m_sleepTime))}if(e>=b2Settings.b2_timeToSleep)for(f=0;f<this.m_bodyCount;++f)g=this.m_bodies[f],g.m_flags|=b2Body.e_sleepFlag,g.m_linearVelocity.SetZero(),g.m_angularVelocity=0}};
a.SolveTOI=function(b){var c=0,d=new b2ContactSolver(b,this.m_contacts,this.m_contactCount,this.m_allocator);for(c=0;c<b.maxIterations;++c)d.SolveVelocityConstraints();for(c=0;c<this.m_bodyCount;++c){var e=this.m_bodies[c];if(!e.IsStatic())e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=b.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=b.dt*e.m_linearVelocity.y,e.m_sweep.a+=b.dt*e.m_angularVelocity,e.SynchronizeTransform()}for(c=0;c<b.maxIterations;++c)if(d.SolvePositionConstraints(0.75))break;
this.Report(d.m_constraints)};
a.Report=function(b){if(this.m_listener!=null)for(var c=0;c<this.m_contactCount;++c){var d=this.m_contacts[c],e=b[c],f=b2Island.s_reportCR;f.shape1=d.m_shape1;f.shape2=d.m_shape2;var g=f.shape1.m_body,h=d.m_manifoldCount;d=d.GetManifolds();for(var i=0;i<h;++i){var j=d[i];f.normal.SetV(j.normal);for(var k=0;k<j.pointCount;++k){var l=j.points[k],m=e.points[k];f.position=g.GetWorldPoint(l.localPoint1);f.normalImpulse=m.normalImpulse;f.tangentImpulse=m.tangentImpulse;f.id.key=l.id.key;this.m_listener.Result(f)}}}};
a.AddBody=function(b){this.m_bodies[this.m_bodyCount++]=b};a.AddContact=function(b){this.m_contacts[this.m_contactCount++]=b};a.AddJoint=function(b){this.m_joints[this.m_jointCount++]=b};var b2ManifoldPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ManifoldPoint.prototype;a.__constructor=function(){};a.__varz=function(){this.localPoint1=new b2Vec2;this.localPoint2=new b2Vec2;this.id=new b2ContactID};a.localPoint1=new b2Vec2;a.localPoint2=new b2Vec2;a.separation=null;
a.normalImpulse=null;a.tangentImpulse=null;a.id=new b2ContactID;a.Reset=function(){this.localPoint1.SetZero();this.localPoint2.SetZero();this.tangentImpulse=this.normalImpulse=this.separation=0;this.id.key=0};a.Set=function(b){this.localPoint1.SetV(b.localPoint1);this.localPoint2.SetV(b.localPoint2);this.separation=b.separation;this.normalImpulse=b.normalImpulse;this.tangentImpulse=b.tangentImpulse;this.id.key=b.id.key};var b2Math=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Math.prototype.__constructor=function(){};b2Math.prototype.__varz=function(){};b2Math.b2Vec2_zero=new b2Vec2(0,0);b2Math.b2Mat22_identity=new b2Mat22(0,new b2Vec2(1,0),new b2Vec2(0,1));b2Math.b2XForm_identity=new b2XForm(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);b2Math.b2IsValid=function(b){return isFinite(b)};b2Math.b2Dot=function(b,c){return b.x*c.x+b.y*c.y};b2Math.b2CrossVV=function(b,c){return b.x*c.y-b.y*c.x};b2Math.b2CrossVF=function(b,c){return new b2Vec2(c*b.y,-c*b.x)};
b2Math.b2CrossFV=function(b,c){return new b2Vec2(-b*c.y,b*c.x)};b2Math.b2MulMV=function(b,c){return new b2Vec2(b.col1.x*c.x+b.col2.x*c.y,b.col1.y*c.x+b.col2.y*c.y)};b2Math.b2MulTMV=function(b,c){return new b2Vec2(b2Math.b2Dot(c,b.col1),b2Math.b2Dot(c,b.col2))};b2Math.b2MulX=function(b,c){c=b2Math.b2MulMV(b.R,c);c.x+=b.position.x;c.y+=b.position.y;return c};b2Math.b2MulXT=function(b,c){c=b2Math.SubtractVV(c,b.position);var d=c.x*b.R.col1.x+c.y*b.R.col1.y;c.y=c.x*b.R.col2.x+c.y*b.R.col2.y;c.x=d;return c};
b2Math.AddVV=function(b,c){return new b2Vec2(b.x+c.x,b.y+c.y)};b2Math.SubtractVV=function(b,c){return new b2Vec2(b.x-c.x,b.y-c.y)};b2Math.b2Distance=function(b,c){var d=b.x-c.x;b=b.y-c.y;return Math.sqrt(d*d+b*b)};b2Math.b2DistanceSquared=function(b,c){var d=b.x-c.x;b=b.y-c.y;return d*d+b*b};b2Math.MulFV=function(b,c){return new b2Vec2(b*c.x,b*c.y)};b2Math.AddMM=function(b,c){return new b2Mat22(0,b2Math.AddVV(b.col1,c.col1),b2Math.AddVV(b.col2,c.col2))};
b2Math.b2MulMM=function(b,c){return new b2Mat22(0,b2Math.b2MulMV(b,c.col1),b2Math.b2MulMV(b,c.col2))};b2Math.b2MulTMM=function(b,c){var d=new b2Vec2(b2Math.b2Dot(b.col1,c.col1),b2Math.b2Dot(b.col2,c.col1));b=new b2Vec2(b2Math.b2Dot(b.col1,c.col2),b2Math.b2Dot(b.col2,c.col2));return new b2Mat22(0,d,b)};b2Math.b2Abs=function(b){return b>0?b:-b};b2Math.b2AbsV=function(b){return new b2Vec2(b2Math.b2Abs(b.x),b2Math.b2Abs(b.y))};b2Math.b2AbsM=function(b){return new b2Mat22(0,b2Math.b2AbsV(b.col1),b2Math.b2AbsV(b.col2))};
b2Math.b2Min=function(b,c){return b<c?b:c};b2Math.b2MinV=function(b,c){return new b2Vec2(b2Math.b2Min(b.x,c.x),b2Math.b2Min(b.y,c.y))};b2Math.b2Max=function(b,c){return b>c?b:c};b2Math.b2MaxV=function(b,c){return new b2Vec2(b2Math.b2Max(b.x,c.x),b2Math.b2Max(b.y,c.y))};b2Math.b2Clamp=function(b,c,d){return b2Math.b2Max(c,b2Math.b2Min(b,d))};b2Math.b2ClampV=function(b,c,d){return b2Math.b2MaxV(c,b2Math.b2MinV(b,d))};b2Math.b2Swap=function(b,c){var d=b[0];b[0]=c[0];c[0]=d};
b2Math.b2Random=function(){return Math.random()*2-1};b2Math.b2RandomRange=function(b,c){return(c-b)*Math.random()+b};b2Math.b2NextPowerOfTwo=function(b){b|=b>>1&2147483647;b|=b>>2&1073741823;b|=b>>4&268435455;b|=b>>8&16777215;b|=b>>16&65535;return b+1};b2Math.b2IsPowerOfTwo=function(b){return b>0&&(b&b-1)==0};var b2CircleDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleDef.prototype,b2ShapeDef.prototype);a=b2CircleDef.prototype;
a._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){this.type=b2Shape.e_circleShape;this.radius=1};a.__varz=function(){this.localPosition=new b2Vec2(0,0)};a.localPosition=new b2Vec2(0,0);a.radius=null;var b2ContactPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};a=b2ContactPoint.prototype;a.__constructor=function(){};a.__varz=function(){this.position=new b2Vec2;this.velocity=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};
a.shape1=null;a.shape2=null;a.position=new b2Vec2;a.velocity=new b2Vec2;a.normal=new b2Vec2;a.separation=null;a.friction=null;a.restitution=null;a.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype);b2PolygonContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};
b2PolygonContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0};b2PolygonContact.prototype.__varz=function(){this.m0=new b2Manifold;this.m_manifolds=[new b2Manifold]};b2PolygonContact.s_evalCP=new b2ContactPoint;b2PolygonContact.Create=function(b,c){return new b2PolygonContact(b,c)};b2PolygonContact.Destroy=function(){};a=b2PolygonContact.prototype;a.m0=new b2Manifold;a.m_manifolds=[new b2Manifold];a.m_manifold=null;
a.Evaluate=function(b){var c,d,e,f=this.m_shape1.m_body,g=this.m_shape2.m_body,h,i=0;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygons(this.m_manifold,this.m_shape1,f.m_xf,this.m_shape2,g.m_xf);var j=[!1,!1];h=b2PolygonContact.s_evalCP;h.shape1=this.m_shape1;h.shape2=this.m_shape2;h.friction=this.m_friction;h.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(i=0;i<this.m_manifold.pointCount;++i){var k=this.m_manifold.points[i];k.normalImpulse=0;k.tangentImpulse=0;var l=
!1,m=k.id._key;for(c=0;c<this.m0.pointCount;++c)if(j[c]!=!0&&(e=this.m0.points[c],e.id._key==m)){j[c]=!0;k.normalImpulse=e.normalImpulse;k.tangentImpulse=e.tangentImpulse;l=!0;if(b!=null)h.position=f.GetWorldPoint(k.localPoint1),c=f.GetLinearVelocityFromLocalPoint(k.localPoint1),d=g.GetLinearVelocityFromLocalPoint(k.localPoint2),h.velocity.Set(d.x-c.x,d.y-c.y),h.normal.SetV(this.m_manifold.normal),h.separation=k.separation,h.id.key=m,b.Persist(h);break}if(l==!1&&b!=null)h.position=f.GetWorldPoint(k.localPoint1),
c=f.GetLinearVelocityFromLocalPoint(k.localPoint1),d=g.GetLinearVelocityFromLocalPoint(k.localPoint2),h.velocity.Set(d.x-c.x,d.y-c.y),h.normal.SetV(this.m_manifold.normal),h.separation=k.separation,h.id.key=m,b.Add(h)}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(b!=null)for(i=0;i<this.m0.pointCount;++i)if(!j[i])e=this.m0.points[i],h.position=f.GetWorldPoint(e.localPoint1),c=f.GetLinearVelocityFromLocalPoint(e.localPoint1),d=g.GetLinearVelocityFromLocalPoint(e.localPoint2),h.velocity.Set(d.x-
c.x,d.y-c.y),h.normal.SetV(this.m0.normal),h.separation=e.separation,h.id.key=e.id._key,b.Remove(h)};a.GetManifolds=function(){return this.m_manifolds};var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype);a=b2MouseJoint.prototype;a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_target.SetV(b.target);var c=this.m_target.x-this.m_body2.m_xf.position.x,d=this.m_target.y-this.m_body2.m_xf.position.y,e=this.m_body2.m_xf.R;this.m_localAnchor.x=c*e.col1.x+d*e.col1.y;this.m_localAnchor.y=c*e.col2.x+d*e.col2.y;this.m_maxForce=b.maxForce;this.m_impulse.SetZero();d=this.m_body2.m_mass;e=2*b2Settings.b2_pi*b.frequencyHz;c=2*d*b.dampingRatio*e;b=b.timeStep*d*e*e;this.m_gamma=1/(c+b);this.m_beta=b/(c+b)};
a.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.m_localAnchor=new b2Vec2;this.m_target=new b2Vec2;this.m_impulse=new b2Vec2;this.m_mass=new b2Mat22;this.m_C=new b2Vec2};a.K=new b2Mat22;a.K1=new b2Mat22;a.K2=new b2Mat22;a.m_localAnchor=new b2Vec2;a.m_target=new b2Vec2;a.m_impulse=new b2Vec2;a.m_mass=new b2Mat22;a.m_C=new b2Vec2;a.m_maxForce=null;a.m_beta=null;a.m_gamma=null;a.GetAnchor1=function(){return this.m_target};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor)};
a.GetReactionForce=function(){return this.m_impulse};a.GetReactionTorque=function(){return 0};a.SetTarget=function(b){this.m_body2.IsSleeping()&&this.m_body2.WakeUp();this.m_target=b};
a.InitVelocityConstraints=function(b){var c=this.m_body2,d;d=c.m_xf.R;var e=this.m_localAnchor.x-c.m_sweep.localCenter.x,f=this.m_localAnchor.y-c.m_sweep.localCenter.y,g=d.col1.x*e+d.col2.x*f;f=d.col1.y*e+d.col2.y*f;e=g;d=c.m_invMass;g=c.m_invI;this.K1.col1.x=d;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=d;this.K2.col1.x=g*f*f;this.K2.col2.x=-g*e*f;this.K2.col1.y=-g*e*f;this.K2.col2.y=g*e*e;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.Invert(this.m_mass);
this.m_C.x=c.m_sweep.c.x+e-this.m_target.x;this.m_C.y=c.m_sweep.c.y+f-this.m_target.y;c.m_angularVelocity*=0.98;var h=b.dt*this.m_impulse.x;b=b.dt*this.m_impulse.y;c.m_linearVelocity.x+=d*h;c.m_linearVelocity.y+=d*b;c.m_angularVelocity+=g*(e*b-f*h)};
a.SolveVelocityConstraints=function(b){var c=this.m_body2,d,e,f;d=c.m_xf.R;var g=this.m_localAnchor.x-c.m_sweep.localCenter.x,h=this.m_localAnchor.y-c.m_sweep.localCenter.y;e=d.col1.x*g+d.col2.x*h;h=d.col1.y*g+d.col2.y*h;g=e;e=c.m_linearVelocity.x+-c.m_angularVelocity*h;var i=c.m_linearVelocity.y+c.m_angularVelocity*g;d=this.m_mass;e=e+this.m_beta*b.inv_dt*this.m_C.x+this.m_gamma*b.dt*this.m_impulse.x;f=i+this.m_beta*b.inv_dt*this.m_C.y+this.m_gamma*b.dt*this.m_impulse.y;i=-b.inv_dt*(d.col1.x*e+d.col2.x*
f);d=-b.inv_dt*(d.col1.y*e+d.col2.y*f);e=this.m_impulse.x;f=this.m_impulse.y;this.m_impulse.x+=i;this.m_impulse.y+=d;i=this.m_impulse.Length();i>this.m_maxForce&&this.m_impulse.Multiply(this.m_maxForce/i);i=this.m_impulse.x-e;d=this.m_impulse.y-f;i*=b.dt;b=b.dt*d;c.m_linearVelocity.x+=c.m_invMass*i;c.m_linearVelocity.y+=c.m_invMass*b;c.m_angularVelocity+=c.m_invI*(g*b-h*i)};a.SolvePositionConstraints=function(){return!0};
var b2CircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype);b2CircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};b2CircleContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0;b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};
b2CircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2CircleContact.s_evalCP=new b2ContactPoint;b2CircleContact.Create=function(b,c){return new b2CircleContact(b,c)};b2CircleContact.Destroy=function(){};a=b2CircleContact.prototype;a.m_manifolds=[new b2Manifold];a.m0=new b2Manifold;a.m_manifold=null;
a.Evaluate=function(b){var c,d,e;c=this.m_shape1.m_body;d=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollideCircles(this.m_manifold,this.m_shape1,c.m_xf,this.m_shape2,d.m_xf);var f=b2CircleContact.s_evalCP;f.shape1=this.m_shape1;f.shape2=this.m_shape2;f.friction=this.m_friction;f.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){this.m_manifoldCount=1;var g=this.m_manifold.points[0];if(this.m0.pointCount==0){if(g.normalImpulse=0,g.tangentImpulse=0,b)f.position=c.GetWorldPoint(g.localPoint1),
c=c.GetLinearVelocityFromLocalPoint(g.localPoint1),d=d.GetLinearVelocityFromLocalPoint(g.localPoint2),f.velocity.Set(d.x-c.x,d.y-c.y),f.normal.SetV(this.m_manifold.normal),f.separation=g.separation,f.id.key=g.id._key,b.Add(f)}else if(e=this.m0.points[0],g.normalImpulse=e.normalImpulse,g.tangentImpulse=e.tangentImpulse,b)f.position=c.GetWorldPoint(g.localPoint1),c=c.GetLinearVelocityFromLocalPoint(g.localPoint1),d=d.GetLinearVelocityFromLocalPoint(g.localPoint2),f.velocity.Set(d.x-c.x,d.y-c.y),f.normal.SetV(this.m_manifold.normal),
f.separation=g.separation,f.id.key=g.id._key,b.Persist(f)}else if(this.m_manifoldCount=0,this.m0.pointCount>0&&b)e=this.m0.points[0],f.position=c.GetWorldPoint(e.localPoint1),c=c.GetLinearVelocityFromLocalPoint(e.localPoint1),d=d.GetLinearVelocityFromLocalPoint(e.localPoint2),f.velocity.Set(d.x-c.x,d.y-c.y),f.normal.SetV(this.m0.normal),f.separation=e.separation,f.id.key=e.id._key,b.Remove(f)};a.GetManifolds=function(){return this.m_manifolds};
var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype);b2PulleyJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2PulleyJoint.prototype.__constructor=function(b){this._super(b);this.m_ground=this.m_body1.m_world.m_groundBody;this.m_groundAnchor1.x=b.groundAnchor1.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=b.groundAnchor1.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=b.groundAnchor2.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=b.groundAnchor2.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_ratio=b.ratio;this.m_constant=
b.length1+this.m_ratio*b.length2;this.m_maxLength1=b2Math.b2Min(b.maxLength1,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=b2Math.b2Min(b.maxLength2,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_limitForce2=this.m_limitForce1=this.m_force=0};
b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u1=new b2Vec2;this.m_u2=new b2Vec2};b2PulleyJoint.b2_minPulleyLength=2;a=b2PulleyJoint.prototype;a.m_ground=null;a.m_groundAnchor1=new b2Vec2;a.m_groundAnchor2=new b2Vec2;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_u1=new b2Vec2;a.m_u2=new b2Vec2;a.m_constant=null;a.m_ratio=null;a.m_maxLength1=null;
a.m_maxLength2=null;a.m_pulleyMass=null;a.m_limitMass1=null;a.m_limitMass2=null;a.m_force=null;a.m_limitForce1=null;a.m_limitForce2=null;a.m_positionImpulse=null;a.m_limitPositionImpulse1=null;a.m_limitPositionImpulse2=null;a.m_state=0;a.m_limitState1=0;a.m_limitState2=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
a.GetReactionForce=function(){var b=this.m_u2.Copy();b.Multiply(this.m_force);return b};a.GetReactionTorque=function(){return 0};a.GetGroundAnchor1=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor1);return b};a.GetGroundAnchor2=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor2);return b};
a.GetLength1=function(){var b=this.m_body1.GetWorldPoint(this.m_localAnchor1),c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(c*c+b*b)};a.GetLength2=function(){var b=this.m_body2.GetWorldPoint(this.m_localAnchor2),c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(c*c+b*b)};a.GetRatio=function(){return this.m_ratio};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=e.col1.x*f+e.col2.x*g;g=e.col1.y*f+e.col2.y*g;f=h;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=h;e=d.m_sweep.c.x+i;h=d.m_sweep.c.y+j;var k=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+
this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+f-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+g-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(e-k,h-l);e=this.m_u1.Length();h=this.m_u2.Length();e>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero();h>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/h):this.m_u2.SetZero();this.m_constant-e-this.m_ratio*h>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_force=0):(this.m_state=b2Joint.e_atUpperLimit,
this.m_positionImpulse=0);e<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitForce1=0):(this.m_limitState1=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse1=0);h<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitForce2=0):(this.m_limitState2=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse2=0);e=f*this.m_u1.y-g*this.m_u1.x;h=i*this.m_u2.y-j*this.m_u2.x;this.m_limitMass1=c.m_invMass+c.m_invI*e*e;this.m_limitMass2=d.m_invMass+d.m_invI*h*h;this.m_pulleyMass=
this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;b.warmStarting?(e=b.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.x,h=b.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.y,k=b.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.x,b=b.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*e,c.m_linearVelocity.y+=c.m_invMass*
h,c.m_angularVelocity+=c.m_invI*(f*h-g*e),d.m_linearVelocity.x+=d.m_invMass*k,d.m_linearVelocity.y+=d.m_invMass*b,d.m_angularVelocity+=d.m_invI*(i*b-j*k)):this.m_limitForce2=this.m_limitForce1=this.m_force=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=e.col1.x*f+e.col2.x*g;g=e.col1.y*f+e.col2.y*g;f=h;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=h;var k,l;if(this.m_state==b2Joint.e_atUpperLimit)e=c.m_linearVelocity.x+-c.m_angularVelocity*g,h=c.m_linearVelocity.y+
c.m_angularVelocity*f,k=d.m_linearVelocity.x+-d.m_angularVelocity*j,l=d.m_linearVelocity.y+d.m_angularVelocity*i,e=-(this.m_u1.x*e+this.m_u1.y*h)-this.m_ratio*(this.m_u2.x*k+this.m_u2.y*l),l=-b.inv_dt*this.m_pulleyMass*e,e=this.m_force,this.m_force=b2Math.b2Max(0,this.m_force+l),l=this.m_force-e,e=-b.dt*l*this.m_u1.x,h=-b.dt*l*this.m_u1.y,k=-b.dt*this.m_ratio*l*this.m_u2.x,l=-b.dt*this.m_ratio*l*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*e,c.m_linearVelocity.y+=c.m_invMass*h,c.m_angularVelocity+=
c.m_invI*(f*h-g*e),d.m_linearVelocity.x+=d.m_invMass*k,d.m_linearVelocity.y+=d.m_invMass*l,d.m_angularVelocity+=d.m_invI*(i*l-j*k);if(this.m_limitState1==b2Joint.e_atUpperLimit)e=c.m_linearVelocity.x+-c.m_angularVelocity*g,h=c.m_linearVelocity.y+c.m_angularVelocity*f,e=-(this.m_u1.x*e+this.m_u1.y*h),l=-b.inv_dt*this.m_limitMass1*e,e=this.m_limitForce1,this.m_limitForce1=b2Math.b2Max(0,this.m_limitForce1+l),l=this.m_limitForce1-e,e=-b.dt*l*this.m_u1.x,h=-b.dt*l*this.m_u1.y,c.m_linearVelocity.x+=c.m_invMass*
e,c.m_linearVelocity.y+=c.m_invMass*h,c.m_angularVelocity+=c.m_invI*(f*h-g*e);if(this.m_limitState2==b2Joint.e_atUpperLimit)k=d.m_linearVelocity.x+-d.m_angularVelocity*j,l=d.m_linearVelocity.y+d.m_angularVelocity*i,e=-(this.m_u2.x*k+this.m_u2.y*l),l=-b.inv_dt*this.m_limitMass2*e,e=this.m_limitForce2,this.m_limitForce2=b2Math.b2Max(0,this.m_limitForce2+l),l=this.m_limitForce2-e,k=-b.dt*l*this.m_u2.x,l=-b.dt*l*this.m_u2.y,d.m_linearVelocity.x+=d.m_invMass*k,d.m_linearVelocity.y+=d.m_invMass*l,d.m_angularVelocity+=
d.m_invI*(i*l-j*k)};
a.SolvePositionConstraints=function(){var b=this.m_body1,c=this.m_body2,d,e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,g=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,i,j,k,l,m,n,o,p=0;if(this.m_state==b2Joint.e_atUpperLimit)d=b.m_xf.R,i=this.m_localAnchor1.x-b.m_sweep.localCenter.x,j=this.m_localAnchor1.y-b.m_sweep.localCenter.y,m=d.col1.x*i+d.col2.x*j,j=d.col1.y*i+d.col2.y*
j,i=m,d=c.m_xf.R,k=this.m_localAnchor2.x-c.m_sweep.localCenter.x,l=this.m_localAnchor2.y-c.m_sweep.localCenter.y,m=d.col1.x*k+d.col2.x*l,l=d.col1.y*k+d.col2.y*l,k=m,m=b.m_sweep.c.x+i,n=b.m_sweep.c.y+j,o=c.m_sweep.c.x+k,d=c.m_sweep.c.y+l,this.m_u1.Set(m-e,n-f),this.m_u2.Set(o-g,d-h),d=this.m_u1.Length(),m=this.m_u2.Length(),d>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/d):this.m_u1.SetZero(),m>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/m):this.m_u2.SetZero(),d=this.m_constant-d-this.m_ratio*m,
p=b2Math.b2Max(p,-d),d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),d*=-this.m_pulleyMass,m=this.m_positionImpulse,this.m_positionImpulse=b2Math.b2Max(0,this.m_positionImpulse+d),d=this.m_positionImpulse-m,m=-d*this.m_u1.x,n=-d*this.m_u1.y,o=-this.m_ratio*d*this.m_u2.x,d=-this.m_ratio*d*this.m_u2.y,b.m_sweep.c.x+=b.m_invMass*m,b.m_sweep.c.y+=b.m_invMass*n,b.m_sweep.a+=b.m_invI*(i*n-j*m),c.m_sweep.c.x+=c.m_invMass*o,c.m_sweep.c.y+=c.m_invMass*d,c.m_sweep.a+=c.m_invI*
(k*d-l*o),b.SynchronizeTransform(),c.SynchronizeTransform();if(this.m_limitState1==b2Joint.e_atUpperLimit)d=b.m_xf.R,i=this.m_localAnchor1.x-b.m_sweep.localCenter.x,j=this.m_localAnchor1.y-b.m_sweep.localCenter.y,m=d.col1.x*i+d.col2.x*j,j=d.col1.y*i+d.col2.y*j,i=m,m=b.m_sweep.c.x+i,n=b.m_sweep.c.y+j,this.m_u1.Set(m-e,n-f),d=this.m_u1.Length(),d>b2Settings.b2_linearSlop?(this.m_u1.x*=1/d,this.m_u1.y*=1/d):this.m_u1.SetZero(),d=this.m_maxLength1-d,p=b2Math.b2Max(p,-d),d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,
-b2Settings.b2_maxLinearCorrection,0),d*=-this.m_limitMass1,e=this.m_limitPositionImpulse1,this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+d),d=this.m_limitPositionImpulse1-e,m=-d*this.m_u1.x,n=-d*this.m_u1.y,b.m_sweep.c.x+=b.m_invMass*m,b.m_sweep.c.y+=b.m_invMass*n,b.m_sweep.a+=b.m_invI*(i*n-j*m),b.SynchronizeTransform();if(this.m_limitState2==b2Joint.e_atUpperLimit)d=c.m_xf.R,k=this.m_localAnchor2.x-c.m_sweep.localCenter.x,l=this.m_localAnchor2.y-c.m_sweep.localCenter.y,
m=d.col1.x*k+d.col2.x*l,l=d.col1.y*k+d.col2.y*l,k=m,o=c.m_sweep.c.x+k,d=c.m_sweep.c.y+l,this.m_u2.Set(o-g,d-h),m=this.m_u2.Length(),m>b2Settings.b2_linearSlop?(this.m_u2.x*=1/m,this.m_u2.y*=1/m):this.m_u2.SetZero(),d=this.m_maxLength2-m,p=b2Math.b2Max(p,-d),d=b2Math.b2Clamp(d+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),d*=-this.m_limitMass2,e=this.m_limitPositionImpulse2,this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+d),d=this.m_limitPositionImpulse2-e,
o=-d*this.m_u2.x,d=-d*this.m_u2.y,c.m_sweep.c.x+=c.m_invMass*o,c.m_sweep.c.y+=c.m_invMass*d,c.m_sweep.a+=c.m_invI*(k*d-l*o),c.SynchronizeTransform();return p<b2Settings.b2_linearSlop};var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype);b2RevoluteJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2RevoluteJoint.prototype.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_referenceAngle=b.referenceAngle;this.m_pivotForce.Set(0,0);this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=0;this.m_lowerAngle=b.lowerAngle;this.m_upperAngle=b.upperAngle;this.m_maxMotorTorque=b.maxMotorTorque;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor};
b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.K3=new b2Mat22;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_pivotForce=new b2Vec2;this.m_pivotMass=new b2Mat22};b2RevoluteJoint.tImpulse=new b2Vec2;a=b2RevoluteJoint.prototype;a.K=new b2Mat22;a.K1=new b2Mat22;a.K2=new b2Mat22;a.K3=new b2Mat22;a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_pivotForce=new b2Vec2;a.m_motorForce=null;a.m_limitForce=null;
a.m_limitPositionImpulse=null;a.m_pivotMass=new b2Mat22;a.m_motorMass=null;a.m_enableMotor=null;a.m_maxMotorTorque=null;a.m_motorSpeed=null;a.m_enableLimit=null;a.m_referenceAngle=null;a.m_lowerAngle=null;a.m_upperAngle=null;a.m_limitState=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};a.GetReactionForce=function(){return this.m_pivotForce};a.GetReactionTorque=function(){return this.m_limitForce};
a.GetJointAngle=function(){return this.m_body2.m_sweep.a-this.m_body1.m_sweep.a-this.m_referenceAngle};a.GetJointSpeed=function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity};a.IsLimitEnabled=function(){return this.m_enableLimit};a.EnableLimit=function(b){this.m_enableLimit=b};a.GetLowerLimit=function(){return this.m_lowerAngle};a.GetUpperLimit=function(){return this.m_upperAngle};a.SetLimits=function(b,c){this.m_lowerAngle=b;this.m_upperAngle=c};a.IsMotorEnabled=function(){return this.m_enableMotor};
a.EnableMotor=function(b){this.m_enableMotor=b};a.SetMotorSpeed=function(b){this.m_motorSpeed=b};a.GetMotorSpeed=function(){return this.m_motorSpeed};a.SetMaxMotorTorque=function(b){this.m_maxMotorTorque=b};a.GetMotorTorque=function(){return this.m_motorForce};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*g+e.col2.x*h;h=e.col1.y*g+e.col2.y*h;g=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;e=c.m_invMass;f=d.m_invMass;var k=c.m_invI,l=d.m_invI;this.K1.col1.x=e+f;this.K1.col2.x=0;this.K1.col1.y=
0;this.K1.col2.y=e+f;this.K2.col1.x=k*h*h;this.K2.col2.x=-k*g*h;this.K2.col1.y=-k*g*h;this.K2.col2.y=k*g*g;this.K3.col1.x=l*j*j;this.K3.col2.x=-l*i*j;this.K3.col1.y=-l*i*j;this.K3.col2.y=l*i*i;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Invert(this.m_pivotMass);this.m_motorMass=1/(k+l);if(this.m_enableMotor==!1)this.m_motorForce=0;if(this.m_enableLimit){var m=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;if(b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop)this.m_limitState=
b2Joint.e_equalLimits;else if(m<=this.m_lowerAngle){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atLowerLimit}else if(m>=this.m_upperAngle){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitForce=0}else this.m_limitForce=0;b.warmStarting?(c.m_linearVelocity.x-=b.dt*e*this.m_pivotForce.x,c.m_linearVelocity.y-=b.dt*e*this.m_pivotForce.y,c.m_angularVelocity-=
b.dt*k*(g*this.m_pivotForce.y-h*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce),d.m_linearVelocity.x+=b.dt*f*this.m_pivotForce.x,d.m_linearVelocity.y+=b.dt*f*this.m_pivotForce.y,d.m_angularVelocity+=b.dt*l*(i*this.m_pivotForce.y-j*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce)):(this.m_pivotForce.SetZero(),this.m_limitForce=this.m_motorForce=0);this.m_limitPositionImpulse=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*g+e.col2.x*h;h=e.col1.y*g+e.col2.y*h;g=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;f=d.m_linearVelocity.x+-d.m_angularVelocity*j-c.m_linearVelocity.x- -c.m_angularVelocity*h;var k=d.m_linearVelocity.y+
d.m_angularVelocity*i-c.m_linearVelocity.y-c.m_angularVelocity*g;e=-b.inv_dt*(this.m_pivotMass.col1.x*f+this.m_pivotMass.col2.x*k);f=-b.inv_dt*(this.m_pivotMass.col1.y*f+this.m_pivotMass.col2.y*k);this.m_pivotForce.x+=e;this.m_pivotForce.y+=f;e*=b.dt;f*=b.dt;c.m_linearVelocity.x-=c.m_invMass*e;c.m_linearVelocity.y-=c.m_invMass*f;c.m_angularVelocity-=c.m_invI*(g*f-h*e);d.m_linearVelocity.x+=d.m_invMass*e;d.m_linearVelocity.y+=d.m_invMass*f;d.m_angularVelocity+=d.m_invI*(i*f-j*e);if(this.m_enableMotor&&
this.m_limitState!=b2Joint.e_equalLimits)g=-b.inv_dt*this.m_motorMass*(d.m_angularVelocity-c.m_angularVelocity-this.m_motorSpeed),h=this.m_motorForce,this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+g,-this.m_maxMotorTorque,this.m_maxMotorTorque),g=this.m_motorForce-h,c.m_angularVelocity-=c.m_invI*b.dt*g,d.m_angularVelocity+=d.m_invI*b.dt*g;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){h=-b.inv_dt*this.m_motorMass*(d.m_angularVelocity-c.m_angularVelocity);if(this.m_limitState==
b2Joint.e_equalLimits)this.m_limitForce+=h;else if(this.m_limitState==b2Joint.e_atLowerLimit)g=this.m_limitForce,this.m_limitForce=b2Math.b2Max(this.m_limitForce+h,0),h=this.m_limitForce-g;else if(this.m_limitState==b2Joint.e_atUpperLimit)g=this.m_limitForce,this.m_limitForce=b2Math.b2Min(this.m_limitForce+h,0),h=this.m_limitForce-g;c.m_angularVelocity-=c.m_invI*b.dt*h;d.m_angularVelocity+=d.m_invI*b.dt*h}};
a.SolvePositionConstraints=function(){var b,c=this.m_body1,d=this.m_body2,e=0;e=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=e.col1.x*f+e.col2.x*g;g=e.col1.y*f+e.col2.y*g;f=h;e=d.m_xf.R;b=this.m_localAnchor2.x-d.m_sweep.localCenter.x;var i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=e.col1.x*b+e.col2.x*i;i=e.col1.y*b+e.col2.y*i;b=h;h=d.m_sweep.c.x+b-(c.m_sweep.c.x+f);var j=d.m_sweep.c.y+i-(c.m_sweep.c.y+g);e=Math.sqrt(h*h+j*j);
var k=c.m_invMass,l=d.m_invMass,m=c.m_invI,n=d.m_invI;this.K1.col1.x=k+l;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=k+l;this.K2.col1.x=m*g*g;this.K2.col2.x=-m*f*g;this.K2.col1.y=-m*f*g;this.K2.col2.y=m*f*f;this.K3.col1.x=n*i*i;this.K3.col2.x=-n*b*i;this.K3.col1.y=-n*b*i;this.K3.col2.y=n*b*b;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(b2RevoluteJoint.tImpulse,-h,-j);h=b2RevoluteJoint.tImpulse.x;j=b2RevoluteJoint.tImpulse.y;c.m_sweep.c.x-=c.m_invMass*h;c.m_sweep.c.y-=
c.m_invMass*j;c.m_sweep.a-=c.m_invI*(f*j-g*h);d.m_sweep.c.x+=d.m_invMass*h;d.m_sweep.c.y+=d.m_invMass*j;d.m_sweep.a+=d.m_invI*(b*j-i*h);c.SynchronizeTransform();d.SynchronizeTransform();f=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){b=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;g=0;if(this.m_limitState==b2Joint.e_equalLimits)b=b2Math.b2Clamp(b,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),g=-this.m_motorMass*b,f=b2Math.b2Abs(b);else if(this.m_limitState==
b2Joint.e_atLowerLimit)b-=this.m_lowerAngle,f=b2Math.b2Max(0,-b),b=b2Math.b2Clamp(b+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),g=-this.m_motorMass*b,b=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+g,0),g=this.m_limitPositionImpulse-b;else if(this.m_limitState==b2Joint.e_atUpperLimit)b-=this.m_upperAngle,f=b2Math.b2Max(0,b),b=b2Math.b2Clamp(b-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),g=-this.m_motorMass*
b,b=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+g,0),g=this.m_limitPositionImpulse-b;c.m_sweep.a-=c.m_invI*g;d.m_sweep.a+=d.m_invI*g;c.SynchronizeTransform();d.SynchronizeTransform()}return e<=b2Settings.b2_linearSlop&&f<=b2Settings.b2_angularSlop};var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype);a=b2PrismaticJoint.prototype;
a._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
a.__constructor=function(b){this._super(b);this.m_localAnchor1.SetV(b.localAnchor1);this.m_localAnchor2.SetV(b.localAnchor2);this.m_localXAxis1.SetV(b.localAxis1);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=b.referenceAngle;this.m_linearJacobian.SetZero();this.m_torque=this.m_angularMass=this.m_force=this.m_linearMass=0;this.m_motorJacobian.SetZero();this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=this.m_motorMass=0;this.m_lowerTranslation=
b.lowerTranslation;this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor};a.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_localXAxis1=new b2Vec2;this.m_localYAxis1=new b2Vec2;this.m_linearJacobian=new b2Jacobian;this.m_motorJacobian=new b2Jacobian};a.m_localAnchor1=new b2Vec2;a.m_localAnchor2=new b2Vec2;a.m_localXAxis1=new b2Vec2;
a.m_localYAxis1=new b2Vec2;a.m_refAngle=null;a.m_linearJacobian=new b2Jacobian;a.m_linearMass=null;a.m_force=null;a.m_angularMass=null;a.m_torque=null;a.m_motorJacobian=new b2Jacobian;a.m_motorMass=null;a.m_motorForce=null;a.m_limitForce=null;a.m_limitPositionImpulse=null;a.m_lowerTranslation=null;a.m_upperTranslation=null;a.m_maxMotorForce=null;a.m_motorSpeed=null;a.m_enableLimit=null;a.m_enableMotor=null;a.m_limitState=0;a.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};
a.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
a.GetReactionForce=function(){var b=this.m_body1.m_xf.R;return new b2Vec2(this.m_limitForce*this.m_limitForce*(b.col1.x*this.m_localXAxis1.x+b.col2.x*this.m_localXAxis1.y)+this.m_force*this.m_force*(b.col1.x*this.m_localYAxis1.x+b.col2.x*this.m_localYAxis1.y),this.m_limitForce*this.m_limitForce*(b.col1.y*this.m_localXAxis1.x+b.col2.y*this.m_localXAxis1.y)+this.m_force*this.m_force*(b.col1.y*this.m_localYAxis1.x+b.col2.y*this.m_localYAxis1.y))};a.GetReactionTorque=function(){return this.m_torque};
a.GetJointTranslation=function(){var b=this.m_body1,c=this.m_body2,d=b.GetWorldPoint(this.m_localAnchor1),e=c.GetWorldPoint(this.m_localAnchor2);c=e.x-d.x;d=e.y-d.y;b=b.GetWorldVector(this.m_localXAxis1);return b.x*c+b.y*d};
a.GetJointSpeed=function(){var b=this.m_body1,c=this.m_body2,d;d=b.m_xf.R;var e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,g=d.col1.x*e+d.col2.x*f;f=d.col1.y*e+d.col2.y*f;e=g;d=c.m_xf.R;var h=this.m_localAnchor2.x-c.m_sweep.localCenter.x,i=this.m_localAnchor2.y-c.m_sweep.localCenter.y;g=d.col1.x*h+d.col2.x*i;i=d.col1.y*h+d.col2.y*i;h=g;d=c.m_sweep.c.x+h-(b.m_sweep.c.x+e);g=c.m_sweep.c.y+i-(b.m_sweep.c.y+f);var j=b.GetWorldVector(this.m_localXAxis1),
k=b.m_linearVelocity,l=c.m_linearVelocity;b=b.m_angularVelocity;c=c.m_angularVelocity;return d*-b*j.y+g*b*j.x+(j.x*(l.x+-c*i-k.x- -b*f)+j.y*(l.y+c*h-k.y-b*e))};a.IsLimitEnabled=function(){return this.m_enableLimit};a.EnableLimit=function(b){this.m_enableLimit=b};a.GetLowerLimit=function(){return this.m_lowerTranslation};a.GetUpperLimit=function(){return this.m_upperTranslation};a.SetLimits=function(b,c){this.m_lowerTranslation=b;this.m_upperTranslation=c};a.IsMotorEnabled=function(){return this.m_enableMotor};
a.EnableMotor=function(b){this.m_enableMotor=b};a.SetMotorSpeed=function(b){this.m_motorSpeed=b};a.GetMotorSpeed=function(){return this.m_motorSpeed};a.SetMaxMotorForce=function(b){this.m_maxMotorForce=b};a.GetMotorForce=function(){return this.m_motorForce};
a.InitVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e,f;e=c.m_xf.R;var g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y;f=e.col1.x*g+e.col2.x*h;h=e.col1.y*g+e.col2.y*h;g=f;e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=e.col1.x*i+e.col2.x*j;j=e.col1.y*i+e.col2.y*j;i=f;f=c.m_invMass;var k=d.m_invMass,l=c.m_invI,m=d.m_invI;e=c.m_xf.R;var n=e.col1.x*this.m_localYAxis1.x+
e.col2.x*this.m_localYAxis1.y;e=e.col1.y*this.m_localYAxis1.x+e.col2.y*this.m_localYAxis1.y;var o=d.m_sweep.c.x+i-c.m_sweep.c.x,p=d.m_sweep.c.y+j-c.m_sweep.c.y;this.m_linearJacobian.linear1.x=-n;this.m_linearJacobian.linear1.y=-e;this.m_linearJacobian.linear2.x=n;this.m_linearJacobian.linear2.y=e;this.m_linearJacobian.angular1=-(o*e-p*n);this.m_linearJacobian.angular2=i*e-j*n;this.m_linearMass=f+l*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+k+m*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2;
this.m_linearMass=1/this.m_linearMass;this.m_angularMass=l+m;if(this.m_angularMass>Number.MIN_VALUE)this.m_angularMass=1/this.m_angularMass;if(this.m_enableLimit||this.m_enableMotor)if(e=c.m_xf.R,n=e.col1.x*this.m_localXAxis1.x+e.col2.x*this.m_localXAxis1.y,e=e.col1.y*this.m_localXAxis1.x+e.col2.y*this.m_localXAxis1.y,this.m_motorJacobian.linear1.x=-n,this.m_motorJacobian.linear1.y=-e,this.m_motorJacobian.linear2.x=n,this.m_motorJacobian.linear2.y=e,this.m_motorJacobian.angular1=-(o*e-p*n),this.m_motorJacobian.angular2=
i*e-j*n,this.m_motorMass=f+l*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+k+m*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2,this.m_motorMass=1/this.m_motorMass,this.m_enableLimit)if(g=n*(o-g)+e*(p-h),b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop)this.m_limitState=b2Joint.e_equalLimits;else if(g<=this.m_lowerTranslation){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atLowerLimit}else if(g>=
this.m_upperTranslation){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitForce=0;if(this.m_enableMotor==!1)this.m_motorForce=0;if(this.m_enableLimit==!1)this.m_limitForce=0;b.warmStarting?(g=b.dt*(this.m_force*this.m_linearJacobian.linear1.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.y),h=b.dt*(this.m_force*this.m_linearJacobian.linear2.x+(this.m_motorForce+
this.m_limitForce)*this.m_motorJacobian.linear2.x),i=b.dt*(this.m_force*this.m_linearJacobian.linear2.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear2.y),j=b.dt*(this.m_force*this.m_linearJacobian.angular1-this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular1),o=b.dt*(this.m_force*this.m_linearJacobian.angular2+this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular2),c.m_linearVelocity.x+=f*b.dt*(this.m_force*this.m_linearJacobian.linear1.x+
(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.x),c.m_linearVelocity.y+=f*g,c.m_angularVelocity+=l*j,d.m_linearVelocity.x+=k*h,d.m_linearVelocity.y+=k*i,d.m_angularVelocity+=m*o):this.m_motorForce=this.m_limitForce=this.m_torque=this.m_force=0;this.m_limitPositionImpulse=0};
a.SolveVelocityConstraints=function(b){var c=this.m_body1,d=this.m_body2,e=c.m_invMass,f=d.m_invMass,g=c.m_invI,h=d.m_invI,i;i=this.m_linearJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);i*=-b.inv_dt*this.m_linearMass;this.m_force+=i;i*=b.dt;c.m_linearVelocity.x+=e*i*this.m_linearJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_linearJacobian.linear1.y;c.m_angularVelocity+=g*i*this.m_linearJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_linearJacobian.linear2.x;
d.m_linearVelocity.y+=f*i*this.m_linearJacobian.linear2.y;d.m_angularVelocity+=h*i*this.m_linearJacobian.angular2;i=-b.inv_dt*this.m_angularMass*(d.m_angularVelocity-c.m_angularVelocity);this.m_torque+=i;i*=b.dt;c.m_angularVelocity-=g*i;d.m_angularVelocity+=h*i;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){i=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity)-this.m_motorSpeed;i*=-b.inv_dt*this.m_motorMass;var j=this.m_motorForce;
this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+i,-this.m_maxMotorForce,this.m_maxMotorForce);i=this.m_motorForce-j;i*=b.dt;c.m_linearVelocity.x+=e*i*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=g*i*this.m_motorJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_motorJacobian.linear2.x;d.m_linearVelocity.y+=f*i*this.m_motorJacobian.linear2.y;d.m_angularVelocity+=h*i*this.m_motorJacobian.angular2}if(this.m_enableLimit&&this.m_limitState!=
b2Joint.e_inactiveLimit){i=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);j=-b.inv_dt*this.m_motorMass*i;if(this.m_limitState==b2Joint.e_equalLimits)this.m_limitForce+=j;else if(this.m_limitState==b2Joint.e_atLowerLimit)i=this.m_limitForce,this.m_limitForce=b2Math.b2Max(this.m_limitForce+j,0),j=this.m_limitForce-i;else if(this.m_limitState==b2Joint.e_atUpperLimit)i=this.m_limitForce,this.m_limitForce=b2Math.b2Min(this.m_limitForce+j,0),
j=this.m_limitForce-i;i=b.dt*j;c.m_linearVelocity.x+=e*i*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=e*i*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=g*i*this.m_motorJacobian.angular1;d.m_linearVelocity.x+=f*i*this.m_motorJacobian.linear2.x;d.m_linearVelocity.y+=f*i*this.m_motorJacobian.linear2.y;d.m_angularVelocity+=h*i*this.m_motorJacobian.angular2}};
a.SolvePositionConstraints=function(){var b,c,d=this.m_body1,e=this.m_body2,f=d.m_invMass,g=e.m_invMass,h=d.m_invI,i=e.m_invI,j,k;j=d.m_xf.R;var l=this.m_localAnchor1.x-d.m_sweep.localCenter.x,m=this.m_localAnchor1.y-d.m_sweep.localCenter.y;k=j.col1.x*l+j.col2.x*m;m=j.col1.y*l+j.col2.y*m;l=k;j=e.m_xf.R;var n=this.m_localAnchor2.x-e.m_sweep.localCenter.x;b=this.m_localAnchor2.y-e.m_sweep.localCenter.y;k=j.col1.x*n+j.col2.x*b;b=j.col1.y*n+j.col2.y*b;j=d.m_sweep.c.x+l;m=d.m_sweep.c.y+m;n=e.m_sweep.c.x+
k;b=e.m_sweep.c.y+b;n-=j;b-=m;j=d.m_xf.R;var o=(j.col1.x*this.m_localYAxis1.x+j.col2.x*this.m_localYAxis1.y)*n+(j.col1.y*this.m_localYAxis1.x+j.col2.y*this.m_localYAxis1.y)*b;o=b2Math.b2Clamp(o,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);c=-this.m_linearMass*o;d.m_sweep.c.x+=f*c*this.m_linearJacobian.linear1.x;d.m_sweep.c.y+=f*c*this.m_linearJacobian.linear1.y;d.m_sweep.a+=h*c*this.m_linearJacobian.angular1;e.m_sweep.c.x+=g*c*this.m_linearJacobian.linear2.x;e.m_sweep.c.y+=
g*c*this.m_linearJacobian.linear2.y;e.m_sweep.a+=i*c*this.m_linearJacobian.angular2;o=b2Math.b2Abs(o);c=e.m_sweep.a-d.m_sweep.a-this.m_refAngle;c=b2Math.b2Clamp(c,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var p=-this.m_angularMass*c;d.m_sweep.a-=d.m_invI*p;e.m_sweep.a+=e.m_invI*p;d.SynchronizeTransform();e.SynchronizeTransform();p=b2Math.b2Abs(c);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){j=d.m_xf.R;l=this.m_localAnchor1.x-d.m_sweep.localCenter.x;
m=this.m_localAnchor1.y-d.m_sweep.localCenter.y;k=j.col1.x*l+j.col2.x*m;m=j.col1.y*l+j.col2.y*m;l=k;j=e.m_xf.R;n=this.m_localAnchor2.x-e.m_sweep.localCenter.x;b=this.m_localAnchor2.y-e.m_sweep.localCenter.y;k=j.col1.x*n+j.col2.x*b;b=j.col1.y*n+j.col2.y*b;j=d.m_sweep.c.x+l;m=d.m_sweep.c.y+m;n=e.m_sweep.c.x+k;b=e.m_sweep.c.y+b;n-=j;b-=m;j=d.m_xf.R;j=(j.col1.x*this.m_localXAxis1.x+j.col2.x*this.m_localXAxis1.y)*n+(j.col1.y*this.m_localXAxis1.x+j.col2.y*this.m_localXAxis1.y)*b;b=0;if(this.m_limitState==
b2Joint.e_equalLimits)b=b2Math.b2Clamp(j,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),b*=-this.m_motorMass,o=b2Math.b2Max(o,b2Math.b2Abs(c));else if(this.m_limitState==b2Joint.e_atLowerLimit)b=j-this.m_lowerTranslation,o=b2Math.b2Max(o,-b),b=b2Math.b2Clamp(b+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),b*=-this.m_motorMass,c=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+b,0),b=this.m_limitPositionImpulse-
c;else if(this.m_limitState==b2Joint.e_atUpperLimit)b=j-this.m_upperTranslation,o=b2Math.b2Max(o,b),b=b2Math.b2Clamp(b-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),b*=-this.m_motorMass,c=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+b,0),b=this.m_limitPositionImpulse-c;d.m_sweep.c.x+=f*b*this.m_motorJacobian.linear1.x;d.m_sweep.c.y+=f*b*this.m_motorJacobian.linear1.y;d.m_sweep.a+=h*b*this.m_motorJacobian.angular1;e.m_sweep.c.x+=g*
b*this.m_motorJacobian.linear2.x;e.m_sweep.c.y+=g*b*this.m_motorJacobian.linear2.y;e.m_sweep.a+=i*b*this.m_motorJacobian.angular2;d.SynchronizeTransform();e.SynchronizeTransform()}return o<=b2Settings.b2_linearSlop&&p<=b2Settings.b2_angularSlop};var ClipVertex=function(){this.__varz();this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){};ClipVertex.prototype.__varz=function(){this.v=new b2Vec2;this.id=new b2ContactID};ClipVertex.prototype.v=new b2Vec2;
ClipVertex.prototype.id=new b2ContactID;var b2NullContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype);a=b2NullContact.prototype;a._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};a.__constructor=function(){};a.__varz=function(){};a.Evaluate=function(){};a.GetManifolds=function(){return null};
var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype);b2PolyAndCircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};
b2PolyAndCircleContact.prototype.__constructor=function(b,c){this._super(b,c);this.m_manifold=this.m_manifolds[0];b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polygonShape);b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape);this.m_manifold.pointCount=0;b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};b2PolyAndCircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2PolyAndCircleContact.s_evalCP=new b2ContactPoint;
b2PolyAndCircleContact.Create=function(b,c){return new b2PolyAndCircleContact(b,c)};b2PolyAndCircleContact.Destroy=function(){};a=b2PolyAndCircleContact.prototype;a.m_manifolds=[new b2Manifold];a.m0=new b2Manifold;a.m_manifold=null;
a.Evaluate=function(b){var c=0,d,e,f,g=this.m_shape1.m_body,h=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygonAndCircle(this.m_manifold,this.m_shape1,g.m_xf,this.m_shape2,h.m_xf);var i=[!1,!1],j=b2PolyAndCircleContact.s_evalCP;j.shape1=this.m_shape1;j.shape2=this.m_shape2;j.friction=this.m_friction;j.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(c=0;c<this.m_manifold.pointCount;++c){var k=this.m_manifold.points[c];k.normalImpulse=0;k.tangentImpulse=
0;var l=!1,m=k.id._key;for(d=0;d<this.m0.pointCount;++d)if(i[d]!=!0&&(f=this.m0.points[d],f.id._key==m)){i[d]=!0;k.normalImpulse=f.normalImpulse;k.tangentImpulse=f.tangentImpulse;l=!0;if(b!=null)j.position=g.GetWorldPoint(k.localPoint1),d=g.GetLinearVelocityFromLocalPoint(k.localPoint1),e=h.GetLinearVelocityFromLocalPoint(k.localPoint2),j.velocity.Set(e.x-d.x,e.y-d.y),j.normal.SetV(this.m_manifold.normal),j.separation=k.separation,j.id.key=m,b.Persist(j);break}if(l==!1&&b!=null)j.position=g.GetWorldPoint(k.localPoint1),
d=g.GetLinearVelocityFromLocalPoint(k.localPoint1),e=h.GetLinearVelocityFromLocalPoint(k.localPoint2),j.velocity.Set(e.x-d.x,e.y-d.y),j.normal.SetV(this.m_manifold.normal),j.separation=k.separation,j.id.key=m,b.Add(j)}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(b!=null)for(c=0;c<this.m0.pointCount;++c)if(!i[c])f=this.m0.points[c],j.position=g.GetWorldPoint(f.localPoint1),d=g.GetLinearVelocityFromLocalPoint(f.localPoint1),e=h.GetLinearVelocityFromLocalPoint(f.localPoint2),j.velocity.Set(e.x-
d.x,e.y-d.y),j.normal.SetV(this.m0.normal),j.separation=f.separation,j.id.key=f.id._key,b.Remove(j)};a.GetManifolds=function(){return this.m_manifolds};var b2ContactManager=function(){b2PairCallback.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2ContactManager.prototype,b2PairCallback.prototype);b2ContactManager.prototype._super=function(){b2PairCallback.prototype.__constructor.apply(this,arguments)};
b2ContactManager.prototype.__constructor=function(){this.m_world=null;this.m_destroyImmediate=!1};b2ContactManager.prototype.__varz=function(){this.m_nullContact=new b2NullContact};b2ContactManager.s_evalCP=new b2ContactPoint;a=b2ContactManager.prototype;a.m_world=null;a.m_nullContact=new b2NullContact;a.m_destroyImmediate=null;
a.PairAdded=function(b,c){var d=b.m_body,e=c.m_body;if(d.IsStatic()&&e.IsStatic())return this.m_nullContact;if(b.m_body==c.m_body)return this.m_nullContact;if(e.IsConnected(d))return this.m_nullContact;if(this.m_world.m_contactFilter!=null&&this.m_world.m_contactFilter.ShouldCollide(b,c)==!1)return this.m_nullContact;var f=b2Contact.Create(b,c,this.m_world.m_blockAllocator);if(f==null)return this.m_nullContact;b=f.m_shape1;c=f.m_shape2;d=b.m_body;e=c.m_body;f.m_prev=null;f.m_next=this.m_world.m_contactList;
if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=f;this.m_world.m_contactList=f;f.m_node1.contact=f;f.m_node1.other=e;f.m_node1.prev=null;f.m_node1.next=d.m_contactList;if(d.m_contactList!=null)d.m_contactList.prev=f.m_node1;d.m_contactList=f.m_node1;f.m_node2.contact=f;f.m_node2.other=d;f.m_node2.prev=null;f.m_node2.next=e.m_contactList;if(e.m_contactList!=null)e.m_contactList.prev=f.m_node2;e.m_contactList=f.m_node2;++this.m_world.m_contactCount;return f};
a.PairRemoved=function(b,c,d){d!=null&&d!=this.m_nullContact&&this.Destroy(d)};
a.Destroy=function(b){var c=b.m_shape1,d=b.m_shape2,e=b.m_manifoldCount;if(e>0&&this.m_world.m_contactListener){var f=c.m_body,g=d.m_body,h=b.GetManifolds(),i=b2ContactManager.s_evalCP;i.shape1=b.m_shape1;i.shape2=b.m_shape1;i.friction=b.m_friction;i.restitution=b.m_restitution;for(var j=0;j<e;++j){var k=h[j];i.normal.SetV(k.normal);for(var l=0;l<k.pointCount;++l){var m=k.points[l];i.position=f.GetWorldPoint(m.localPoint1);var n=f.GetLinearVelocityFromLocalPoint(m.localPoint1),o=g.GetLinearVelocityFromLocalPoint(m.localPoint2);
i.velocity.Set(o.x-n.x,o.y-n.y);i.separation=m.separation;i.id.key=m.id._key;this.m_world.m_contactListener.Remove(i)}}}if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_world.m_contactList)this.m_world.m_contactList=b.m_next;c=c.m_body;d=d.m_body;if(b.m_node1.prev)b.m_node1.prev.next=b.m_node1.next;if(b.m_node1.next)b.m_node1.next.prev=b.m_node1.prev;if(b.m_node1==c.m_contactList)c.m_contactList=b.m_node1.next;if(b.m_node2.prev)b.m_node2.prev.next=b.m_node2.next;
if(b.m_node2.next)b.m_node2.next.prev=b.m_node2.prev;if(b.m_node2==d.m_contactList)d.m_contactList=b.m_node2.next;b2Contact.Destroy(b,this.m_world.m_blockAllocator);--this.m_world.m_contactCount};a.Collide=function(){for(var b=this.m_world.m_contactList;b;b=b.m_next){var c=b.m_shape2.m_body;b.m_shape1.m_body.IsSleeping()&&c.IsSleeping()||b.Update(this.m_world.m_contactListener)}};var b2World=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2World.prototype.__constructor=function(b,c,d){this.m_boundaryListener=this.m_destructionListener=null;this.m_contactFilter=b2ContactFilter.b2_defaultFilter;this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_contactListener=null;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;b2World.m_positionCorrection=!0;b2World.m_warmStarting=!0;b2World.m_continuousPhysics=!0;this.m_allowSleep=d;this.m_gravity=c;this.m_lock=!1;this.m_inv_dt0=0;this.m_contactManager.m_world=this;
this.m_broadPhase=new b2BroadPhase(b,this.m_contactManager);this.m_groundBody=this.CreateBody(new b2BodyDef)};b2World.prototype.__varz=function(){this.m_raycastNormal=new b2Vec2;this.m_contactManager=new b2ContactManager};b2World.m_positionCorrection=null;b2World.m_warmStarting=null;b2World.m_continuousPhysics=null;b2World.s_jointColor=new b2Color(0.5,0.8,0.8);b2World.s_coreColor=new b2Color(0.9,0.6,0.6);b2World.s_xf=new b2XForm;a=b2World.prototype;a.m_raycastUserData=null;a.m_raycastSegment=null;
a.m_raycastNormal=new b2Vec2;a.m_blockAllocator=null;a.m_stackAllocator=null;a.m_lock=null;a.m_broadPhase=null;a.m_contactManager=new b2ContactManager;a.m_bodyList=null;a.m_jointList=null;a.m_contactList=null;a.m_bodyCount=0;a.m_contactCount=0;a.m_jointCount=0;a.m_gravity=null;a.m_allowSleep=null;a.m_groundBody=null;a.m_destructionListener=null;a.m_boundaryListener=null;a.m_contactFilter=null;a.m_contactListener=null;a.m_debugDraw=null;a.m_inv_dt0=null;a.m_positionIterationCount=0;
a.SetDestructionListener=function(b){this.m_destructionListener=b};a.SetBoundaryListener=function(b){this.m_boundaryListener=b};a.SetContactFilter=function(b){this.m_contactFilter=b};a.SetContactListener=function(b){this.m_contactListener=b};a.SetDebugDraw=function(b){this.m_debugDraw=b};a.Validate=function(){this.m_broadPhase.Validate()};a.GetProxyCount=function(){return this.m_broadPhase.m_proxyCount};a.GetPairCount=function(){return this.m_broadPhase.m_pairManager.m_pairCount};
a.CreateBody=function(b){if(this.m_lock==!0)return null;b=new b2Body(b,this);b.m_prev=null;if(b.m_next=this.m_bodyList)this.m_bodyList.m_prev=b;this.m_bodyList=b;++this.m_bodyCount;return b};
a.DestroyBody=function(b){if(this.m_lock!=!0){for(var c=b.m_jointList;c;){var d=c;c=c.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(d.joint);this.DestroyJoint(d.joint)}for(c=b.m_shapeList;c;)d=c,c=c.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeShape(d),d.DestroyProxy(this.m_broadPhase),b2Shape.Destroy(d,this.m_blockAllocator);if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_bodyList)this.m_bodyList=b.m_next;
--this.m_bodyCount}};
a.CreateJoint=function(b){var c=b2Joint.Create(b,this.m_blockAllocator);c.m_prev=null;if(c.m_next=this.m_jointList)this.m_jointList.m_prev=c;this.m_jointList=c;++this.m_jointCount;c.m_node1.joint=c;c.m_node1.other=c.m_body2;c.m_node1.prev=null;if(c.m_node1.next=c.m_body1.m_jointList)c.m_body1.m_jointList.prev=c.m_node1;c.m_body1.m_jointList=c.m_node1;c.m_node2.joint=c;c.m_node2.other=c.m_body1;c.m_node2.prev=null;if(c.m_node2.next=c.m_body2.m_jointList)c.m_body2.m_jointList.prev=c.m_node2;c.m_body2.m_jointList=
c.m_node2;if(b.collideConnected==!1){b=b.body1.m_shapeCount<b.body2.m_shapeCount?b.body1:b.body2;for(var d=b.m_shapeList;d;d=d.m_next)d.RefilterProxy(this.m_broadPhase,b.m_xf)}return c};
a.DestroyJoint=function(b){var c=b.m_collideConnected;if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_jointList)this.m_jointList=b.m_next;var d=b.m_body1,e=b.m_body2;d.WakeUp();e.WakeUp();if(b.m_node1.prev)b.m_node1.prev.next=b.m_node1.next;if(b.m_node1.next)b.m_node1.next.prev=b.m_node1.prev;if(b.m_node1==d.m_jointList)d.m_jointList=b.m_node1.next;b.m_node1.prev=null;b.m_node1.next=null;if(b.m_node2.prev)b.m_node2.prev.next=b.m_node2.next;if(b.m_node2.next)b.m_node2.next.prev=
b.m_node2.prev;if(b.m_node2==e.m_jointList)e.m_jointList=b.m_node2.next;b.m_node2.prev=null;b.m_node2.next=null;b2Joint.Destroy(b,this.m_blockAllocator);--this.m_jointCount;if(c==!1){b=d.m_shapeCount<e.m_shapeCount?d:e;for(c=b.m_shapeList;c;c=c.m_next)c.RefilterProxy(this.m_broadPhase,b.m_xf)}};a.Refilter=function(b){b.RefilterProxy(this.m_broadPhase,b.m_body.m_xf)};a.SetWarmStarting=function(b){b2World.m_warmStarting=b};a.SetPositionCorrection=function(b){b2World.m_positionCorrection=b};
a.SetContinuousPhysics=function(b){b2World.m_continuousPhysics=b};a.GetBodyCount=function(){return this.m_bodyCount};a.GetJointCount=function(){return this.m_jointCount};a.GetContactCount=function(){return this.m_contactCount};a.SetGravity=function(b){this.m_gravity=b};a.GetGroundBody=function(){return this.m_groundBody};
a.Step=function(b,c){this.m_lock=!0;var d=new b2TimeStep;d.dt=b;d.maxIterations=c;d.inv_dt=b>0?1/b:0;d.dtRatio=this.m_inv_dt0*b;d.positionCorrection=b2World.m_positionCorrection;d.warmStarting=b2World.m_warmStarting;this.m_contactManager.Collide();d.dt>0&&this.Solve(d);b2World.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d);this.DrawDebugData();this.m_inv_dt0=d.inv_dt;this.m_lock=!1};a.Query=function(b,c,d){var e=Array(d);b=this.m_broadPhase.QueryAABB(b,e,d);for(d=0;d<b;++d)c[d]=e[d];return b};
a.Raycast=function(b,c,d,e,f){var g=Array(d);this.m_raycastSegment=b;this.m_raycastUserData=f;f=e?this.m_broadPhase.QuerySegment(b,g,d,this.RaycastSortKey):this.m_broadPhase.QuerySegment(b,g,d,this.RaycastSortKey2);for(b=0;b<f;++b)c[b]=g[b];return f};a.RaycastOne=function(b,c,d,e,f){var g=Array(1);e=this.Raycast(b,g,1,e,f);if(e==0)return null;e>1&&trace(e);g=g[0];e=g.GetBody().GetXForm();g.TestSegment(e,c,d,b,1);return g};a.GetBodyList=function(){return this.m_bodyList};a.GetJointList=function(){return this.m_jointList};
a.Solve=function(b){var c;this.m_positionIterationCount=0;var d=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator,this.m_contactListener);for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~b2Body.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~b2Contact.e_islandFlag;for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=!1;e=Array(this.m_bodyCount);for(var f=this.m_bodyList;f;f=f.m_next)if(!(f.m_flags&(b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag))&&
!f.IsStatic()){d.Clear();var g=0;e[g++]=f;for(f.m_flags|=b2Body.e_islandFlag;g>0;)if(c=e[--g],d.AddBody(c),c.m_flags&=~b2Body.e_sleepFlag,!c.IsStatic()){for(var h,i=c.m_contactList;i;i=i.next)if(!(i.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_nonSolidFlag))&&i.contact.m_manifoldCount!=0)d.AddContact(i.contact),i.contact.m_flags|=b2Contact.e_islandFlag,h=i.other,h.m_flags&b2Body.e_islandFlag||(e[g++]=h,h.m_flags|=b2Body.e_islandFlag);for(c=c.m_jointList;c;c=c.next)if(c.joint.m_islandFlag!=
!0)d.AddJoint(c.joint),c.joint.m_islandFlag=!0,h=c.other,h.m_flags&b2Body.e_islandFlag||(e[g++]=h,h.m_flags|=b2Body.e_islandFlag)}d.Solve(b,this.m_gravity,b2World.m_positionCorrection,this.m_allowSleep);if(d.m_positionIterationCount>this.m_positionIterationCount)this.m_positionIterationCount=d.m_positionIterationCount;for(g=0;g<d.m_bodyCount;++g)c=d.m_bodies[g],c.IsStatic()&&(c.m_flags&=~b2Body.e_islandFlag)}for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag)||c.IsStatic()||
c.SynchronizeShapes()==!1&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(c);this.m_broadPhase.Commit()};
a.SolveTOI=function(b){var c,d,e,f=new b2Island(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,0,this.m_stackAllocator,this.m_contactListener),g=Array(this.m_bodyCount);for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~b2Body.e_islandFlag,c.m_sweep.t0=0;var h;for(h=this.m_contactList;h;h=h.m_next)h.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(;;){c=null;var i=1;for(h=this.m_contactList;h;h=h.m_next)if(!(h.m_flags&(b2Contact.e_slowFlag|b2Contact.e_nonSolidFlag))){if(h.m_flags&b2Contact.e_toiFlag)d=
h.m_toi;else{d=h.m_shape1;e=h.m_shape2;d=d.m_body;e=e.m_body;if((d.IsStatic()||d.IsSleeping())&&(e.IsStatic()||e.IsSleeping()))continue;var j=d.m_sweep.t0;if(d.m_sweep.t0<e.m_sweep.t0)j=e.m_sweep.t0,d.m_sweep.Advance(j);else if(e.m_sweep.t0<d.m_sweep.t0)j=d.m_sweep.t0,e.m_sweep.Advance(j);d=b2TimeOfImpact.TimeOfImpact(h.m_shape1,d.m_sweep,h.m_shape2,e.m_sweep);d>0&&d<1&&(d=(1-d)*j+d,d>1&&(d=1));h.m_toi=d;h.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<d&&d<i&&(c=h,i=d)}if(c==null||1-100*Number.MIN_VALUE<
i)break;d=c.m_shape1;e=c.m_shape2;d=d.m_body;e=e.m_body;d.Advance(i);e.Advance(i);c.Update(this.m_contactListener);c.m_flags&=~b2Contact.e_toiFlag;if(c.m_manifoldCount!=0){c=d;c.IsStatic()&&(c=e);f.Clear();h=0;g[h++]=c;for(c.m_flags|=b2Body.e_islandFlag;h>0;)if(c=g[--h],f.AddBody(c),c.m_flags&=~b2Body.e_sleepFlag,!c.IsStatic())for(c=c.m_contactList;c;c=c.next)if(f.m_contactCount!=f.m_contactCapacity&&!(c.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_slowFlag|b2Contact.e_nonSolidFlag))&&c.contact.m_manifoldCount!=
0)f.AddContact(c.contact),c.contact.m_flags|=b2Contact.e_islandFlag,d=c.other,d.m_flags&b2Body.e_islandFlag||(d.IsStatic()==!1&&(d.Advance(i),d.WakeUp()),g[h++]=d,d.m_flags|=b2Body.e_islandFlag);h=new b2TimeStep;h.dt=(1-i)*b.dt;h.inv_dt=1/h.dt;h.maxIterations=b.maxIterations;f.SolveTOI(h);for(i=i=0;i<f.m_bodyCount;++i)if(c=f.m_bodies[i],c.m_flags&=~b2Body.e_islandFlag,!(c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag))&&!c.IsStatic()){c.SynchronizeShapes()==!1&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(c);
for(c=c.m_contactList;c;c=c.next)c.contact.m_flags&=~b2Contact.e_toiFlag}for(i=0;i<f.m_contactCount;++i)h=f.m_contacts[i],h.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);this.m_broadPhase.Commit()}}};
a.DrawJoint=function(b){var c=b.m_body1,d=b.m_body2,e=c.m_xf.position,f=d.m_xf.position,g=b.GetAnchor1(),h=b.GetAnchor2(),i=b2World.s_jointColor;switch(b.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(g,h,i);break;case b2Joint.e_pulleyJoint:c=b.GetGroundAnchor1();b=b.GetGroundAnchor2();this.m_debugDraw.DrawSegment(c,g,i);this.m_debugDraw.DrawSegment(b,h,i);this.m_debugDraw.DrawSegment(c,b,i);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(g,h,i);break;default:c!=this.m_groundBody&&
this.m_debugDraw.DrawSegment(e,g,i),this.m_debugDraw.DrawSegment(g,h,i),d!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,h,i)}};
a.DrawShape=function(b,c,d,e){var f=b2World.s_coreColor;switch(b.m_type){case b2Shape.e_circleShape:var g=b2Math.b2MulX(c,b.m_localPosition);b=b.m_radius;this.m_debugDraw.DrawSolidCircle(g,b,c.R.col1,d);e&&this.m_debugDraw.DrawCircle(g,b-b2Settings.b2_toiSlop,f);break;case b2Shape.e_polygonShape:var h=b.GetVertexCount(),i=b.GetVertices(),j=Array(b2Settings.b2_maxPolygonVertices);for(g=0;g<h;++g)j[g]=b2Math.b2MulX(c,i[g]);this.m_debugDraw.DrawSolidPolygon(j,h,d);if(e){d=b.GetCoreVertices();for(g=0;g<
h;++g)j[g]=b2Math.b2MulX(c,d[g]);this.m_debugDraw.DrawPolygon(j,h,f)}}};
a.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var b=this.m_debugDraw.GetFlags(),c=0,d,e,f=new b2Vec2,g=new b2Vec2,h=new b2Vec2,i=new b2Color(0,0,0),j,k=new b2AABB,l=new b2AABB,m=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];if(b&b2DebugDraw.e_shapeBit){c=(b&b2DebugDraw.e_coreShapeBit)==b2DebugDraw.e_coreShapeBit;for(d=this.m_bodyList;d;d=d.m_next){j=d.m_xf;for(e=d.GetShapeList();e;e=e.m_next)d.IsStatic()?this.DrawShape(e,j,new b2Color(0.5,0.9,0.5),
c):d.IsSleeping()?this.DrawShape(e,j,new b2Color(0.5,0.5,0.9),c):this.DrawShape(e,j,new b2Color(0.9,0.9,0.9),c)}}if(b&b2DebugDraw.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(b&b2DebugDraw.e_pairBit){d=this.m_broadPhase;f.Set(1/d.m_quantizationFactor.x,1/d.m_quantizationFactor.y);i.Set(0.9,0.9,0.3);for(c=0;c<b2Pair.b2_tableCapacity;++c)for(e=d.m_pairManager.m_hashTable[c];e!=b2Pair.b2_nullPair;){e=d.m_pairManager.m_pairs[e];j=d.m_proxyPool[e.proxyId1];var n=d.m_proxyPool[e.proxyId2];
k.lowerBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][j.lowerBounds[0]].value;k.lowerBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][j.lowerBounds[1]].value;k.upperBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][j.upperBounds[0]].value;k.upperBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][j.upperBounds[1]].value;l.lowerBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][n.lowerBounds[0]].value;l.lowerBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][n.lowerBounds[1]].value;
l.upperBound.x=d.m_worldAABB.lowerBound.x+f.x*d.m_bounds[0][n.upperBounds[0]].value;l.upperBound.y=d.m_worldAABB.lowerBound.y+f.y*d.m_bounds[1][n.upperBounds[1]].value;g.x=0.5*(k.lowerBound.x+k.upperBound.x);g.y=0.5*(k.lowerBound.y+k.upperBound.y);h.x=0.5*(l.lowerBound.x+l.upperBound.x);h.y=0.5*(l.lowerBound.y+l.upperBound.y);this.m_debugDraw.DrawSegment(g,h,i);e=e.next}}if(b&b2DebugDraw.e_aabbBit){d=this.m_broadPhase;g=d.m_worldAABB.lowerBound;h=d.m_worldAABB.upperBound;f.Set(1/d.m_quantizationFactor.x,
1/d.m_quantizationFactor.y);i.Set(0.9,0.3,0.9);for(c=0;c<b2Settings.b2_maxProxies;++c)if(l=d.m_proxyPool[c],l.IsValid()!=!1)k.lowerBound.x=g.x+f.x*d.m_bounds[0][l.lowerBounds[0]].value,k.lowerBound.y=g.y+f.y*d.m_bounds[1][l.lowerBounds[1]].value,k.upperBound.x=g.x+f.x*d.m_bounds[0][l.upperBounds[0]].value,k.upperBound.y=g.y+f.y*d.m_bounds[1][l.upperBounds[1]].value,m[0].Set(k.lowerBound.x,k.lowerBound.y),m[1].Set(k.upperBound.x,k.lowerBound.y),m[2].Set(k.upperBound.x,k.upperBound.y),m[3].Set(k.lowerBound.x,
k.upperBound.y),this.m_debugDraw.DrawPolygon(m,4,i);m[0].Set(g.x,g.y);m[1].Set(h.x,g.y);m[2].Set(h.x,h.y);m[3].Set(g.x,h.y);this.m_debugDraw.DrawPolygon(m,4,new b2Color(0.3,0.9,0.9))}if(b&b2DebugDraw.e_obbBit){i.Set(0.5,0.3,0.5);for(d=this.m_bodyList;d;d=d.m_next){j=d.m_xf;for(e=d.GetShapeList();e;e=e.m_next)if(e.m_type==b2Shape.e_polygonShape){f=e.GetOBB();c=f.extents;m[0].Set(-c.x,-c.y);m[1].Set(c.x,-c.y);m[2].Set(c.x,c.y);m[3].Set(-c.x,c.y);for(c=0;c<4;++c)k=f.R,g=m[c],h=f.center.x+(k.col1.x*g.x+
k.col2.x*g.y),m[c].y=f.center.y+(k.col1.y*g.x+k.col2.y*g.y),m[c].x=h,k=j.R,h=j.position.x+(k.col1.x*g.x+k.col2.x*g.y),m[c].y=j.position.y+(k.col1.y*g.x+k.col2.y*g.y),m[c].x=h;this.m_debugDraw.DrawPolygon(m,4,i)}}}if(b&b2DebugDraw.e_centerOfMassBit)for(d=this.m_bodyList;d;d=d.m_next)j=b2World.s_xf,j.R=d.m_xf.R,j.position=d.GetWorldCenter(),this.m_debugDraw.DrawXForm(j)}};
a.RaycastSortKey=function(b){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,b))return-1;var c=b.GetBody().GetXForm(),d=[0];if(b.TestSegment(c,d,this.m_raycastNormal,this.m_raycastSegment,1)==b2Shape.e_missCollide)return-1;return d[0]};
a.RaycastSortKey2=function(b){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,b))return-1;var c=b.GetBody().GetXForm(),d=[0];if(b.TestSegment(c,d,this.m_raycastNormal,this.m_raycastSegment,1)!=b2Shape.e_hitCollide)return-1;return d[0]};var Rectangle=function(b,c,d,e){this.x=b;this.y=c;this.width=d;this.height=e};Rectangle.prototype.draw=function(b){b.fillRect(this.x,this.y,this.width,this.height);b.addClearRectangle(this)};
CanvasRenderingContext2D.prototype.dashedLine=function(b,c,d,e,f){var g=d-b,h=e-c,i=Math.sqrt(g*g+h*h),j=f*g/i;f=f*h/i;i=j;var k=f,l=!0;for(this.moveTo(b,c);Math.abs(g)>Math.abs(i)||Math.abs(h)>Math.abs(k);)l?this.lineTo(b+i,c+k):this.moveTo(b+i,c+k),l=!l,i+=j,k+=f;l?this.lineTo(d,e):this.moveTo(d,e)};CanvasRenderingContext2D.prototype.clearRects=[];CanvasRenderingContext2D.prototype.addClearRectangle=function(b){this.clearRects.push(b)};
CanvasRenderingContext2D.prototype.clearRectangles=function(){var b;for(b=0;b<this.clearRects.length;b++)this.clearRect(this.clearRects[b].x-1,this.clearRects[b].y-1,this.clearRects[b].width+2,this.clearRects[b].height+2)};CanvasRenderingContext2D.prototype.clearShadow=function(){this.shadowColor="rgba(0, 0, 0, 0)"};Array.prototype.shuffle=function(){var b=this.length;if(b<2)return!1;do{var c=Math.floor(Math.random()*b),d=this[c];this[c]=this[--b];this[b]=d}while(b);return!0};
Date.prototype.getMonthName=function(){return["January","February","March","April","May","June","July","August","September","October","November","December"][this.getMonth()]};Date.prototype.getFormatHours=function(){if(this.getHours()===12)return 12;return this.fullString(this.getHours()%12)};Date.prototype.getFormatMinutes=function(){return this.fullString(this.getMinutes())};Date.prototype.fullString=function(b){b=b.toString();if(b.length===1)return"0"+b;return b};
Date.prototype.getDayTime=function(){if(this.getHours()>11)return"PM";return"AM"};function getAbsolutePosition(b){var c={x:b.offsetLeft,y:b.offsetTop};b.offsetParent&&(b=getAbsolutePosition(b.offsetParent),c.x+=b.x,c.y+=b.y);return c}
function getRelativeCoordinates(b,c){var d,e,f,g;b=b||window.event;var h=b.target||b.srcElement;if(!window.opera&&typeof b.offsetX!=="undefined"){g={x:b.offsetX,y:b.offsetY};for(f=h;f;)f.mouseX=g.x,f.mouseY=g.y,g.x+=f.offsetLeft,g.y+=f.offsetTop,f=f.offsetParent;f=c;for(g={x:0,y:0};f;){if(typeof f.mouseX!=="undefined"){d=f.mouseX-g.x;e=f.mouseY-g.y;break}g.x+=f.offsetLeft;g.y+=f.offsetTop;f=f.offsetParent}for(f=h;f;)f.mouseX=void 0,f.mouseY=void 0,f=f.offsetParent}else g=getAbsolutePosition(c),d=
b.pageX-g.x,e=b.pageY-g.y;return{x:d,y:e}}function testShadowOffsetTransform(){var b=document.createElement("canvas");b.width=b.height=8;b=b.getContext("2d");b.shadowColor="rgba(255, 255, 255, 1.0)";b.shadowOffsetX=4;b.translate(1.5,1.5);b.rotate(Math.PI/2);b.fillStyle="#000000";b.fillRect(-2,-2,4,4);return b.getImageData(1,5,1,1).data[0]===255}
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,25)}}();var Pattern={};Pattern.image={};Pattern.onload=null;Pattern.loaded=0;Pattern.total=0;Pattern.onLoaded=function(){Pattern.loaded++;if(Pattern.loaded===Pattern.total&&Pattern.onload)Pattern.onload()};
Pattern.loadPattern=function(b){var c,d=function(){Pattern.context.createPattern&&(Pattern[this.name]=Pattern.context.createPattern(this,"repeat"),Pattern.onLoaded())};Pattern.total=b.length;for(c=0;c<b.length;c++){var e=new Image;e.src=b[c].path;e.name=b[c].name;Pattern.image[b[c].name]=e;e.onload=d}};var Event=Class.create({initialize:function(b){this.type=b;this.mouseY=this.mouseX=this.parameter=null}});
EventEngine=Class.create({initialize:function(){this.listeners=[];this.state={type:"unknown"};this.clickTimeout=this.latestEvent=null;this.clickTime=250;var b=this;document.body.onmousedown=function(c){b.onMouseDown.call(b,c)};document.body.onmouseup=function(c){b.onMouseUp.call(b,c)};document.body.onmousemove=function(c){b.onMouseMove.call(b,c)}},addListener:function(b,c,d){this.listeners.push({type:b,closure:c,thisArgument:d})},removeListener:function(b,c){var d;for(d=0;d<this.listeners.length;d++)this.listeners[d].type===
b&&this.listeners[d].closure===c&&this.listeners.splice(d,1)},dispatchEvent:function(b){var c;this.latestEvent=b;for(c=0;c<this.listeners.length;c++)this.listeners[c].type===b.type&&this.listeners[c].closure.call(this.listeners[c].thisArgument,b)},onMouseDown:function(b){var c=getRelativeCoordinates(b,$("editor")),d=new Event("mouseDown");d.parameter=b;d.mouseX=c.x;d.mouseY=c.y;this.dispatchEvent(d);this.state={type:"down",x:c.x,y:c.y};var e=this;this.clickTimeoutID=setTimeout(function(b,c){e.onClickTimeout(b,
c)},this.clickTime,c,b)},onMouseUp:function(b){if(this.clickTimeoutID)clearTimeout(this.clickTimeoutID),this.clickTimeoutID=null;var c;this.state.type==="drag"?c="stopDrag":this.state.type==="down"&&(c="click");var d=getRelativeCoordinates(b,$("editor"));c=new Event(c);c.parameter=b;c.mouseX=d.x;c.mouseY=d.y;this.state.type="up";this.dispatchEvent(c)},onMouseMove:function(b){var c=getRelativeCoordinates(b,$("editor")),d=new Event("mouseMove");d.parameter=b;d.mouseX=c.x;d.mouseY=c.y;this.dispatchEvent(d);
if(this.state.type!=="up")d.type="drag",this.dispatchEvent(d);if(this.state.type==="down"&&function(b,c,d,h){b=d-b;c=h-c;return Math.sqrt(b*b+c*c)}(this.state.x,this.state.y,c.x,c.y)>5)this.onClickTimeout({x:this.state.x,y:this.state.y})},onClickTimeout:function(b,c){if(this.state.type==="down"){this.clickTimeoutID=null;this.state.type="drag";var d=new Event("startDrag");d.parameter=c;d.mouseX=b.x;d.mouseY=b.y;this.dispatchEvent(d)}}});
var DisplayObject=Class.create({initialize:function(){this.parent=this.height=this.width=this.y=this.x=null},hitTest:function(b,c){return b<this.x||c<this.y||b>this.x+this.width||c>this.y+this.height?!1:!0},parentToLocal:function(b){return{x:b.x-this.x,y:b.y-this.y}}}),Brick=Class.create(DisplayObject,{initialize:function($super){$super();this.targetRotation=this.rotation=this.y=this.x=0;this.rotateID=null;this.isRemoveable=this.isDraggable=this.isVisible=!0;this.isPreview=!1;this.isInFront=!0;this.isDynamic=
!1;this.hasShadow=!0;this.cell={row:0,col:0}},update:function(){},draw:function(b){if(this.isVisible){this.rotation!==0&&this.applyRotation(b);b.drawShadows&&this.hasShadow&&!this.isPreview&&this.applyShadow(b);if(this.isPreview)b.globalAlpha=0.3;this.drawShape(b);this.isPreview&&this.applyStyle(b);this.rotateID&&this.applyClearing(b);b.beginPath()}},reset:function(){},drawShape:function(b){b.fillRect(0,0,Brick.SIZE,Brick.SIZE);b.clearShadow();b.strokeRect(0,0,Brick.SIZE,Brick.SIZE)},applyStyle:function(b){b.fillStyle=
Brick.FILL;b.strokeStyle=Brick.STROKE;b.lineJoing="miter";b.lineWidth=1},applyShadow:function(b){var c=new b2Vec2(Math.cos(Math.PI/4)*-Brick.SIZE/4,Math.sin(Math.PI/4)*Brick.SIZE/4);shadowOffsetGetsTransformed&&(c=this.rotateVector(c,-this.rotation));b.shadowOffsetX=c.x;b.shadowOffsetY=c.y;b.shadowBlur=5;b.shadowColor="rgba(0, 0, 0, 0.5)"},applyScale:function(b){b.translate(Brick.SIZE/2,Brick.SIZE/2);b.scale(1.1,1.1);b.translate(-Brick.SIZE/2,-Brick.SIZE/2)},applyRotation:function(b){b.translate(Brick.SIZE/
2,Brick.SIZE/2);b.rotate(this.rotation);b.translate(-Brick.SIZE/2,-Brick.SIZE/2)},applyClearing:function(b){var c=new Rectangle(this.x-Brick.SIZE*0.4,this.y-Brick.SIZE*0.2,Brick.SIZE*1.6,Brick.SIZE*1.6);b.addClearRectangle(c)},drawGlobal:function(b){var c=Brick.SIZE;Brick.SIZE=Brick.BIG_SIZE;b.save();b.translate(this.x,this.y);this.applyStyle(b);this.draw(b);b.restore();this.applyClearing(b);Brick.SIZE=c},createBody:function(b){var c=new b2BodyDef;c.position.Set(this.cell.col+0.5,this.cell.row+0.5);
this.body=b.CreateBody(c);this.createShapes(this.body);this.body.SetMassFromShapes();this.setRotation(this.rotation)},createShapes:function(b){var c=new b2PolygonDef;c.SetAsBox(0.5,0.5);c.restitution=0;c.friction=0.9;b.CreateShape(c)},removeBody:function(b){b.DestroyBody(this.body)},moveToCell:function(b){this.cell=b;this.body&&this.body.SetXForm(new b2Vec2(b.col+0.5,b.row+0.5),this.body.GetAngle())},rotate:function(b){this.rotateID?(clearTimeout(this.rotateID),this.targetRotation+=b):(this.storedDynamic=
this.isDynamic,this.isDynamic=!0,this.parent.renderNew=!0,this.targetRotation=this.rotation+b);var c=this;this.rotateID=setTimeout(function(){c.rotateTimeout()},30)},rotateTimeout:function(){this.rotation+=(this.targetRotation-this.rotation)/3;if(Math.abs(this.rotation-this.targetRotation)<0.03)this.rotateStop();else{var b=this;this.rotateID=setTimeout(function(){b.rotateTimeout()},30)}},rotateStop:function(){this.setRotation(this.targetRotation);this.isDynamic=this.storedDynamic;this.parent.renderNew=
!0;this.rotateID=null},setRotation:function(b){this.body?(this.body.SetXForm(this.body.GetPosition(),b),this.rotation=this.body.GetAngle()):this.rotation=b},rotateVector:function(b,c){return new b2Vec2(b.x*Math.cos(c)-b.y*Math.sin(c),b.x*Math.sin(c)+b.y*Math.cos(c))}});Brick.SIZE=28;Brick.BIG_SIZE=32;Brick.TINY_SIZE=12;Brick.FILL="#1E1E1E";Brick.STROKE="#F2E049";Brick.prototype.type="Brick";
var Kicker=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(1,0);b.bezierCurveTo(1,Brick.SIZE/2,Brick.SIZE/2,Brick.SIZE-1,Brick.SIZE,Brick.SIZE-1);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=[],d;for(d=0;d<6;d++)c[d]=new b2PolygonDef,c[d].vertexCount=4,c[d].restitution=0,c[d].friction=0.9;var e=Math.PI/2/6,f={x:-Math.cos(e),y:Math.sin(e)},g={x:-1,y:Math.tan(e)};
c[0].vertexCount=3;c[0].vertices[0].Set(-0.5,-0.5);c[0].vertices[1].Set(f.x+0.5,f.y-0.5);c[0].vertices[2].Set(g.x+0.5,g.y-0.5);for(d=1;d<5;d++){var h={x:-Math.cos((d+1)*e),y:Math.sin((d+1)*e)},i;i=d>=3?{x:-Math.tan((6-d-1)*e),y:1}:{x:-1,y:Math.tan((d+1)*e)};c[d].vertices[0].Set(f.x+0.5,f.y-0.5);c[d].vertices[1].Set(h.x+0.5,h.y-0.5);c[d].vertices[2].Set(i.x+0.5,i.y-0.5);c[d].vertices[3].Set(g.x+0.5,g.y-0.5);f=h;g=i}c[5].vertexCount=3;c[5].vertices[0].Set(0.5,0.5);c[5].vertices[1].Set(g.x+0.5,g.y-0.5);
c[5].vertices[2].Set(f.x+0.5,f.y-0.5);for(d=0;d<6;d++)b.CreateShape(c[d])}});Kicker.prototype.type="Kicker";var Ramp=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,-0.5);c.vertices[1].Set(0.5,0.5);c.vertices[2].Set(-0.5,0.5);b.CreateShape(c)}});
Ramp.prototype.type="Ramp";
var Curve=new Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.bezierCurveTo(Brick.SIZE/2,0,Brick.SIZE,Brick.SIZE/2,Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef,d=Math.PI/2/6,e,f;c.vertexCount=8;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,0.5);e=6;for(f=0;e>=0;e--,f++)c.vertices[f].Set(Math.cos(d*e)-0.5,-Math.sin(d*e)+0.5);c.vertices[7].Set(-0.5,0.5);b.CreateShape(c)}});
Curve.prototype.type="Curve";
var Line=Class.create(Brick,{drawShape:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(Brick.SIZE,0);b.lineTo(Brick.SIZE,Brick.SIZE/7);b.lineTo(0,Brick.SIZE/7);b.lineTo(0,0);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=8;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,-0.499);c.vertices[1].Set(-0.49,-0.5);c.vertices[2].Set(0.49,-0.5);c.vertices[3].Set(0.5,-0.499);c.vertices[4].Set(0.5,-0.376);c.vertices[5].Set(0.49,-0.375);
c.vertices[6].Set(-0.49,-0.375);c.vertices[7].Set(-0.5,-0.376);b.CreateShape(c)}});Line.prototype.type="Line";
var Exit=Class.create(Brick,{initialize:function($super){$super();this.hasShadow=this.isInFront=this.isRemoveable=this.isDraggable=!1},drawShape:function(b){var c=Brick.SIZE/5,d=0,e,f;for(e=0;e<5;e++)for(f=0;f<5;f++)d%2===0&&b.fillRect(c*f,c*e,c,c),d++},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=4;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0.3,0.3);c.vertices[1].Set(-0.3,0.3);c.vertices[2].Set(-0.3,-0.3);c.vertices[3].Set(0.3,-0.3);c.isSensor=!0;b.CreateShape(c);var d=this;
b.onCollision=function(b){d.onCollision(b)}},onCollision:function(b){if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance)if(this.parent.parent.onBallExit(),this.parent.trackLength&&this.parent.bricks.length>2)this.parent.validTrack=!0,$("publishButton").addClassName("activePublish"),$("publishButtonWarning").style.visibility="hidden"},rotate:function(){}});Exit.prototype.type="Exit";
var Spring=new Class.create(Brick,{drawShape:function(b){b.strokeStyle=b.fillStyle;b.lineWidth=2;b.beginPath();b.moveTo(Brick.SIZE/5,Brick.SIZE*0.22);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.07);b.moveTo(Brick.SIZE/5,Brick.SIZE*0.37);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.22);b.moveTo(Brick.SIZE/5,Brick.SIZE*0.52);b.lineTo(Brick.SIZE*4/5,Brick.SIZE*0.37);b.stroke();b.fillRect(0,0,Brick.SIZE,Brick.SIZE/8);b.fillRect(0,Brick.SIZE/2,Brick.SIZE,Brick.SIZE/2);b.clearShadow();this.applyStyle(b);b.strokeRect(0,
0,Brick.SIZE,Brick.SIZE)},createBody:function($super,c){$super(c);var d=this;this.body.onCollision=function(c){d.onCollision(c)}},onCollision:function(b){var c;if(b.shape1.GetBody().ballInstance)c=b.shape1.GetBody().ballInstance;else if(b.shape2.GetBody().ballInstance)c=b.shape2.GetBody().ballInstance;else return;var d=this.body.GetPosition();b=this.rotateVector(new b2Vec2(b.position.x-d.x,b.position.y-d.y),-this.body.GetAngle());b.x>-0.5&&b.x<0.5&&b.y>-0.6&&b.y<-0.4&&(b=new b2Vec2(0,-6),c.impulseVector.Add(this.rotateVector(b,
this.body.GetAngle())))}});Spring.prototype.type="Spring";
var Boost=new Class.create(Brick,{initialize:function($super){$super();this.hasShadow=this.isInFront=!1},drawShape:function(b){b.beginPath();b.moveTo(Brick.SIZE/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*2/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*4/7,Brick.SIZE/2);b.lineTo(Brick.SIZE*2/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*3/7,Brick.SIZE/2);b.closePath();b.fill();b.beginPath();b.moveTo(Brick.SIZE*3/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*4/7,Brick.SIZE*3/14);b.lineTo(Brick.SIZE*
6/7,Brick.SIZE/2);b.lineTo(Brick.SIZE*4/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*3/7,Brick.SIZE*11/14);b.lineTo(Brick.SIZE*5/7,Brick.SIZE/2);b.closePath();b.fill()},createShapes:function(b){var c=new b2PolygonDef;c.vertexCount=4;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.4,-0.4);c.vertices[1].Set(0.4,-0.4);c.vertices[2].Set(0.4,0.4);c.vertices[3].Set(-0.4,0.4);c.isSensor=!0;c.filter.maskBits=2;b.CreateShape(c);var d=this;b.whileCollision=function(b){d.whileCollision(b)}},whileCollision:function(b){b=
b.shape1.GetBody().ballInstance?b.shape1.GetBody().ballInstance:b.shape2.GetBody().ballInstance;var c=new b2Vec2(0.3,0);b.impulseVector.Add(this.rotateVector(c,this.body.GetAngle()))}});Boost.prototype.type="Boost";
var Ball=Class.create(Brick,{initialize:function($super){$super();this.impulseVector=new b2Vec2;this.positionVector=new b2Vec2;this.velocityVector=new b2Vec2;this.rollLength=0;this.lastPosition=new b2Vec2;this.isRemoveable=this.isDraggable=!1;this.isDynamic=!0;this.hasShadow=!1},update:function(){this.impulseVector.Length()>0&&(this.body.ApplyImpulse(this.impulseVector,this.body.GetPosition()),this.impulseVector.Set(0,0));this.positionVector.Length()>0&&(this.body.SetXForm(this.positionVector,this.body.GetAngle()),
this.body.SetLinearVelocity(this.velocityVector),this.lastPosition.Set(this.positionVector.x,this.positionVector.y),this.positionVector.Set(0,0));this.rollLength+=this.minus(this.lastPosition,this.body.GetPosition()).Length();this.lastPosition.Set(this.body.GetPosition().x,this.body.GetPosition().y);if(this.rollLength>9999)this.rollLength=9999;$("lengthDisplay").update(this.getFormatString(this.rollLength));this.parent.trackLength=this.rollLength/10},minus:function(b,c){return new b2Vec2(b.x-c.x,
b.y-c.y)},getFormatString:function(b){for(b=parseInt(b,10).toString();b.length<4;)b="0"+b;return b.toString()},reset:function(){this.rollLength=0;this.lastPosition.Set(this.cell.col+0.5,this.cell.row+0.5);this.body.SetXForm(this.lastPosition,0);this.body.SetLinearVelocity({x:0,y:0});this.body.SetAngularVelocity(0);this.impulseVector.Set(0,0)},drawShape:function(b){var c;this.body?(c=this.body.GetPosition(),b.addClearRectangle(new Rectangle(this.x+(c.x-this.cell.col-Ball.radius)*Brick.SIZE,this.y+
(c.y-this.cell.row-Ball.radius)*Brick.SIZE,Ball.radius*2*Brick.SIZE,Ball.radius*2*Brick.SIZE))):c={x:this.cell.col+0.5,y:this.cell.row+0.5};b.save();b.translate((c.x-this.cell.col)*Brick.SIZE,(c.y-this.cell.row)*Brick.SIZE);this.body&&b.rotate(this.body.GetAngle());b.fillStyle="#800000";b.beginPath();b.arc(0,0,Ball.radius*Brick.SIZE,0,Math.PI*2,!0);b.lineTo(Ball.radius*Brick.SIZE,0);b.fill();b.restore()},createShapes:function(b){var c=new b2CircleDef;c.radius=Ball.radius;c.restitution=0;c.density=
2;c.friction=0.9;c.filter.categoryBits=2;b.CreateShape(c);b.SetMassFromShapes();b.ballInstance=this},rotate:function(){}});Ball.prototype.type="Ball";Ball.radius=0.25;
var Breaker=new Class.create(Brick,{initialize:function($super){$super();this.bodies=null;this.isBroken=!1;this.timeoutID=0;this.isDynamic=!1;this.hasShadow=!0;this.generateShapes()},reset:function(){this.isBroken=this.isDynamic=!1;if(this.timeoutID)clearTimeout(this.timeoutID),this.timeoutID=0;this.bodies&&this.removeBodies(this.world);this.body||this.createBody(this.world)},createBody:function($super,c){this.world=c;$super(c);var d=this;this.body.onCollision=function(c){d.onCollision(c)};this.body.afterCollision=
function(c){d.afterCollision(c)}},createBodies:function(b){this.bodies=[];var c;for(c=0;c<this.shapes.length;c++){var d=new b2BodyDef;d.position.Set(this.cell.col+0.5,this.cell.row+0.5);d=b.CreateBody(d);this.createShape(d,c);d.SetMassFromShapes();this.bodies.push(d)}},removeBody:function($super,c){$super(c);this.bodies&&this.removeBodies(c);this.body=null},removeBodies:function(b){var c=b.m_bodyCount,d;for(d=0;d<this.bodies.length;d++)b.DestroyBody(this.bodies[d]);c===b.m_bodyCount&&console.error("Bodies were not removed");
this.bodies=null},drawShape:function(b){if(!this.isBroken){var c,d,e;b.save();this.bodies&&b.clearShadow();b.translate(-this.cell.col*Brick.SIZE,-this.cell.row*Brick.SIZE);for(c=0;c<this.shapes.length;c++){b.save();e=this.bodies?this.bodies[c].GetPosition():{x:this.cell.col+0.5,y:this.cell.row+0.5};b.translate(e.x*Brick.SIZE,e.y*Brick.SIZE);this.bodies&&b.rotate(this.bodies[c].GetAngle());b.beginPath();b.moveTo(this.shapes[c][0].x*Brick.SIZE,this.shapes[c][0].y*Brick.SIZE);for(d=1;d<this.shapes[c].length;d++)b.lineTo(this.shapes[c][d].x*
Brick.SIZE,this.shapes[c][d].y*Brick.SIZE);b.closePath();b.fill();b.stroke();b.restore();this.bodies&&(d=this.x+(e.x-this.cell.col-0.7)*Brick.SIZE,e=this.y+(e.y-this.cell.row-0.7)*Brick.SIZE,b.addClearRectangle(new Rectangle(d,e,Brick.SIZE*1.4,Brick.SIZE*1.4)))}b.restore()}},createShape:function(b,c){var d=new b2PolygonDef,e;d.vertexCount=this.shapes[c].length;d.restitution=0;d.friction=0.9;for(e=0;e<this.shapes[c].length;e++)d.vertices[e]=this.shapes[c][e];d.density=2;d.filter.maskBits=1;b.CreateShape(d)},
onCollision:function(b){if(this.timeoutID&&(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance))clearTimeout(this.timeoutID),this.timeoutID=0},afterCollision:function(b){if(!this.isBroken&&(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance)){if(this.timeoutID)clearTimeout(this.timeoutID),this.timeoutID=0;var c=this;this.timeoutID=setTimeout(function(){c.onTimeout()},200)}},onTimeout:function(){this.isDynamic=!0;this.parent.renderNew=!0;this.removeBody(this.world);this.createBodies(this.world);
this.applyImpulse();var b=this;this.timeoutID=setTimeout(function(){b.removeBodies(b.world);b.isBroken=!0},500)},applyImpulse:function(){var b,c=new b2Vec2(0,-Math.random());c=this.rotateVector(c,-Math.PI/3);for(b=0;b<this.bodies.length;b++)this.bodies[b].ApplyImpulse(c,this.bodies[b].GetPosition()),c=this.rotateVector(c,Math.PI/3)},generateShapes:function(){this.shapes=[];var b=new b2Vec2(Math.random()/2-0.25,Math.random()/2-0.25),c=[new b2Vec2(-0.5,Math.random()/2-0.25),new b2Vec2(-0.5,-0.5),new b2Vec2(-Math.random()/
2,-0.501),new b2Vec2(Math.random()/2,-0.501),new b2Vec2(0.5,-0.5),new b2Vec2(0.501,Math.random()/2-0.25),new b2Vec2(0.5,0.5),new b2Vec2(Math.random()/2,0.501),new b2Vec2(-Math.random()/2,0.501),new b2Vec2(-0.501,0.5)],d=[3,2,3,3,2,3],e=0,f,g;d.shuffle();for(f=0;f<6;f++){var h=[];h.push(b);for(g=0;g<d[f];g++)h.push(c[e%10]),e++;e--;this.shapes.push(h)}},rotate:function(){}});Breaker.prototype.type="Breaker";
var Beamer=new Class.create(Brick,{initialize:function($super){$super();this.partner=null;this.hasBeamed=!1},reset:function(){this.hasBeamed=!1},drawShape:function(b){b.beginPath();b.moveTo(0,Brick.SIZE/2);b.lineTo(Brick.SIZE/5,Brick.SIZE/2);b.bezierCurveTo(Brick.SIZE/5,Brick.SIZE*9/10,Brick.SIZE*4/5,Brick.SIZE*9/10,Brick.SIZE*4/5,Brick.SIZE/2);b.lineTo(Brick.SIZE,Brick.SIZE/2);b.lineTo(Brick.SIZE,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.closePath();b.fill();b.clearShadow();b.stroke()},createShapes:function(b){var c=
new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(-0.5,0);c.vertices[1].Set(0.2,0.5);c.vertices[2].Set(-0.5,0.5);b.CreateShape(c);c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0.5,0);c.vertices[1].Set(0.5,0.5);c.vertices[2].Set(-0.2,0.5);b.CreateShape(c);c=new b2PolygonDef;c.vertexCount=3;c.restitution=0;c.friction=0.9;c.vertices[0].Set(0,0);c.vertices[1].Set(0.2,0.2);c.vertices[2].Set(-0.2,0.2);c.isSensor=!0;c.filter.maskBits=
2;b.CreateShape(c);var d=this;b.onCollision=function(b){d.onCollision(b)};b.afterCollision=function(b){d.afterCollision(b)};this.divorce()},removeBody:function($super,c){$super(c);this.partner?(this.partner.divorce(),this.partner=null):this.parent.singles[this.pairType]===this&&(this.parent.singles[this.pairType]=null)},divorce:function(){this.partner=null;this.parent.findPartner(this)},onCollision:function(b){if(b.shape1.m_isSensor)b=b.shape2.GetBody().ballInstance;else if(b.shape2.m_isSensor)b=
b.shape1.GetBody().ballInstance;else return;if(this.partner&&!this.hasBeamed){var c=this.rotateVector(new b2Vec2(0,-0.1),this.partner.rotation);b.positionVector.Set(this.partner.cell.col+0.5+c.x,this.partner.cell.row+0.5+c.y);c.Multiply(10);c.Multiply(b.body.GetLinearVelocity().Length());b.velocityVector=c;this.hasBeamed=this.partner.hasBeamed=!0}},afterCollision:function(b){if(this.hasBeamed&&this.partner&&(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance))this.hasBeamed=this.partner.hasBeamed=
!1}});Beamer.prototype.type="Beamer";Beamer.prototype.pairType="Beamer";
var OneWay=Class.create(Line,{initialize:function($super){$super();this.isActive=!1},reset:function(){this.isActive=!1},drawShape:function($super,c){$super(c);c.beginPath();c.moveTo(Brick.SIZE/2,Brick.SIZE*7/20);c.lineTo(Brick.SIZE*7/10,Brick.SIZE*13/20);c.lineTo(Brick.SIZE*3/10,Brick.SIZE*13/20);c.closePath();c.fill()},createShapes:function($super,c){$super(c);var d=new b2PolygonDef;d.vertexCount=4;d.restitution=0;d.friction=0.9;d.vertices[0].Set(-1.5,-0.45);d.vertices[1].Set(1.5,-0.45);d.vertices[2].Set(1.5,
0);d.vertices[3].Set(-1.5,0);d.isSensor=!0;d.filter.maskBits=2;c.CreateShape(d);var e=this;c.beforeCollision=function(c,d){return e.beforeCollision(c,d)};c.onCollision=function(c){e.onCollision(c)};c.afterCollision=function(c){e.afterCollision(c)}},removeBody:function($super,c){$super(c)},beforeCollision:function(b,c){if(b.GetBody().ballInstance&&this.isActive)return!1;else if(c.GetBody().ballInstance&&this.isActive)return!1;return!0},onCollision:function(b){if(b.shape1.GetBody().ballInstance&&b.shape2.m_isSensor)this.isActive=
!0;else if(b.shape2.GetBody().ballInstance&&b.shape1.m_isSensor)this.isActive=!0},afterCollision:function(b){if(b.shape1.GetBody().ballInstance&&b.shape2.m_isSensor)this.isActive=!1;else if(b.shape2.GetBody().ballInstance&&b.shape1.m_isSensor)this.isActive=!1}});OneWay.prototype.type="OneWay";
var Graviton=new Class.create(Brick,{initialize:function($super){$super();this.isActive=!1;this.timeoutID=0;this.isDynamic=!1;this.hasShadow=!0},reset:function(){this.isActive=!1;if(this.timeoutID)clearTimeout(this.timeoutID),this.timeoutID=0},createBody:function($super,c){$super(c);var d=this;this.body.onCollision=function(c){d.onCollision(c)}},drawShape:function($super,c){$super(c);c.beginPath();c.moveTo(Brick.SIZE/2,Brick.SIZE/7);c.lineTo(Brick.SIZE*6/7,Brick.SIZE/2);c.lineTo(Brick.SIZE*5/7,Brick.SIZE/
2);c.lineTo(Brick.SIZE*5/7,Brick.SIZE*6/7);c.lineTo(Brick.SIZE*2/7,Brick.SIZE*6/7);c.lineTo(Brick.SIZE*2/7,Brick.SIZE/2);c.lineTo(Brick.SIZE/7,Brick.SIZE/2);c.closePath();this.isActive?(c.save(),c.fillStyle=c.strokeStyle,c.fill(),c.restore()):c.stroke()},onCollision:function(b){if(b.shape1.GetBody().ballInstance||b.shape2.GetBody().ballInstance){this.parent.setActiveGraviton(this);this.isActive=!0;this.parent.renderNew=!0;var c=this;this.timeoutID=setTimeout(function(){var b=new b2Vec2(0,-9.81);c.body.GetWorld().SetGravity(c.rotateVector(b,
c.body.GetAngle()));c.timeoutID=0},50)}}});Graviton.prototype.type="Graviton";
Grid=Class.create(DisplayObject,{initialize:function($super){$super();this.cols=this.rows=0;this.bricks=[];this.renderDynamics=this.renderStatics=this.renderNew=!1},draw:function(b){this.drawStatics(b);this.drawDynamics(b)},drawStatics:function(b){this.renderNew=!1;this.setClipping(b);b.translate(this.x,this.y);this.drawStaticElements(b);this.drawFrame(b);this.releaseClipping(b)},drawDynamics:function(b){this.setClipping(b);b.translate(this.x,this.y);this.renderDynamics=!0;b.drawShadows=!0;this.drawElements(b,
!0);this.renderDynamics=!1;this.releaseClipping(b)},setClipping:function(b){b.save();b.translate(0.5,0.5);b.beginPath();b.moveTo(this.x-2,this.y-2);b.lineTo(this.x+this.width,this.y-2);b.lineTo(this.x+this.width,this.y+this.height);b.lineTo(this.x-2,this.y+this.height);b.closePath();b.translate(-0.5,-0.5);b.clip()},releaseClipping:function(b){b.restore()},drawFrame:function(b){b.save();b.translate(-0.5,-0.5);b.strokeStyle="#2D2D2D";b.lineWidth=2;b.strokeRect(0,0,this.width,this.height);b.restore()},
drawGrid:function(b){b.strokeStyle="#000000";b.lineWidth=0.5;var c;for(c=1;c<this.rows;c++)b.beginPath(),b.dashedLine(0,c*Brick.SIZE,this.cols*Brick.SIZE,c*Brick.SIZE,3),b.closePath(),b.stroke();for(c=1;c<this.cols;c++)b.beginPath(),b.dashedLine(c*Brick.SIZE,0,c*Brick.SIZE,this.rows*Brick.SIZE,3),b.closePath(),b.stroke();b.beginPath()},drawFieldShadow:function(b){b.save();b.beginPath();b.moveTo(-10,0);b.lineTo(this.width,0);b.lineTo(this.width,this.height);b.lineTo(this.width+10,this.height);b.lineTo(this.width+
10,-10);b.lineTo(-10,-10);b.closePath();b.shadowOffsetX=-6;b.shadowOffsetY=6;b.shadowBlur=5;b.shadowColor="rgba(0, 0, 0, 0.4)";b.fill();b.restore()},drawStaticElements:function(b){this.drawGrid(b);this.drawFieldShadow(b);this.renderStatics=!0;b.drawShadows=!0;this.drawElements(b);b.drawShadows=!1;this.drawElements(b);this.renderStatics=!1},drawElements:function(b){if(this.bricks.length!==0){this.bricks[0].applyStyle(b);var c;for(c=0;c<this.bricks.length;c++)if(this.bricks[c].isDynamic&&this.renderDynamics||
!this.bricks[c].isDynamic&&this.renderStatics)b.save(),b.translate(this.bricks[c].cell.col*Brick.SIZE,this.bricks[c].cell.row*Brick.SIZE),this.bricks[c].draw(b),b.restore()}},getCell:function(b,c){if(b>0&&c>0&&b<this.width&&c<this.height)return{row:parseInt(c/Brick.SIZE,10),col:parseInt(b/Brick.SIZE,10)};return null},checkCell:function(b){return b&&b.row>=0&&b.row<this.rows&&b.col>=0&&b.col<this.cols},getCellBox:function(b){if(!this.checkCell(b))return null;return new Rectangle(this.x+b.col*Brick.SIZE,
this.y+b.row*Brick.SIZE,Brick.SIZE,Brick.SIZE)},getBrickAt:function(b){var c;if(this.checkCell(b))for(c=0;c<this.bricks.length;c++)if(this.bricks[c].cell.row===b.row&&this.bricks[c].cell.col===b.col)return this.bricks[c];return null},removeBrickAt:function(b){if(!this.checkCell(b))return!1;var c;for(c=0;c<this.bricks.length;c++)if(this.bricks[c].cell.row===b.row&&this.bricks[c].cell.col===b.col){this.bricks.splice(c,1);this.renderNew=!0;break}return!0},dropBrickAt:function(b,c){if(!this.checkCell(c))return!1;
b.cell=c;return this.insertBrick(b)},insertBrick:function(b){b.parent=this;if(!this.removeBrickAt(b.cell))return!1;b.x=this.x+b.cell.col*Brick.SIZE;b.y=this.y+b.cell.row*Brick.SIZE;b.width=b.height=Brick.SIZE;b.isInFront?this.bricks.push(b):this.bricks.unshift(b);return this.renderNew=!0}});
var Toolbox=Class.create(Grid,{initialize:function($super){$super();this.rows=15;this.cols=3;this.width=Brick.SIZE*this.cols;this.height=Brick.SIZE*this.rows;this.brickCounter=0},addBrick:function(b){var c=new b;c.cell={row:this.brickCounter*2+1,col:1};c.parent=this;this.dropBrickAt(c,c.cell);this.brickCounter++;if(c.pairType)b=new b,b.parent=this,b.setRotation(Math.PI),b.cell=c.cell,this.bricks.push(b),c.partner=b;return c},addPreviewBrick:function(b){b=this.addBrick(b);b.isDraggable=!1;b.isPreview=
!0;if(b.partner)b.partner.isDraggable=!1,b.partner.isPreview=!0},onClick:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e&&e.isDraggable&&this.parent.selectElement&&this.parent.selectElement.brick===e)e.rotate(Math.PI/2),this.renderNew=!0,e.partner&&e.partner.rotate(Math.PI/2);this.select(d)},onStartDrag:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(e&&e.isDraggable){var f=new (eval(e.type));f.rotation=e.rotation;this.parent.dragBrick(f)}this.select(d)},select:function(b){var c=
this.getBrickAt(b),d=null;d=this.getCellBox(b);if(c&&c.isDraggable)d.brick=c;this.parent.selectElement=d}});
Field=Class.create(Grid,{initialize:function($super){$super();this.rows=15;this.cols=10;this.width=Brick.SIZE*this.cols;this.height=Brick.SIZE*this.rows;this.bricks=[];this.singles={};this.debugMode=!1;this.trackLength=0},setup:function(){$("lengthDisplay").update("0000");this.trackLength=0;this.initializeBox2D();this.clearTrack(!0)},draw:function($super,c){this.debugMode?this.drawBodies(c):$super(c)},drawStatics:function($super,c){this.renderNew=!1;this.parent.tweenMode?(this.setClipping(c),c.translate(this.x,
this.y),c.save(),c.translate(10,0),this.drawFieldShadow(c),c.restore(),c.save(),c.translate(0,this.parent.fieldOffset),this.drawStaticElements(c),c.restore(),this.parent.drawTweenMode(c),this.drawFrame(c),this.releaseClipping(c)):$super(c)},drawBodies:function(b){b.strokeStyle="#FF0000";b.lineWidth=1;b.save();b.translate(this.x,this.y);var c;for(c=this.world.GetBodyList();c!==null;c=c.GetNext())this.drawBody(b,c);b.restore();b.addClearRectangle(new Rectangle(this.x-Brick.SIZE,this.y-Brick.SIZE,(this.cols+
2)*Brick.SIZE,(this.rows+2)*Brick.SIZE))},drawBody:function(b,c){b.save();var d=c.GetPosition(),e;b.translate(Brick.SIZE*d.x,Brick.SIZE*d.y);b.rotate(c.GetAngle());b.beginPath();b.moveTo(0,0);b.lineTo(0,-Brick.SIZE/2);for(d=c.GetShapeList();d!==null;d=d.GetNext())if(d.m_vertices&&d.m_vertices[0]){b.moveTo(d.m_vertices[0].x*Brick.SIZE,d.m_vertices[0].y*Brick.SIZE);for(e=1;e<d.m_vertexCount;e++)b.lineTo(d.m_vertices[e].x*Brick.SIZE,d.m_vertices[e].y*Brick.SIZE);b.lineTo(d.m_vertices[0].x*Brick.SIZE,
d.m_vertices[0].y*Brick.SIZE)}else b.moveTo(Ball.radius*Brick.SIZE,0),b.arc(0,0,Ball.radius*Brick.SIZE,0,Math.PI*2,!0);b.stroke();b.restore()},initializeBox2D:function(){var b=new b2AABB,c=new b2Vec2(0,9.81);b.lowerBound.Set(-10,-10);b.upperBound.Set(20,25);this.world=new b2World(b,c,!0);this.createBorders();this.initContactListener();this.initContactFilter();this.intervalLength=1/120},startBox2D:function(){this.resetTrack();var b=this;this.world.SetGravity(new b2Vec2(0,9.81));this.intervalID=setInterval(function(){b.calculateBox2D()},
this.intervalLength*1E3);$("lengthDisplay").update("0000");this.trackLength=0},stopBox2D:function(){this.intervalID&&clearInterval(this.intervalID);this.intervalID=null},calculateBox2D:function(){var b;for(b=0;b<this.bricks.length;b++)this.bricks[b].update();this.world.Step(0.02,20)},createBorders:function(){var b=new b2BodyDef,c;b.position.Set(0,0);b=this.world.CreateBody(b);var d=function(b,c){var d=new b2PolygonDef;d.vertexCount=4;d.restitution=0;d.friction=0.9;d.vertices[0].Set(b.x,b.y);d.vertices[1].Set(c.x,
b.y);d.vertices[2].Set(c.x,c.y);d.vertices[3].Set(b.x,c.y);return d},e=[{A:new b2Vec2(0,-1),B:new b2Vec2(this.cols,0)},{A:new b2Vec2(this.cols,0),B:new b2Vec2(this.cols+1,this.rows)},{A:new b2Vec2(0,this.rows),B:new b2Vec2(this.cols,this.rows+1)},{A:new b2Vec2(-1,0),B:new b2Vec2(0,this.rows)}];for(c=0;c<4;c++)b.CreateShape(d(e[c].A,e[c].B));b.SetMassFromShapes()},initContactListener:function(){var b=new b2ContactListener;b.Add=function(b){if(b.shape1.GetBody().onCollision)b.shape1.GetBody().onCollision(b);
else if(b.shape2.GetBody().onCollision)b.shape2.GetBody().onCollision(b)};b.Persist=function(b){b.shape1.GetBody().whileCollision?b.shape1.GetBody().whileCollision(b):b.shape2.GetBody().whileCollision&&b.shape2.GetBody().whileCollision(b)};b.Remove=function(b){b.shape1.GetBody().afterCollision?b.shape1.GetBody().afterCollision(b):b.shape2.GetBody().afterCollision&&b.shape2.GetBody().afterCollision(b)};this.world.SetContactListener(b)},initContactFilter:function(){var b=new b2ContactFilter;b.ShouldCollide=
function(b,d){if(b.GetBody().beforeCollision)return b.GetBody().beforeCollision(b,d);else if(d.GetBody().beforeCollision)return d.GetBody().beforeCollision(b,d);var e=b.GetFilterData(),f=d.GetFilterData();if(e.groupIndex===f.groupIndex&&e.groupIndex!==0)return e.groupIndex>0;return(e.maskBits&f.categoryBits)!==0&&(e.categoryBits&f.maskBits)!==0};this.world.SetContactFilter(b)},findPartner:function(b){if(this.singles[b.pairType]){if(this.singles[b.pairType]!==b)b.partner=this.singles[b.pairType],this.singles[b.pairType].partner=
b,this.singles[b.pairType]=null}else this.singles[b.type]=b},setActiveGraviton:function(b){if(this.activeGraviton)this.activeGraviton.isActive=!1;this.activeGraviton=b},dropBrickAt:function($super,c,d){if($super(c,d))c.createBody(this.world),this.validTrack=!1,$("publishButton").removeClassName("activePublish")},removeBrickAt:function($super,c){var d=this.getBrickAt(c);if(d)if($super(c))d.removeBody(this.world),this.validTrack=!1,$("publishButton").removeClassName("activePublish");else return!1;return!0},
onClick:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);e?(e.rotate(Math.PI/2),this.validTrack=!1,$("publishButton").removeClassName("activePublish")):d&&this.parent.selectElement&&this.parent.selectElement.brick&&(e=new (eval(this.parent.selectElement.brick.type)),e.setRotation(this.parent.selectElement.brick.rotation),this.dropBrickAt(e,d));this.renderNew=!0},onStartDrag:function(b,c){var d=this.getBrickAt(this.getCell(b,c));if(d){if(d.isDraggable){d.isVisible=!1;this.renderNew=!0;var e=
new (eval(d.type));e.setRotation(d.rotation);e.origin=d;this.parent.dragBrick(e);this.validTrack=!1;$("publishButton").removeClassName("activePublish")}}else this.onDrag(b,c),this.parent.startDragBricking()},onDrag:function(b,c){var d=this.getCell(b,c),e=this.getBrickAt(d);if(d&&this.parent.selectElement){if(this.parent.selectElement.brick){if(e&&(!e.isRemoveable||e.type===this.parent.selectElement.brick.type&&e.rotation===this.parent.selectElement.brick.rotation))return;e=new (eval(this.parent.selectElement.brick.type));
e.setRotation(this.parent.selectElement.brick.rotation);this.dropBrickAt(e,d)}else e&&e.isRemoveable&&this.removeBrickAt(d);this.renderNew=!0}},onStopDrag:function(b,c){var d=this.getCell(c.x-this.x+Brick.SIZE/2,c.y-this.y+Brick.SIZE/2);if(d){var e=this.getBrickAt(d);this.intervalID&&this.resetTrack();if(e&&!e.isRemoveable){if(c.origin)this.renderNew=c.origin.isVisible=!0}else e&&c.origin!==e&&this.removeBrickAt(d),c.origin?(c.origin.x=this.x+d.col*Brick.SIZE,c.origin.y=this.y+d.row*Brick.SIZE,c.origin.moveToCell(d),
this.renderNew=c.origin.isVisible=!0):this.dropBrickAt(c,d)}else if(c.origin)c.isRemoveable?this.removeBrickAt(c.origin.cell):this.renderNew=c.origin.isVisible=!0;this.validTrack=!1;$("publishButton").removeClassName("activePublish")},resetTrack:function(){this.stopBox2D();this.renderNew=!0;var b;for(b=0;b<this.bricks.length;b++)this.bricks[b].reset()},setTrack:function(b){var c;this.clearTrack();for(c in b.bricks)if(b.bricks.hasOwnProperty(c)){var d=b.bricks[c],e=new (eval(d.type));e.setRotation(d.rotation*
Math.PI/2);this.dropBrickAt(e,{row:d.row,col:d.col})}if(b.pairs)for(c=0;c<b.pairs.length;c++)if(d=this.getBrickAt(b.pairs[c].girl),e=this.getBrickAt(b.pairs[c].boy),d&&e&&d.pairType===e.type)d.partner=e,e.partner=d;return!0},getTrack:function(){this.resetTrack();var b={bricks:{},pairs:[]},c,d,e=function(b){for(var c=0;b-0.5>0;)b-=Math.PI/2,c++;return c%4};for(c=0;c<this.bricks.length;c++){var f=this.bricks[c];b.bricks[f.cell.row*this.cols+f.cell.col]={type:f.type,rotation:e(f.rotation),row:f.cell.row,
col:f.cell.col};if(f.pairType&&f.partner){var g=!1;for(d=0;d<b.pairs.length;d++)if(b.pairs[d].girl===f||b.pairs[d].boy===f){g=!0;break}g||b.pairs.push({girl:{row:f.cell.row,col:f.cell.col},boy:{row:f.partner.cell.row,col:f.partner.cell.col}})}}return b},clearTrack:function(b){this.resetTrack();var c;for(c=0;c<this.bricks.length;c++)this.bricks[c].removeBody(this.world);this.bricks=[];this.singles={};b&&(this.dropBrickAt(new Ball,{row:0,col:0}),this.dropBrickAt(new Exit,{row:this.rows-1,col:0}))},
getTrackImage:function(b){this.resetTrack();var c=b.getContext("2d"),d=Brick.SIZE,e;Brick.SIZE=Brick.TINY_SIZE;b.width=Brick.SIZE*this.cols+2;b.height=Brick.SIZE*this.rows+2;c.save();c.translate(0.5,0.5);c.lineWidth=0.5;c.beginPath();for(e=1;e<this.rows;e++)c.dashedLine(0,Brick.SIZE*e,Brick.SIZE*this.cols,Brick.SIZE*e,2);for(e=1;e<this.cols;e++)c.dashedLine(Brick.SIZE*e,0,Brick.SIZE*e,Brick.SIZE*this.rows,2);c.stroke();c.beginPath();if(this.bricks.length){this.bricks[0].applyStyle(c);c.lineWidth=
0.5;for(e=0;e<this.bricks.length;e++)c.save(),c.translate(this.bricks[e].cell.col*Brick.SIZE,this.bricks[e].cell.row*Brick.SIZE),this.bricks[e].draw(c),c.restore()}c.strokeStyle="#000000";c.lineWidth=1;c.strokeRect(0,0,Brick.SIZE*this.cols,Brick.SIZE*this.rows);c.restore();Brick.SIZE=d;return b.toDataURL("image/png")}});
var Renderer=Class.create(DisplayObject,{initialize:function($super,c,d){$super();this.staticCanvas=c;this.dynamicCanvas=d;this.staticContext=this.staticCanvas.getContext("2d");this.dynamicContext=this.dynamicCanvas.getContext("2d");this.initField();this.timeoutID=null;this.isAnimated=!1},initField:function(){this.field=new Field;this.field.parent=this;this.field.x=64;this.field.y=Brick.SIZE;this.field.setup()},initializeHTMLInterface:function(){},debug:function(){this.field.debugMode=!this.field.debugMode},
startRender:function(){if(!this.isAnimated)this.isAnimated=!0,this.animate()},stopRender:function(){this.isAnimated=!1},quit:function(){this.stopRender();this.field.stopBox2D();if(this.timeoutID)clearTimeout(this.timeoutID),this.timeoutID=null},init:function(){this.startRender()},onBallExit:function(){this.field.stopBox2D()},clearCanvas:function(b){var c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);c.beginPath()},animate:function(){if(this.isAnimated){var b=this;requestAnimFrame(function(){b.animate()})}this.draw()},
draw:function(){this.drawDynamics();this.drawStatics();this.dynamicContext.getImageData(0,0,1,1)},drawStatics:function(){this.field.renderNew&&(this.staticContext.save(),this.clearCanvas(this.staticCanvas),this.staticContext.translate(0.5,0.5),this.field.drawStatics(this.staticContext),this.staticContext.restore())},drawDynamics:function(){this.dynamicContext.save();this.clearDynamicCanvas();this.dynamicContext.translate(0.5,0.5);this.field.drawDynamics(this.dynamicContext);this.field.debugMode&&
this.field.draw(this.dynamicContext);this.dynamicContext.restore()},clearDynamicCanvas:function(){this.dynamicContext.clearRectangles();this.dynamicContext.clearRects=[]}}),Editor=Class.create(Renderer,{initialize:function($super,c,d,e){$super(c,d);this.imageCanvas=e;this.baseToolbox=new Toolbox;this.baseToolbox.parent=this;this.baseToolbox.x=this.field.x+this.field.width+3*Brick.SIZE;this.baseToolbox.y=this.field.y;this.specialToolbox=new Toolbox;this.specialToolbox.parent=this;this.specialToolbox.x=
this.baseToolbox.x+this.baseToolbox.width+Brick.SIZE;this.specialToolbox.y=this.baseToolbox.y;this.eventEngine=new EventEngine;this.dragElement=this.hoverElement=this.selectElement=null;this.setSize();this.addBricksToToolboxes();this.initializeHTMLInterface()},quit:function($super){$super();this.removeEventListening()},init:function($super){$super();this.addEventListening();this.field.resetTrack()},setSize:function(){var b=this.field.y+this.field.height+Brick.SIZE;this.width=this.staticCanvas.width=
this.dynamicCanvas.width=this.specialToolbox.x+this.specialToolbox.width+3;this.height=this.staticCanvas.height=this.dynamicCanvas.height=b},addEventListening:function(){this.eventEngine.addListener("click",this.onClick,this);this.eventEngine.addListener("mouseMove",this.onMouseMove,this);this.eventEngine.addListener("startDrag",this.onStartDrag,this);this.eventEngine.addListener("stopDrag",this.onStopDrag,this)},removeEventListening:function(){this.eventEngine.removeListener("click",this.onClick);
this.eventEngine.removeListener("mouseMove",this.onMouseMove);this.eventEngine.removeListener("startDrag",this.onStartDrag);this.eventEngine.removeListener("stopDrag",this.onStopDrag)},addBricksToToolboxes:function(){var b=[Brick,Ramp,Kicker,Curve,Line],c;for(c=0;c<b.length;c++)this.baseToolbox.addBrick(b[c]);var d=this;jQuery.ajax({url:"http://marblerun.at/unlocks",type:"GET",headers:{Accept:"application/json"},data:{},success:function(b){for(c=5;c<b.unlocks.length;c++)d.specialToolbox.addBrick(eval(b.unlocks[c]));
b.locks&&d.specialToolbox.addPreviewBrick(eval(b.locks[0]))},error:function(){}})},initializeHTMLInterface:function(){var b=this;$("runButton").observe("click",function(){b.field.startBox2D()});$("clearButton").observe("click",function(){b.field.clearTrack(!0)});$("publishButton").observe("click",function(){$("publishButton").hasClassName("activePublish")&&b.field.validTrack?(b.publishTrack(),$("publishButtonWarning").style.visibility="hidden"):$("publishButtonWarning").style.visibility="visible"})},
drawStatics:function(){if(this.field.renderNew||this.baseToolbox.renderNew||this.specialToolbox.renderNew)this.clearCanvas(this.staticCanvas),this.staticContext.save(),this.staticContext.translate(0.5,0.5),this.field.drawStatics(this.staticContext),this.baseToolbox.drawStatics(this.staticContext),this.specialToolbox.drawStatics(this.staticContext),this.staticContext.restore()},drawDynamics:function(){this.dynamicContext.save();this.clearDynamicCanvas();this.dynamicContext.translate(0.5,0.5);this.field.drawDynamics(this.dynamicContext);
this.baseToolbox.drawDynamics(this.dynamicContext);this.specialToolbox.drawDynamics(this.dynamicContext);if(this.hoverElement)this.dynamicContext.save(),this.dynamicContext.fillStyle="#333333",this.dynamicContext.globalAlpha=0.15,this.hoverElement.draw(this.dynamicContext),this.dynamicContext.restore();if(this.selectElement)this.dynamicContext.save(),this.dynamicContext.fillStyle="#800000",this.dynamicContext.globalAlpha=0.3,this.selectElement.draw(this.dynamicContext),this.dynamicContext.restore();
this.field.debugMode&&this.field.draw(this.dynamicContext);if(this.dragElement)this.dynamicContext.drawShadows=!0,this.dragElement.drawGlobal(this.dynamicContext),this.dynamicContext.drawShadows=!1;this.dynamicContext.restore()},onClick:function(b){if(this.field.hitTest(b.mouseX,b.mouseY)){if(!this.field.intervalID)this.field.onClick(b.mouseX-this.field.x,b.mouseY-this.field.y);this.field.resetTrack()}else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.baseToolbox.onClick(b.mouseX-this.baseToolbox.x,
b.mouseY-this.baseToolbox.y);else if(this.specialToolbox.hitTest(b.mouseX,b.mouseY))this.specialToolbox.onClick(b.mouseX-this.specialToolbox.x,b.mouseY-this.specialToolbox.y)},onMouseMove:function(b){this.hoverElement=null;if(this.field.hitTest(b.mouseX,b.mouseY))this.hoverElement=this.getCellBox(this.field,b.mouseX,b.mouseY);else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.hoverElement=this.getCellBox(this.baseToolbox,b.mouseX,b.mouseY);else if(this.specialToolbox.hitTest(b.mouseX,b.mouseY))this.hoverElement=
this.getCellBox(this.specialToolbox,b.mouseX,b.mouseY)},getCellBox:function(b,c,d){return b.getCellBox(b.getCell(c-b.x,d-b.y))},onStartDrag:function(b){this.field.resetTrack();if(this.field.hitTest(b.mouseX,b.mouseY))this.field.resetTrack(),this.field.onStartDrag(b.mouseX-this.field.x,b.mouseY-this.field.y);else if(this.baseToolbox.hitTest(b.mouseX,b.mouseY))this.baseToolbox.onStartDrag(b.mouseX-this.baseToolbox.x,b.mouseY-this.baseToolbox.y);else if(this.specialToolbox.hitTest(b.mouseX,b.mouseY))this.specialToolbox.onStartDrag(b.mouseX-
this.specialToolbox.x,b.mouseY-this.specialToolbox.y)},onDrag:function(b){if(this.dragElement&&b.mouseX&&b.mouseY)this.dragElement.x=parseInt(b.mouseX-Brick.SIZE/2,10),this.dragElement.y=parseInt(b.mouseY-Brick.SIZE/2,10)},dragBrick:function(b){var c={x:this.eventEngine.latestEvent.mouseX,y:this.eventEngine.latestEvent.mouseY};b.x=c.x-Brick.BIG_SIZE/2;b.y=c.y-Brick.BIG_SIZE/2;this.dragElement=b;this.eventEngine.addListener("drag",this.onDrag,this)},startDragBricking:function(){this.eventEngine.addListener("drag",
this.onDragBricking,this)},onDragBricking:function(b){if(this.field.hitTest(b.mouseX,b.mouseY))this.field.onDrag(b.mouseX-this.field.x,b.mouseY-this.field.y)},onStopDrag:function(b){if(this.dragElement)this.field.onStopDrag(b,this.dragElement),this.dragElement=null;this.eventEngine.removeListener("drag",this.onDragBricking);this.eventEngine.removeListener("drag",this.onDrag)},publishTrack:function(){if(this.field.validTrack){contentLoader.parseResponse({responseJSON:{mode:"load"}});var b=this.field.trackLength;
Object.toJSON(this.field.getTrack());this.field.getTrackImage(this.imageCanvas);$("userName");$("trackName");jQuery.ajax({url:"http://marblerun.at/tracks",type:"POST",headers:{Accept:"application/json"},data:{"track[json]":Object.toJSON(this.field.getTrack()),"track[length]":b,"track[imagedata]":this.field.getTrackImage(this.imageCanvas),"track[username]":$("userName").value,"track[trackname]":$("trackName").value},success:function(b){contentLoader.parseResponse({responseJSON:b},!0)},error:function(b){contentLoader.parseResponse({responseJSON:b},
!1)}});this.field.clearTrack(!0)}}}),Showroom=Class.create(Renderer,{initialize:function($super,c,d){$super(c,d);this.initializeHTMLInterface();this.trackID=null;this.tweenMode=this.autoMode=!1;this.tweenDown=!0;this.tweenStart=!1;this.fieldOffset=0;this.fieldImage=null},quit:function($super){$super();if(this.tweenTimeoutID)clearTimeout(this.tweenTimeoutID),this.tweenTimeoutID=null,this.tweenMode=!1;$("showroomLikeButton").stopObserving();$("showroomFlagButton").stopObserving()},drawDynamics:function($super,
c){this.tweenMode?this.clearDynamicCanvas():this.tweenStart?(this.tweenStart=!1,this.tweenDown?this.fadeTrack(trackStore.next(this.trackID)):this.fadeTrack(trackStore.previous(this.trackID))):$super(c)},drawTweenMode:function(b){var c;b.save();c=this.fieldOffset+(this.field.height+Brick.SIZE)*(this.fieldOffset<0?1:-1);b.translate(-0.5,c-0.5);b.drawImage(this.fieldImage,this.field.x,this.field.y,this.field.width,this.field.height,0,0,this.field.width,this.field.height);b.restore();b.save();c=this.fieldOffset+
(this.fieldOffset>0?-Brick.SIZE:this.field.height);b.translate(0,c);this.drawInlay(b);b.restore()},drawInlay:function(b){b.beginPath();b.moveTo(0,0);b.lineTo(this.field.width,0);b.lineTo(this.field.width,Brick.SIZE);b.lineTo(0,Brick.SIZE);b.closePath();b.clip();b.fillStyle=Brick.FILL;b.strokeStyle=Brick.STROKE;b.lineWidth=3;b.fillRect(0,0,this.field.width,Brick.SIZE);b.beginPath();var c;for(c=0;c<this.field.width+Brick.SIZE;c+=Brick.SIZE/3)b.moveTo(c,0),b.lineTo(c-Brick.SIZE,Brick.SIZE);b.stroke();
b.lineWidth=1;b.beginPath();for(c=1;c<this.field.cols;c++)b.moveTo(c*Brick.SIZE,0),b.lineTo(c*Brick.SIZE,Brick.SIZE);b.stroke();b.beginPath()},onBallExit:function($super){$super();if(this.autoMode)trackStore.hasNext(this.trackID)?(this.tweenDown=!0,this.fadeTrack(trackStore.next(this.trackID))):contentLoader.loadContent("/tracks/"+this.trackID+"/next",!0)},parseTrack:function(b){this.initField();this.trackID=b.id;this.field.setTrack(b.json);trackStore.loadNext(this.trackID);trackStore.loadPrevious(this.trackID);
this.setLikeBlameButtons();this.autoMode&&!this.tweenMode&&this.field.startBox2D()},initializeHTMLInterface:function(){var b=this;$("showButton").observe("click",function(){b.field.startBox2D()});$("autoButton").observe("click",function(){$("autoButton").toggleClassName("active");b.autoMode=$("autoButton").hasClassName("active")});$("nextButton").observe("click",function(){trackStore.hasNext(b.trackID)?(b.tweenDown=!0,b.tweenStart=!0):contentLoader.loadContent("/tracks/"+b.trackID+"/next")});$("previousButton").observe("click",
function(){trackStore.hasPrevious(b.trackID)?(b.tweenDown=!1,b.tweenStart=!0):contentLoader.loadContent("/tracks/"+b.trackID+"/previous")})},setLikeBlameButtons:function(){var b=this;Cookie.likedTracks.indexOf(this.trackID)===-1?($("showroomLikeButton").observe("click",function(){b.like()}),$("showroomLikeButton").setStyle({display:"block"})):($("showroomLikeButton").stopObserving(),$("showroomLikeButton").setStyle({display:"none"}));Cookie.flagedTracks.indexOf(this.trackID)===-1?($("showroomFlagButton").observe("click",
function(){b.flag()}),$("showroomFlag").setStyle({display:"block"})):($("showroomFlagButton").stopObserving(),$("showroomFlag").setStyle({display:"none"}))},startRender:function($super){$super();this.autoMode&&!this.tweenTimeoutID&&this.field.startBox2D()},like:function(){if(this.trackID){var b=this;jQuery.ajax({url:"http://marblerun.at/tracks/"+this.trackID,type:"PUT",headers:{Accept:"application/json"},data:{likes:1},success:function(){Cookie.likedTracks.push(b.trackID);Cookie.set("likes",JSON.stringify(Cookie.likedTracks),
{maxAge:31536E3});$("tableLikes").update(parseInt($("tableLikes").innerHTML,10)+1);$("showroomLikeButton").setStyle({display:"none"})},error:function(){$("showroomLikeButton").setStyle({display:"none"})}})}},flag:function(){if(this.trackID){var b=this;jQuery.ajax({url:"http://marblerun.at/tracks/"+this.trackID,type:"PUT",headers:{Accept:"application/json"},data:{flags:1},success:function(){Cookie.flagedTracks.push(b.trackID);Cookie.set("flags",JSON.stringify(Cookie.flagedTracks),{maxAge:31536E3});
$("showroomFlag").setStyle({display:"none"})},error:function(){$("showroomFlag").setStyle({display:"none"})}})}},fadeTrack:function(b){this.tweenPercent=0;this.fieldOffset=this.totalHeight=(this.field.height+Brick.SIZE)*(this.tweenDown?1:-1);this.fieldImage=new Image;var c=this;this.fieldImage.onload=function(){c.tweenMode=!0;trackStore.loadTrack(b,contentLoader.parseResponse,contentLoader,!0);c.tweenMode=!0;c.tween()};this.fieldImage.src=this.staticCanvas.toDataURL("image/png")},tween:function(){this.field.renderNew=
!0;if(this.tweenPercent>=1)this.tweenMode=!1,this.tweenTimeoutID=null,this.fieldOffset=0,this.autoMode&&this.field.startBox2D();else{this.fieldOffset=(Math.cos(this.tweenPercent*Math.PI)+1)/2*this.totalHeight;this.tweenPercent+=0.05;var b=this;this.tweenTimeoutID=setTimeout(function(){b.tween()},50)}}}),Meter=Class.create(DisplayObject,{initialize:function($super,c){$super();this.canvas=c;this.context=c.getContext("2d");this.context.translate(0.5,0.5);this.width=218;this.height=185;this.angle=-Math.PI/
4;this.timeINT=this.targetAngle=null},setSize:function(){this.canvas.width=this.width;this.canvas.height=this.height},setRotation:function(b){clearTimeout(this.timeINT);this.targetAngle=b*Math.PI/2-Math.PI/4;var c=this;setTimeout(function(){c.calculateRotation()},1E3)},calculateRotation:function(){this.angle+=(this.targetAngle-this.angle)/8;if(Math.abs(this.angle-this.targetAngle)<0.01)this.angle=this.targetAngle,this.draw(),this.timeINT=null;else{this.draw();var b=this;this.timeINT=setTimeout(function(){b.calculateRotation()},
50)}},draw:function(){this.setSize();this.context.fillStyle=Pattern.meterBackground;this.context.fillRect(0,0,this.width,this.height);this.context.save();this.context.translate(109,120);this.context.rotate(this.angle);this.context.translate(-19,-65);this.context.drawImage(Pattern.image.meterPointer,0,0,22,92);this.context.restore();this.context.fillStyle=Pattern.meterForeground;this.context.fillRect(0,0,this.width,this.height)}}),SidebarController=Class.create({initialize:function(){this.meter=new Meter(meterCanvas);
this.meter.setRotation(0);var b=this;jQuery.ajax({url:"http://marblerun.at/tracks/info",type:"GET",headers:{Accept:"application/json"},data:{},success:function(c){b.onInfoUpdate.call(b,{responseText:c})},error:function(){console.error("Periodical Update failed!")}});setInterval(function(){jQuery.ajax({url:"http://marblerun.at/tracks/info",type:"GET",headers:{Accept:"application/json"},data:{},success:function(c){b.onInfoUpdate.call(b,{responseText:c})},error:function(){console.error("Periodical Update failed!")}})},
6E3);this.targetMeters=null;this.meters=0},onInfoUpdate:function(b){response=JSON.parse(b.responseText);this.meter.setRotation(response.percentage);this.setMeters(parseInt(response.total_length/100,10));this.setLatestTrack(response.latest_track)},setMeters:function(b){this.targetMeters=b;var c=this;setTimeout(function(){c.updateMeters()},100)},updateMeters:function(){if(this.targetMeters-this.meters>1){this.meters+=(this.targetMeters-this.meters)/9;var b=this;setTimeout(function(){b.updateMeters()},
50)}else this.meters=this.targetMeters;for(var c=parseInt(this.meters,10).toString();c.length<7;)c="0"+c;$("lengthMeter").update(c)},setLatestTrack:function(b){$("lastTrackHolder").writeAttribute({onclick:"contentLoader.loadContent('/tracks/"+b.id+"', true)"});$("latestTrackReflection").writeAttribute({onclick:"contentLoader.loadContent('/tracks/"+b.id+"', true)"});var c='<div><img width="122" height="182" src="';c+=b.imagedata;c+='" /><div class="background"></div><div><div class="header">LATEST TRACK</div><div id="latestInfo">';
c+=b.trackname.toUpperCase()+"<br>";c+=b.username.toUpperCase()+"<br>";c+=(Math.round(b.length*10)/10).toString()+" METER";c+="</div></div></div>";$("lastTrackHolder").update(c)}}),ContentLoader=Class.create({initialize:function(){this.oldContent=this.oldMode=this.loadingInterval=this.visibleList=null;this.setInitialScreen();this.editor=new Editor(staticCanvas,dynamicCanvas,imageCanvas);this.editor.x=editorPosition.left;this.editor.y=editorPosition.top;this.showroom=new Showroom(staticCanvas,dynamicCanvas);
this.showroom.x=editorPosition.left;this.showroom.y=editorPosition.top;var b=this;Pattern.context=meterCanvas.getContext("2d");Pattern.loadPattern([{name:"meterBackground",path:"./images/sidebar-meter-background.png"},{name:"meterForeground",path:"./images/sidebar-meter-foreground.png"},{name:"meterPointer",path:"./images/sidebar-meter-pointer.png"},{name:"fieldBackground",path:"./images/background-yellow.png"}]);Pattern.onload=function(){sidebarController=new SidebarController;var c=window.location.href,
d=c.substr(c.indexOf("/",7));if(d.substr(0,8)=="/tracks?"){d=d.substr(8);d=d.split("&");for(var e=0;e<d.length;e++){var f=d[e].split("="),g=f[0];f=f[1];g=="page"?currentPage=f:g=="search"?(currentKeyWord=f,document.getElementById("searchField").value=f):g=="sorting"&&(currentSorting=f)}}b.loadContent(c)}},loadContent:function(b,c){this.parseResponse({responseJSON:{mode:"load"}});if(b==="/about"||b==="/imprint"||b==="/contact")this.parseResponse({responseJSON:{mode:b.substr(1)}},c);else{var d=this;
jQuery.ajax({url:"http://marblerun.at"+b,type:"GET",headers:{Accept:"application/json"},data:{},success:function(b){d.parseResponse.call(d,{responseJSON:b},c)},error:function(b){d.parseResponse.call(d,{responseJSON:b},!1)}})}},parseResponse:function(b,c){this.loadingInterval&&clearInterval(this.loadingInterval);typeof c==="undefined"&&(c=!0);var d=b.responseJSON,e;this.visibleList=[];if(d.mode!="show")this.showroom.tweenMode=!1;this.oldContent&&this.oldContent.quit();switch(d.mode){case "build":this.oldContent=
this.editor;this.createBuildMode(d);e="/tracks/new";break;case "show":this.oldContent=this.showroom;this.createShowMode(d);trackStore.addTrack(d.track);e="/tracks/"+d.track.id;setSwitchMode("none");break;case "overview":this.oldContent=null;this.createOverviewMode(d);e="/tracks?page="+currentPage;currentKeyWord.length>0&&(e+="&search="+currentKeyWord);currentSorting.length>0&&(e+="&sorting="+currentSorting);break;case "about":case "imprint":case "contact":this.oldContent=null;this.visibleList=[d.mode+
"Page"];e="/"+d.mode;break;case "load":this.oldContent=null;c=!1;this.visibleList=["loadingPage"];this.loadingInterval=setInterval(function(){$("loadingPage").toggleClassName("blink")},500);break;case "failure":this.oldContent=null,this.visibleList=["errorPage"],$("errorMessage").update(d.message.toUpperCase())}this.oldMode=d.mode;setToggleElementsVisibility(this.visibleList);c&&this.pushURL(e,b);$("helpBox").setStyle({display:"none"});$("helpButton").removeClassName("active")},createBuildMode:function(){setBuildTweetButton();
setSwitchMode("build");this.editor.init();$("editor").setStyle({height:"560px"});this.visibleList=["editorControlsTop","editorControlsBottom","editorToolboxTop","editorToolboxBottom","staticCanvas","dynamicCanvas","editorRuler"]},createShowMode:function(b){setTrackTweetButton(b.track.id);setSwitchMode("view");this.showroom.parseTrack(b.track);this.showroom.init();$("tableTrack").update(b.track.trackname.toUpperCase());$("tableBuilder").update(b.track.username.toUpperCase());$("tableLength").update(parseInt(b.track.length*
10,10)/10+" METER");$("tableDate").update(b.track.date);$("tableTime").update(b.track.time);$("tableLikes").update(b.track.likes);$("editor").setStyle({height:"520px"});this.visibleList=["showroomControlsTop","showroomControlsBottom","showroomDetail","staticCanvas","dynamicCanvas"]},createOverviewMode:function(b){setSwitchMode("view");currentPage=b.current_page;$("overviewPageDisplay").update(""+b.current_page+" / "+b.total_pages);$("overviewPreviousButton").removeClassName("inactive");$("overviewNextButton").removeClassName("inactive");
b.current_page<=1&&$("overviewPreviousButton").addClassName("inactive");b.current_page>=b.total_pages&&$("overviewNextButton").addClassName("inactive");var c="<ul>",d,e=null,f=null;b.tracks.length==0&&(c='<p class="no-track-warning">No track found</p>');for(d=0;d<b.tracks.length;d++)e=d===b.tracks.length-1?null:b.tracks[d+1].id,trackStore.addTrack(b.tracks[d],e,f),f=b.tracks[d].id,e="<li>",e+='<a onclick="trackStore.loadTrack('+b.tracks[d].id+', contentLoader.parseResponse, contentLoader)"><img src="'+
b.tracks[d].imagedata+'"></a>',e+="<ul>",e+='<li class="trackname">'+b.tracks[d].trackname+"</li>",e+='<li class="username">'+b.tracks[d].username+"</li>",e+='<li class="length">'+Math.round(b.tracks[d].length*10)/10+" Meter | LIKES "+b.tracks[d].likes+"</li>",e+="</ul>",e+="</li>",c+=e;c+="</ul>";$("overviewGrid").update(c);this.visibleList=["overviewControls","overviewGrid"]},pushURL:function(b,c){history&&history.pushState&&history.pushState(c,"",b)},onPopState:function(b){this.parseResponse(b.state,
!1)},setInitialScreen:function(){Cookie.get("isFirstVisit")?($("firstVisitContainer").setStyle({visibility:"hidden"}),$("firstVisitText").setStyle({visibility:"hidden"}),$("firstVisitCloseButton").setStyle({visibility:"hidden"})):($("firstVisitContainer").setStyle({visibility:"visible"}),$("firstVisitText").setStyle({visibility:"visible"}),$("firstVisitCloseButton").setStyle({visibility:"visible"}),$("firstVisitCloseButton").observe("click",function(){$("firstVisitContainer").setStyle({visibility:"hidden"});
$("firstVisitText").setStyle({visibility:"hidden"});$("firstVisitCloseButton").setStyle({visibility:"hidden"})}));Cookie.set("isFirstVisit",!0,{maxAge:5184E3});Cookie.likedTracks=JSON.parse(Cookie.get("likes"))||[];Cookie.flagedTracks=JSON.parse(Cookie.get("flags"))||[]}}),TrackStore=Class.create({initialize:function(){this.tracks={}},addTrack:function(b,c,d){if(this.tracks[b.id]){if(c)this.tracks[b.id].next=c;if(d)this.tracks[b.id].previous=d}else this.tracks[b.id]={track:b,next:c,previous:d}},getTrack:function(b){if(!this.tracks[b])return null;
return this.tracks[b].track},loadTrack:function(b,c,d,e){if(this.tracks[b]&&c)c.call(d,{responseJSON:{mode:"show",track:this.tracks[b].track}},e);else{var f=this;jQuery.ajax({url:"http://marblerun.at/tracks/"+b,type:"GET",headers:{Accept:"application/json"},data:{},success:function(b){f.addTrack.call(f,b.track);c&&c.call(d,{responseJSON:b},e)},error:function(){}})}},loadNext:function(b){if(!this.tracks[b]||!this.tracks[b].next||!this.tracks[this.tracks[b].next]){var c=this;jQuery.ajax({url:"http://marblerun.at/tracks/"+
b+"/next",type:"GET",headers:{Accept:"application/json"},data:{},success:function(d){c.tracks[b].next=d.track.id;c.addTrack.call(c,d.track,null,b)},error:function(){c.tracks[b].next=b}})}},loadPrevious:function(b){if(!this.tracks[b]||!this.tracks[b].previous||!this.tracks[this.tracks[b].previous]){var c=this;jQuery.ajax({url:"http://marblerun.at/tracks/"+b+"/previous",type:"GET",headers:{Accept:"application/json"},data:{},success:function(d){c.tracks[b].previous=d.track.id;c.addTrack.call(c,d.track,
null,b)},error:function(){c.tracks[b].previous=b}})}},hasNext:function(b){return this.tracks[b].next!==null},next:function(b){if(this.hasNext(b))return this.tracks[b].next;return null},hasPrevious:function(b){return this.tracks[b].previous!==null},previous:function(b){if(this.hasPrevious(b))return this.tracks[b].previous;return null}});